require(["gitbook","jquery"],(function(e,t){var n,a,o,r,s,i=e.state,l={},u=void 0!==window.history.pushState,c=t("body");function p(e){return String(e).replace(/([-.*+?^${}()|[\]/\\])/g,"\\$1")}function d(i){if(null!=i&&""!==i.trim()){var u=[],c=-1;for(var d in l){var h=l[d],f=i.toLowerCase(),v=!1;h.keywords&&~h.keywords.split(/\s+/).indexOf(f.split(":").pop())&&(/.:./.test(f)?f=f.split(":").slice(0,-1).join(":"):v=!0);var g=new RegExp("("+p(f)+")","gi");(v||~(c=h.body.toLowerCase().indexOf(f)))&&u.push({url:d,title:h.title,body:h.body.substr(Math.max(0,c-50),500).replace(/^[^\s,.]+./,"").replace(/(..*)[\s,.].*/,"$1").replace(g,'<span class="search-highlight-keyword">$1</span>')})}!function(i){n=t("#book-search-results"),a=n.find(".search-results-list"),o=n.find(".search-results-title"),r=o.find(".search-results-count"),s=o.find(".search-query"),n.addClass("open");var l=0===i.count;n.toggleClass("no-results",l),a.empty(),r.text(i.count),s.text(i.query),i.results.forEach((function(n){var o=t("<li>",{class:"search-results-item"}),r=t("<h3>"),s=t("<a>",{href:e.state.basePath+"/"+n.url+"?h="+encodeURIComponent(i.query),text:n.title,"data-is-search":1});s[0].href.split("?")[0]===window.location.href.split("?")[0]&&s[0].setAttribute("data-need-reload",1);var l=n.body.trim();l.length>500&&(l+="...");var u=t("<p>").html(l);s.appendTo(r),r.appendTo(o),u.appendTo(o),o.appendTo(a)})),t(".body-inner").scrollTop(0)}({count:u.length,query:f,results:u})}}function h(e){var t,n,a;c.addClass("with-search"),c.addClass("search-loading"),(t=function(){d(e),c.removeClass("search-loading")},function(){var e=this,o=arguments;a||(a=setTimeout((function(){a=null,t.apply(e,o)}),n))})()}function f(){c.removeClass("with-search"),t("#book-search-results").removeClass("open")}function v(){var e=t("body");e.on("keyup","#book-search-input input",(function(e){if(13===e.keyCode&&u){var n=y("q",t(this).val());window.history.pushState({path:n},null,n)}var a;0===(a=t("#book-search-input input").val()).length?f():h(a)})),e.on("blur","#book-search-input input",(function(e){if(u){var n=y("q",t(this).val());window.history.pushState({path:n},null,n)}}))}e.events.on("start",(function(){v(),t.getJSON(i.basePath+"/search_plus_index.json").then((function(e){l=e,w(),f()}))}));var g={ignoreJoiners:!0,acrossElements:!0,separateWordSearch:!1};function w(){var e,n;/\b(q|h)=([^&]+)/.test(window.location.search)&&(n=RegExp.$1,e=decodeURIComponent(RegExp.$2),"q"===n?h(e):function(e){var n=t(".page-inner");/(?:(.+)?\:)(.+)/.test(e)&&n.mark(RegExp.$1,g),n.mark(e,g),setTimeout((function(){var e=t('mark[data-markjs="true"]');e.length&&e[0].scrollIntoView()}),100)}(e),t("#book-search-input input").val(e))}function y(e,t){t=encodeURIComponent(t);var n,a=window.location.href.replace(/([?&])(?:q|h)=([^&]+)(&|$)/,(function(e,t,n,a){return"&"===a?t:""})),o=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(o.test(a))return null!=t?a.replace(o,"$1"+e+"="+t+"$2$3"):(n=a.split("#"),a=n[0].replace(o,"$1$3").replace(/(&|\?)$/,""),void 0!==n[1]&&null!==n[1]&&(a+="#"+n[1]),a);if(null!=t){var r=-1!==a.indexOf("?")?"&":"?";return n=a.split("#"),a=n[0]+r+e+"="+t,void 0!==n[1]&&null!==n[1]&&(a+="#"+n[1]),a}return a}e.events.on("page.change",w),window.addEventListener("click",(function(e){"A"===e.target.tagName&&e.target.getAttribute("data-need-reload")&&setTimeout((function(){window.location.reload()}),100)}),!0)}));