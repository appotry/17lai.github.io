(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(require("jquery")):typeof define==="function"&&define.amd?define(["jquery"],t):t(e.$)})(this,function(d){"use strict";d=d&&"default"in d?d["default"]:d;var f;var c=d(window);function l(e){return e[e.length-1]=="%"}function e(){var e=document.createElement("canvas");f=e.getContext("webgl")||e.getContext("experimental-webgl");if(!f){return null}var s={};["OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear"].forEach(function(e){var t=f.getExtension(e);if(t){s[e]=t}});if(!s.OES_texture_float){return null}var t=[];function r(e,t,r){var i="OES_texture_"+e,a=i+"_linear",n=a in s,o=[i];if(n){o.push(a)}return{type:t,arrayType:r,linearSupport:n,extensions:o}}t.push(r("float",f.FLOAT,Float32Array));if(s.OES_texture_half_float){t.push(r("half_float",s.OES_texture_half_float.HALF_FLOAT_OES,null))}var i=f.createTexture();var a=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,a);f.bindTexture(f.TEXTURE_2D,i);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);var n=null;for(var o=0;o<t.length;o++){f.texImage2D(f.TEXTURE_2D,0,f.RGBA,32,32,0,f.RGBA,t[o].type,null);f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,i,0);if(f.checkFramebufferStatus(f.FRAMEBUFFER)===f.FRAMEBUFFER_COMPLETE){n=t[o];break}}return n}function t(t,r){try{return new ImageData(t,r)}catch(e){var i=document.createElement("canvas");return i.getContext("2d").createImageData(t,r)}}function g(t){var e=t.split(" ");if(e.length===1){switch(t){case"center":return["50%","50%"];case"top":return["50%","0"];case"bottom":return["50%","100%"];case"left":return["0","50%"];case"right":return["100%","50%"];default:return[t,"50%"]}}else{return e.map(function(e){switch(t){case"center":return"50%";case"top":case"left":return"0";case"right":case"bottom":return"100%";default:return e}})}}function r(e,t,r){function i(e,t){var r=f.createShader(e);f.shaderSource(r,t);f.compileShader(r);if(!f.getShaderParameter(r,f.COMPILE_STATUS)){throw new Error("compile error: "+f.getShaderInfoLog(r))}return r}var a={};a.id=f.createProgram();f.attachShader(a.id,i(f.VERTEX_SHADER,e));f.attachShader(a.id,i(f.FRAGMENT_SHADER,t));f.linkProgram(a.id);if(!f.getProgramParameter(a.id,f.LINK_STATUS)){throw new Error("link error: "+f.getProgramInfoLog(a.id))}a.uniforms={};a.locations={};f.useProgram(a.id);f.enableVertexAttribArray(0);var n,o,s=/uniform (\w+) (\w+)/g,u=e+t;while((n=s.exec(u))!=null){o=n[2];a.locations[o]=f.getUniformLocation(a.id,o)}return a}function u(e,t){f.activeTexture(f.TEXTURE0+(t||0));f.bindTexture(f.TEXTURE_2D,e)}function a(e){var t=/url\(["']?([^"']*)["']?\)/.exec(e);if(t==null){return null}return t[1]}function n(e){return e.match(/^data:/)}var p=e();var i=t(32,32);d("head").prepend("<style>.jquery-ripples { position: relative; z-index: 0; }</style>");var o=function(e,t){var r=this;this.$el=d(e);this.interactive=t.interactive;this.resolution=t.resolution;this.textureDelta=new Float32Array([1/this.resolution,1/this.resolution]);this.perturbance=t.perturbance;this.dropRadius=t.dropRadius;this.crossOrigin=t.crossOrigin;this.imageUrl=t.imageUrl;var i=document.createElement("canvas");i.width=this.$el.innerWidth();i.height=this.$el.innerHeight();this.canvas=i;this.$canvas=d(i);this.$canvas.css({position:"absolute",left:0,top:0,right:0,bottom:0,zIndex:-1});this.$el.addClass("jquery-ripples").append(i);this.context=f=i.getContext("webgl")||i.getContext("experimental-webgl");p.extensions.forEach(function(e){f.getExtension(e)});this.updateSize=this.updateSize.bind(this);d(window).on("resize",this.updateSize);this.textures=[];this.framebuffers=[];this.bufferWriteIndex=0;this.bufferReadIndex=1;var a=p.arrayType;var n=a?new a(this.resolution*this.resolution*4):null;for(var o=0;o<2;o++){var s=f.createTexture();var u=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,u);f.bindTexture(f.TEXTURE_2D,s);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,p.linearSupport?f.LINEAR:f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,p.linearSupport?f.LINEAR:f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.texImage2D(f.TEXTURE_2D,0,f.RGBA,this.resolution,this.resolution,0,f.RGBA,p.type,n);f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,s,0);this.textures.push(s);this.framebuffers.push(u)}this.quad=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,this.quad);f.bufferData(f.ARRAY_BUFFER,new Float32Array([-1,-1,+1,-1,+1,+1,-1,+1]),f.STATIC_DRAW);this.initShaders();this.initTexture();this.setTransparentTexture();this.loadImage();f.clearColor(0,0,0,0);f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA);this.visible=true;this.running=true;this.inited=true;this.destroyed=false;this.setupPointerEvents();function h(){if(!r.destroyed){r.step();requestAnimationFrame(h)}}requestAnimationFrame(h)};o.DEFAULTS={imageUrl:null,resolution:256,dropRadius:20,perturbance:.03,interactive:true,crossOrigin:""};o.prototype={setupPointerEvents:function(){var r=this;function i(){return r.visible&&r.running&&r.interactive}function a(e,t){if(i()){r.dropAtPointer(e,r.dropRadius*(t?1.5:1),t?.14:.01)}}this.$el.on("mousemove.ripples",function(e){a(e)}).on("touchmove.ripples touchstart.ripples",function(e){var t=e.originalEvent.changedTouches;for(var r=0;r<t.length;r++){a(t[r])}}).on("mousedown.ripples",function(e){a(e,true)})},loadImage:function(){var r=this;f=this.context;var e=this.imageUrl||a(this.originalCssBackgroundImage)||a(this.$el.css("backgroundImage"));if(e==this.imageSource){return}this.imageSource=e;if(!this.imageSource){this.setTransparentTexture();return}var i=new Image;i.onload=function(){f=r.context;function e(e){return(e&e-1)==0}var t=e(i.width)&&e(i.height)?f.REPEAT:f.CLAMP_TO_EDGE;f.bindTexture(f.TEXTURE_2D,r.backgroundTexture);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,t);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,t);f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,i);r.backgroundWidth=i.width;r.backgroundHeight=i.height;r.hideCssBackground()};i.onerror=function(){f=r.context;r.setTransparentTexture()};i.crossOrigin=n(this.imageSource)?null:this.crossOrigin;i.src=this.imageSource},step:function(){f=this.context;if(!this.visible){return}this.computeTextureBoundaries();if(this.running){this.update()}this.render()},drawQuad:function(){f.bindBuffer(f.ARRAY_BUFFER,this.quad);f.vertexAttribPointer(0,2,f.FLOAT,false,0,0);f.drawArrays(f.TRIANGLE_FAN,0,4)},render:function(){f.bindFramebuffer(f.FRAMEBUFFER,null);f.viewport(0,0,this.canvas.width,this.canvas.height);f.enable(f.BLEND);f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT);f.useProgram(this.renderProgram.id);u(this.backgroundTexture,0);u(this.textures[0],1);f.uniform1f(this.renderProgram.locations.perturbance,this.perturbance);f.uniform2fv(this.renderProgram.locations.topLeft,this.renderProgram.uniforms.topLeft);f.uniform2fv(this.renderProgram.locations.bottomRight,this.renderProgram.uniforms.bottomRight);f.uniform2fv(this.renderProgram.locations.containerRatio,this.renderProgram.uniforms.containerRatio);f.uniform1i(this.renderProgram.locations.samplerBackground,0);f.uniform1i(this.renderProgram.locations.samplerRipples,1);this.drawQuad();f.disable(f.BLEND)},update:function(){f.viewport(0,0,this.resolution,this.resolution);f.bindFramebuffer(f.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]);u(this.textures[this.bufferReadIndex]);f.useProgram(this.updateProgram.id);this.drawQuad();this.swapBufferIndices()},swapBufferIndices:function(){this.bufferWriteIndex=1-this.bufferWriteIndex;this.bufferReadIndex=1-this.bufferReadIndex},computeTextureBoundaries:function(){var e=this.$el.css("background-size");var t=this.$el.css("background-attachment");var r=g(this.$el.css("background-position"));var i;if(t=="fixed"){i={left:window.pageXOffset,top:window.pageYOffset};i.width=c.width();i.height=c.height()}else{i=this.$el.offset();i.width=this.$el.innerWidth();i.height=this.$el.innerHeight()}if(e=="cover"){var a=Math.max(i.width/this.backgroundWidth,i.height/this.backgroundHeight);var n=this.backgroundWidth*a;var o=this.backgroundHeight*a}else if(e=="contain"){var a=Math.min(i.width/this.backgroundWidth,i.height/this.backgroundHeight);var n=this.backgroundWidth*a;var o=this.backgroundHeight*a}else{e=e.split(" ");var n=e[0]||"";var o=e[1]||n;if(l(n)){n=i.width*parseFloat(n)/100}else if(n!="auto"){n=parseFloat(n)}if(l(o)){o=i.height*parseFloat(o)/100}else if(o!="auto"){o=parseFloat(o)}if(n=="auto"&&o=="auto"){n=this.backgroundWidth;o=this.backgroundHeight}else{if(n=="auto"){n=this.backgroundWidth*(o/this.backgroundHeight)}if(o=="auto"){o=this.backgroundHeight*(n/this.backgroundWidth)}}}var s=r[0];var u=r[1];if(l(s)){s=i.left+(i.width-n)*parseFloat(s)/100}else{s=i.left+parseFloat(s)}if(l(u)){u=i.top+(i.height-o)*parseFloat(u)/100}else{u=i.top+parseFloat(u)}var h=this.$el.offset();this.renderProgram.uniforms.topLeft=new Float32Array([(h.left-s)/n,(h.top-u)/o]);this.renderProgram.uniforms.bottomRight=new Float32Array([this.renderProgram.uniforms.topLeft[0]+this.$el.innerWidth()/n,this.renderProgram.uniforms.topLeft[1]+this.$el.innerHeight()/o]);var d=Math.max(this.canvas.width,this.canvas.height);this.renderProgram.uniforms.containerRatio=new Float32Array([this.canvas.width/d,this.canvas.height/d])},initShaders:function(){var e=["attribute vec2 vertex;","varying vec2 coord;","void main() {","coord = vertex * 0.5 + 0.5;","gl_Position = vec4(vertex, 0.0, 1.0);","}"].join("\n");this.dropProgram=r(e,["precision highp float;","const float PI = 3.141592653589793;","uniform sampler2D texture;","uniform vec2 center;","uniform float radius;","uniform float strength;","varying vec2 coord;","void main() {","vec4 info = texture2D(texture, coord);","float drop = max(0.0, 1.0 - length(center * 0.5 + 0.5 - coord) / radius);","drop = 0.5 - cos(drop * PI) * 0.5;","info.r += drop * strength;","gl_FragColor = info;","}"].join("\n"));this.updateProgram=r(e,["precision highp float;","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 coord;","void main() {","vec4 info = texture2D(texture, coord);","vec2 dx = vec2(delta.x, 0.0);","vec2 dy = vec2(0.0, delta.y);","float average = (","texture2D(texture, coord - dx).r +","texture2D(texture, coord - dy).r +","texture2D(texture, coord + dx).r +","texture2D(texture, coord + dy).r",") * 0.25;","info.g += (average - info.r) * 2.0;","info.g *= 0.995;","info.r += info.g;","gl_FragColor = info;","}"].join("\n"));f.uniform2fv(this.updateProgram.locations.delta,this.textureDelta);this.renderProgram=r(["precision highp float;","attribute vec2 vertex;","uniform vec2 topLeft;","uniform vec2 bottomRight;","uniform vec2 containerRatio;","varying vec2 ripplesCoord;","varying vec2 backgroundCoord;","void main() {","backgroundCoord = mix(topLeft, bottomRight, vertex * 0.5 + 0.5);","backgroundCoord.y = 1.0 - backgroundCoord.y;","ripplesCoord = vec2(vertex.x, -vertex.y) * containerRatio * 0.5 + 0.5;","gl_Position = vec4(vertex.x, -vertex.y, 0.0, 1.0);","}"].join("\n"),["precision highp float;","uniform sampler2D samplerBackground;","uniform sampler2D samplerRipples;","uniform vec2 delta;","uniform float perturbance;","varying vec2 ripplesCoord;","varying vec2 backgroundCoord;","void main() {","float height = texture2D(samplerRipples, ripplesCoord).r;","float heightX = texture2D(samplerRipples, vec2(ripplesCoord.x + delta.x, ripplesCoord.y)).r;","float heightY = texture2D(samplerRipples, vec2(ripplesCoord.x, ripplesCoord.y + delta.y)).r;","vec3 dx = vec3(delta.x, heightX - height, 0.0);","vec3 dy = vec3(0.0, heightY - height, delta.y);","vec2 offset = -normalize(cross(dy, dx)).xz;","float specular = pow(max(0.0, dot(offset, normalize(vec2(-0.6, 1.0)))), 4.0);","gl_FragColor = texture2D(samplerBackground, backgroundCoord + offset * perturbance) + specular;","}"].join("\n"));f.uniform2fv(this.renderProgram.locations.delta,this.textureDelta)},initTexture:function(){this.backgroundTexture=f.createTexture();f.bindTexture(f.TEXTURE_2D,this.backgroundTexture);f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,1);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR)},setTransparentTexture:function(){f.bindTexture(f.TEXTURE_2D,this.backgroundTexture);f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,i)},hideCssBackground:function(){var e=this.$el[0].style.backgroundImage;if(e=="none"){return}this.originalInlineCss=e;this.originalCssBackgroundImage=this.$el.css("backgroundImage");this.$el.css("backgroundImage","none")},restoreCssBackground:function(){this.$el.css("backgroundImage",this.originalInlineCss||"")},dropAtPointer:function(e,t,r){var i=parseInt(this.$el.css("border-left-width"))||0,a=parseInt(this.$el.css("border-top-width"))||0;this.drop(e.pageX-this.$el.offset().left-i,e.pageY-this.$el.offset().top-a,t,r)},drop:function(e,t,r,i){f=this.context;var a=this.$el.innerWidth();var n=this.$el.innerHeight();var o=Math.max(a,n);r=r/o;var s=new Float32Array([(2*e-a)/o,(n-2*t)/o]);f.viewport(0,0,this.resolution,this.resolution);f.bindFramebuffer(f.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]);u(this.textures[this.bufferReadIndex]);f.useProgram(this.dropProgram.id);f.uniform2fv(this.dropProgram.locations.center,s);f.uniform1f(this.dropProgram.locations.radius,r);f.uniform1f(this.dropProgram.locations.strength,i);this.drawQuad();this.swapBufferIndices()},updateSize:function(){var e=this.$el.innerWidth(),t=this.$el.innerHeight();if(e!=this.canvas.width||t!=this.canvas.height){this.canvas.width=e;this.canvas.height=t}},destroy:function(){this.$el.off(".ripples").removeClass("jquery-ripples").removeData("ripples");f=null;d(window).off("resize",this.updateSize);this.$canvas.remove();this.restoreCssBackground();this.destroyed=true},show:function(){this.visible=true;this.$canvas.show();this.hideCssBackground()},hide:function(){this.visible=false;this.$canvas.hide();this.restoreCssBackground()},pause:function(){this.running=false},play:function(){this.running=true},set:function(e,t){switch(e){case"dropRadius":case"perturbance":case"interactive":case"crossOrigin":this[e]=t;break;case"imageUrl":this.imageUrl=t;this.loadImage();break}}};var s=d.fn.ripples;d.fn.ripples=function(i){if(!p){throw new Error("Your browser does not support WebGL, the OES_texture_float extension or rendering to floating point textures.")}var a=arguments.length>1?Array.prototype.slice.call(arguments,1):undefined;return this.each(function(){var e=d(this),t=e.data("ripples"),r=d.extend({},o.DEFAULTS,e.data(),typeof i=="object"&&i);if(!t&&typeof i=="string"){return}if(!t){e.data("ripples",t=new o(this,r))}else if(typeof i=="string"){o.prototype[i].apply(t,a)}})};d.fn.ripples.Constructor=o;d.fn.ripples.noConflict=function(){d.fn.ripples=s;return this}});