(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?module.exports=t():typeof define==="function"&&define.amd?define(t):(e=typeof globalThis!=="undefined"?globalThis:e||self,e.lgVideo=t())})(this,function(){"use strict";var s=function(){s=Object.assign||function e(t){for(var o,i=1,r=arguments.length;i<r;i++){o=arguments[i];for(var l in o)if(Object.prototype.hasOwnProperty.call(o,l))t[l]=o[l]}return t};return s.apply(this,arguments)};var t={autoplayFirstVideo:true,youTubePlayerParams:false,vimeoPlayerParams:false,wistiaPlayerParams:false,gotoNextSlideOnVideoEnd:true,autoplayVideoOnSlide:false,videojs:false,videojsTheme:"",videojsOptions:{}};var o={afterAppendSlide:"lgAfterAppendSlide",init:"lgInit",hasVideo:"lgHasVideo",containerResize:"lgContainerResize",updateSlides:"lgUpdateSlides",afterAppendSubHtml:"lgAfterAppendSubHtml",beforeOpen:"lgBeforeOpen",afterOpen:"lgAfterOpen",slideItemLoad:"lgSlideItemLoad",beforeSlide:"lgBeforeSlide",afterSlide:"lgAfterSlide",posterClick:"lgPosterClick",dragStart:"lgDragStart",dragMove:"lgDragMove",dragEnd:"lgDragEnd",beforeNextSlide:"lgBeforeNextSlide",beforePrevSlide:"lgBeforePrevSlide",beforeClose:"lgBeforeClose",afterClose:"lgAfterClose",rotateLeft:"lgRotateLeft",rotateRight:"lgRotateRight",flipHorizontal:"lgFlipHorizontal",flipVertical:"lgFlipVertical",autoplay:"lgAutoplay",autoplayStart:"lgAutoplayStart",autoplayStop:"lgAutoplayStop"};var V=function(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")};var n=function(e){var t=e.slice(1).split("&").map(function(e){return e.split("=")}).reduce(function(e,t){var o=t.map(decodeURIComponent),i=o[0],r=o[1];e[i]=r;return e},{});return t};var w=function(e,t){if(!e.youtube)return"";var o=e.youtube[2]?n(e.youtube[2]):"";var i={wmode:"opaque",autoplay:0,mute:1,enablejsapi:1};var r=t||{};var l=s(s(s({},i),r),o);var a="?"+V(l);return a};var S=function(e){return e.includes("youtube-nocookie.com")};var j=function(e,t){if(!t||!t.vimeo)return"";var o=t.vimeo[2]||"";var i=e&&Object.keys(e).length!==0?"&"+V(e):"";var r=t.vimeo[0].split("/").pop()||"";var l=r.split("?")[0]||"";var a=l.split("#")[0];var s=t.vimeo[1]!==a;if(s){o=o.replace("/"+a,"")}o=o[0]=="?"?"&"+o.slice(1):o||"";var n="?autoplay=0&muted=1"+(s?"&h="+a:"")+i+o;return n};var e=function(){function e(e){this.core=e;this.settings=s(s({},t),this.core.settings);return this}e.prototype.init=function(){var t=this;this.core.LGel.on(o.hasVideo+".video",this.onHasVideo.bind(this));this.core.LGel.on(o.posterClick+".video",function(){var e=t.core.getSlideItem(t.core.index);t.loadVideoOnPosterClick(e)});this.core.LGel.on(o.slideItemLoad+".video",this.onSlideItemLoad.bind(this));this.core.LGel.on(o.beforeSlide+".video",this.onBeforeSlide.bind(this));this.core.LGel.on(o.afterSlide+".video",this.onAfterSlide.bind(this))};e.prototype.onSlideItemLoad=function(e){var t=this;var o=e.detail,i=o.isFirstSlide,r=o.index;if(this.settings.autoplayFirstVideo&&i&&r===this.core.index){setTimeout(function(){t.loadAndPlayVideo(r)},200)}if(!i&&this.settings.autoplayVideoOnSlide&&r===this.core.index){this.loadAndPlayVideo(r)}};e.prototype.onHasVideo=function(e){var t=e.detail,o=t.index,i=t.src,r=t.html5Video,l=t.hasPoster;if(!l){this.appendVideos(this.core.getSlideItem(o),{src:i,addClass:"lg-object",index:o,html5Video:r});this.gotoNextSlideOnVideoEnd(i,o)}};e.prototype.onBeforeSlide=function(e){if(this.core.lGalleryOn){var t=e.detail.prevIndex;this.pauseVideo(t)}};e.prototype.onAfterSlide=function(e){var t=this;var o=e.detail,i=o.index,r=o.prevIndex;var l=this.core.getSlideItem(i);if(this.settings.autoplayVideoOnSlide&&i!==r){if(l.hasClass("lg-complete")){setTimeout(function(){t.loadAndPlayVideo(i)},100)}}};e.prototype.loadAndPlayVideo=function(e){var t=this.core.getSlideItem(e);var o=this.core.galleryItems[e];if(o.poster){this.loadVideoOnPosterClick(t,true)}else{this.playVideo(e)}};e.prototype.playVideo=function(e){this.controlVideo(e,"play")};e.prototype.pauseVideo=function(e){this.controlVideo(e,"pause")};e.prototype.getVideoHtml=function(e,t,o,i){var r="";var l=this.core.galleryItems[o].__slideVideoInfo||{};var a=this.core.galleryItems[o];var s=a.title||a.alt;s=s?'title="'+s+'"':"";var n='allowtransparency="true"\n            frameborder="0"\n            scrolling="no"\n            allowfullscreen\n            mozallowfullscreen\n            webkitallowfullscreen\n            oallowfullscreen\n            msallowfullscreen';if(l.youtube){var d="lg-youtube"+o;var c=w(l,this.settings.youTubePlayerParams);var f=S(e);var u=f?"//www.youtube-nocookie.com/":"//www.youtube.com/";r='<iframe allow="autoplay" id='+d+' class="lg-video-object lg-youtube '+t+'" '+s+' src="'+u+"embed/"+(l.youtube[1]+c)+'" '+n+"></iframe>"}else if(l.vimeo){var d="lg-vimeo"+o;var v=j(this.settings.vimeoPlayerParams,l);r='<iframe allow="autoplay" id='+d+' class="lg-video-object lg-vimeo '+t+'" '+s+' src="//player.vimeo.com/video/'+(l.vimeo[1]+v)+'" '+n+"></iframe>"}else if(l.wistia){var g="lg-wistia"+o;var v=V(this.settings.wistiaPlayerParams);v=v?"?"+v:"";r='<iframe allow="autoplay" id="'+g+'" src="//fast.wistia.net/embed/iframe/'+(l.wistia[4]+v)+'" '+s+' class="wistia_embed lg-video-object lg-wistia '+t+'" name="wistia_embed" '+n+"></iframe>"}else if(l.html5){var p="";for(var h=0;h<i.source.length;h++){p+='<source src="'+i.source[h].src+'" type="'+i.source[h].type+'">'}if(i.tracks){var y=function(e){var t="";var o=i.tracks[e];Object.keys(o||{}).forEach(function(e){t+=e+'="'+o[e]+'" '});p+="<track "+t+">"};for(var h=0;h<i.tracks.length;h++){y(h)}}var m="";var b=i.attributes||{};Object.keys(b||{}).forEach(function(e){m+=e+'="'+b[e]+'" '});r='<video class="lg-video-object lg-html5 '+(this.settings.videojs&&this.settings.videojsTheme?this.settings.videojsTheme+" ":"")+" "+(this.settings.videojs?" video-js":"")+'" '+m+">\n                "+p+"\n                Your browser does not support HTML5 video.\n            </video>"}return r};e.prototype.appendVideos=function(e,t){var o;var i=this.getVideoHtml(t.src,t.addClass,t.index,t.html5Video);e.find(".lg-video-cont").append(i);var r=e.find(".lg-video-object").first();if(t.html5Video){r.on("mousedown.lg.video",function(e){e.stopPropagation()})}if(this.settings.videojs&&((o=this.core.galleryItems[t.index].__slideVideoInfo)===null||o===void 0?void 0:o.html5)){try{return videojs(r.get(),this.settings.videojsOptions)}catch(e){console.error("lightGallery:- Make sure you have included videojs")}}};e.prototype.gotoNextSlideOnVideoEnd=function(e,t){var o=this;var i=this.core.getSlideItem(t).find(".lg-video-object").first();var r=this.core.galleryItems[t].__slideVideoInfo||{};if(this.settings.gotoNextSlideOnVideoEnd){if(r.html5){i.on("ended",function(){o.core.goToNextSlide()})}else if(r.vimeo){try{new Vimeo.Player(i.get()).on("ended",function(){o.core.goToNextSlide()})}catch(e){console.error("lightGallery:- Make sure you have included //github.com/vimeo/player.js")}}else if(r.wistia){try{window._wq=window._wq||[];window._wq.push({id:i.attr("id"),onReady:function(e){e.bind("end",function(){o.core.goToNextSlide()})}})}catch(e){console.error("lightGallery:- Make sure you have included //fast.wistia.com/assets/external/E-v1.js")}}}};e.prototype.controlVideo=function(e,t){var o=this.core.getSlideItem(e).find(".lg-video-object").first();var i=this.core.galleryItems[e].__slideVideoInfo||{};if(!o.get())return;if(i.youtube){try{o.get().contentWindow.postMessage('{"event":"command","func":"'+t+'Video","args":""}',"*")}catch(e){console.error("lightGallery:- "+e)}}else if(i.vimeo){try{new Vimeo.Player(o.get())[t]()}catch(e){console.error("lightGallery:- Make sure you have included //github.com/vimeo/player.js")}}else if(i.html5){if(this.settings.videojs){try{videojs(o.get())[t]()}catch(e){console.error("lightGallery:- Make sure you have included videojs")}}else{o.get()[t]()}}else if(i.wistia){try{window._wq=window._wq||[];window._wq.push({id:o.attr("id"),onReady:function(e){e[t]()}})}catch(e){console.error("lightGallery:- Make sure you have included //fast.wistia.com/assets/external/E-v1.js")}}};e.prototype.loadVideoOnPosterClick=function(e,t){var o=this;if(!e.hasClass("lg-video-loaded")){if(!e.hasClass("lg-has-video")){e.addClass("lg-has-video");var i=void 0;var r=this.core.galleryItems[this.core.index].src;var l=this.core.galleryItems[this.core.index].video;if(l){i=typeof l==="string"?JSON.parse(l):l}var a=this.appendVideos(e,{src:r,addClass:"",index:this.core.index,html5Video:i});this.gotoNextSlideOnVideoEnd(r,this.core.index);var s=e.find(".lg-object").first().get();e.find(".lg-video-cont").first().append(s);e.addClass("lg-video-loading");a&&a.ready(function(){a.on("loadedmetadata",function(){o.onVideoLoadAfterPosterClick(e,o.core.index)})});e.find(".lg-video-object").first().on("load.lg error.lg loadedmetadata.lg",function(){setTimeout(function(){o.onVideoLoadAfterPosterClick(e,o.core.index)},50)})}else{this.playVideo(this.core.index)}}else if(t){this.playVideo(this.core.index)}};e.prototype.onVideoLoadAfterPosterClick=function(e,t){e.addClass("lg-video-loaded");this.playVideo(t)};e.prototype.destroy=function(){this.core.LGel.off(".lg.video");this.core.LGel.off(".video")};return e}();return e});