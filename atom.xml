<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>夜法之书</title>
  
  <subtitle>深度思考，深入生活！文章持续滚动更新！</subtitle>
  <link href="https://blog.17lai.site/atom.xml" rel="self"/>
  
  <link href="https://blog.17lai.site/"/>
  <updated>2022-03-16T11:59:42.157Z</updated>
  <id>https://blog.17lai.site/</id>
  
  <author>
    <name>夜法之书</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>node 项目从构建到使用 jenkins + docker + nginx + mysql + redis 自动化部署</title>
    <link href="https://blog.17lai.site/posts/68d3867d/"/>
    <id>https://blog.17lai.site/posts/68d3867d/</id>
    <published>2022-03-16T10:04:02.000Z</published>
    <updated>2022-03-16T11:59:42.157Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1>概述</h1><p>这都2019年末了，你还不会 docker吗？ 你 low 爆了，我们作为一枚前端，不能说是要精通使用 docker 完成各种事情，但我觉得必须要学会使用 docker 干下面几件事：</p><ol><li>部署前端应用</li><li>部署nginx</li><li>使用docker-compose部署</li><li>在容器之间建立联系</li></ol><p>Docker 可理解为跑在宿主机上的非常精简、小巧、高度浓缩的虚拟机。 它可以将容器里的进程安稳的在宿主机上运行，之前我也有写过一些关于docker的文章，在这我就不做过多的介绍了，如有需要请自行查看我之前的文章即可，接下来我们通过项目来了解并使用 docker</p><h1>Egg.js ？</h1><p>在这里我使用 <code>egg.js</code> 来为大家实操一下项目的部署流程。有人会问 <code>egg.js</code> 是什么？ 我只能回答这是一款专业级的 <code>node</code> 框架。作为一个有梦想的前端，我们有必要去学习一种后端语言，而作为前端 <code>node</code> 的学习成本相对来说比较低的。 <code>egg.js</code> 这个框架在 node 现有框架中也是比较优秀的，如有需要，大家可以自行学习，我们今天的学习主要还是项目的部署流程，在这我就不给大家做过多的介绍。如有需要，请查阅 <a href="https://link.juejin.cn?target=https%3A%2F%2Feggjs.org%2Fzh-cn%2Fintro%2Findex.html" title="https://eggjs.org/zh-cn/intro/index.html">官方文档</a></p><h1>开始前的准备</h1><blockquote><p>docker 与 docker-compose 的安装我就不给大家介绍了。在之前的文章中是有的，也比较详细，作为一位开发人员，我认为这点事情难不倒大家</p></blockquote><h2 id="初始化项目">初始化项目</h2><pre class="line-numbers language-none"><code class="language-none">$ mkdir egg-example &amp;&amp; cd egg-example$ npm init egg --type=simple$ npm i复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="创建需要的文件">创建需要的文件</h2><p>我们需要在项目根目录创建我们所需要的文件</p><pre class="line-numbers language-none"><code class="language-none">$ touch Dockerfile$ touch docker-compose.yml$ setup.sh复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="目录结构-2">目录结构</h2><pre class="line-numbers language-none"><code class="language-none">egg-project├── package.json├── setup.sh (新建)├── Dockerfile (新建)├── docker-compose.yml (新建)├── app|   ├── router.js│   ├── controller│   |   └── home.js│   ├── service (可选)│   |   └── user.js│   ├── middleware (可选)│   |   └── response_time.js│   ├── schedule (可选)│   |   └── my_task.js...复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="常用指令">常用指令</h2><p>在开始之前我们要学习下常用的一些指令，看下方：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110127.webp" alt=""></p><h1>了解流程</h1><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110133.webp" alt=""></p><h1>安装 jenkins</h1><p>在安装jenkins我选择了使用docker-compose<br>docker-compose 是一个用来把 docker 自动化的东西<br>有了 docker-compose 你可以把所有繁复的 docker 操作全都一条命令，自动化的完成。</p><h2 id="首先我们需要在服务器上创建一个目录机构-具体结构个人自行创建">首先我们需要在服务器上创建一个目录机构 (具体结构个人自行创建)</h2><pre class="line-numbers language-none"><code class="language-none">/home/jenkins     - docker-compose.yml     - jenkins-home复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="接下来我们来编写-docker-compose-yml-安装jenkins">接下来我们来编写 docker-compose.yml 安装jenkins</h2><pre class="line-numbers language-none"><code class="language-none">version: '3'                                    # 指定 docker-compose.yml 文件的写法格式services:                                       # 多个容器集合  docker_jenkins:     user: root                                  # 为了避免一些权限问题 在这我使用了root    restart: always                             # 重启方式    image: jenkins/jenkins:lts                  # 指定服务所使用的镜像 在这里我选择了 LTS (长期支持)    container_name: jenkins                     # 容器名称    ports:                                      # 对外暴露的端口定义      - '8080:8080'      - '50000:50000'    volumes:                                    # 卷挂载路径      - /home/jenkins/jenkins_home/:/var/jenkins_home   # 这是我们一开始创建的目录挂载到容器内的jenkins_home目录      - /var/run/docker.sock:/var/run/docker.sock      - /usr/bin/docker:/usr/bin/docker                 # 这是为了我们可以在容器内使用docker命令      - /usr/local/bin/docker-compose:/usr/local/bin/docker-compose     # 同样的这是为了使用docker-compose命令复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们需要进入到 jenkins 目录下执行：</p><pre class="line-numbers language-none"><code class="language-none">$ docker-compose up -d复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="配置-2">配置</h2><p>不出意外你现在可以打开你的服务器地址 <a href="https://link.juejin.cn?target=http%3A%2F%2Fxxxxxxx" title="http://xxxxxxx">http://xxxxxxx</a>:端口号 就能看到这个界面：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110139.webp" alt=""></p><p>打开你所创建的jenkins目录进入到jenkins-home<br>/home/jenkins/jenkins-home</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110148.webp" alt=""></p><p>进入 secrets 目录</p><pre class="line-numbers language-none"><code class="language-none">$ cat initialAdminPassword复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110209.webp" alt=""></p><p>然后把里面的文本复制出来填到管理员密码中</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110327.webp" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110215.webp" alt=""></p><p>接下来需要安装两个插件</p><pre class="line-numbers language-none"><code class="language-none">NodeJS PluginPublish Over SSH复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110334.webp" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110221.webp" alt=""></p><p>然后我们滑到最下方</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110228.webp" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110341.webp" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110347.webp" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110235.webp" alt=""></p><h1>开始我们的操作</h1><h2 id="Dockerfile">Dockerfile</h2><p>我们在开始阶段的时候学过一些常用指令，大家应该一眼就可以看得懂这些命令。 加油！！</p><pre class="line-numbers language-none"><code class="language-none">FROM node:10.0-alpine             # 镜像版本# 设置时区RUN apk --update add tzdata \    &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \    &amp;&amp; echo "Asia/Shanghai" &gt; /etc/timezone \    &amp;&amp; apk del tzdata# 创建app目录RUN mkdir -p /usr/src/node-app/egg-santak# 设置工作目录WORKDIR /usr/src/node-app/egg-santak# 拷贝package.json文件到工作目录# !!重要：package.json需要单独添加。# Docker在构建镜像的时候，是一层一层构建的，仅当这一层有变化时，重新构建对应的层。# 如果package.json和源代码一起添加到镜像，则每次修改源码都需要重新安装npm模块，这样木有必要。# 所以，正确的顺序是: 添加package.json；安装npm模块；添加源代码。COPY package.json /usr/src/node-app/egg-santak/package.json# 安装npm依赖(使用淘宝的镜像源)# 如果使用的境外服务器，无需使用淘宝的镜像源，即改为`RUN npm i`。RUN npm i --registry=https://registry.npm.taobao.org# 拷贝所有源代码到工作目录COPY . /usr/src/node-app/egg-santak# 暴露容器端口EXPOSE 7001# 启动node应用CMD npm start复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="在服务器中创建我们所需要挂载的数据卷">在服务器中创建我们所需要挂载的数据卷</h2><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110241.webp" alt=""></p><pre class="line-numbers language-none"><code class="language-none"># nginx$ mkdir -p nginx/conf.d nginx/logs# mysql$ mkdir mysql# redis$ mkdir redis复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后进入 <code>nginx/conf.d</code> 文件夹中 创建一个后缀为 <code>conf</code> 的文件</p><pre class="line-numbers language-none"><code class="language-none">$ cd nginx/conf.d$ touch default.conf$ vim default.conf复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>写入以下内容：</p><pre class="line-numbers language-none"><code class="language-none">server {  listen 80;  listen [::]:80;  server_tokens off;  root /var/www/html;  index index.html index.htm;  # 修改为自己的域名  server_name api.lovelp.xin;  # 访问 / 路径时执行反向代理  location / {    # 这里 nodejs 是 node 容器名    proxy_pass http://nodejs:7001;    proxy_set_header X-Real-IP $remote_addr;    proxy_set_header Host $host;    # 后端的Web服务器可以通过 X-Forwarded-For 获取用户真实 IP    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;    # 允许客户端请求的最大单文件字节数    client_max_body_size 15M;    # 缓冲区代理缓冲用户端请求的最大字节数    client_body_buffer_size 128k;  }}复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="docker-compose-yml">docker-compose.yml</h2><pre class="line-numbers language-none"><code class="language-none">version: '3'services:  santak_redis:    image: redis:3                  # 指定服务镜像    container_name: santak_redis    # 容器名称    restart: always                 # 重启方式    hostname: redis    command: redis-server /usr/local/etc/redis/redis.conf --requirepass 123456  --appendonly yes    volumes:                        # 挂载数据卷      - /root/redis/redis.conf:/usr/local/etc/redis/redis.conf    ports:                          # 映射端口      - "6379:6379"         networks:                       # 加入指定网络      - app-network  santak_nginx:    image: nginx:stable-alpine      # 指定服务镜像    container_name: santak_nginx    # 容器名称    restart: always                 # 重启方式    ports:                          # 映射端口      - "80:80"    volumes:                        # 挂载数据卷      - /etc/localtime:/etc/localtime      - /root/nginx/conf.d:/etc/nginx/conf.d      - /root/nginx/logs:/var/log/nginx    depends_on:                     # 启动顺序      - nodejs    networks:                       # 加入指定网络      - app-network  santak_mysql:    image: mysql:5.7    container_name: santak_mysql    restart: always    ports:                          # 映射端口      - "3306:3306"    environment:      - MYSQL_ROOT_PASSWORD=root      - MYSQL_USER=lovelp           # 创建lovelp用户      - MYSQL_PASSWORD=mm123321     # 设置lovelp用户的密码      - MYSQL_DATABASE=santak       # 创建初始数据库      - TZ=Asia/Shanghai            # 设置时区    volumes:                        # 挂载数据卷      - /root/mysql:/var/lib/mysql  # 为了数据持久化    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci    networks:                       # 加入指定网络      - app-network   nodejs:    build:                          # 这里指的是我们刚刚撸的 Dockerfile 文件      context: .                          dockerfile: Dockerfile    image: nodejs                   # 镜像名称    container_name: nodejs          # 容器名称    restart: always                 # 重启方式    depends_on:                     # 启动顺序      - santak_redis      - santak_mysql    links:                          # 容器连接      - santak_redis:santak_redis      - santak_mysql:santak_mysql    networks:                       # 加入指定网络      - app-networkvolumes:  certbot-etc:  certbot-var:networks:  # 实现通信  app-network:    driver: bridge复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="在项目中的使用">在项目中的使用</h2><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110359.webp" alt=""></p><h2 id="setup-sh"><a target="_blank" rel="noopener" href="http://setup.sh">setup.sh</a></h2><pre class="line-numbers language-none"><code class="language-none">#!/usr/bin/env bash#image_version=`date +%Y%m%d%H%M`;# 关闭容器docker-compose stop || true;# 删除容器docker-compose down || true;# 构建镜像docker-compose build;# 启动并后台运行docker-compose up -d;# 查看日志docker logs nodejs;# 对空间进行自动清理docker system prune -a -f复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1>jenkins 创建项目</h1><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110247.webp" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110248.webp" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110254.webp" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110409.webp" alt=""></p><p>最后我们就可以愉快的 <code>Build Now</code> 了</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110415.webp" alt=""></p><p>在这里我选择的是手动构建。其实jenkins有很多可配置项，比如自动化构建啥的，兴趣使然，大家自行摸索，谢谢大家</p><h2 id="整理转载">整理转载:</h2><ul><li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904006184091662">掘金</a></li></ul><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="web" scheme="https://blog.17lai.site/categories/web/"/>
    
    
    <category term="web" scheme="https://blog.17lai.site/tags/web/"/>
    
    <category term="docker" scheme="https://blog.17lai.site/tags/docker/"/>
    
    <category term="CI/CD" scheme="https://blog.17lai.site/tags/CI-CD/"/>
    
    <category term="node" scheme="https://blog.17lai.site/tags/node/"/>
    
    <category term="jenkins" scheme="https://blog.17lai.site/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>音乐推荐-曾经我也想过一了百了</title>
    <link href="https://blog.17lai.site/posts/8b7d3a9a/"/>
    <id>https://blog.17lai.site/posts/8b7d3a9a/</id>
    <published>2022-03-14T15:37:19.000Z</published>
    <updated>2022-03-16T10:52:12.650Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="现场MV-2">现场MV</h2><style>.bbplayer{width: 100%; max-width: 850px; margin: auto}</style><div class="bbplayer"><iframe class="bbplayer" id="mmedia-OLoKkcYdmcAzJJLX" src="https://player.bilibili.com/player.html?bvid=BV1b64y1d7pw&amp;page=1&amp;high_quality=1&amp;danmaku=true" allowfullscreen="allowfullscreen" scrolling="no" border="0" frameborder="0" framespacing="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts allow-popups"></iframe></div><script> document.getElementById("mmedia-OLoKkcYdmcAzJJLX").style.height=document.getElementById("mmedia-OLoKkcYdmcAzJJLX").scrollWidth*0.76+"px";    window.onresize = function(){      document.getElementById("mmedia-OLoKkcYdmcAzJJLX").style.height=document.getElementById("mmedia-OLoKkcYdmcAzJJLX").scrollWidth*0.76+"px";    }; </script><h2 id="背景介绍">背景介绍</h2><p>《曾经我也想过一了百了》是日本歌手中岛美嘉演唱的歌曲，由秋田弘填词和谱曲、出羽良彰编曲，于2013年8月28日发行，收录在中岛美嘉个人专辑《TOUGH 为爱勇敢》中。该歌曲勾勒出向死而生、努力活着的人，让人感到温暖和希望，让因为压力迷茫无助而有轻生想法的人，开始积极拥抱生活。 《曾经我也想过一了百了》由日本摇滚乐队amazarashi的主唱秋田弘创作，创作理念为“为了描写浓烈的希望，必须先描写深层的黑暗”。2010年，迎来出道十周年的中岛美嘉宣布自己因耳咽管开放症暂停一切音乐活动。在疾病的影响下，歌唱对她而言变得无比艰难。2011年，她携单曲《Dear》复出，但复出后始终经历着状态的起伏和媒体的质疑。 中岛美嘉起先向amazarashi提出合作请求，希望乐队能为自己创作一首节奏明快的歌曲，但随后秋田弘向她播放了乐队一首未发行的样本歌曲，并认为该曲很适合由她来演唱。收到该曲时，中岛美嘉起先感到十分惊讶，但听到最后泪流不止，感到自己的心变得柔和，便立即要求演唱该曲。录制过程中，中岛美嘉将自己的心声融入到了该曲中，希望能将力量传达给低迷苦闷的听众。</p><pre class="line-numbers language-lrc" data-language="lrc"><code class="language-lrc">[00:00.10]僕が死のうと思ったのは (曾经我也想过一了百了) - 中島美嘉 (なかしま みか)[00:00.20]词：秋田ひろむ[00:00.30]曲：秋田ひろむ[00:00.40]编曲：出羽良彰[00:27.95]僕が死のうと思ったのは[00:33.83]ウミネコが桟橋で鳴いたから[00:39.20]波の随意に浮かんで消える[00:45.33]過去も啄ばんで飛んでいけ[00:50.70]僕が死のうと思ったのは[00:56.52]誕生日に杏の花が咲いたから[01:02.22]その木漏れ日でうたた寝したら[01:08.09]虫の死骸と土になれるかな[01:14.09]薄荷飴 漁港の灯台[01:17.05]錆びたアーチ橋 捨てた自転車[01:19.74]木造の駅のストーブの前で[01:22.74]どこにも旅立てない心[01:25.61]今日はまるで昨日みたいだ[01:28.30]明日を変えるなら今日を変えなきゃ[01:31.56]分かってる 分かってる けれど[01:39.71]僕が死のうと思ったのは[01:44.89]心が空っぽになったから[01:50.71]満たされないと泣いているのは[01:56.39]きっと満たされたいと願うから[02:25.49]僕が死のうと思ったのは[02:30.69]靴紐が解けたから[02:36.57]結びなおすのは苦手なんだよ[02:42.25]人との繋がりもまた然り[02:47.90]僕が死のうと思ったのは[02:53.65]少年が僕を見つめていたから[02:59.30]ベッドの上で土下座してるよ[03:05.12]あの日の僕にごめんなさいと[03:11.43]パソコンの薄明かり[03:14.05]上階の部屋の生活音[03:16.80]インターフォンのチャイムの音[03:19.80]耳を塞ぐ鳥かごの少年[03:22.87]見えない敵と戦ってる[03:25.43]六畳一間のドンキホーテ[03:28.30]ゴールはどうせ醜いものさ[03:36.74]僕が死のうと思ったのは[03:42.05]冷たい人と言われたから[03:47.94]愛されたいと泣いているのは[03:53.63]人の温もりを知ってしまったから[04:22.79]僕が死のうと思ったのは[04:27.91]あなたが綺麗に笑うから[04:33.49]死ぬことばかり考えてしまうのは[04:39.62]きっと生きる事に真面目すぎるから[04:45.43]僕が死のうと思ったのは[04:50.70]まだあなたに出会ってなかったから[04:56.51]あなたのような人が生まれた[05:02.09]世界を少し好きになったよ[05:07.96]あなたのような人が生きてる[05:13.65]世界に少し期待するよ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="中文翻唱">中文翻唱</h2>        <div id="aplayer-bVDSpKFM" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;"></div>  <script>  var options = {"narrow":false,"autoplay":false,"showlrc":3,"mode":"random","mutex":true,"theme":"#e6d0b2","preload":"metadata","listmaxheight":"513px","music":[{"title":"曾经我也想过一了百了","author":"一么","url":"https://cdn.17lai.site/media/music/僕が死のうと思ったのは/曾经我也想过一了百了-一么.mp3","pic":"https://cdn.17lai.site/media/music/僕が死のうと思ったのは/僕が死のうと思ったのは.jpg","lrc":"https://cdn.17lai.site/media/music/僕が死のうと思ったのは/曾经我也想过一了百了-一么.lrc"},{"title":"僕が死のうと思ったのは","author":"中岛美嘉","url":"https://cdn.17lai.site/media/music/僕が死のうと思ったのは/01%20僕が死のうと思ったのは.mp3","pic":"https://cdn.17lai.site/media/music/僕が死のうと思ったのは/僕が死のうと思ったのは.jpg","lrc":"https://cdn.17lai.site/media/music/僕が死のうと思ったのは/01%20僕が死のうと思ったのは.lrc"}]};  options.element = document.getElementById("aplayer-bVDSpKFM");  var ap = new APlayer(options);    window.aplayers || (window.aplayers = []);  window.aplayers.push(ap);  </script><pre class="line-numbers language-none"><code class="language-none">[00:02.09]作曲 : 秋田 ひろむ[00:02.64]曾经我也想过一了百了[00:03.21]原唱：中岛美嘉[00:04.46] [00:29.85]曾经我 也想过 一了百了[00:34.79]因为看见蜷缩的猫[00:37.40]在码头望着远方[00:40.40]海浪拍打在岸上[00:43.44]一阵又一阵侵踏[00:46.22]希望那些过往都消失[00:49.38]不再回望[00:52.43]曾经我 也想过[00:54.82]一了百了[00:57.46]是因为生日的那天[01:00.10]杏花 又开放[01:03.75]阳光灿烂树荫下[01:06.41]落花已沉睡安详[01:09.84]是否我也 能化作尘土[01:12.16]不再流浪[01:15.76]仍放抽屉里过期的糖[01:18.28]迷路的单车被留在回家路上[01:21.27]还有海边抛弃的避风港[01:23.88]全都提醒 我和他们一样[01:26.75]昨天和今天的画面不断浮现[01:29.74]明天 渴望能不能有[01:31.54]新的改变[01:32.90]不能沮丧 我知道啊[01:35.55]可是啊[01:40.88]曾经我 也想过 一了百了[01:46.24]身边一切都像在问我[01:49.19]过得好不好[01:52.28]泪不能停止的流[01:55.05]流进心底的荒漠[01:58.28]这颗心中的模样[02:00.17]早空如一具躯壳[02:26.84]曾经我 也想过 一了百了[02:32.71]因为我的存在[02:34.23]总让别人失望[02:37.98]不曾拥有就不怕[02:40.80]关于人与人的伤[02:44.18]这么简单的道理[02:45.96]我也只会搞砸[02:49.80]曾经我 也想过 一了百了[02:55.49]是因为墙上[02:56.52]那张骄傲的自画像[03:00.96]无力反驳地跪下[03:03.66]只说的出一句话[03:06.99]生而为人的我[03:08.61]真的对不起呀[03:12.75]房间里闪烁着荧幕微光[03:15.56]伴随着屋外夜色的声音嘈杂[03:18.43]电话那头传来窒息的话[03:21.28]刺痛在笼中[03:22.44]备受折磨的时间啊[03:24.25]黑暗中我装备[03:25.58]唐吉轲德的毅力[03:26.89]对抗看不见的敌人[03:28.38]摧毁我的决心[03:29.85]不要害怕我知道啊可是啊[03:38.04]曾经我也想过一了百了[03:44.29]为何人们都说我无可救药[03:49.69]不强求能明白我[03:52.60]不奢望时间倒流[03:55.70]因为很久很久以前我曾爱过[04:00.86]曾经我 也想过 一了百了[04:06.89]是因为我该那样[04:08.43]灿烂那样美好[04:12.49]一味消极着过去[04:14.95]离去的念头缠绕[04:17.29]闭上眼能感受到[04:20.04]更好的明天来到[04:24.35]茫茫人海中的你[04:27.01]泪光中微笑的你[04:30.26]在我耳边温柔唱起这首歌曲<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>PS: 数据丢失了一回，折腾了很长时间才重新补回来。</p><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="music" scheme="https://blog.17lai.site/categories/music/"/>
    
    
    <category term="music" scheme="https://blog.17lai.site/tags/music/"/>
    
    <category term="中岛美嘉" scheme="https://blog.17lai.site/tags/%E4%B8%AD%E5%B2%9B%E7%BE%8E%E5%98%89/"/>
    
  </entry>
  
  <entry>
    <title>私人在线音乐服务器搭建与使用介绍</title>
    <link href="https://blog.17lai.site/posts/2b9325d0/"/>
    <id>https://blog.17lai.site/posts/2b9325d0/</id>
    <published>2021-11-07T01:25:00.000Z</published>
    <updated>2022-03-16T12:29:02.095Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p><strong>多种音乐播放实现方式</strong></p><ol><li>页面内插入音乐列表。Aplayer实现</li><li>单独页面音乐列表。Aplayer实现</li><li>音乐Docker。在线云音乐</li></ol><blockquote><ul><li>原作者DMCA原因不再维护，如果你想自己部署，需要修改原作者docker内部代码。</li></ul></blockquote><ol><li>音乐Docker <a target="_blank" rel="noopener" href="https://github.com/linuxserver/docker-mstream">Mstream docker</a>。</li><li>音乐Docker <a target="_blank" rel="noopener" href="https://hub.docker.com/r/apnar/logitech-media-server">Logitech Media Server</a>。<a target="_blank" rel="noopener" href="https://github.com/Logitech/slimserver">Github</a></li></ol><blockquote><ul><li>多用户音乐分享、播放，在线，分类等功能。</li></ul></blockquote></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0720211107003631.jpg" alt="img"></p><h2 id="Aplayer-在线音乐">Aplayer 在线音乐</h2><blockquote><p>博文页面内插入音乐列表</p></blockquote><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><div id="mmedia-LVZgRfTZgRqZkzJm"></div><script> var LVZgRfTZgRqZkzJm_options = JSON.parse('{\"lrcType\":3,\"volume\":0.66,\"audio\":[{\"name\":\"Hotel California\",\"artist\":\"Camille and Kennerly\",\"url\":\"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.mp3\",\"lrc\":\"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.lrc\",\"cover\":\"https://cdn.17lai.site/media/music/Hotel%20California/Hotel%20California.webp\"}]}'); LVZgRfTZgRqZkzJm_options.container = document.getElementById("mmedia-LVZgRfTZgRqZkzJm"); const ap_LVZgRfTZgRqZkzJm = new APlayer(LVZgRfTZgRqZkzJm_options); </script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><div id="mmedia-NYRtYdlYgANUYcOp"></div><script> var NYRtYdlYgANUYcOp_options = JSON.parse('{\"lrcType\":3,\"volume\":0.8,\"autoplay\":false,\"audio\":[{\"name\":\"Hotel California\",\"artist\":\"Camille and Kennerly\",\"url\":\"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.mp3\",\"cover\":\"https://cdn.17lai.site/media/music/Hotel%20California/Hotel%20California.webp\",\"lrc\":\"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.lrc\",\"theme\":\"#ebd0c2\"},{\"name\":\"Sold Out\",\"artist\":\"Diamonds\",\"url\":\"https://cdn.17lai.site/media/music/Diamonds/05%20Sold%20Out.flac\",\"cover\":\"https://cdn.17lai.site/media/music/Diamonds/Diamonds.jpg\",\"theme\":\"#ebd0c2\"},{\"name\":\"The Final Bell\",\"artist\":\"Rocky_ Original Motion Picture Score\",\"url\":\"https://cdn.17lai.site/media/music/Rocky_%20Original%20Motion%20Picture%20Score/12%20Bill%20Conti%20-%20The%20Final%20Bell.mp3\",\"cover\":\"https://cdn.17lai.site/media/music/Rocky_%20Original%20Motion%20Picture%20Score/Rocky_%20Original%20Motion%20Picture%20Score.jpg\",\"theme\":\"#ebd0c2\"},{\"name\":\" Croatian Rhapsody\",\"artist\":\"The Piano Player\",\"url\":\"https://cdn.17lai.site/media/music/The%20Piano%20Player/11%20Croatian%20Rhapsody.mp3\",\"cover\":\"https://cdn.17lai.site/media/music/The%20Piano%20Player/The%20Piano%20Player.jpg\",\"theme\":\"#ebd0c2\"}]}'); NYRtYdlYgANUYcOp_options.container = document.getElementById("mmedia-NYRtYdlYgANUYcOp"); const ap_NYRtYdlYgANUYcOp = new APlayer(NYRtYdlYgANUYcOp_options); </script><h2 id="单独Aplayer音乐页面">单独Aplayer音乐页面</h2><blockquote><p><strong>直接戳这里 -&gt;</strong> <a href="https://blog.17lai.site/musics/">Musics</a></p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0720211107002935.jpg" alt="img"></p><h2 id="在线云音乐">在线云音乐</h2><p>私人云音乐</p><div class="admonition note"><p class="admonition-title">研究学习使用</p><p>不对外公开发布，研究学习用。</p></div><p>用户名密码base64编码</p><pre class="line-numbers language-base64" data-language="base64"><code class="language-base64">55So5oi35ZCN5a+G56CB6YO95pivMTdsYWk=<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>base64解密: <a target="_blank" rel="noopener" href="http://encode.chahuo.com/">在线加密解密</a></p><p><a target="_blank" rel="noopener" href="https://musicplayer.17lai.site/"><strong>入口</strong></a></p><blockquote><ul><li>公开在线云音乐服务网页版。</li><li>可以与网易云音乐UID同步！</li><li><a target="_blank" rel="noopener" href="https://hub.docker.com/r/oldiy/music-player-docker">DockerHub</a></li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/0920211009174442.png" alt="在线云音乐入口"></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1220211012022352.png" alt="播放界面"></p><p>与网易云同步</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/0920211009174557.png" alt=""></p><p>网易云UID在登陆 <a target="_blank" rel="noopener" href="https://music.163.com/">https://music.163.com/</a> 后 点击右上角图标的我的主页 <a target="_blank" rel="noopener" href="https://music.163.com/#/user/home?id=617xxxxx0">https://music.163.com/#/user/home?id=617xxxxx0</a></p><p>home?id= 后面的数字就是你的UID。登录后，可以同步个人列表！</p><h2 id="私人音乐服务器">私人音乐服务器</h2><p><a target="_blank" rel="noopener" href="https://music.17lai.site/"><strong>入口</strong></a></p><blockquote><ul><li>所有音乐作者，专辑，演唱者元数据刮削。</li><li>rclone挂载webdav网盘存储音乐文件。</li><li>cloudflare parterner加速。</li><li>私人使用，不对外公开。</li></ul></blockquote><h2 id="在线音乐播放">在线音乐播放</h2><blockquote><ul><li>SelfHost 支持。Docker 部署！</li><li>Github: <a target="_blank" rel="noopener" href="https://github.com/linuxserver/docker-mstream">Mstream docker</a>。</li><li>浏览器界面支持。</li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/0620211006015739.png" alt="私人音乐服务"></p><h3 id="支持DJ模式">支持DJ模式</h3><blockquote><ul><li>在音乐库中随机选择音乐播放。</li><li>选择症患者救星。</li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/0620211006020713.png" alt="DJ模式"></p><h3 id="Android支持">Android支持</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/0620211006020403.png" alt="Android支持"></p><h3 id="其它特性">其它特性</h3><blockquote><ul><li>转码支持</li><li>遥控器支持</li><li>播放列表</li><li>等等</li></ul></blockquote><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="music" scheme="https://blog.17lai.site/categories/music/"/>
    
    
    <category term="docker" scheme="https://blog.17lai.site/tags/docker/"/>
    
    <category term="music" scheme="https://blog.17lai.site/tags/music/"/>
    
    <category term="mstream" scheme="https://blog.17lai.site/tags/mstream/"/>
    
    <category term="selfhost" scheme="https://blog.17lai.site/tags/selfhost/"/>
    
  </entry>
  
  <entry>
    <title>自己动手制作电子书的最佳方式（支持PDF、ePub、mobi等格式）</title>
    <link href="https://blog.17lai.site/posts/d6bad1e5/"/>
    <id>https://blog.17lai.site/posts/d6bad1e5/</id>
    <published>2021-11-02T01:25:00.000Z</published>
    <updated>2022-03-16T10:52:12.514Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="前言-3">前言</h2><p>对于经常阅读的人来说，制作本地电子书，算是刚需了。网上的很多教程都不太好用，所以我特地整理出一个详细的教程。亲测有效，一劳永逸。</p><p>当你意外发现某个宝藏公众号时，想要集中阅读上面的每一篇文章，恨不得一口气看完，你会怎么做呢？你可能会把它添加到“微信读书”App 的书架上：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223600.jpeg" alt="img"></p><p>但上面这种曲线救国的方式并非最佳，仍然不尽人意，存在不少问题。</p><p>我知道，现在有很多的第三方服务，可以将任意公众号的文章制作成电子书，我试过很多次，但都是付费的。一听说要钱，你又不干了：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223603.jpeg" alt="img"></p><p>再列举一种场景：当你在 GitHub 上发现一个很全面很丰富的项目文档时，仿佛发现了新大陆。可 GitHub 网站的服务器在国外，国内的访问速度实在感人，你想要把它下载到本地查看，会怎么做呢？你估计会选择<code>git clone</code>或者直接选择“Download ZIP”，然后用 Typora 或者 VS Code 软件打开这个项目文档，在本地查看：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223605.jpeg" alt="img"></p><p>总之，你能想到的方式，我都想到了，而且都尝试过。</p><p>现在的需求就是，如果你经常阅读网上的资料，肯定会有这样一个需求：<strong>怎么把这些几百页、甚至几千页的内容整理成 PDF、ePub、mobi等格式的电子书呢</strong>？</p><p>要么花钱请别人做，要么自己做。</p><p>今天这篇文章，就是来告诉你”<strong>自己动手制作 PDF、ePub、mobi 等格式电子书</strong>“的最佳方式。如果你是码农出身，下面讲的这些步骤，根本难不倒你。如果你不是码农出身，也没关系，只要你有一台电脑，跟着我讲的教程研究下去，肯定能搞定。</p><p>问题的关键不在于难不难、会不会，而是在于你是不是<strong>爱折腾</strong>。</p><h2 id="工具篇">工具篇</h2><h3 id="bloodstar-gitbook-builder"><a target="_blank" rel="noopener" href="https://hub.docker.com/r/bloodstar/gitbook-builder">bloodstar/gitbook-builder</a></h3><blockquote><p>Gitbook Docker 集成开发环境。支持CJK，附带常用工具。使用它，下面一些列环境配置都可以省略了。开箱即用。</p></blockquote><h3 id="Usage">Usage</h3><p>Read the official <a target="_blank" rel="noopener" href="https://toolchain.gitbook.com/">GitBook Toolchain Documentation</a> documentation <a target="_blank" rel="noopener" href="https://github.com/GitbookIO/gitbook#how-to-use-it">GitbookIO/gitbook</a> first.</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># init</span>docker run --rm -v <span class="token string">"<span class="token environment constant">$PWD</span>:/gitbook"</span> -p <span class="token number">4000</span>:4000 bloodstar/gitbook-builder gitbook init<span class="token comment"># serve</span>docker run --rm -v <span class="token string">"<span class="token environment constant">$PWD</span>:/gitbook"</span> -p <span class="token number">4000</span>:4000 bloodstar/gitbook-builder gitbook serve<span class="token comment"># build</span>docker run --rm -v <span class="token string">"<span class="token environment constant">$PWD</span>:/gitbook"</span> -p <span class="token number">4000</span>:4000 bloodstar/gitbook-builder gitbook build<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>For short, you can use alias for the long command line text. Place the alias statement in your <code>.bashrc</code> or <code>.zshrc</code>.</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">alias</span> <span class="token assign-left variable">gitbook</span><span class="token operator">=</span><span class="token string">'docker run --rm -v "$PWD":/gitbook -p 4000:4000 bloodstar/gitbook-builder gitbook'</span><span class="token comment"># init</span>gitbook init<span class="token comment"># serve</span>gitbook serve<span class="token comment"># build</span>gitbook build<span class="token comment"># pdf output</span>gitbook pdf <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Integrate-with-Gitlab-CI">Integrate with Gitlab CI</h3><p>This docker image is originally designed for generating ebook with <a target="_blank" rel="noopener" href="https://about.gitlab.com/gitlab-ci/">Gitlab CI</a>. You could configure your Gitlab CI as following:</p><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">before_script</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> env  <span class="token punctuation">-</span> export LC_ALL=zh_TW.UTF<span class="token punctuation">-</span><span class="token number">8</span><span class="token key atrule">stages</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> build<span class="token key atrule">ebook</span><span class="token punctuation">:</span>  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build  <span class="token key atrule">script</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> gitbook pdf  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>    <span class="token key atrule">paths</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> book.pdf  <span class="token key atrule">only</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> master  <span class="token key atrule">tags</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> gitbook  <span class="token key atrule">image</span><span class="token punctuation">:</span> bloodstar/gitbook<span class="token punctuation">-</span>builder<span class="token punctuation">:</span>latest  <span class="token key atrule">allow_failure</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="制作电子书的具体步骤">制作电子书的具体步骤</h2><h3 id="整体流程">整体流程</h3><p>先说一下整体步骤：</p><p>（1）安装 gitbook 工具。</p><p>（2）安装 calibre 软件，配置 <code>ebook-convert</code>工具。</p><p>（3）将<code>md</code>格式的多个文件素材导出为电子书（支持 PDF、ePub、mobi 等格式）。</p><p>（4）高级进阶：配置电子书的目录、封面、页眉页脚等。</p><p>整理流程如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223611.jpeg" alt="img"></p><p>接下来我们看看详细的完整步骤。</p><h3 id="步骤-1：通过-npm-安装-gitbook-cli">步骤 1：通过 npm 安装 gitbook-cli</h3><p>安装命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> -g gitbook-cli<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>安装成功之后，再执行<code>gitbook -V</code>命令确认是否安装成功：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gitbook -VCLI version: <span class="token number">2.3</span>.2GitBook version: <span class="token number">3.2</span>.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>备注：如果你不知道 <code>npm</code> 是什么，可以自行查阅<strong>如何安装 Node.js 和 npm 环境</strong>。</p><h3 id="步骤-2：安装-ebook-convert（针对-Windows-用户）">步骤 2：安装 ebook-convert（针对 Windows 用户）</h3><p>ebook-convert 是能够自由转化格式的一个命令行工具，已经包含在 calibre 软件里面了。</p><p>（1）安装 <code>calibre</code> 软件。calibre 的官网如下：（我们可以去官网下载安装）</p><blockquote><p><a target="_blank" rel="noopener" href="https://calibre-ebook.com/">https://calibre-ebook.com/</a></p></blockquote><p>（2）在终端输入如下命令，验证 <code>ebook-convert</code> 是否能正常使用：</p><p>如果输入上面的命令后提示错误，说明你还需要将 calibre 的安装目录添加到系统的环境变量中。</p><h3 id="步骤-2：安装-ebook-convert（针对-Mac-用户）">步骤 2：安装 ebook-convert（针对 Mac 用户）</h3><p>ebook-convert 是能够自由转化格式的一个命令行工具，已经包含在 calibre 软件里面了。</p><p>（1）安装 <code>calibre</code> 软件。calibre 的官网如下：（我们可以去官网下载安装）</p><blockquote><p><a target="_blank" rel="noopener" href="https://calibre-ebook.com/">https://calibre-ebook.com/</a></p></blockquote><p>（2）配置 <code>ebook-convert</code>。针对 Mac 系统，需要执行如下命令，把 <code>ebook-convert</code> 软链接到 <code>bin</code> 目录：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">ln</span> -s /Applications/calibre.app/Contents/MacOS/ebook-convert /usr/bin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>执行上面的命令后，如果出现<code>Operation not permitted</code>异常，说明系统权限限制，此时需要<strong>配置环境变量</strong>。</p><p>（3）环境变量配置：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> ~/.bash_profile<span class="token comment"># 将下面这两行配置，添加到 .bash_profile 文件中</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">EBOOK_PATH</span><span class="token operator">=</span>/Applications/calibre.app/Contents/MacOS<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$EBOOK_PATH</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>备注：可以自行研究下，在命令行环境，如何通过 vim 编辑文件。</p><p>然后刷新一下刚刚的配置：</p><p>验证<code>ebook-convert</code>是否能正常使用：</p><h3 id="步骤-3：配置电子书的目录">步骤 3：配置电子书的目录</h3><p>本地新建一个空的文件夹，作为我们的电子书项目。文件夹的名字随便起，但建议用英文命名。</p><p>（1）项目初始化。</p><p>在当前项目下，执行如下命令，进行初始化：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gitbook init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>此时，项目下会自动生成如下两个文件：（<strong>非常重要，必不可少</strong>）</p><ul><li><code>README.md</code>：书籍的简介放在这个文件里。</li><li><code>SUMMARY.md</code>：书籍的<strong>目录结构</strong>在这里配置。</li></ul><p>这两个文件创建后，内容为空白，可使用 Markdown 语言自定义内容。</p><p>（2）配置电子书的目录。</p><p>我们先把本地的 markdown 文件（也就是我们的<strong>电子书素材</strong>）放到项目中，然后在<code>SUMMARY.md</code>文件中配置电子书的目录。</p><p>比如说， 我的项目中有下面这些文件：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223644.jpeg" alt="img"></p><p>那么，我在<code>SUMMARY.md</code>文件中就要这样配置：</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 目录</span><span class="token list punctuation">*</span> <span class="token url">[<span class="token content">README</span>](<span class="token url">./README.md</span>)</span><span class="token list punctuation">*</span> <span class="token url">[<span class="token content">00-前端工具</span>](<span class="token url">00-前端工具/0-README.md</span>)</span>  <span class="token list punctuation">*</span> [01-VS Code的使用](00-前端工具/01-VS Code的使用.md)  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">02-Git的使用</span>](<span class="token url">00-前端工具/02-Git的使用.md</span>)</span><span class="token list punctuation">*</span> <span class="token url">[<span class="token content">01-HTML</span>](<span class="token url">01-HTML/0-README.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">01-认识Web和Web标准</span>](<span class="token url">01-HTML/01-认识Web和Web标准.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">02-浏览器的介绍</span>](<span class="token url">01-HTML/02-浏览器的介绍.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">03-初识HTML</span>](<span class="token url">01-HTML/03-初识HTML.md</span>)</span><span class="token list punctuation">*</span> <span class="token url">[<span class="token content">02-CSS基础</span>](<span class="token url">02-CSS基础/0-README.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">01-CSS属性：字体属性和文本属性</span>](<span class="token url">02-CSS基础/01-CSS属性：字体属性和文本属性.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">02-CSS属性：背景属性</span>](<span class="token url">02-CSS基础/02-CSS属性：背景属性.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">03-CSS样式表和选择器</span>](<span class="token url">02-CSS基础/03-CSS样式表和选择器.md</span>)</span><span class="token list punctuation">*</span> <span class="token url">[<span class="token content">03-JavaScript基础</span>](<span class="token url">03-JavaScript基础/0-README.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">00-编程语言</span>](<span class="token url">03-JavaScript基础/00-编程语言.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">01-JS简介</span>](<span class="token url">03-JavaScript基础/01-JS简介.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">02-变量</span>](<span class="token url">03-JavaScript基础/02-变量.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">03-变量的数据类型：基本数据类型和引用数据类型</span>](<span class="token url">03-JavaScript基础/03-变量的数据类型：基本数据类型和引用数据类型.md</span>)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>制作成的目录，将会是下面这种效果：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223613.jpeg" alt="img"></p><h3 id="步骤-4：导出电子书">步骤 4：导出电子书</h3><p>（1）本地预览电子书：</p><p>执行上方命令后，工具会对项目里的 Markdown 格式的文件进行转换，默认转换为 html 格式，最后提示 <code>Serving book on http://localhost:4000</code>。</p><p>我们打开浏览器输入<code>http://localhost:4000</code>，预览一下电子书的效果：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223620.jpeg" alt="img"></p><p>（2）制作并导出电子书。<strong>接下来就是见证奇迹的时刻</strong>。</p><p>生成 PDF 格式的电子书：（PDF 是最常见的文档格式）</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gitbook pdf ./ ./mybook.pdf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>生成 epub 格式的电子书：（epub 是最常见、最通用的电子书格式）</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gitbook epub ./ ./mybook.epub<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>生成 mobi 格式的电子书：（mobi 格式可以在 kindle 中打开）</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gitbook mobi ./ ./mybook.mobi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>上面这三种格式的电子书生成之后，项目里会看到这三个新增的文件：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223652.jpeg" alt="img"></p><p>我们把电子书打开，验收一下成果。</p><p>打开 pdf 电子书看看效果：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223700.jpeg" alt="img"></p><p>打开 epub 电子书看看效果：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223622.jpeg" alt="img"></p><p>怎么样，自制电子书就这样做好了，是不是很有成就感？</p><blockquote><p>更详细参考教程： <a target="_blank" rel="noopener" href="https://blog.17lai.fun/posts/7fe86002/">GitBook+GitLab撰写发布技术文档-Part1:GitBook篇</a></p></blockquote><h2 id="制作电子书的高级配置">制作电子书的高级配置</h2><p>电子书做好之后，我猜你肯定想进一步做<strong>个性化配置</strong>，比如：怎么加封面？怎么修改页眉页脚？还有其他的一些配置。</p><p>我们来看看亲手制作的电子书，有哪些常见的高级配置。</p><h3 id="制作书籍封面">制作书籍封面</h3><p>为了让书籍显示得更加优雅，我们可以指定一个自定义的封面。操作如下：</p><p>在项目的根目录下准备好 <code>cover.jpg</code> （大封面）和 <code>cover_small.jpg</code> （小封面）这两种封面图片。注意，图片的文件名和后缀名必须严格按照这句话来。</p><p>GitBook 的官方文档建议： <code>cover.jpg</code> （大封面）的尺寸为 1800x2360 像素，<code>cover_small.jpg</code>（小封面）的尺寸为 200x262 像素。图片的制作，建议遵循如下规范：</p><ul><li>没有边框</li><li>清晰可见的书本标题</li><li>任何重要的文字在小封面中应该清晰可见</li></ul><h3 id="book-json-：电子书的各种配置">book.json ：电子书的各种配置</h3><p>我们可以在项目的根目录下新建一个文件<code>book.json</code>（注意，文件名是<code>book</code>，后缀名是<code>json</code>），这个<code>book.json</code>就是电子书的配置文件，可以在里面填一些常见的配置。</p><p>关于 book.json 的配置项有很多，我们可以在网上搜索“GitBook book.json”找到。这里大致列举一些。</p><p>1、<strong>常规配置</strong>如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223624.jpeg" alt="img"></p><p>配置 book.json 的示例如下：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"前端入门和进阶图文教程"</span><span class="token punctuation">,</span>    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"前端入门到进阶图文教程，超详细的Web前端学习笔记。从零开始学前端，做一名精致优雅的前端工程师。公众号「千古壹号」作者。"</span><span class="token punctuation">,</span>    <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"千古壹号"</span><span class="token punctuation">,</span>    <span class="token property">"language"</span><span class="token operator">:</span> <span class="token string">"zh-hans"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook"</span><span class="token operator">:</span> <span class="token string">"3.2.3"</span><span class="token punctuation">,</span>    <span class="token property">"root"</span><span class="token operator">:</span> <span class="token string">"."</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>备注：上面的<code>root</code>根目录为当前目录，使用默认的就好，此项可以删掉，这里仅做演示。</p><p>2、<strong>pdf</strong> 的配置如下：（使用 <code>book.json</code> 中的一组选项来定制 PDF 输出）</p><p>| 配置项 | 描述 | | ----------------- | ------------------------------------------------------------ | | pdf.pageNumbers | 将页码添加到每个页面的底部（默认为 true） | | pdf.fontSize | 基本字体大小（默认是 12） | | pdf.fontFamily | 基本字体样式（默认是 Arial） | | pdf.paperSize | 页面尺寸，选项有： a0、a1、 a2、 a3、a4、a5、a6、b0、b1、b2、b3、b4、b5、b6、legal、letter （默认值是 a4） | | pdf.margin.top | 上边距（默认值是 56） | | pdf.margin.bottom | 下边距（默认值是 56） | | pdf.margin.left | 左边距（默认值是 62） | | pdf.margin.right | 右边距（默认值是 62） |</p><p>定制 PDF 文档输出格式的示例代码如下：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"pdf"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"pageNumbers"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"fontSize"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>        <span class="token property">"paperSize"</span><span class="token operator">:</span> <span class="token string">"a4"</span><span class="token punctuation">,</span>        <span class="token property">"margin"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"top"</span><span class="token operator">:</span> <span class="token number">36</span><span class="token punctuation">,</span>            <span class="token property">"bottom"</span><span class="token operator">:</span> <span class="token number">36</span><span class="token punctuation">,</span>            <span class="token property">"left"</span><span class="token operator">:</span> <span class="token number">62</span><span class="token punctuation">,</span>            <span class="token property">"right"</span><span class="token operator">:</span> <span class="token number">62</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>备注：如果你不需要对输出的 pdf 做任何特定的配置，则不需要添加上面的内容，让 pdf 的输出格式保持默认就好。</p><p>3、<strong>plugins</strong> 插件：</p><p>插件及其配置在 <code>book.json</code> 中指定，让电子书的配置能力更加强大。</p><p>通过插件，我们可以做很多事情，比如：修改页眉页脚、自动生成并显示图片的标题等。</p><p>另外，针对<strong>在线版</strong>的GitBook电子书，也有很多插件，这里列举几个：</p><ul><li>自带的search插件不支持中文搜索，使用起来非常不方便，还好<code>search-pro</code>插件横空出世，让搜索功能焕发出新的生机。插件地址：<a target="_blank" rel="noopener" href="https://github.com/gitbook-plugins/gitbook-plugin-search-pro">https://github.com/gitbook-plugins/gitbook-plugin-search-pro</a></li><li>默认侧边栏宽度是不能够调节的，如果想通过拖拽的方式自由调节侧边栏宽度，可以使用插件<code>splitter</code>。插件地址：<a target="_blank" rel="noopener" href="https://github.com/yoshidax/gitbook-plugin-splitter">https://github.com/yoshidax/gitbook-plugin-splitter</a></li><li>donate插件支持定义和显示支付宝和微信打赏。插件地址：<a target="_blank" rel="noopener" href="https://github.com/willin/gitbook-plugin-donate">http://github.com/willin/gitbook-plugin-donate</a></li></ul><p>关于插件的具体配置，感兴趣的同学可以自行研究下。</p><h3 id="自动生成目录（重要）">自动生成目录（重要）</h3><p>如果你的电子书素材里有很多 markdown 文件，那么，如何将多个 markdown 文件的文件名，在<code>SUMMARY.md</code>里快速生成对应的目录？</p><p>难道要一个一个地手动 copy 吗？这不可能。</p><p>说白了，这个需求就是：<strong>如何自动生成电子书的目录</strong>？改变世界的程序员用「脚本」就能搞定，一键执行。</p><p>网上有很多好用的脚本，我给你推荐一个亲测好用的脚本：</p><blockquote><p>GitBook 自动生成目录的脚本：<a target="_blank" rel="noopener" href="https://github.com/fushenghua/gitbook-plugin-summary">https://github.com/fushenghua/gitbook-plugin-summary</a></p></blockquote><p>操作方法很简单，把上面这个链接中的项目下载下来，进入到这个项目的目录，执行 <code>$ python gitbook-plugin-summary.py dirPath</code> 即可自动生成电子书的目录，亲测有效。备注：这里的<code>dirPath</code>指的是你的电子书目录的绝对路径。</p><p>对了，在执行上面这个脚本之前，记得先安装 <code>Python</code> 环境。</p><h2 id="电子书用什么软件打开">电子书用什么软件打开</h2><h3 id="用什么软件打开-PDF">用什么软件打开 PDF</h3><p>Windows 平台：可以用「福昕阅读器」或者「Acrobat Reader DC」。「福昕阅读器」既有 Windows 平台，也有 Mac 平台。</p><p>Mac 平台：可以用自带的「预览」打开。</p><p>其实，不管你用的是 Windows 电脑还是 Mac 电脑，你都可以用 Chrome 浏览器打开 PDF。</p><p>iPhone 或 iPad平台：可以用自带的「iBooks」打开，或者用「WPS Office」打开。也可以用第三方软件「GoodReader」，不过需要 40 人民币。</p><p>Android 手机：可以用「WPS Office」等第三方办公软件打开。</p><h3 id="用什么软件阅读-ePub-电子书">用什么软件阅读 ePub 电子书</h3><p>Windows 平台：可以用「calibre」软件阅读 epub 电子书。</p><p>Mac &amp; iPhone &amp; iPad 平台：用自带的「iBooks」阅读即可。iBooks 可以非常方便地对电子书进行标注和搜索，无疑是体验最好的 ePub 电子书阅读软件。</p><p>Android 手机：可以用「多看阅读」App 来阅读 epub 格式电子书。</p><h3 id="用什么方式阅读-mobi-电子书">用什么方式阅读 mobi 电子书</h3><p>kindle 电子书有两种常见的电子书格式：「mobi」格式和「azw3」格式。</p><ul><li>针对 mobi 格式的电子书，你既可以通过邮件的形式将其发送到 kindle 阅读器（可以自行网上查一下相关教程），也可以将其拷贝到 kindle 阅读器（是连接 usb 进行拷贝）。</li><li>针对 azw3 格式的电子书，就只能通过拷贝的形式（是连接 usb 拷贝）传输到 kindle 阅读器。</li></ul><h3 id="小结">小结</h3><p>我在 2017 年 1 月写过一篇电子书科普的文章，快三年过去了，如今回过头来看，那篇文章一点也不过时，不妨看看：《<a href="https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/-FsT_GQtBQ0-q_ndO5X6sQ">电子书有哪些常见格式？以及该怎样阅读它</a>》</p><h2 id="最后一段-2">最后一段</h2><p>如果你一时半会儿找不到可用的素材来制作电子书，可以拿我的项目练练手。项目地址：</p><blockquote><p><a target="_blank" rel="noopener" href="https://github.com/qianguyihao/web">https://github.com/qianguyihao/web</a></p></blockquote><p>不瞒你说，这篇文章，我在一年多以前就写好了初稿并放在了 GitHub 上，当时专门折腾过一次。</p><p>最近几天，我突然又有了制作电子书的需求。一年多过去了，我还以为有啥新的方法可以试试，然而我在网上找了一圈，好用的方法还是没变。所以，我今天整理一下发出来，希望让更多人看到。</p><p>其他的各种自制电子书的方法我都试过了，都不太好使，唯独 <strong>GitBook + calibre</strong> 是最佳选择，信我没错！</p><h2 id="参考链接-2">参考链接</h2><ul><li>GITBOOK 使用：<a target="_blank" rel="noopener" href="https://kuang.netlify.app/blog/gitbook.htmlbook.html">https://kuang.netlify.app/blog/gitbook.htmlbook.html</a></li><li>GitBook 制作 Kindle 电子书详细教程：<a target="_blank" rel="noopener" href="https://github.com/fushenghua/gitbook-plugin-summary/blob/master/gitbook-guide.md">https://github.com/fushenghua/gitbook-plugin-summary/blob/master/gitbook-guide.md</a></li><li>gitbook-plugin-summary 工具（自动生成目录）：<a target="_blank" rel="noopener" href="https://github.com/fushenghua/gitbook-plugin-summary">https://github.com/fushenghua/gitbook-plugin-summary</a></li><li>gitbook-plugin-atoc（自动生成目录的插件）：<a target="_blank" rel="noopener" href="https://github.com/willin/gitbook-plugin-atoc">https://github.com/willin/gitbook-plugin-atoc</a></li><li>自动生成目录：<a target="_blank" rel="noopener" href="https://github.com/mofhu/GitBook-auto-summary">https://github.com/mofhu/GitBook-auto-summary</a></li><li>使用 Gitbook 打造你的电子书：<a target="_blank" rel="noopener" href="https://juejin.im/post/6844903793033740302">https://juejin.im/post/6844903793033740302</a></li><li>书籍《了不起的 Markdown》的第 8 章：自由地写作——GitBook</li><li>gitbook 的 book.json 配置示例：<a target="_blank" rel="noopener" href="https://blog.ujwd.cn/archives/349">https://blog.ujwd.cn/archives/349</a></li><li>关于更加详细的 book.json 文件配置：<a target="_blank" rel="noopener" href="https://zhousiwei.gitee.io/mybook/notes/gitbook_config.html">https://zhousiwei.gitee.io/mybook/notes/gitbook_config.html</a></li><li>GitBook 简明使用教程：<a target="_blank" rel="noopener" href="https://www.phpjieshuo.com/archives/153/">https://www.phpjieshuo.com/archives/153/</a></li><li>gitbook 入门教程之导出电子书：<a target="_blank" rel="noopener" href="https://juejin.im/post/5caa0fb46fb9a05e5a2e53b3">https://juejin.im/post/5caa0fb46fb9a05e5a2e53b3</a></li><li>GitBook 插件整理 - book.json 配置：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/mingyue5826/p/10307051.html">https://www.cnblogs.com/mingyue5826/p/10307051.html</a></li><li>如何把 Markdown 文件批量转换为 PDF（不好用）：<a target="_blank" rel="noopener" href="https://sspai.com/post/47110">https://sspai.com/post/47110</a></li><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/245763905">自己动手制作电子书的最佳方式</a></li></ul><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="gitbook" scheme="https://blog.17lai.site/categories/gitbook/"/>
    
    
    <category term="docker" scheme="https://blog.17lai.site/tags/docker/"/>
    
    <category term="gitbook" scheme="https://blog.17lai.site/tags/gitbook/"/>
    
    <category term="git" scheme="https://blog.17lai.site/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>CI/CD与Git Flow与GitLab</title>
    <link href="https://blog.17lai.site/posts/1879721e/"/>
    <id>https://blog.17lai.site/posts/1879721e/</id>
    <published>2021-11-01T11:25:00.000Z</published>
    <updated>2022-03-16T10:52:12.343Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>CI/CD + Git Flow + GitLab 的整体工作流程记录。主要介绍一下 GitLab CI 相关功能，并通过 GitLab CI 实现自动化构建项目。项目中所用的示例项目已经上传到了 <a target="_blank" rel="noopener" href="https://github.com/mritd/GitLabCI-TestProject">GitHub</a></p></blockquote><h3 id="一、Git-Flow-简介">一、Git Flow 简介</h3><p>Git Flow 定义了一个围绕项目开发发布的严格 git 分支模型，用于管理多人协作的大型项目中实现高效的协作开发；Git Flow 分支模型最早起源于 <a target="_blank" rel="noopener" href="http://nvie.com/about/">Vincent Driessen</a> 的 <a target="_blank" rel="noopener" href="http://nvie.com/posts/a-successful-git-branching-model/">A successful Git branching model</a> 文章；随着时间发展，Git Flow 大致分为三种:</p><ul><li>Git Flow: 最原始的 Git Flow 分支模型</li><li>Github Flow: Git Flow 的简化版，专门配合持续发布</li><li>GitLab Flow: Git Flow 与 Github Flow 的结合版</li></ul><p>关于三种 Git Flow 区别详情可参考 <a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2015/12/git-workflow.html">Git 工作流程</a></p><h3 id="二、-Git-Flow-流程">二、 Git Flow 流程</h3><p>Github Flow 和 GitLab Flow 对于持续发布支持比较好，但是原始版本的 Git Flow 对于传统的按照版本发布更加友好一些，所以以下主要说明以下 Git Flow 的工作流程；Git Flow 主要分支模型如下</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220215.jpg" alt="git flow"></p><p>在整个分支模型中 <strong>存在两个长期分支: develop 和 master</strong>，其中 develop 分支为开发分支，master 为生产分支；<strong>master 代码始终保持随时可以部署到线上的状态；develop 分支用于合并最新提交的功能性代码</strong>；具体的分支定义如下</p><ul><li>master: 生产代码，始终保持可以直接部署生产的状态</li><li>develop: 开发分支，每次合并最新功能代码到此分支</li><li>feature: 新功能分支，所有新开发的功能将采用 <code>feature/xxxx</code> 形式命名分支</li><li>hotfixes: 紧急修复补丁分支，当新功能部署到了线上出现了严重 bug 需要紧急修复时，则创建 <code>hotfixes/xxxx</code> 形式命名的分支</li><li>release: 稳定版分支，当完成大版本变动后，应该创建 <code>release/xxxx</code> 分支</li></ul><p>在整个分支模型中，develop 分支为最上游分支，会不断有新的 feature 合并入 develop 分支，当功能开发达到完成所有版本需求时，则从 develop 分支创建 release 分支，release 后如没有发现其他问题，最终 release 会被合并到 master 分支以完成线上部署</p><h3 id="三、Git-Flow-工具">三、Git Flow 工具</h3><p>针对于 Git Flow，其手动操作 git 命令可能过于繁琐，所以后来有了 git-flow 工具；git-flow 是一个 git 扩展集，按 Vincent Driessen 的分支模型提供高层次的库操作；使用 git-flow 工具可以以更加简单的命令完成对 Vincent Driessen 分支模型的实践；<br>git-flow 安装以及使用具体请参考 <a target="_blank" rel="noopener" href="https://danielkummer.github.io/git-flow-cheatsheet/index.zh_CN.html">git-flow 备忘清单</a>，该文章详细描述了 git-flow 工具的使用方式</p><p>还有另一个工具是 <a target="_blank" rel="noopener" href="https://github.com/tj/git-extras">git-extras</a>，该工具没有 git-flow 那么简单化，不过其提供更加强大的命令支持</p><h3 id="四、Git-Commit-Message">四、Git Commit Message</h3><p>在整个 Git Flow 中，commit message 也是必不可少的一部分；一个良好且统一的 commit message 有助于代码审计以及 review 等；目前使用最广泛的写法是 <a target="_blank" rel="noopener" href="https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit#heading=h.greljkmo14y0">Angular 社区规范</a>，该规范大中 commit message 格式大致如下:</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>(<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>): <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>subject</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BLANK</span> <span class="token attr-name">LINE</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BLANK</span> <span class="token attr-name">LINE</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">&gt;</span></span>Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>总体格式大致分为 3 部分，首行主要 3 个组成部分:</p><ul><li>type: 本次提交类型</li><li>scope: 本次提交影响范围，一般标明影响版本号或者具体的范围如 <code>$browser, $compile, $rootScope, ngHref, ngClick, ngView, etc...</code></li><li>subject: 本次提交简短说明</li></ul><p>关于 type 提交类型，有如下几种值:</p><ul><li>feat：新功能(feature)</li><li>fix：修补 bug</li><li>docs：文档(documentation)</li><li>style： 格式(不影响代码运行的变动)</li><li>refactor：重构(即不是新增功能，也不是修改 bug 的代码变动)</li><li>test：增加测试</li><li>chore：构建过程或辅助工具的变动</li></ul><p>中间的 body 部分是对本次提交的详细描述信息，底部的 footer 部分一般分为两种情况:</p><ul><li>不兼容变动: 如果出现不兼容变动，则以 <code>BREAKING CHANGE:</code> 开头，后面跟上不兼容变动的具体描述和解决办法</li><li>关闭 issue: 如果该 commit 针对某个 issue，并且可以将其关闭，则可以在其中指定关闭的 issue，如 <code>Close #9527,#9528</code></li></ul><p>不过 footer 部分也有特殊情况，如回滚某次提交，则以 <code>revert:</code> 开头，后面紧跟 commit 信息和具体描述；还有时某些 commit 只是解决了 某个 issue 的一部分问题，这是可以使用 <code>refs ISSUE</code> 的方式来引用该 issue</p><h3 id="五、Git-Commit-Message-工具">五、Git Commit Message 工具</h3><p>针对 Git 的 commit message 目前已经有了成熟的生成工具，比较有名的为 <a target="_blank" rel="noopener" href="https://github.com/commitizen/cz-cli">commitizen-cli</a> 工具，其采用 node.js 编写，执行 <code>git cz</code> 命令能够自动生成符合 Angular 社区规范的 commit message；不过由于其使用 node.js 编写，所以安装前需要安装 node.js，因此可能不适合其他非 node.js 的项目使用；这里推荐一个基于 shell 编写的 <a target="_blank" rel="noopener" href="https://cimhealth.github.io/git-toolkit">Git-toolkit</a>，安装此工具后执行 <code>git ci</code> 命令进行提交将会产生交互式生成 Angular git commit message 格式的提交说明，截图如下:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220233.jpg" alt="git ci"></p><h3 id="六、GitLab-整合">六、GitLab 整合</h3><p>以上 Git Flow 所有操作介绍的都是在本地操作，而正常我们在工作中都是基于 GitLab 搭建私有 Git 仓库来进行协同开发的，以下简述以下 Git Flow 配合 GitLab 的流程</p><h4 id="6-1、开发-features">6.1、开发 features</h4><p>当开发一个新功能时流程如下:</p><ul><li>本地 <code>git flow feature start xxxx</code> 开启一个 feature 新分支</li><li><code>git flow feature publish xxxx</code> 将此分支推送到远端以便他人获取</li><li>完成开发后 GitLab 上向 <code>develop</code> 分支发起合并请求</li><li>CI sonar 等质量检测工具扫描，其他用户 review 代码</li><li>确认无误后 <code>master</code> 权限用户合并其到 <code>develop</code> 分支</li><li>部署到测试环境以便测试组测试</li><li>如果测试不通过，则继续基于此分支开发，直到该功能开发完成</li></ul><h4 id="6-2、创建-release">6.2、创建 release</h4><p>当一定量的 feature 开发完成并合并到 develop 后，如所有 feature 都测试通过并满足版本需求，则可以创建 release 版本分支；release 分支流程如下</p><ul><li>本地 <code>git flow release start xxxx</code> 开启 release 分支</li><li><code>git flow release publish xxxx</code> 将其推送到远端以便他人获取</li><li>继续进行完整性测试，出现问题继续修复，直到 release 完全稳定</li><li>从 release 分支向 master、develop 分支分别发起合并请求</li><li>master 合并后创建对应的 release 标签，并部署生产环境</li><li>develop 合并 release 的后期修改</li></ul><h4 id="6-3、紧急修复">6.3、紧急修复</h4><p>当 master 某个 tag 部署到生产环境后，也可能出现不符合预期的问题出现；此时应该基于 master 创建 hotfix 分支进行修复，流程如下</p><ul><li>本地 <code>git flow hotfix start xxxx</code> 创建紧急修复分支</li><li>修改代码后将其推送到远端，并像 master、develop 分支发起合并</li><li>develop 合并紧急修复补丁，如果必要最好再做一下测试</li><li>master 合并紧急修复补丁，创建紧急修复 tag，并部署生产环境</li></ul><h3 id="七、环境准备">七、环境准备</h3><p>首先需要有一台 GitLab 服务器，然后需要有个项目；这里示例项目以 Spring Boot 项目为例，然后最好有一台专门用来 Build 的机器，实际生产中如果 Build 任务不频繁可适当用一些业务机器进行 Build；本文示例所有组件将采用 Docker 启动， GitLab HA 等不在本文阐述范围内</p><ul><li>Docker Version : 1.13.1</li><li>GitLab Version : 10.1.4-ce.0</li><li>GitLab Runner Version : 10.1.0</li><li>GitLab IP : 172.16.0.37</li><li>GitLab Runner IP : 172.16.0.36</li></ul><h3 id="八、GitLab-CI-简介">八、GitLab CI 简介</h3><p>GitLab CI 是 GitLab 默认集成的 CI 功能，GitLab CI 通过在项目内 <code>.gitlab-ci.yaml</code> 配置文件读取 CI 任务并进行相应处理；GitLab CI 通过其称为 GitLab Runner 的 Agent 端进行 build 操作；Runner 本身可以使用多种方式安装，比如使用 Docker 镜像启动等；Runner 在进行 build 操作时也可以选择多种 build 环境提供者；比如直接在 Runner 所在宿主机 build、通过新创建虚拟机(vmware、virtualbox)进行 build等；同时 Runner 支持 Docker 作为 build 提供者，即每次 build 新启动容器进行 build；GitLab CI 其大致架构如下</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220236.png" alt="GitLab"></p><h3 id="九、搭建-GitLab-服务器">九、搭建 GitLab 服务器</h3><h4 id="9-1、GitLab-搭建">9.1、GitLab 搭建</h4><p>GitLab 搭建这里直接使用 docker compose 启动，compose 配置如下</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">gitlab</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">'gitlab/gitlab-ce:10.1.4-ce.0'</span>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> gitlab    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> <span class="token string">'git.mritd.me'</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">GITLAB_OMNIBUS_CONFIG</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">        external_url 'http://git.mritd.me'        # Add any other gitlab.rb configuration here, each on its own line</span>    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">'80:80'</span>      <span class="token punctuation">-</span> <span class="token string">'443:443'</span>      <span class="token punctuation">-</span> <span class="token string">'8022:22'</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">'./data/gitlab/config:/etc/gitlab'</span>      <span class="token punctuation">-</span> <span class="token string">'./data/gitlab/logs:/var/log/gitlab'</span>      <span class="token punctuation">-</span> './data/gitlab/data<span class="token punctuation">:</span>/var/opt/gitlab'Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>直接启动后，首次登陆需要设置初始密码如下，默认用户为 <code>root</code></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220240.png" alt="gitkab init"></p><p>登陆成功后创建一个用户(该用户最好给予 Admin 权限，以后操作以该用户为例)，并且创建一个测试 Group 和 Project，如下所示</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220427.png" alt="Create User"></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220432.png" alt="Test Project"></p><h4 id="9-2、增加示例项目">9.2、增加示例项目</h4><p>这里示例项目采用 Java 的 SpringBoot 项目，并采用 Gradle 构建，其他语言原理一样；<strong>如果不熟悉 Java 的没必要死磕此步配置，任意语言(最好 Java)整一个能用的 Web 项目就行，并不强求一定 Java 并且使用 Gradle 构建，以下只是一个样例项目</strong>；SpringBoot 可以采用 <a target="_blank" rel="noopener" href="https://start.spring.io/">Spring Initializr</a> 直接生成(依赖要加入 WEB)，如下所示</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220246.png" alt="Spring Initializr"></p><p>将项目导入 IDEA，然后创建一个 index 示例页面，主要修改如下</p><ul><li>build.gradle</li></ul><pre class="line-numbers language-jade" data-language="jade"><code class="language-jade">buildscript {    ext {        springBootVersion = '1.5.8.RELEASE'    }    repositories {        mavenCentral()    }    dependencies {        classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")    }}apply plugin: 'java'apply plugin: 'eclipse'apply plugin: 'idea'apply plugin: 'org.springframework.boot'group = 'me.mritd'version = '0.0.1-SNAPSHOT'sourceCompatibility = 1.8repositories {    mavenCentral()}dependencies {    compile('org.springframework.boot:spring-boot-starter')    compile('org.springframework.boot:spring-boot-starter-web')    compile('org.springframework.boot:spring-boot-starter-thymeleaf')    testCompile('org.springframework.boot:spring-boot-starter-test')}Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>新建一个 HomeController</li></ul><pre class="line-numbers language-jade" data-language="jade"><code class="language-jade">package me.mritd.TestProject;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping;/******************************************************************************* * Copyright (c) 2005-2017 Mritd, Inc. * TestProject * me.mritd.TestProject * Created by mritd on 2017/11/24 下午12:23. * Description:  *******************************************************************************/@Controllerpublic class HomeController {    @RequestMapping("/")    public String home(){        return "index";    }}Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>templates 下新建 index.html</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Test...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后项目整体结构如下</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220249.png" alt="TestProject"></p><p>执行 <code>assemble</code> Task 打包出可执行 jar 包，并运行 <code>java -jar TestProject-0.0.1-SNAPSHOT.jar</code> 测试下能启动访问页面即可</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220251.png" alt="TestProject assemble"></p><p>最后将项目提交到 GitLab 后如下</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220304.png" alt="init Project"></p><h3 id="十、GitLab-CI-配置">十、GitLab CI 配置</h3><blockquote><p>针对这一章节创建基础镜像以及项目镜像，这里仅以 Java 项目为例；其他语言原理相通，按照其他语言对应的运行环境修改即可</p></blockquote><h4 id="10-1、增加-Runner">10.1、增加 Runner</h4><p>GitLab CI 在进行构建时会将任务下发给 Runner，让 Runner 去执行；所以先要添加一个 Runner，Runner 这里采用 Docker Compose 启动，build 方式也使用 Docker 方式 Build；compose 文件如下</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">gitlab-runner</span><span class="token punctuation">:</span>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> gitlab<span class="token punctuation">-</span>runner    <span class="token key atrule">image</span><span class="token punctuation">:</span> gitlab/gitlab<span class="token punctuation">-</span>runner<span class="token punctuation">:</span>alpine<span class="token punctuation">-</span>v10.1.0    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">"host"</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> /var/run/docker.sock<span class="token punctuation">:</span>/var/run/docker.sock      <span class="token punctuation">-</span> ./config.toml<span class="token punctuation">:</span>/etc/gitlab<span class="token punctuation">-</span>runner/config.toml    <span class="token key atrule">extra_hosts</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> "git.mritd.me<span class="token punctuation">:</span>172.16.0.37"Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>在启动前，我们需要先 touch 一下这个 config.toml 配置文件</strong>；该文件是 Runner 的运行配置，此后 Runner 所有配置都会写入这个文件(不 touch 出来 docker-compose 发现不存在会挂载一个目录进去，导致 Runner 启动失败)；启动 docker-compose 后，<strong>需要进入容器执行注册，让 Runner 主动去连接 GitLab 服务器</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 生成 Runner 配置文件</span><span class="token function">touch</span> config.toml<span class="token comment"># 启动 Runner</span>docker-compose up -d<span class="token comment"># 激活 Runner</span>docker <span class="token builtin class-name">exec</span> -it gitlab-runner gitlab-runner registerCopy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在执行上一条激活命令后，会按照提示让你输入一些信息；<strong>首先输入 GitLab 地址，然后是 Runner Token，Runner Token 可以从 GitLab 设置中查看</strong>，如下所示</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220624.png" alt="Runner Token"></p><p>整体注册流程如下</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220312.png" alt="Runner registry"></p><p>注册完成后，在 GitLab Runner 设置中就可以看到刚刚注册的 Runner，如下所示</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220628.png" alt="Runner List"></p><p><strong>Runner 注册成功后会将配置写入到 config.toml 配置文件；由于两个测试宿主机都没有配置内网 DNS，所以为了保证 runner 在使用 docker build 时能正确的找到 GitLab 仓库地址，还需要增加一个 docker 的 host 映射( <code>extra_hosts</code> )；同时为了能调用 宿主机 Docker 和持久化 build 的一些缓存还挂载了一些文件和目录；完整的 配置如下(配置文件可以做一些更高级的配置，具体参考 <a target="_blank" rel="noopener" href="https://docs.gitlab.com/runner/configuration/advanced-configuration.html">官方文档</a> )</strong></p><ul><li>config.toml</li></ul><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token key property">concurrent</span> <span class="token punctuation">=</span> <span class="token number">1</span><span class="token key property">check_interval</span> <span class="token punctuation">=</span> <span class="token number">0</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">runners</span><span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"Test Runner"</span>  <span class="token key property">url</span> <span class="token punctuation">=</span> <span class="token string">"http://git.mritd.me"</span>  <span class="token key property">token</span> <span class="token punctuation">=</span> <span class="token string">"c279ec1ac08aec98c7141c7cf2d474"</span>  <span class="token key property">executor</span> <span class="token punctuation">=</span> <span class="token string">"docker"</span>  <span class="token key property">builds_dir</span> <span class="token punctuation">=</span> <span class="token string">"/gitlab/runner-builds"</span>  <span class="token key property">cache_dir</span> <span class="token punctuation">=</span> <span class="token string">"/gitlab/runner-cache"</span>  <span class="token punctuation">[</span><span class="token table class-name">runners.docker</span><span class="token punctuation">]</span>    <span class="token key property">tls_verify</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>    <span class="token key property">image</span> <span class="token punctuation">=</span> <span class="token string">"debian"</span>    <span class="token key property">privileged</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>    <span class="token key property">disable_cache</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>    <span class="token key property">shm_size</span> <span class="token punctuation">=</span> <span class="token number">0</span>    <span class="token key property">volumes</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"/data/gitlab-runner:/gitlab"</span><span class="token punctuation">,</span><span class="token string">"/var/run/docker.sock:/var/run/docker.sock"</span><span class="token punctuation">,</span><span class="token string">"/data/maven_repo:/data/repo"</span><span class="token punctuation">,</span><span class="token string">"/data/maven_repo:/data/maven"</span><span class="token punctuation">,</span><span class="token string">"/data/gradle:/data/gradle"</span><span class="token punctuation">,</span><span class="token string">"/data/sonar_cache:/root/.sonar"</span><span class="token punctuation">,</span><span class="token string">"/data/androidsdk:/usr/local/android"</span><span class="token punctuation">,</span><span class="token string">"/data/node_modules:/data/node_modules"</span><span class="token punctuation">]</span>    <span class="token key property">extra_hosts</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"git.mritd.me:172.16.0.37"</span><span class="token punctuation">]</span>  <span class="token punctuation">[</span><span class="token table class-name">runners.cache</span><span class="token punctuation">]</span>Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>注意，这里声明的 Volumes 会在每个运行的容器中都生效；也就是说 build 时新开启的每个容器都会被挂载这些目录</strong>；修改完成后重启 runner 容器即可，由于 runner 中没啥可保存的东西，所以可以直接 <code>docker-compose down &amp;&amp; docker-compose up -d</code> 重启</p><h4 id="10-2、创建基础镜像">10.2、创建基础镜像</h4><p>由于示例项目是一个 Java 项目，而且是采用 Spring Boot 的，所以该项目想要运行起来只需要一个 java 环境即可，中间件已经被打包到了 jar 包中；以下是一个作为基础运行环境的 openjdk 镜像的 Dockerfile</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">FROM alpine:edge LABEL maintainer="mritd &lt;mritd1234@gmail.com&gt;"ENV JAVA_HOME /usr/lib/jvm/java-1.8-openjdkENV PATH $PATH:/usr/lib/jvm/java-1.8-openjdk/jre/bin:/usr/lib/jvm/java-1.8-openjdk/binRUN apk add --update bash curl tar wget ca-certificates unzip \        openjdk8 font-adobe-100dpi ttf-dejavu fontconfig \    &amp;&amp; rm -rf /var/cache/apk/* \CMD ["bash"]Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>这个 openjdk Dockerfile 升级到了 8.151 版本，并且集成了一些字体相关的软件，以解决在 Java 中某些验证码库无法运行问题，详见 <a target="_blank" rel="noopener" href="https://mritd.me/2017/09/27/alpine-3.6-openjdk-8-bug/">Alpine 3.6 OpenJDK 8 Bug</a></strong>；使用这个 Dockerfile，在当前目录执行 <code>docker build -t mritd/openjdk:8 .</code> build 一个 openjdk8 的基础镜像，然后将其推送到私服，或者 Docker Hub 即可</p><h4 id="10-3、创建项目镜像">10.3、创建项目镜像</h4><p>有了基本的 openjdk 的 docker 镜像后，针对于项目每次 build 都应该生成一个包含发布物的 docker 镜像，所以对于项目来说还需要一个项目本身的 Dockerfile；<strong>项目的 Dockerfile 有两种使用方式；一种是动态生成 Dockerfile，然后每次使用新生成的 Dockerfile 去 build；还有一种是写一个通用的 Dockerfile，build 时利用 ARG 参数传入变量</strong>；这里采用第二种方式，以下为一个可以反复使用的 Dockerfile</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">FROM mritd/openjdk:8-144-01MAINTAINER mritd &lt;mritd1234@gmail.com&gt;ARG PROJECT_BUILD_FINALNAMEENV TZ 'Asia/Shanghai'ENV PROJECT_BUILD_FINALNAME ${PROJECT_BUILD_FINALNAME}COPY build/libs/${PROJECT_BUILD_FINALNAME}.jar /${PROJECT_BUILD_FINALNAME}.jarCMD ["bash","-c","java -jar /${PROJECT_BUILD_FINALNAME}.jar"]Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>该 Dockerfile 通过声明一个 <code>PROJECT_BUILD_FINALNAME</code> 变量来表示项目的发布物名称；然后将其复制到根目录下，最终利用 java 执行这个 jar 包；所以每次 build 之前只要能拿到项目发布物的名称即可</strong></p><h4 id="10-4、Gradle-修改">10.4、Gradle 修改</h4><p>上面已经创建了一个标准的通用型 Dockerfile，每次 build 镜像只要传入 <code>PROJECT_BUILD_FINALNAME</code> 这个最终发布物名称即可；对于发布物名称来说，最好不要固定死；当然不论是 Java 还是其他语言的项目我们都能将最终发布物变成一个固定名字，最不济可以写脚本重命名一下；但是不建议那么干，最好保留版本号信息，以便于异常情况下进入容器能够分辨；对于当前 Java 项目来说，想要拿到 <code>PROJECT_BUILD_FINALNAME</code> 很简单，我们只需要略微修改一下 Gradle 的 build 脚本，让其每次打包 jar 包时将项目的名称及版本号导出到文件中即可；同时这里也加入了镜像版本号的处理，Gradle 脚本修改如下</p><ul><li>build.gradle 最后面增加如下</li></ul><pre class="line-numbers language-jade" data-language="jade"><code class="language-jade">bootRepackage {    mainClass = 'me.mritd.TestProject.TestProjectApplication'    executable = true    doLast {        File envFile = new File("build/tmp/PROJECT_ENV")        println("Create ${archivesBaseName} ENV File ===&gt; " + envFile.createNewFile())        println("Export ${archivesBaseName} Build Version ===&gt; ${version}")        envFile.write("export PROJECT_BUILD_FINALNAME=${archivesBaseName}-${version}\n")        println("Generate Docker image tag...")        envFile.append("export BUILD_DATE=`date +%Y%m%d%H%M%S`\n")        envFile.append("export IMAGE_NAME=mritd/test:`echo \${CI_BUILD_REF_NAME} | tr '/' '-'`-`echo \${CI_COMMIT_SHA} | cut -c1-8`-\${BUILD_DATE}\n")        envFile.append("export LATEST_IMAGE_NAME=mritd/test:latest\n")    }}Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>这一步操作实际上是修改了 <code>bootRepackage</code> 这个 Task(不了解 Gradle 或者不是 Java 项目的请忽略)，在其结束后创建了一个叫 <code>PROJECT_ENV</code> 的文件，里面实际上就是写入了一些 bash 环境变量声明，以方便后面 source 一下这个文件拿到一些变量，然后用户 build 镜像使用</strong>，<code>PROJECT_ENV</code> 最终生成如下</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">PROJECT_BUILD_FINALNAME</span><span class="token operator">=</span>TestProject-0.0.1-SNAPSHOT<span class="token builtin class-name">export</span> <span class="token assign-left variable">BUILD_DATE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">`</span></span><span class="token builtin class-name">export</span> <span class="token assign-left variable">IMAGE_NAME</span><span class="token operator">=</span>mritd/test:<span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $<span class="token punctuation">{</span>CI_BUILD_REF_NAME<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">'/'</span> <span class="token string">'-'</span><span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $<span class="token punctuation">{</span>CI_COMMIT_SHA<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token function">cut</span> -c1-8<span class="token variable">`</span></span>-<span class="token variable">${BUILD_DATE}</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">LATEST_IMAGE_NAME</span><span class="token operator">=</span>mritd/test:latestCopy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220738.png" alt="PROJECT_ENV"></p><h4 id="10-5、创建-CI-配置文件">10.5、创建 CI 配置文件</h4><p>一切准备就绪以后，就可以编写 CI 脚本了；GitLab 依靠读取项目根目录下的 <code>.gitlab-ci.yml</code> 文件来执行相应的 CI 操作；以下为测试项目的 <code>.gitlab-ci.yml</code> 配置</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 调试开启</span><span class="token comment">#before_script:</span><span class="token comment">#  - pwd</span><span class="token comment">#  - env</span><span class="token key atrule">cache</span><span class="token punctuation">:</span>  <span class="token key atrule">key</span><span class="token punctuation">:</span> $CI_PROJECT_NAME/$CI_COMMIT_REF_NAME<span class="token punctuation">-</span>$CI_COMMIT_SHA  <span class="token key atrule">paths</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> build<span class="token key atrule">stages</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> build  <span class="token punctuation">-</span> deploy<span class="token key atrule">auto-build</span><span class="token punctuation">:</span>  <span class="token key atrule">image</span><span class="token punctuation">:</span> mritd/build<span class="token punctuation">:</span>2.1.1  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build  <span class="token key atrule">script</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> gradle <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>daemon clean assemble  <span class="token key atrule">tags</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> test<span class="token key atrule">deploy</span><span class="token punctuation">:</span>  <span class="token key atrule">image</span><span class="token punctuation">:</span> mritd/docker<span class="token punctuation">-</span>kubectl<span class="token punctuation">:</span>v1.7.4  <span class="token key atrule">stage</span><span class="token punctuation">:</span> deploy  <span class="token key atrule">script</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> source build/tmp/PROJECT_ENV    <span class="token punctuation">-</span> echo "Build Docker Image ==<span class="token punctuation">&gt;</span> $<span class="token punctuation">{</span>IMAGE_NAME<span class="token punctuation">}</span>"    <span class="token punctuation">-</span> docker build <span class="token punctuation">-</span>t $<span class="token punctuation">{</span>IMAGE_NAME<span class="token punctuation">}</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>build<span class="token punctuation">-</span>arg PROJECT_BUILD_FINALNAME=$<span class="token punctuation">{</span>PROJECT_BUILD_FINALNAME<span class="token punctuation">}</span> .<span class="token comment">#    - docker push ${IMAGE_NAME}</span>    <span class="token punctuation">-</span> docker tag $<span class="token punctuation">{</span>IMAGE_NAME<span class="token punctuation">}</span> $<span class="token punctuation">{</span>LATEST_IMAGE_NAME<span class="token punctuation">}</span><span class="token comment">#    - docker push ${LATEST_IMAGE_NAME}</span><span class="token comment">#    - docker rmi ${IMAGE_NAME} ${LATEST_IMAGE_NAME}</span><span class="token comment">#    - kubectl --kubeconfig ${KUBE_CONFIG} set image deployment/test test=$IMAGE_NAME</span>  <span class="token key atrule">tags</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> test  <span class="token key atrule">only</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> master    <span class="token punctuation">-</span> develop    <span class="token punctuation">-</span> /^chore.<span class="token important">*$/Copy</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>关于 CI 配置的一些简要说明如下</strong></li></ul><h5 id="stages">stages</h5><p>stages 字段定义了整个 CI 一共有哪些阶段流程，以上的 CI 配置中，定义了该项目的 CI 总共分为 <code>build</code>、<code>deploy</code> 两个阶段；GitLab CI 会根据其顺序执行对应阶段下的所有任务；<strong>在正常生产环境流程可以定义很多个，比如可以有 <code>test</code>、<code>publish</code>，甚至可能有代码扫描的 <code>sonar</code> 阶段等；这些阶段没有任何限制，完全是自定义的</strong>，上面的阶段定义好后在 CI 中表现如下图</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220327.png" alt="stages"></p><h5 id="task">task</h5><p>task 隶属于 stages 之下；也就是说一个阶段可以有多个任务，任务执行顺序默认不指定会并发执行；对于上面的 CI 配置来说 <code>auto-build</code> 和 <code>deploy</code> 都是 task，他们通过 <code>stage: xxxx</code> 这个标签来指定他们隶属于哪个 stage；当 Runner 使用 Docker 作为 build 提供者时，我们可以在 task 的 <code>image</code> 标签下声明该 task 要使用哪个镜像运行，不指定则默认为 Runner 注册时的镜像(这里是 debian)；<strong>同时 task 还有一个 <code>tags</code> 的标签，该标签指明了这个任务将可以在哪些 Runner 上运行；这个标签可以从 Runner 页面看到，实际上就是 Runner 注册时输入的哪个 tag；对于某些特殊的项目，比如 IOS 项目，则必须在特定机器上执行，所以此时指定 tags 标签很有用</strong>，当 task 运行后如下图所示</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101221014.png" alt="Task"></p><p>除此之外 task 还能指定 <code>only</code> 标签用于限定那些分支才能触发这个 task，如果分支名字不满足则不会触发；<strong>默认情况下，这些 task 都是自动执行的，如果感觉某些任务太过危险，则可以通过增加 <code>when: manual</code> 改为手动执行；注意: 手动执行被 GitLab 认为是高权限的写操作，所以只有项目管理员才能手动运行一个 task，直白的说就是管理员才能点击</strong>；手动执行如下图所示</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220759.png" alt="manual task"></p><h5 id="cache">cache</h5><p>cache 这个参数用于定义全局那些文件将被 cache；<strong>在 GitLab CI 中，跨 stage 是不能保存东西的；也就是说在第一步 build 的操作生成的 jar 包，到第二部打包 docker image 时就会被删除；GitLab 会保证每个 stage 中任务在执行时都将工作目录(Docker 容器 中)还原到跟 GitLab 代码仓库中一模一样，多余文件及变更都会被删除</strong>；正常情况下，第一步 build 生成 jar 包应当立即推送到 nexus 私服；但是这里测试没有搭建，所以只能放到本地；但是放到本地下一个 task 就会删除它，所以利用 <code>cache</code> 这个参数将 <code>build</code> 目录 cache 住，保证其跨 stage 也能存在</p><p><strong>关于 <code>.gitlab-ci.yml</code> 具体配置更完整的请参考 <a target="_blank" rel="noopener" href="https://docs.gitlab.com/ee/ci/yaml/">官方文档</a></strong></p><h3 id="十一、其他相关">十一、其他相关</h3><h4 id="11-1、GitLab-内置环境变量">11.1、GitLab 内置环境变量</h4><p>上面已经基本搞定了一个项目的 CI，但是有些变量可能并未说清楚；比如在创建的 <code>PROJECT_ENV</code> 文件中引用了 <code>${CI_COMMIT_SHA}</code> 变量；这种变量其实是 GitLab CI 的内置隐藏变量，这些变量在每次 CI 调用 Runner 运行某个任务时都会传递到对应的 Runner 的执行环境中；<strong>也就是说这些变量在每次的任务容器 SHELL 环境中都会存在，可以直接引用</strong>，具体的完整环境变量列表可以从 <a target="_blank" rel="noopener" href="https://docs.gitlab.com/ee/ci/variables/">官方文档</a> 中获取；如果想知道环境变量具体的值，实际上可以通过在任务执行前用 <code>env</code> 指令打印出来，如下所示</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220338.png" alt="env"></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220800.png" alt="env task"></p><h4 id="11-2、GitLab-自定义环境变量">11.2、GitLab 自定义环境变量</h4><p>在某些情况下，我们希望 CI 能自动的发布或者修改一些东西；比如将 jar 包上传到 nexus、将 docker 镜像 push 到私服；这些动作往往需要一个高权限或者说有可写入对应仓库权限的账户来支持，但是这些账户又不想写到项目的 CI 配置里；因为这样很不安全，谁都能看到；此时我们可以将这些敏感变量写入到 GitLab 自定义环境变量中，GitLab 会像对待内置变量一样将其传送到 Runner 端，以供我们使用；GitLab 中自定义的环境变量可以有两种，一种是项目级别的，只能够在当前项目使用，如下</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220803.png" alt="project env"></p><p>另一种是组级别的，可以在整个组内的所有项目中使用，如下</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220805.png" alt="group env"></p><p>这两种变量添加后都可以在 CI 的脚本中直接引用</p><h4 id="11-3、Kubernetes-集成">11.3、Kubernetes 集成</h4><p>对于 Kubernetes 集成实际上有两种方案，一种是对接 Kubernetes 的 api，纯代码实现；另一种取巧的方案是调用 kubectl 工具，用 kubectl 工具来实现滚动升级；这里采用后一种取巧的方式，将 kubectl 二进制文件封装到镜像中，然后在 deploy 阶段使用这个镜像直接部署就可以</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220345.png" alt="kubectl"></p><p>其中 <code>mritd/docker-kubectl:v1.7.4</code> 这个镜像的 Dockerfile 如下</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">FROM docker:dind LABEL maintainer="mritd &lt;mritd1234@gmail.com&gt;"ARG TZ="Asia/Shanghai"ENV TZ ${TZ}ENV KUBE_VERSION v1.8.0RUN apk upgrade --update \    &amp;&amp; apk add bash tzdata wget ca-certificates \    &amp;&amp; wget https://storage.googleapis.com/kubernetes-release/release/${KUBE_VERSION}/bin/linux/amd64/kubectl -O /usr/local/bin/kubectl \    &amp;&amp; chmod +x /usr/local/bin/kubectl \    &amp;&amp; ln -sf /usr/share/zoneinfo/${TZ} /etc/localtime \    &amp;&amp; echo ${TZ} &gt; /etc/timezone \    &amp;&amp; rm -rf /var/cache/apk/*CMD ["/bin/bash"]Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里面的 <code>${KUBE_CONFIG}</code> 是一个自定义的环境变量，对于测试环境我将配置文件直接挂载入了容器中，然后 <code>${KUBE_CONFIG}</code> 只是指定了一个配置文件位置，实际生产环境中可以选择将配置文件变成自定义环境变量使用</p><h4 id="11-4、GitLab-CI-总结">11.4、GitLab CI 总结</h4><p>关于 GitLab CI 上面已经讲了很多，但是并不全面，也不算太细致；因为这东西说起来实际太多了，现在目测已经 1W 多字了；以下总结一下 GitLab CI 的总体思想，当思路清晰了以后，我想后面的只是查查文档自己试一试就行了</p><ul><li><strong>CS 架构</strong></li></ul><p>GitLab 作为 Server 端，控制 Runner 端执行一系列的 CI 任务；代码 clone 等无需关心，GitLab 会自动处理好一切；Runner 每次都会启动新的容器执行 CI 任务</p><ul><li><strong>容器即环境</strong></li></ul><p>在 Runner 使用 Docker build 的前提下；<strong>所有依赖切换、环境切换应当由切换不同镜像实现，即 build 那就使用 build 的镜像，deploy 就用带有 deploy 功能的镜像；通过不同镜像容器实现完整的环境隔离</strong></p><ul><li><strong>CI即脚本</strong></li></ul><p>不同的 CI 任务实际上就是在使用不同镜像的容器中执行 SHELL 命令，自动化 CI 就是执行预先写好的一些小脚本</p><ul><li><strong>敏感信息走环境变量</strong></li></ul><p>一切重要的敏感信息，如账户密码等，不要写到 CI 配置中，直接放到 GitLab 的环境变量中；GitLab 会保证将其推送到远端 Runner 的 SHELL 变量中</p><p>转载整理From：</p><ul><li><a target="_blank" rel="noopener" href="https://mritd.com/2017/09/05/git-flow-note/">git-flow-note</a></li><li><a target="_blank" rel="noopener" href="https://mritd.com/2017/11/28/ci-cd-gitlab-ci/">ci-cd-gitlab-ci</a></li></ul><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Gitlab" scheme="https://blog.17lai.site/categories/Gitlab/"/>
    
    
    <category term="Gitlab" scheme="https://blog.17lai.site/tags/Gitlab/"/>
    
    <category term="Git" scheme="https://blog.17lai.site/tags/Git/"/>
    
    <category term="CI/CD" scheme="https://blog.17lai.site/tags/CI-CD/"/>
    
  </entry>
  
  <entry>
    <title>Earthly 一个更加强大的镜像构建工具</title>
    <link href="https://blog.17lai.site/posts/593cc323/"/>
    <id>https://blog.17lai.site/posts/593cc323/</id>
    <published>2021-10-31T23:25:00.000Z</published>
    <updated>2022-03-16T10:52:12.416Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、Earthly-介绍">一、Earthly 介绍</h2><blockquote><p>开局一张图，功能全靠吹。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210057.png" alt="img"></p><p>Earthly 是一个更加高级的 Docker 镜像构建工具，Earthly 通过自己定义的 Earthfile 来代替传统的 Dockerfile 完成镜像构建；Earthfile 就如同 Earthly 官方所描述:</p><pre class="line-numbers language-none"><code class="language-none">**Makefile + Dockerfile = Earthfile**<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在使用 Earthly 进行构建镜像时目前强依赖于 buildkit，Earthly 通过 buildkit 支持了一些 Dockerfile 的扩展语法，同时将 Dockerfile 与 Makefile 整合，使得多平台构建和代码化 Dockerfile 变得更加简单；使用 Earthly 可以更加方便的完成 Dockerfile 的代码复用以及更加友好的 CI 自动集成。</p><h2 id="二、快速开始">二、快速开始</h2><h3 id="2-1、安装依赖">2.1、安装依赖</h3><p>Earthly 目前依赖于 Docker 和 Git，所以安装 Earthly 前请确保机器已经安装了 Docker 和 Git。</p><h3 id="2-2、安装-Earthly">2.2、安装 Earthly</h3><p>Earthly 采用 Go 编写，所以主要就一个二进制文件，Linux 下安装可以直接参考官方的安装脚本:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> /bin/sh -c <span class="token string">'wget https://github.com/earthly/earthly/releases/latest/download/earthly-linux-amd64 -O /usr/local/bin/earthly &amp;&amp; chmod +x /usr/local/bin/earthly &amp;&amp; /usr/local/bin/earthly bootstrap --with-autocomplete'</span>Copy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>安装完成后 Earthly 将会启动一个 buildkitd 容器: <code>earthly-buildkitd</code>。</p><h3 id="2-3、语法高亮">2.3、语法高亮</h3><p>目前 Earthly 官方支持 VS Code、VIM 以及 Sublime Text 三种编辑器的语法高亮，具体如何安装请参考 <a target="_blank" rel="noopener" href="https://earthly.dev/get-earthly">官方文档</a>。</p><h3 id="2-4、基本使用">2.4、基本使用</h3><p>本示例源于官方 Basic 教程，以下示例以编译 Go 项目为样例:</p><p>首先创建一个任意名称的目录，目录中存在项目源码文件以及一个 <code>Earthfile</code> 文件；</p><p><strong>main.go</strong></p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token string">"fmt"</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">}</span>Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Earthfile</strong></p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">FROM golang:1.17-alpineWORKDIR /go-examplebuild:    COPY main.go .    RUN go build -o build/go-example main.go    SAVE ARTIFACT build/go-example /go-example AS LOCAL build/go-exampledocker:    COPY +build/go-example .    ENTRYPOINT ["/go-example/go-example"]    SAVE IMAGE go-example:latestCopy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>有了 <code>Earthfile</code> 以后我们就可以使用 <code>Earthly</code> 将其打包为镜像；</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 目录结构</span>~/t/earthlytest ❯❯❯ tree<span class="token builtin class-name">.</span>├── Earthfile└── main.go<span class="token number">0</span> directories, <span class="token number">2</span> files<span class="token comment"># 通过 earthly 进行构建</span>~/t/earthlytest ❯❯❯ earthly +dockerCopy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210338.png" alt="img"></p><p>构建完成后我们就可以直接从 docker 的 images 列表中查看刚刚构建的镜像，并运行:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101212129.png" alt="img"></p><h2 id="三、进阶使用">三、进阶使用</h2><h3 id="3-1、多阶段构建">3.1、多阶段构建</h3><p>Earthfile 中包含类似 Makefile 一样的 <code>target</code>，不同的 <code>target</code> 之间还可以通过特定语法进行引用，每个 <code>target</code> 都可以被单独执行，执行过程中 earthly 会自动解析这些依赖关系。</p><p>这种多阶段构建时语法很弹性，我们可以在每个阶段运行独立的命令以及使用不同的基础镜像；从快速开始中可以看到，我们始终使用了一个基础镜像(<code>golang:1.17-alpine</code>)，对于 Go 这种编译后自带运行时不依赖其语言 SDK 的应用，我们事实上可以将 “发布物” 仅放在简单的运行时系统镜像内，从而减少最终镜像体积:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210338-2.png" alt="img"></p><p>由于使用了多个 target，所以我们可以单独的运行 <code>build</code> 这个 target 来验证我们的编译流程，<strong>这种多 target 的设计方便我们构建应用时对编译、打包步骤的细化拆分，同时也方便我们进行单独的验证。</strong> 例如我们单独执行 <code>build</code> 这个 target 来验证我们的编译流程是否正确:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210338-3.png" alt="img"></p><p>在其他阶段验证完成后，我们可以直接运行最终的 target，earthly 会自动识别到这种依赖关系从而自动运行其依赖的 target:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210338-4.png" alt="img"></p><h3 id="3-2、扩展指令">3.2、扩展指令</h3><h4 id="3-2-1、SAVE">3.2.1、SAVE</h4><p>SAVE 指令是 Earthly 自己的一个扩展指令，实际上分为 <code>SAVE ARTIFACT</code> 和 <code>SAVE IMAGE</code>；其中 <code>SAVE ARTIFACT</code> 指令格式如下:</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">SAVE ARTIFACT [--keep-ts] [--keep-own] [--if-exists] [--force] &lt;src&gt; [&lt;artifact-dest-path&gt;] [AS LOCAL &lt;local-path&gt;]Copy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>SAVE ARTIFACT</code> 指令用于将文件或目录从 build 运行时环境保存到 target 的 artifact 环境；当保存到 artifact 环境后，可以通过 <code>COPY</code> 等命令在其他位置进行引用，类似于 Dockerfile 的 <code>COPY --from...</code> 语法；不同的是 <code>SAVE ARTIFACT</code> 支持 <code>AS LOCAL &lt;local-path&gt;</code> 附加参数，一但指定此参数后，earthly 会同时将文件或目录在宿主机复制一份，一般用于调试等目的。<code>SAVE ARTIFACT</code> 命令在上面的样例中已经展示了，在运行完 <code>earthly +build</code> 命令后实际上会在本地看到被 SAVE 出来的 ARTIFACT:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210338-5.png" alt="img"></p><p>而另一个 <code>SAVE IMAGE</code> 指令则主要用于将当前的 build 环境 SAVE 为一个 IMAGE，<strong>如果指定了 <code>--push</code> 选项，同时在执行 <code>earthly +target</code> 命令时也加入 <code>--push</code> 选项，该镜像将会自动被推送到目标 Registry 上。</strong><code>SAVE IMAGE</code> 指令格式如下:</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">SAVE IMAGE [--cache-from=&lt;cache-image&gt;] [--push] &lt;image-name&gt;...Copy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210338-6.png" alt="img"></p><h4 id="3-2-2、GIT-CLONE">3.2.2、GIT CLONE</h4><p><code>GIT CLONE</code> 指令用于将指定 git 仓库 clone 到 build 环境中；与 <code>RUN git clone...</code> 命令不同的是，<strong><code>GIT CLONE</code> 通过宿主机的 git 命令运行，它不依赖于容器内的 git 命令，同时还可以直接为 earthly 配置 git 认证，从而避免将这些安全信息泄漏到 build 环境中；</strong> 关于如何配置 earthly 的 git 认证请参考 <a target="_blank" rel="noopener" href="https://docs.earthly.dev/docs/guides/auth">官方文档</a>；下面是 <code>GIT CLONE</code> 指令的样例</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101213746.png" alt="img"></p><h4 id="3-2-3、COPY">3.2.3、COPY</h4><p><code>COPY</code> 指令与标准的 Dockerfile COPY 指令类似，除了支持 Dockerfile 标准的 COPY 功能以外，<strong>earthly 中的 <code>COPY</code> 指令可以引用其他 target 环节产生的 artifact，在引用时会自动声明依赖关系；即当在 <code>B</code> target 中存在 <code>COPY +A/xxxxx /path/to/copy</code> 类似的指令时，如果只单纯的执行 <code>earthly +B</code>，那么 earthly 根据依赖分析会得出在 COPY 之前需要执行 target A。</strong><code>COPY</code> 指令的语法格式如下:</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile"># 与 Dockerfile 相同的使用方式，从上下文复制COPY [options...] &lt;src&gt;... &lt;dest&gt;# 扩展支持的从 target 复制方式COPY [options...] &lt;src-artifact&gt;... &lt;dest&gt;Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-2-4、RUN">3.2.4、RUN</h4><p><code>RUN</code> 指令在标准使用上与 Dockerfile 里保持一致，除此之外增加了更多的扩展选项，其指令格式如下:</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile"># shell 方式运行(/bin/sh -c)RUN [--push] [--entrypoint] [--privileged] [--secret &lt;env-var&gt;=&lt;secret-ref&gt;] [--ssh] [--mount &lt;mount-spec&gt;] [--] &lt;command&gt;# exec 方式运行RUN [[&lt;flags&gt;...], "&lt;executable&gt;", "&lt;arg1&gt;", "&lt;arg2&gt;", ...]Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中 <code>--privileged</code> 选项允许运行的命令使用 <code>privileged capabilities</code>，但是需要 earthly 在运行 target 时增加 <code>--allow-privileged</code> 选项；<code>--interactive / --interactive-keep</code> 选项用于交互式执行一些命令，在完成交互后 build 继续进行，<strong>在交互过程中进行的操作都会被持久化到 镜像中:</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210338-8.png" alt="img"></p><p>限于篇幅原因，其他的具体指令请查阅官方文档 <a target="_blank" rel="noopener" href="https://docs.earthly.dev/docs/earthfile">Earthfile reference</a>。</p><h3 id="3-3、UDCS">3.3、UDCS</h3><p>UDCs 全称 “User-defined commands”，即用户定义指令；通过 UDCs 我们可以将 Earthfile 中特定的命令剥离出来，从而实现更加通用和统一的代码复用；下面是一个定义 UDCs 指令的样例:</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile"># 定义一个 Command# ⚠️ 注意: 语法必须满足以下规则# 1、名称全大写# 2、名称下划线分割# 3、首个命令必须为 COMMAND(后面没有冒号)MY_COPY:    COMMAND    ARG src    ARG dest=./    ARG recursive=false    RUN cp $(if $recursive =  "true"; then printf -- -r; fi) "$src" "$dest"# target 中引用build:    FROM alpine:3.13    WORKDIR /udc-example    RUN echo "hello" &gt;./foo    # 通过 DO 关键字引用 UDCs    DO +MY_COPY --src=./foo --dest=./bar    RUN cat ./bar # prints "hello"Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>UDCs 不光可以定义在一个 Earthfile 中，UDCs 可以跨文件、跨目录引用:</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101212525.png" alt="img"></p><p>有了 UDCs 以后，我们可以通过这种方式将对基础镜像的版本统一控制、对特殊镜像的通用处理等操作全部抽象出来，然后每个 Earthfile 根据需要进行引用；关于 UDCs 的使用样例可以参考我的 <a target="_blank" rel="noopener" href="https://github.com/mritd/autobuild">autobuild</a> 项目，其中的 <a target="_blank" rel="noopener" href="https://github.com/mritd/autobuild/tree/main/earthfiles/udcs">udcs</a> 目录定义了大量的通用 UDCs，这些 UDCs 被其他目标镜的 Earthfile 批量引用。</p><h3 id="3-4、多平台构建">3.4、多平台构建</h3><p>在以前使用 Dockerfile 的时候，我们需要自己配置然后开启 buildkit 来实现多平台构建；在配置过程中可能会很繁琐，现在使用 earthly 可以默认帮我们实现多平台的交叉编译，我们需要做的仅仅是在 Earthfile 中声明需要支持哪些平台而已:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210338-10.png" alt="img"></p><p>以上 Earthfile 在执行 <code>earthly --push +all</code> 构建时，将会自动构建四个平台的镜像，并保持单个 tag，同时由于使用了 <code>--push</code> 选项还会自动推送到 Docker Hub 上:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210338-11.png" alt="img"></p><h2 id="四、总结">四、总结</h2><p>Earthly 弥补了 Dockerfile 的很多不足，解决了很多痛点问题；但同样可能需要一些学习成本，但是如果已经熟悉了 Dockerfile 其实学习成本不高；所以目前还是比较推荐将 Dockerfile 切换为 Earthfile 进行统一和版本化管理的。本文由于篇幅所限(懒)很多地方没有讲，比如共享缓存等，所以关于 Earthly 更多的详细使用等最好还是仔细阅读一下<a target="_blank" rel="noopener" href="https://docs.earthly.dev/docs/guides">官方文档</a>。</p><blockquote><p>整理转载：<a target="_blank" rel="noopener" href="https://mritd.com/2021/10/27/the-best-image-build-tool-earthly/">the-best-image-build-tool-earthly</a></p></blockquote><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Docker" scheme="https://blog.17lai.site/categories/Docker/"/>
    
    
    <category term="Docker" scheme="https://blog.17lai.site/tags/Docker/"/>
    
    <category term="Earthly" scheme="https://blog.17lai.site/tags/Earthly/"/>
    
  </entry>
  
  <entry>
    <title>Hexo Markdown以及各种插件功能测试</title>
    <link href="https://blog.17lai.site/posts/cf0f47fd/"/>
    <id>https://blog.17lai.site/posts/cf0f47fd/</id>
    <published>2021-10-20T01:25:00.000Z</published>
    <updated>2022-03-16T11:19:39.493Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="Markdown-插件">Markdown 插件</h2><ul><li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-abbr">markdown-it-abbr</a></li><li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-container">markdown-it-container</a></li><li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-deflist">markdown-it-deflist</a></li><li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-emoji">markdown-it-emoji</a></li><li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-footnote">markdown-it-footnote</a></li><li><a target="_blank" rel="noopener" href="https://github.com/tatsy/markdown-it-imsize">markdown-it-imsize</a></li><li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-ins">markdown-it-ins</a></li><li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-mark">markdown-it-mark</a></li><li><a target="_blank" rel="noopener" href="https://github.com/rlidwka/markdown-it-regexp">markdown-it-regexp</a></li><li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-sub">markdown-it-sub</a></li><li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-sup">markdown-it-sup</a></li><li><a target="_blank" rel="noopener" href="https://github.com/linsir/markdown-it-task-checkbox">markdown-it-task-checkbox</a></li></ul><h3 id="常用标记">常用标记</h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token list punctuation">-</span> 29^th^ =&gt; <span class="token code-snippet code keyword">`29&lt;sup&gt;th&lt;/sup&gt;`</span><span class="token list punctuation">-</span> H<span class="token strike"><span class="token punctuation">~</span><span class="token content">2</span><span class="token punctuation">~</span></span>0 =&gt; <span class="token code-snippet code keyword">`H&lt;sub&gt;2&lt;/sub&gt;O`</span><span class="token list punctuation">-</span> ==marked== =&gt; <span class="token code-snippet code keyword">`&lt;mark&gt;inserted&lt;/mark&gt;`</span><span class="token list punctuation">-</span> ++inserted++ =&gt; <span class="token code-snippet code keyword">`&lt;ins&gt;inserted&lt;/ins&gt;`</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>29<sup>th</sup> =&gt; <code>29&lt;sup&gt;th&lt;/sup&gt;</code></li><li>H<sub>2</sub>0 =&gt; <code>H&lt;sub&gt;2&lt;/sub&gt;O</code></li><li><mark>marked</mark> =&gt; <code>&lt;mark&gt;inserted&lt;/mark&gt;</code></li><li><ins>inserted</ins> =&gt; <code>&lt;ins&gt;inserted&lt;/ins&gt;</code></li></ul><h3 id="markdown-it-task-checkbox"><a target="_blank" rel="noopener" href="https://github.com/linsir/markdown-it-task-checkbox">markdown-it-task-checkbox</a></h3><blockquote><p>和主题某些css冲突，停用</p></blockquote><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token list punctuation">-</span> [x] item 1    <span class="token list punctuation">-</span> [x] item 1-1    <span class="token list punctuation">-</span> [ ] item 1-2    <span class="token list punctuation">-</span> [ ] item 1-3    <span class="token list punctuation">-</span> [ ] item 1-4<span class="token list punctuation">-</span> [ ] item 2    <span class="token list punctuation">-</span> [ ] item 2-1    <span class="token list punctuation">-</span> [ ] item 2-2    <span class="token list punctuation">-</span> [ ] item 2-3    <span class="token list punctuation">-</span> [ ] item 2-4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>[x] item 1<ul><li>[x] item 1-1</li><li>[ ] item 1-2</li><li>[ ] item 1-3</li><li>[ ] item 1-4</li></ul></li><li>[ ] item 2<ul><li>[ ] item 2-1</li><li>[ ] item 2-2</li><li>[ ] item 2-3</li><li>[ ] item 2-4</li></ul></li></ul><h3 id="markdown-it-multimd-table"><a target="_blank" rel="noopener" href="https://github.com/RedBug312/markdown-it-multimd-table">markdown-it-multimd-table</a></h3><blockquote><p>目前仅支持多列合并</p></blockquote><pre class="line-numbers language-none"><code class="language-none">| 标题1        | 标题2        || ------------ | ------------ || 合并第一行                ||| 第二行第一列 | 第二行第二列 |<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th style="text-align:left">标题1</th><th style="text-align:left">标题2</th></tr></thead><tbody><tr><td style="text-align:left">合并第一行</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">第二行第一列</td><td style="text-align:left">第二行第二列</td></tr></tbody></table><p>colspan <code>&gt;</code> or <code>empty cell</code>:</p><table><thead><tr><th style="text-align:left">a</th><th style="text-align:left">b</th></tr></thead><tbody><tr><td style="text-align:left">&gt;</td><td style="text-align:left">1</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left"></td></tr></tbody></table><p>rowspan ‘^’</p><table><thead><tr><th style="text-align:left">a</th><th style="text-align:left">b</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left">2</td></tr><tr><td style="text-align:left">^^</td><td style="text-align:left">4</td></tr></tbody></table><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token table"><span class="token table-header-row"><span class="token punctuation">|</span><span class="token table-header important">   Markdown   </span><span class="token punctuation">|</span><span class="token table-header important"> Rendered HTML </span><span class="token punctuation">|</span></span><span class="token table-line"><span class="token punctuation">|</span><span class="token punctuation">--------------</span><span class="token punctuation">|</span><span class="token punctuation">---------------</span><span class="token punctuation">|</span></span><span class="token table-data-rows"></span></span>|    <span class="token italic"><span class="token punctuation">*</span><span class="token content">Italic</span><span class="token punctuation">*</span></span>  | <span class="token italic"><span class="token punctuation">*</span><span class="token content">Italic</span><span class="token punctuation">*</span></span>      | \|              |               ||    - Item 1  | - Item 1      | \|    - Item 2  | - Item 2      ||    ```python | ```python       \|    .1 + .2   | .1 + .2         \|    ```       | ```           |<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th style="text-align:left">Markdown</th><th style="text-align:left">Rendered <abbr title="Hyper Text Markup Language">HTML</abbr></th><th></th></tr></thead><tbody><tr><td style="text-align:left"><em>Italic</em></td><td style="text-align:left"><em>Italic</em></td><td>\</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"></td><td></td></tr><tr><td style="text-align:left">- Item 1</td><td style="text-align:left">- Item 1</td><td>\</td></tr><tr><td style="text-align:left">- Item 2</td><td style="text-align:left">- Item 2</td><td></td></tr><tr><td style="text-align:left">```python</td><td style="text-align:left">```python \</td><td></td></tr><tr><td style="text-align:left">.1 + .2</td><td style="text-align:left">.1 + .2 \</td><td></td></tr><tr><td style="text-align:left">```</td><td style="text-align:left">```</td><td></td></tr></tbody></table><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token table"><span class="token table-header-row"><span class="token punctuation">|</span><span class="token table-header important"> Task           </span><span class="token punctuation">|</span><span class="token table-header important"> Time required </span><span class="token punctuation">|</span><span class="token table-header important"> Assigned to   </span><span class="token punctuation">|</span><span class="token table-header important"> Current Status </span><span class="token punctuation">|</span><span class="token table-header important"> Finished </span><span class="token punctuation">|</span><span class="token table-header important"> </span></span><span class="token table-line"><span class="token punctuation">|</span><span class="token punctuation">----------------</span><span class="token punctuation">|</span><span class="token punctuation">---------------</span><span class="token punctuation">|</span><span class="token punctuation">---------------</span><span class="token punctuation">|</span><span class="token punctuation">----------------</span><span class="token punctuation">|</span><span class="token punctuation">-----------</span><span class="token punctuation">|</span></span><span class="token table-data-rows"><span class="token punctuation">|</span><span class="token table-data"> Calendar Cache </span><span class="token punctuation">|</span><span class="token table-data"> &gt; 5 hours  </span><span class="token punctuation">|</span><span class="token table-data"> @georgehrke </span><span class="token punctuation">|</span><span class="token table-data"> in progress </span><span class="token punctuation">|</span><span class="token table-data"> <span class="token list punctuation">-</span> [x] ok?</span><span class="token punctuation">|</span><span class="token table-data"> Object Cache   </span><span class="token punctuation">|</span><span class="token table-data"> &gt; 5 hours  </span><span class="token punctuation">|</span><span class="token table-data"> @georgehrke </span><span class="token punctuation">|</span><span class="token table-data"> in progress </span><span class="token punctuation">|</span><span class="token table-data"> [x] item1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>[ ] item2</span><span class="token punctuation">|</span><span class="token table-data"> Object Cache   </span><span class="token punctuation">|</span><span class="token table-data"> &gt; 5 hours  </span><span class="token punctuation">|</span><span class="token table-data"> @georgehrke </span><span class="token punctuation">|</span><span class="token table-data"> in progress </span><span class="token punctuation">|</span><span class="token table-data"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>- [x] item1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>- [ ] item2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">|</span><span class="token table-data"> Object Cache   </span><span class="token punctuation">|</span><span class="token table-data"> &gt; 5 hours  </span><span class="token punctuation">|</span><span class="token table-data"> @georgehrke </span><span class="token punctuation">|</span><span class="token table-data"> in progress </span><span class="token punctuation">|</span><span class="token table-data"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>[x] item1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>[ ] item2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span></span></span></span><span class="token list punctuation">-</span> [x] works<span class="token list punctuation">-</span> [x] works too<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th style="text-align:left">Task</th><th style="text-align:left">Time required</th><th style="text-align:left">Assigned to</th><th style="text-align:left">Current Status</th><th style="text-align:left">Finished</th></tr></thead><tbody><tr><td style="text-align:left">Calendar Cache</td><td style="text-align:left">&gt; 5 hours</td><td style="text-align:left">@georgehrke</td><td style="text-align:left">in progress</td><td style="text-align:left">- [x] ok?</td></tr><tr><td style="text-align:left">Object Cache</td><td style="text-align:left">&gt; 5 hours</td><td style="text-align:left">@georgehrke</td><td style="text-align:left">in progress</td><td style="text-align:left">[x] item1 [ ] item2</td></tr><tr><td style="text-align:left">Object Cache</td><td style="text-align:left">&gt; 5 hours</td><td style="text-align:left">@georgehrke</td><td style="text-align:left">in progress</td><td style="text-align:left">- [x] item1- [ ] item2</td></tr><tr><td style="text-align:left">Object Cache</td><td style="text-align:left">&gt; 5 hours</td><td style="text-align:left">@georgehrke</td><td style="text-align:left">in progress</td><td style="text-align:left">[x] item1[ ] item2</td></tr></tbody></table><ul><li>[x] works</li><li>[x] works too</li></ul><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token table"><span class="token table-header-row"><span class="token table-header important">Function </span><span class="token punctuation">|</span><span class="token table-header important"> MySQL / MariaDB </span><span class="token punctuation">|</span><span class="token table-header important"> PostgreSQL </span><span class="token punctuation">|</span><span class="token table-header important"> SQLite</span></span><span class="token table-line"><span class="token punctuation">:------------</span> <span class="token punctuation">|</span> <span class="token punctuation">:-------------</span><span class="token punctuation">|</span> <span class="token punctuation">:-------------</span><span class="token punctuation">|</span> <span class="token punctuation">:-------------</span></span><span class="token table-data-rows"><span class="token table-data">substr </span><span class="token punctuation">|</span><span class="token table-data"> :heavy_check_mark: </span><span class="token punctuation">|</span><span class="token table-data">  :white_check_mark: </span><span class="token punctuation">|</span><span class="token table-data"> :heavy_check_mark:</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><table><thead><tr><th style="text-align:left">Function</th><th style="text-align:left">MySQL / MariaDB</th><th style="text-align:left">PostgreSQL</th><th style="text-align:left">SQLite</th></tr></thead><tbody><tr><td style="text-align:left">substr</td><td style="text-align:left">✔️</td><td style="text-align:left">✅</td><td style="text-align:left">✔️</td></tr></tbody></table><h3 id="emoji"><a target="_blank" rel="noopener" href="https://www.webfx.com/tools/emoji-cheat-sheet/">emoji</a></h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">:smile::smirk::sunny:<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>😄😏☀️</p><h3 id="markdown-it-abbr"><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-abbr">markdown-it-abbr</a></h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token italic"><span class="token punctuation">*</span><span class="token content">[HTML]: Hyper Text Markup Language</span><span class="token punctuation">*</span></span><span class="token url-reference url"><span class="token punctuation">[</span><span class="token variable">W3C</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  World</span> Wide Web ConsortiumThe HTML specificationis maintained by the W3C.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>The <abbr title="Hyper Text Markup Language">HTML</abbr> specification<br>is maintained by the <abbr title="World Wide Web Consortium">W3C</abbr>.</p><h3 id="markdown-it-container"><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-container">markdown-it-container</a></h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">::: warning<span class="token italic"><span class="token punctuation">*</span><span class="token content">here be dragons</span><span class="token punctuation">*</span></span>:::<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><em>here be dragons</em></p><h3 id="footnote">footnote</h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">Here is a footnote reference,[^1] and another.[^longnote]<span class="token url-reference url"><span class="token punctuation">[</span><span class="token variable">^1</span><span class="token punctuation">]</span><span class="token punctuation">:</span> Here</span> is the footnote.<span class="token url-reference url"><span class="token punctuation">[</span><span class="token variable">^longnote</span><span class="token punctuation">]</span><span class="token punctuation">:</span> Here's</span> one with multiple blocks.<span class="token code keyword">    Subsequent paragraphs are indented to show that they</span>belong to the previous footnote.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Here is a footnote reference,<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> and another.<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup></p><p>belong to the previous footnote.</p><h3 id="markdown-it-imsize"><a target="_blank" rel="noopener" href="https://github.com/tatsy/markdown-it-imsize">markdown-it-imsize</a></h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url"><span class="token operator">!</span>[<span class="token content">test</span>](<span class="token url">https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1220211012022352.png</span>)</span>![test](https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1220211012022352.png =100x200)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1220211012022352.png" alt="test"><br>![test](<a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1220211012022352.png">https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1220211012022352.png</a> =100x200)</p><h2 id="公式测试">公式测试</h2><blockquote><p>采用**<a target="_blank" rel="noopener" href="https://github.com/MakerGYT/markdown-it-latex2img">markdown-it-latex2img</a>**</p></blockquote><p><a target="_blank" rel="noopener" href="https://makergyt.github.io/markdown-it-latex2img/">Demo</a></p><h3 id="1-数学公式">1 数学公式</h3><h4 id="1-1-内联公式">1.1 内联公式</h4><p><strong>开头的<code>$</code>必须在其右边紧跟一个非空格字符，而结尾的<code>$</code>必须在其左边紧接一个非空格字符，并且不能紧跟一个数字。</strong></p><ul><li>勾股定理: <img src="https://math.now.sh?inline=a%5E2%2Bb%5E2%3Dc%5E2" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></li><li>等差数列求和公式: <img src="https://math.now.sh?inline=S_%7Bn%7D%3Dn%20a_%7B1%7D%2B%5Cfrac%7Bn%28n-1%29%7D%7B2%7D%20d%2C%20n%20%5Cin%20N%5E%7B*%7D" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></li><li>牛顿-莱布尼茨公式: <img src="https://math.now.sh?inline=%5Cint_%7Ba%7D%5E%7Bb%7D%20f%28x%29%20d%20x%3DF(b)-F(a)%3D%5Cleft.F(x)%5Cright%7C_%7Ba%7D%20%5E%7Bb%7D" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></li><li>二项分布: <img src="https://math.now.sh?inline=P_%7Bn%7D%28k%29%3DC_%7Bn%7D%5E%7Bk%7D%20p%5E%7Bk%7D%20q%5E%7Bn-k%7D%20%5Cquad%20k%3D0%2C1%2C2%20%5Cldots%20%5Cldots%2C%20n" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></li></ul><h4 id="1-2-块公式">1.2 块公式</h4><p>正态分布<img src="https://math.now.sh?inline=X%20%5Csim%20N%28%5Cmu%2C%5Csigma%5E2%29" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;">:</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=f%28x%29%20%3D%20%5Cfrac%7B1%7D%7B%5Csqrt%7B2%5Cpi%7D%5Csigma%7De%5E%7B-%5Cfrac%7B(x-%5Cmu)%5E2%7D%7B2%5Csigma%5E2%7D%7D%0A"></p><p>斐波那契数列<img src="https://math.now.sh?inline=A_n%3DA_%7Bn-1%7D%2BA_%7Bn-2%7D" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;">,前后两项的比值逐渐收敛到黄金分割比例</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=%5Clim_%7Bn%5Cto%20%5Cinfty%7D%5Cfrac%7BA_%7Bn-1%7D%7D%7BA_n%7D%3D%5Cfrac%7B%5Csqrt%7B5%7D-1%7D%7B2%7D.%0A"></p><p>因式分解</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=%5Cbegin%7Bsplit%7D%28x%E2%88%921%29(x%E2%88%923)%26%3Dx%5E2%E2%88%924x%2B3%20%5C%5C%20%0A%26%3Dx%5E2%E2%88%924x%2B4%E2%88%921%20%5C%5C%20%0A%26%3D(x%E2%88%922)%5E2%E2%88%921%0A%5Cend%7Bsplit%7D%0A"></p><p>狄利克雷函数</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=D%28x%29%3D%0A%5Cbegin%7Bcases%7D%0A1%2C%26%20x%20%5Cin%20Q%20%5C%5C%0A0%2C%26%20x%20%5Cnotin%20Q%0A%5Cend%7Bcases%7D%0A"></p><p>高斯公式</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=%5Ciiint_%7B%5COmega%7D%5Cleft%28%5Cfrac%7B%5Cpartial%20P%7D%7B%5Cpartial%20x%7D%2B%5Cfrac%7B%5Cpartial%20Q%7D%7B%5Cpartial%20y%7D%2B%5Cfrac%7B%5Cpartial%20R%7D%7B%5Cpartial%20z%7D%5Cright%29%20d%20v%3D%5Ciint_%7B%5CSigma%7D%20P%20d%20y%20d%20z%2BQ%20d%20z%20d%20x%2BR%20d%20x%20d%20y%0A"></p><p>范德蒙行列式</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=D_%7Bn-1%7D%3D%5Cleft%7C%5Cbegin%7Barray%7D%7Bcccc%7D%0A1%20%26%201%20%26%20%5Cdots%20%26%201%20%5C%5C%0Ax_%7B2%7D%20%26%20x_%7B3%7D%20%26%20%5Cdots%20%26%20x_%7Bn%7D%20%5C%5C%0A%5Cvdots%20%26%20%5Cvdots%20%26%20%26%20%5Cvdots%20%5C%5C%0Ax_%7B2%7D%5E%7Bn-2%7D%20%26%20x_%7B3%7D%5E%7Bn-2%7D%20%26%20%5Cdots%20%26%20x_%7Bn%7D%5E%7Bn-2%7D%0A%5Cend%7Barray%7D%5Cright%7C%3D%5Cprod_%7B2%20%5Cleq%20j%3Ci%20%5Cleq%20n%7D%5Cleft%28x_%7Bi%7D-x_%7Bj%7D%5Cright%29"></p><p>线性方程组</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=%5Cleft%5C%7B%5Cbegin%7Baligned%7D%0Aa_%7B11%7D%20x_%7B1%7D%2Ba_%7B12%7D%20x_%7B2%7D%2B%5Ccdots%2Ba_%7B1%20n%7D%20x_%7Bn%7D%20%26%3Db_%7B1%7D%20%5C%5C%0Aa_%7B21%7D%20x_%7B1%7D%2Ba_%7B22%7D%20x_%7B2%7D%2B%5Ccdots%2Ba_%7B2%20n%7D%20x_%7Bn%7D%20%26%3Db_%7B2%7D%20%5C%5C%0A%5Ccdots%20%5Ccdots%20%5Ccdots%20%5C%5C%0Aa_%7Bm%201%7D%20x_%7B1%7D%2Ba_%7Bm%202%7D%20x_%7B2%7D%2B%5Ccdots%2Ba_%7Bm%20n%7D%20x_%7Bn%7D%20%26%3Db_%7Bm%7D%0A%5Cend%7Baligned%7D%5Cright."></p><h3 id="2-物理公式">2 物理公式</h3><ul><li>牛顿第一定律: <img src="https://math.now.sh?inline=%5Csum%20%5Cvec%7BF%7D_%7Bi%7D%3D%5Cfrac%7B%5Cmathrm%7Bd%7D%20%5Cvec%7Bv%7D%7D%7B%5Cmathrm%7Bd%7D%20t%7D%3D0" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></li><li>牛顿第二定律: <img src="https://math.now.sh?inline=%5Cvec%7BF%7D%3D%5Cfrac%7B%5Cmathrm%7Bd%7D%20m%7D%7B%5Cmathrm%7Bd%7D%20t%7D%20%5Cvec%7Bv%7D%2Bm%20%5Cfrac%7B%5Cmathrm%7Bd%7D%20%5Cvec%7Bv%7D%7D%7B%5Cmathrm%7Bd%7D%20t%7D%3D%5Cfrac%7B%5Cmathrm%7Bd%7D%20m%7D%7B%5Cmathrm%7Bd%7D%20t%7D%20%5Cvec%7Bv%7D%2Bm%20%5Cvec%7Ba%7D%3D%5Cfrac%7B%5Cmathrm%7Bd%7D%20m%7D%7B%5Cmathrm%7Bd%7D%20t%7D%20%5Cvec%7Bv%7D%2Bm%20%5Cfrac%7B%5Cmathrm%7Bd%7D%5E%7B2%7D%20%5Cvec%7Br%7D%7D%7B%5Cmathrm%7Bd%7D%20t%5E%7B2%7D%7D" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></li><li>牛顿第三定律: <img src="https://math.now.sh?inline=%5Coverrightarrow%7BF_%7B12%7D%7D%3D-%5Coverrightarrow%7BF_%7B21%7D%7D" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></li><li>质能守恒: <img src="https://math.now.sh?inline=E%3Dmc%5E2" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></li></ul><p>万有引力定律: <img src="https://math.now.sh?inline=F%3D%5Cfrac%7BG%20M%20m%7D%7Br%5E%7B2%7D%7D" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=G%20%5Cfrac%7Bm%20M%7D%7B%28r%2Bh%29%5E%7B2%7D%7D%3Dm%20%5Cfrac%7B%5Cnu%5E%7B2%7D%7D%7B(r%2Bh)%7D%0A"></p><p>基尔霍夫定律</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=%5Cleft%5B%5Cfrac%7B%5Cpartial%5Cleft%28%5CDelta_%7Br%7D%20H_%7Bm%7D%5Cright%29%7D%7B%5Cpartial%20T%7D%5Cright%5D_%7Bp%7D%3D%5Csum_%7BB%7D%20v_%7BB%7D%20C_%7Bp%2C%20m%7D(B)%0A"></p><p>热力学第二定律</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=d%20S%20%5Cgeq%20%5Cfrac%7B%5Cdelta%20Q%7D%7BT%7D%0A"></p><h3 id="3-化学公式">3 化学公式</h3><p>离子反应与沉淀: <img src="https://math.now.sh?inline=%5Cce%7BSO4%5E2-%20%2B%20Ba%5E2%2B%20-%3E%20BaSO4%20v%7D" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></p><p>氮气氢气合成氨</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=%5Cce%7BN2%20%2B%203H2%20%3C%3D%3ET%5B%E9%AB%98%E6%B8%A9%E3%80%81%E5%8A%A0%E5%8E%8B%5D%5B%E5%82%AC%E5%8C%96%E5%89%82%5D%202NH3%7D%0A"></p><p>化学平衡常数:<img src="https://math.now.sh?inline=%5Cmathrm%7BZn%7D%2B2%20%5Cmathrm%7BHCl%7D%28%5Cmathrm%7Baq%7D%29%3D%5Cmathrm%7BH%7D_%7B2%7D%2B%5Cmathrm%7BZnCl%7D_%7B2%7D%20%5Cquad(%5Cmathrm%7Baq%7D)" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=K%5E%7B%5Ctheta%7D%3D%5Cfrac%7B%5Cleft%5Bp%5Cleft%28%5Cmathrm%7BH%7D_%7B2%7D%5Cright%29%20%2F%20p%5E%7B%5Ctheta%7D%5Cright%5D%5Cleft%5Bc%5Cleft(%5Cmathrm%7BZnCl%7D_%7B2%7D%5Cright)%5Cright%5D%7D%7Bc%5E%7B2%7D(%5Cmathrm%7BHC%7D)%7D%0A"></p><h3 id="4-生物公式">4 生物公式</h3><p>光合作用</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=%5Cce%3C!--swig%EF%BF%BC75--%3E%0A"></p><h3 id="5-语法参考">5 语法参考</h3><p><a target="_blank" rel="noopener" href="https://math.meta.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference">MathJax basic tutorial and quick reference</a></p><h4 id="长公式">长公式</h4><p><img src="https://math.now.sh/?from=%5Cdef%20%5Clowercase%20%7B%5Calpha%20%5Cbeta%20%5Cgamma%20%5Cdelta%20%5Cepsilon%20%5Czeta%20%5Ceta%20%5Ctheta%20%5Ciota%20%5Ckappa%20%5Clambda%20%5Cmu%20%5Cnu%20%5Comicron%20%5Cpi%20%5Crho%20%5Csigma%20%5Ctau%20%5Cupsilon%20%5Cphi%20%5Cchi%20%5Cpsi%20%5Comega%7D%0A%5Cdef%20%5Cuppercase%20%7BA%20B%20%5CGamma%20%5CDelta%20E%20Z%20E%20%5CTheta%20I%20K%20%5CLambda%20M%20N%20O%20%5CPi%20R%20%5CSigma%20T%20%5CUpsilon%20%5CPhi%20X%20%5CPsi%20%5COmega%7D%0A%5Cdef%20%5Clong%20%7B%5Cuppercase%20%5CLeftrightarrow%20%5Clowercase%7D%0A" alt="img"></p><p><img src="https://math.now.sh/?inline=%5Ctext%7Blong%20inline%20mathjax%3A%7D%5Cquad%20%5Clong%20%5Cquad%20%5Clong%20%5Cquad%20%5Clong" alt="img"></p><p><img src="https://math.now.sh/?from=%5Ctext%7B%3C-%20long%20displayed%20mathjax%20example%20-%3E%7D%20%5C%5C%0A%5Cbegin%7Bsplit%7D%0A%5Clong%20%5Cquad%20%26%5Clong%20%5C%5C%0A%26%5Clong%20%5Cquad%20%5Clong%0A%5Cend%7Bsplit%7D%0A" alt="img"></p><h4 id="小括号测试">小括号测试</h4><pre class="line-numbers language-none"><code class="language-none">$\alpha\beta$$\alpha_\beta$$\alpha_\beta = \gamma_\delta$(abctest)\(abctest\)\\(abctest\\)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://math.now.sh?inline=%5Calpha%5Cbeta" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></p><p><img src="https://math.now.sh?inline=%5Calpha_%5Cbeta" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></p><p><img src="https://math.now.sh?inline=%5Calpha_%5Cbeta%20%3D%20%5Cgamma_%5Cdelta" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></p><p>(abctest)</p><p>(abctest)</p><p>\(abctest\)</p><h4 id="下划线测试">下划线测试</h4><pre class="line-numbers language-none"><code class="language-none">w^{(l)}*{ij} = w^{(l)}*{ij} - \eta\frac{\partial E(W, b)}{\partial w^{(l)}_{ij}}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://math.now.sh/?from=w%5E%7B%28l%29%7D*%7Bij%7D%20%3D%20w%5E%7B(l)%7D*%7Bij%7D%20-%20%5Ceta%5Cfrac%7B%5Cpartial%20E(W%2C%20b)%7D%7B%5Cpartial%20w%5E%7B(l)%7D_%7Bij%7D%7D%0A" alt="img"></p><h2 id="CSS测试">CSS测试</h2><p>文字增加背景色块 <span id="inline-blue">站点配置文件</span>,<br><span id="inline-purple">主题配置文件</span></p><pre class="line-numbers language-none"><code class="language-none">&lt;span id="inline-blue"&gt;站点配置文件&lt;/span&gt;, &lt;span id="inline-purple"&gt;主题配置文件&lt;/span&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="引用边框变色">引用边框变色</h3><p id="div-border-left-red">如果没有安装成功, 那可能就是墙的原因. 建议下载 `Node.js` 直接安装. </p><p id="div-border-top-blue">关于更多基本操作和基础知识, 请查阅 [Hexo](https://hexo.io/zh-cn/) 与 [NexT](http://theme-next.iissnan.com/) 官方文档.</p>  <pre class="line-numbers language-none"><code class="language-none">&lt;p id="div-border-left-red"&gt;如果没有安装成功, 那可能就是墙的原因. 建议下载 `Node.js` 直接安装. &lt;/p&gt;&lt;p id="div-border-top-blue"&gt;关于更多基本操作和基础知识, 请查阅 [Hexo](https://hexo.io/zh-cn/) 与 [NexT](http://theme-next.iissnan.com/) 官方文档.&lt;/p&gt;  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="图形边框效果">图形边框效果</h3><p><a id="download" target="_blank" rel="noopener" href="https://git-scm.com/download/win"><i class="fa fa-download"></i><span> Download Now</span><br></a></p><pre class="line-numbers language-none"><code class="language-none">&lt;a id="download" href="https://git-scm.com/download/win"&gt;&lt;i class="fa fa-download"&gt;&lt;/i&gt;&lt;span&gt; Download Now&lt;/span&gt;&lt;/a&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>更多tips可参考 <a target="_blank" rel="noopener" href="https://yangbingdong.com/2017/build-blog-hexo-advanced">blog</a></p><h3 id="在文档中增加图标">在文档中增加图标</h3><ul><li><i class="fa fa-pencil"></i>支持Markdown<br><i>Hexo 支持 GitHub Flavored Markdown 的所有功能, 甚至可以整合 Octopress 的大多数插件. </i></li><li><i class="fa fa-cloud-upload"></i>一件部署<br><i>只需一条指令即可部署到Github Pages, 或其他网站</i></li><li><i class="fa fa-cog"></i>丰富的插件<br><i>Hexo 拥有强大的插件系统, 安装插件可以让 Hexo 支持 Jade, CoffeeScript. </i></li></ul><pre class="line-numbers language-none"><code class="language-none">- &lt;i class="fa fa-pencil"&gt;&lt;/i&gt;支持Markdown&lt;i&gt;Hexo 支持 GitHub Flavored Markdown 的所有功能, 甚至可以整合 Octopress 的大多数插件. &lt;/i&gt;- &lt;i class="fa fa-cloud-upload"&gt;&lt;/i&gt;一件部署&lt;i&gt;只需一条指令即可部署到Github Pages, 或其他网站&lt;/i&gt;- &lt;i class="fa fa-cog"&gt;&lt;/i&gt;丰富的插件&lt;i&gt;Hexo 拥有强大的插件系统, 安装插件可以让 Hexo 支持 Jade, CoffeeScript. &lt;/i&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><i class="fa fa-github"></i><br><i class="fa fa-github fa-lg"></i><br><i class="fa fa-github fa-2x"></i></p><pre class="line-numbers language-none"><code class="language-none">`&lt;i class="fa fa-github"&gt;&lt;/i&gt;``&lt;i class="fa fa-github fa-lg"&gt;&lt;/i&gt;``&lt;i class="fa fa-github fa-2x"&gt;&lt;/i&gt;`<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="图表绘制">图表绘制</h2><ul><li><p><strong><a target="_blank" rel="noopener" href="https://github.com/JameChou/hexo-tag-mermaid">hexo-tag-mermaid</a></strong></p></li><li><p><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=hOwQoD6fIIIe7W28woagTQ%3D%3D.VHuPUTxtKKrWqD9OwRmRWowEiRhfZtrRRPW0tAHaUnugQA9ofUIFaPqb38gbAsyx"><strong>hexo-tag-plantuml</strong></a></p><blockquote><p>hexo-tag-plantuml is a tag plugin for Hexo. It can work with plantuml to draw uml.</p></blockquote><p>在Hexo中绘制uml图。</p></li><li><p><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=7CVDHj4WMnK6vHwS3JXOAQ%3D%3D.VqG%2BdxXCAb%2FdHLPgRnzrtjEUBUuK1EhF%2Fo7ev0Banu7ADAa3cS1GF4ROLNNWkriO"><strong>hexo-filter-flowchart</strong></a></p><blockquote><p>Generate flowchart diagrams for Hexo.</p></blockquote></li></ul><h2 id="Mermaid">Mermaid</h2><blockquote><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/horsee/category_10772579.html">Markdown mermaid教程</a></p></blockquote><h3 id="mermaid"><a target="_blank" rel="noopener" href="https://github.com/mermaid-js/mermaid">mermaid</a></h3><p><a target="_blank" rel="noopener" href="https://github.com/JameChou/hexo-tag-mermaid">hexo-tag-mermaid</a><a target="_blank" rel="noopener" href="https://github.com/two/hexo-tag-plantuml">hexo-tag-plantuml</a></p><blockquote><p><strong>需要用下面块包裹</strong></p></blockquote><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% mermaid %}[内容]{% endmermaid %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>先来几个演示</p><div class="mermaid">  graph LR source(*.java) --javac--&gt; bytecode(*.class) bytecode --java--&gt; result(程序输出)</div><div class="mermaid">  graph LR type(type) -.-&gt; type type -.-&gt; object(object) type -.-&gt; A(A) type -.-&gt; int(int) A -.-&gt; a((a)) int -.-&gt; i((i)) object --&gt; type object --&gt; A</div><h3 id="flowchart">flowchart</h3><p>[<a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid/#/flowchart">docs</a> - <a target="_blank" rel="noopener" href="https://mermaidjs.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoiZ3JhcGggVERcbiAgICBBW0hhcmRdIC0tPnxUZXh0fCBCKFJvdW5kKVxuICAgIEIgLS0-IEN7RGVjaXNpb259XG4gICAgQyAtLT58T25lfCBEW1Jlc3VsdCAxXVxuICAgIEMgLS0-fFR3b3wgRVtSZXN1bHQgMl0iLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9fQ">live editor</a>]</p><pre class="line-numbers language-none"><code class="language-none">{% mermaid %}graph TD    A[Christmas] --&gt;|Get money| B(Go shopping)    B --&gt; C{Let me think}    C --&gt;|One| D[Laptop]    C --&gt;|Two| E[iPhone]    C --&gt;|Three| F[Car]{% endmermaid %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="mermaid">  graph TD    A[Christmas] --&gt;|Get money| B(Go shopping)    B --&gt; C{Let me think}    C --&gt;|One| D[Laptop]    C --&gt;|Two| E[iPhone]    C --&gt;|Three| F[Car]</div><h3 id="Sequence-diagram">Sequence <strong>diagram</strong></h3><p>[<a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid/#/sequenceDiagram">docs</a> - <a target="_blank" rel="noopener" href="https://mermaidjs.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG5BbGljZS0-PkpvaG46IEhlbGxvIEpvaG4sIGhvdyBhcmUgeW91P1xubG9vcCBIZWFsdGhjaGVja1xuICAgIEpvaG4tPj5Kb2huOiBGaWdodCBhZ2FpbnN0IGh5cG9jaG9uZHJpYVxuZW5kXG5Ob3RlIHJpZ2h0IG9mIEpvaG46IFJhdGlvbmFsIHRob3VnaHRzIVxuSm9obi0tPj5BbGljZTogR3JlYXQhXG5Kb2huLT4-Qm9iOiBIb3cgYWJvdXQgeW91P1xuQm9iLS0-PkpvaG46IEpvbGx5IGdvb2QhIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifX0">live editor</a>]</p><pre class="line-numbers language-none"><code class="language-none">{% mermaid %}sequenceDiagram    loop every day        Alice-&gt;&gt;John: Hello John, how are you?        John--&gt;&gt;Alice: Great!    end{% endmermaid %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="mermaid">  sequenceDiagram    loop every day        Alice-&gt;&gt;John: Hello John, how are you?        John--&gt;&gt;Alice: Great!    end</div><h3 id="Gantt-diagram">Gantt <strong>diagram</strong></h3><p>[<a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid/#/gantt">docs</a> - <a target="_blank" rel="noopener" href="https://mermaidjs.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoiZ2FudHRcbnNlY3Rpb24gU2VjdGlvblxuQ29tcGxldGVkIDpkb25lLCAgICBkZXMxLCAyMDE0LTAxLTA2LDIwMTQtMDEtMDhcbkFjdGl2ZSAgICAgICAgOmFjdGl2ZSwgIGRlczIsIDIwMTQtMDEtMDcsIDNkXG5QYXJhbGxlbCAxICAgOiAgICAgICAgIGRlczMsIGFmdGVyIGRlczEsIDFkXG5QYXJhbGxlbCAyICAgOiAgICAgICAgIGRlczQsIGFmdGVyIGRlczEsIDFkXG5QYXJhbGxlbCAzICAgOiAgICAgICAgIGRlczUsIGFmdGVyIGRlczMsIDFkXG5QYXJhbGxlbCA0ICAgOiAgICAgICAgIGRlczYsIGFmdGVyIGRlczQsIDFkIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifX0">live editor</a>]</p><pre class="line-numbers language-none"><code class="language-none">{% mermaid %}gantt    dateFormat  YYYY-MM-DD    title Adding GANTT diagram functionality to mermaid    section A section    Completed task            :done,    des1, 2014-01-06,2014-01-08    Active task               :active,  des2, 2014-01-09, 3d    Future task               :         des3, after des2, 5d    Future task2               :         des4, after des3, 5d    section Critical tasks    Completed task in the critical line :crit, done, 2014-01-06,24h    Implement parser and jison          :crit, done, after des1, 2d    Create tests for parser             :crit, active, 3d    Future task in critical line        :crit, 5d    Create tests for renderer           :2d    Add to mermaid                      :1d    section Documentation    Describe gantt syntax               :active, a1, after des1, 3d    Add gantt diagram to demo page      :after a1  , 20h    Add another diagram to demo page    :doc1, after a1  , 48h    section Last section    Describe gantt syntax               :after doc1, 3d    Add gantt diagram to demo page      : 20h    Add another diagram to demo page    : 48h{% endmermaid %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="mermaid">  gantt    dateFormat  YYYY-MM-DD    title Adding GANTT diagram functionality to mermaid    section A section    Completed task            :done,    des1, 2014-01-06,2014-01-08    Active task               :active,  des2, 2014-01-09, 3d    Future task               :         des3, after des2, 5d    Future task2               :         des4, after des3, 5d        section Critical tasks    Completed task in the critical line :crit, done, 2014-01-06,24h    Implement parser and jison          :crit, done, after des1, 2d    Create tests for parser             :crit, active, 3d    Future task in critical line        :crit, 5d    Create tests for renderer           :2d    Add to mermaid                      :1d        section Documentation    Describe gantt syntax               :active, a1, after des1, 3d    Add gantt diagram to demo page      :after a1  , 20h    Add another diagram to demo page    :doc1, after a1  , 48h        section Last section    Describe gantt syntax               :after doc1, 3d    Add gantt diagram to demo page      : 20h    Add another diagram to demo page    : 48h</div><h3 id="ER图">ER图</h3><div class="mermaid">  erDiagram    CUSTOMER ||--o{ ORDER : places    CUSTOMER {        string name        string custNumber        string sector    }    ORDER ||--|{ LINE-ITEM : contains    ORDER {        int orderNumber        string deliveryAddress    }    LINE-ITEM {        string productCode        int quantity        float pricePerUnit    }</div><pre class="line-numbers language-none"><code class="language-none">erDiagram    CUSTOMER ||--o{ ORDER : places    CUSTOMER {        string name        string custNumber        string sector    }    ORDER ||--|{ LINE-ITEM : contains    ORDER {        int orderNumber        string deliveryAddress    }    LINE-ITEM {        string productCode        int quantity        float pricePerUnit    }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="class"><strong>class</strong></h3><p>[<a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid/#/classDiagram">docs</a> - <a target="_blank" rel="noopener" href="https://mermaidjs.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoiY2xhc3NEaWFncmFtXG5DbGFzczAxIDx8LS0gQXZlcnlMb25nQ2xhc3MgOiBDb29sXG48PGludGVyZmFjZT4-IENsYXNzMDFcbkNsYXNzMDkgLS0-IEMyIDogV2hlcmUgYW0gaT9cbkNsYXNzMDkgLS0qIEMzXG5DbGFzczA5IC0tfD4gQ2xhc3MwN1xuQ2xhc3MwNyA6IGVxdWFscygpXG5DbGFzczA3IDogT2JqZWN0W10gZWxlbWVudERhdGFcbkNsYXNzMDEgOiBzaXplKClcbkNsYXNzMDEgOiBpbnQgY2hpbXBcbkNsYXNzMDEgOiBpbnQgZ29yaWxsYVxuY2xhc3MgQ2xhc3MxMCB7XG4gID4-c2VydmljZT4-XG4gIGludCBpZFxuICBzaXplKClcbn0iLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9fQ">live editor</a>]</p><pre class="line-numbers language-none"><code class="language-none">classDiagramclass Shape{    &lt;&lt;interface&gt;&gt;    noOfVertices    draw()}class Color{    &lt;&lt;enumeration&gt;&gt;    RED    BLUE    GREEN    WHITE    BLACK}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="mermaid">  classDiagramclass Shape{    &lt;<interface>&gt;    noOfVertices    draw()}class Color{    &lt;<enumeration>&gt;    RED    BLUE    GREEN    WHITE    BLACK}</enumeration></interface></div><h3 id="State"><strong>State</strong></h3><p>[<a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid/#/stateDiagram">docs</a> - <a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic3RhdGVEaWFncmFtLXYyXG4gICAgWypdIC0tPiBTdGlsbFxuICAgIFN0aWxsIC0tPiBbKl1cbiAgICBTdGlsbCAtLT4gTW92aW5nXG4gICAgTW92aW5nIC0tPiBTdGlsbFxuICAgIE1vdmluZyAtLT4gQ3Jhc2hcbiAgICBDcmFzaCAtLT4gWypdIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQiLCJ0aGVtZVZhcmlhYmxlcyI6eyJiYWNrZ3JvdW5kIjoid2hpdGUiLCJwcmltYXJ5Q29sb3IiOiIjRUNFQ0ZGIiwic2Vjb25kYXJ5Q29sb3IiOiIjZmZmZmRlIiwidGVydGlhcnlDb2xvciI6ImhzbCg4MCwgMTAwJSwgOTYuMjc0NTA5ODAzOSUpIiwicHJpbWFyeUJvcmRlckNvbG9yIjoiaHNsKDI0MCwgNjAlLCA4Ni4yNzQ1MDk4MDM5JSkiLCJzZWNvbmRhcnlCb3JkZXJDb2xvciI6ImhzbCg2MCwgNjAlLCA4My41Mjk0MTE3NjQ3JSkiLCJ0ZXJ0aWFyeUJvcmRlckNvbG9yIjoiaHNsKDgwLCA2MCUsIDg2LjI3NDUwOTgwMzklKSIsInByaW1hcnlUZXh0Q29sb3IiOiIjMTMxMzAwIiwic2Vjb25kYXJ5VGV4dENvbG9yIjoiIzAwMDAyMSIsInRlcnRpYXJ5VGV4dENvbG9yIjoicmdiKDkuNTAwMDAwMDAwMSwgOS41MDAwMDAwMDAxLCA5LjUwMDAwMDAwMDEpIiwibGluZUNvbG9yIjoiIzMzMzMzMyIsInRleHRDb2xvciI6IiMzMzMiLCJtYWluQmtnIjoiI0VDRUNGRiIsInNlY29uZEJrZyI6IiNmZmZmZGUiLCJib3JkZXIxIjoiIzkzNzBEQiIsImJvcmRlcjIiOiIjYWFhYTMzIiwiYXJyb3doZWFkQ29sb3IiOiIjMzMzMzMzIiwiZm9udEZhbWlseSI6IlwidHJlYnVjaGV0IG1zXCIsIHZlcmRhbmEsIGFyaWFsIiwiZm9udFNpemUiOiIxNnB4IiwibGFiZWxCYWNrZ3JvdW5kIjoiI2U4ZThlOCIsIm5vZGVCa2ciOiIjRUNFQ0ZGIiwibm9kZUJvcmRlciI6IiM5MzcwREIiLCJjbHVzdGVyQmtnIjoiI2ZmZmZkZSIsImNsdXN0ZXJCb3JkZXIiOiIjYWFhYTMzIiwiZGVmYXVsdExpbmtDb2xvciI6IiMzMzMzMzMiLCJ0aXRsZUNvbG9yIjoiIzMzMyIsImVkZ2VMYWJlbEJhY2tncm91bmQiOiIjZThlOGU4IiwiYWN0b3JCb3JkZXIiOiJoc2woMjU5LjYyNjE2ODIyNDMsIDU5Ljc3NjUzNjMxMjglLCA4Ny45MDE5NjA3ODQzJSkiLCJhY3RvckJrZyI6IiNFQ0VDRkYiLCJhY3RvclRleHRDb2xvciI6ImJsYWNrIiwiYWN0b3JMaW5lQ29sb3IiOiJncmV5Iiwic2lnbmFsQ29sb3IiOiIjMzMzIiwic2lnbmFsVGV4dENvbG9yIjoiIzMzMyIsImxhYmVsQm94QmtnQ29sb3IiOiIjRUNFQ0ZGIiwibGFiZWxCb3hCb3JkZXJDb2xvciI6ImhzbCgyNTkuNjI2MTY4MjI0MywgNTkuNzc2NTM2MzEyOCUsIDg3LjkwMTk2MDc4NDMlKSIsImxhYmVsVGV4dENvbG9yIjoiYmxhY2siLCJsb29wVGV4dENvbG9yIjoiYmxhY2siLCJub3RlQm9yZGVyQ29sb3IiOiIjYWFhYTMzIiwibm90ZUJrZ0NvbG9yIjoiI2ZmZjVhZCIsIm5vdGVUZXh0Q29sb3IiOiJibGFjayIsImFjdGl2YXRpb25Cb3JkZXJDb2xvciI6IiM2NjYiLCJhY3RpdmF0aW9uQmtnQ29sb3IiOiIjZjRmNGY0Iiwic2VxdWVuY2VOdW1iZXJDb2xvciI6IndoaXRlIiwic2VjdGlvbkJrZ0NvbG9yIjoicmdiYSgxMDIsIDEwMiwgMjU1LCAwLjQ5KSIsImFsdFNlY3Rpb25Ca2dDb2xvciI6IndoaXRlIiwic2VjdGlvbkJrZ0NvbG9yMiI6IiNmZmY0MDAiLCJ0YXNrQm9yZGVyQ29sb3IiOiIjNTM0ZmJjIiwidGFza0JrZ0NvbG9yIjoiIzhhOTBkZCIsInRhc2tUZXh0TGlnaHRDb2xvciI6IndoaXRlIiwidGFza1RleHRDb2xvciI6IndoaXRlIiwidGFza1RleHREYXJrQ29sb3IiOiJibGFjayIsInRhc2tUZXh0T3V0c2lkZUNvbG9yIjoiYmxhY2siLCJ0YXNrVGV4dENsaWNrYWJsZUNvbG9yIjoiIzAwMzE2MyIsImFjdGl2ZVRhc2tCb3JkZXJDb2xvciI6IiM1MzRmYmMiLCJhY3RpdmVUYXNrQmtnQ29sb3IiOiIjYmZjN2ZmIiwiZ3JpZENvbG9yIjoibGlnaHRncmV5IiwiZG9uZVRhc2tCa2dDb2xvciI6ImxpZ2h0Z3JleSIsImRvbmVUYXNrQm9yZGVyQ29sb3IiOiJncmV5IiwiY3JpdEJvcmRlckNvbG9yIjoiI2ZmODg4OCIsImNyaXRCa2dDb2xvciI6InJlZCIsInRvZGF5TGluZUNvbG9yIjoicmVkIiwibGFiZWxDb2xvciI6ImJsYWNrIiwiZXJyb3JCa2dDb2xvciI6IiM1NTIyMjIiLCJlcnJvclRleHRDb2xvciI6IiM1NTIyMjIiLCJjbGFzc1RleHQiOiIjMTMxMzAwIiwiZmlsbFR5cGUwIjoiI0VDRUNGRiIsImZpbGxUeXBlMSI6IiNmZmZmZGUiLCJmaWxsVHlwZTIiOiJoc2woMzA0LCAxMDAlLCA5Ni4yNzQ1MDk4MDM5JSkiLCJmaWxsVHlwZTMiOiJoc2woMTI0LCAxMDAlLCA5My41Mjk0MTE3NjQ3JSkiLCJmaWxsVHlwZTQiOiJoc2woMTc2LCAxMDAlLCA5Ni4yNzQ1MDk4MDM5JSkiLCJmaWxsVHlwZTUiOiJoc2woLTQsIDEwMCUsIDkzLjUyOTQxMTc2NDclKSIsImZpbGxUeXBlNiI6ImhzbCg4LCAxMDAlLCA5Ni4yNzQ1MDk4MDM5JSkiLCJmaWxsVHlwZTciOiJoc2woMTg4LCAxMDAlLCA5My41Mjk0MTE3NjQ3JSkifX0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9">live editor</a>]</p><pre class="line-numbers language-none"><code class="language-none">{% mermaid %}stateDiagram-v2    [*] --&gt; Still    Still --&gt; [*]    Still --&gt; Moving    Moving --&gt; Still    Moving --&gt; Crash    Crash --&gt; [*]{% endmermaid %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="mermaid">  stateDiagram-v2    [*] --&gt; Still    Still --&gt; [*]    Still --&gt; Moving    Moving --&gt; Still    Moving --&gt; Crash    Crash --&gt; [*]</div><h3 id="Pie"><strong>Pie</strong></h3><p>[<a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid/#/pie">docs</a> - <a target="_blank" rel="noopener" href="https://mermaidjs.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoicGllXG5cIkRvZ3NcIiA6IDQyLjk2XG5cIkNhdHNcIiA6IDUwLjA1XG5cIlJhdHNcIiA6IDEwLjAxIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifX0">live editor</a>]</p><pre class="line-numbers language-none"><code class="language-none">{% mermaid %}pie"Dogs" : 386"Cats" : 85"Rats" : 15{% endmermaid %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="mermaid">  pie"Dogs" : 386"Cats" : 85"Rats" : 15</div><h3 id="User-Journey"><strong>User Journey</strong></h3><p>[<a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid/#/user-journey">docs</a> - <a target="_blank" rel="noopener" href="https://mermaidjs.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic3RhdGVEaWFncmFtXG4gICAgWypdIC0tPiBTdGlsbFxuICAgIFN0aWxsIC0tPiBbKl1cbiAgICBTdGlsbCAtLT4gTW92aW5nXG4gICAgTW92aW5nIC0tPiBTdGlsbFxuICAgIE1vdmluZyAtLT4gQ3Jhc2hcbiAgICBDcmFzaCAtLT4gWypdIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifX0">live editor</a>]</p><pre class="line-numbers language-none"><code class="language-none">{% mermaid %}  journey    title My working day    section Go to work      Make tea: 5: Me      Go upstairs: 3: Me      Do work: 1: Me, Cat    section Go home      Go downstairs: 5: Me      Sit down: 3: Me{% endmermaid %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="mermaid">  journey title My working day section Go to work   Make tea: 5: Me   Go upstairs: 3: Me   Do work: 1: Me, Cat section Go home   Go downstairs: 5: Me   Sit down: 3: Me</div><h2 id="plant-uml">plant uml</h2><p><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=ZnkRBa%2Fre3TQCl7KNJg2Sg%3D%3D.ZEjsSgGk0F1LOYjRqQLWGcsHdjIHjXJJNCwT20OKlas%3D"><strong>PlantUML</strong> </a>是一个允许你快速编写一下图表的组件 :</p><ul><li><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=WnNQQpbhwLLtOvy0iZznAw%3D%3D.ufDzIrmSHLTJOvU%2B%2BrCbHKX7i%2BXDfiAs43p47%2Brd6CPQPzmoRjTx9Yjer2eCPMIx">Sequence diagram</a>（时序图）</li><li><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=swyHFudu0Dv1kgG36K6uKQ%3D%3D.%2F3OTiCZ42cJb5Qx7sx3T0xkD8UzUl2QpmT5nScfRShRBbDCjvTAYmIjQBdcndh5P">Usecase diagram</a></li><li><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=y2iylEjbyP1BkiOoSD3aBQ%3D%3D.Uk3N50fH52eqKvi5pR9V2dCwZ2t88GyGCkB56t0bi51SDzK3TAm8q%2F%2BknYaMp6gq">Class diagram</a>（类图）</li><li><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=ZPF3Fm60rmWHTd6iqgefYw%3D%3D.hetxaEZitHOTlwF26EQHW1ze%2BqQe28tO5Zan9A6PQD7tELizzdVt2LCwJ7Wqni8N">Activity diagram</a> (here is <a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=G1AlcTWhXkwCzalwXO04Tw%3D%3D.RKEPVfhovignZnpee9bltjlVeAZ25VKK5bSbzmo2G225h2cQ3wEKM8LyC23GxRLL">the legacy syntax)</a></li><li><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=Vxtv5M%2FcCgkpBtyWH8mDCA%3D%3D.xTXdTliRpsnQ8OniXrs1V6YfjTy0nSFbS7l7wqvn0uACpHlTJNL9BlF0xb7vfM4Z">Component diagram</a></li><li><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=asRZoWO7I5UQ3wuP84r8hg%3D%3D.vyIPg7GpNKjSjf7e2IS4KO%2Bg6SnD1DLe9DYb9T1CuW2U41s72PgDFuT0hbkp2BO9">State diagram</a></li><li><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=WMWDuC4PoXS%2BUq8UK%2B6m6Q%3D%3D.UaRzixgD%2B8x%2BRoBPDjArHXZEVWCpjnRwzoBn9HZDWAgyM2iggTjoxPJrpjuH5nZL">Object diagram</a></li><li><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=4QYG%2FOLv5kpCA0Wur4JTBg%3D%3D.Ci3AIvz1ie0I6BCUt8a%2BaklDx8hJvKPujkVdWDGw%2BzDTkfdnBBhY5GhX9mIITaMb">Deployment diagram</a>(BETA)</li><li><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=%2Bi9ecBhjJV%2Fo6bPpIo6zEw%3D%3D.b0HW%2B0h7iKI3LibmVdbEmi77twGMobstSrkBWn2n6AucZmIcrNRI7QEhpDEMrUTR">Timing diagram</a>(BETA)</li></ul><p>Hexo安装hexo-tag-plantuml插件，便能使其绘制的图表在博客上展示，其原理其实使用的是 PlantUML 提供的在线服务, 只是简单地将标签包裹的代码传给服务器, 获取生成的链接, 生成 img标签替换原来的代码区域.</p><blockquote><p><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=Om2tsztpVQpl48NLQP8wPg%3D%3D.lA5QuvRnDCcbundLA81sGH8MG3E6QjnIJQ6%2BgojZWH8%3D">plantUML在线编辑网站</a></p></blockquote><p>可使用HTML标签将其嵌套</p><pre class="line-numbers language-none"><code class="language-none">{% plantuml %}title Relationships - Class Diagramclass Dwelling {  +Int Windows  +void LockTheDoor()}class Apartmentclass Houseclass Communeclass Windowclass DoorDwelling &lt;|-down- Apartment: InheritanceDwelling &lt;|-down- Commune: InheritanceDwelling &lt;|-down- House: InheritanceDwelling "1" *-up- "many" Window: CompositionDwelling "1" *-up- "many" Door: Composition{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="http://www.plantuml.com/plantuml/svg/XP0z2y8m48Rt_8gZanzaS2qkKWSBJY8uXpQqXybTQ5ABgF_TrhQAuCUMbpptt4V0O3Jij541cNo9peE4n2ZlOOsgg9GL8kjZeur1Ak0Y0EOf1JWWvTpuBfuOSzXoTjoNUirSJQRYDXQkdAg2rHI6lE7Qw-6TiBKrZQaNZlrQZH3FhikhRFz8ldGnf5Jg2eEYJ7y01_S_x37E5oXQH32JjPCGMKNdQ9WmxjoEFNP7-q5tAxonTm00"><pre class="line-numbers language-none"><code class="language-none">{% plantuml %}[内容]{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="时序图"><a target="_blank" rel="noopener" href="https://plantuml.com/zh/timing-diagram">时序图</a></h3><pre class="line-numbers language-none"><code class="language-none">{% plantuml %}    Bob-&gt;Alice : hello{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><img src="http://www.plantuml.com/plantuml/svg/SyfFqhLppCbCJbMmKiX8pSd91m00"><pre class="line-numbers language-none"><code class="language-none">Alice -&gt; Bob: Authentication RequestBob --&gt; Alice: Authentication ResponseAlice -&gt; Bob: Another authentication RequestAlice &lt;-- Bob: Another authentication Response<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="http://www.plantuml.com/plantuml/svg/Syp9J4vLqBLJSCfFib9mB2t9ICqhoKnEBCdCprC8IYqiJIqkuGBAAUW2rJY256DHLLoGdrUSoiNbY6fONZvGNP528dP38OfjT7K9g8OO3W00"><h3 id="用例图"><a target="_blank" rel="noopener" href="https://plantuml.com/zh/use-case-diagram">用例图</a></h3><pre class="line-numbers language-none"><code class="language-none">{% plantuml %}User -&gt; (Start)User --&gt; (Use the application) : A small label:Main Admin: ---&gt; (Use the application) : This is\nyet another\nlabel{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="类图"><a target="_blank" rel="noopener" href="https://plantuml.com/zh/class-diagram">类图</a></h3><pre class="line-numbers language-none"><code class="language-none">{% plantuml %}class Object &lt;&lt; general &gt;&gt;Object &lt;|--- ArrayListnote top of Object : In java, every class\nextends this one.note "This is a floating note" as N1note "This note is connected\nto several objects." as N2Object .. N2N2 .. ArrayListclass Foonote left: On last defined class{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="活动图"><a target="_blank" rel="noopener" href="https://plantuml.com/zh/activity-diagram-beta">活动图</a></h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% plantuml %}@startumlstartif (Graphviz 已安装?) then (yes)  :处理所有\n绘制任务;else (no)  :仅处理  <span class="token bold"><span class="token punctuation">__</span><span class="token content">时序图</span><span class="token punctuation">__</span></span> 和 <span class="token bold"><span class="token punctuation">__</span><span class="token content">活动</span><span class="token punctuation">__</span></span> 图;endifstop@enduml{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="http://www.plantuml.com/plantuml/svg/SoWkIImgAStDuG8pkBWoqnGqt8iI2pBACgiKdcxVz7HTvul5hVQQ2YKPgNaA6fMfnPfS2WfMJvUqF9_GzgopuTcSpfYyvxjdFEtOzcJtxgTT2wsvKdEAKnKqylB12f_iReMe1NBYuvzDt_PqL__JsVlYunMUJke1YMm1Qbe1uixU1zIQbvAPnWLqItu1bmEG0tGO0000"><h3 id="组件图"><a target="_blank" rel="noopener" href="https://plantuml.com/zh/component-diagram">组件图</a></h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% plantuml %}@startuml[First component][Another component] as Comp2component Comp3component [Last\ncomponent] as Comp4@enduml{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="http://www.plantuml.com/plantuml/svg/SoWkIImgAStDuUAATiiiAYvHICxFBSZFIyqhYUMATipBByb8BK8IKqWiLd06yeouu69WlZ4IFzediRWa9WzJamaNbqDgNWhGDW00"><h3 id="状态图"><a target="_blank" rel="noopener" href="https://plantuml.com/zh/state-diagram">状态图</a></h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% plantuml %}@startuml[<span class="token italic"><span class="token punctuation">*</span><span class="token content">] --&gt; State1State1 --&gt; [</span><span class="token punctuation">*</span></span>]State1 : this is a stringState1 : this is another stringState1 -&gt; State2State2 --&gt; [*]@enduml{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="http://www.plantuml.com/plantuml/svg/SoWkIImgAStDuUAArefLqDMrKmWkIIn9DUI2K60He0oCQwLGaf5Ph014YGh59KMPUUbOPFBoIp9IYs3oS9EWHXj118pWHdCvfEQb09q00000"><h3 id="对象图"><a target="_blank" rel="noopener" href="https://plantuml.com/zh/object-diagram">对象图</a></h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% plantuml %}@startuml PERTleft to right direction' Horizontal lines: --&gt;, <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>--,</span> <span class="token attr-name">&lt;--</span><span class="token punctuation">&gt;</span></span>' Vertical lines: -&gt;, <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>-,</span> <span class="token attr-name">&lt;-</span><span class="token punctuation">&gt;</span></span>title PERT: Project Namemap Kick.Off {}map task.1 {    Start =&gt; End}map task.2 {    Start =&gt; End}map task.3 {    Start =&gt; End}map task.4 {    Start =&gt; End}map task.5 {    Start =&gt; End}Kick.Off --&gt; task.1 : Label 1Kick.Off --&gt; task.2 : Label 2Kick.Off --&gt; task.3 : Label 3task.1 --&gt; task.4task.2 --&gt; task.4task.3 --&gt; task.4task.4 --&gt; task.5 : Label 4@enduml{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="http://www.plantuml.com/plantuml/svg/XP7DQiCm48Jl-nHpwoKEn3yNqvfS0e64r3IbTyMM4oMo5EJjfQNl7iMaIcWD5gn0yosp8tRUiN3ysMgKYxTtqh9Xi8LJ-mEZLavMhAoX9oojKr_MiD3GoiWkHnGL4pn7KNyLlkL3EbRLGqFFhrKGAzQodv6ZTFReVR4HhIHgnHahLPschqs3R_hf1HRTQJhpJ_YplKR4Iu65gHzvFCAJ4PwEy6oOXx3-rxz1Swp5JchC1cWSQ3n0aq0Jkfa5bjBDuA-I_5FIkv85nvJcqjH-kHS0"><h3 id="部署图"><a target="_blank" rel="noopener" href="https://plantuml.com/zh/deployment-diagram">部署图</a></h3><pre class="line-numbers language-none"><code class="language-none">{% plantuml %}@startumlactor actoragent agentartifact artifactboundary boundarycard cardcloud cloudcomponent componentcontrol controldatabase databaseentity entityfile filefolder folderframe frameinterface  interfacenode nodepackage packagequeue queuestack stackrectangle rectanglestorage storageusecase usecase@enduml{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="http://www.plantuml.com/plantuml/svg/FP1B4eGm24JtVGgEubKmGSio1WV9mjiFyRTv_Gho8HaEP_Es5N1oDRe8dgKwNKIqbodAz0f6RJMpdVGA4bkc3gIYBRGJIRTTQp_fiwXLDotq938xZtm8lO9OjVX9Ts1QYb079YrPZEx0PBn5enDBTR6OJ8W-HTKir86TqnfFeIVnQzA4BY9UdrQw29FaNEUuxxFeg_MzJw8TalgqJsAGckFp_W00"><h2 id="URL-卡片"><a target="_blank" rel="noopener" href="https://github.com/toastsgithub/hexo-valkyr-url">URL 卡片</a></h2><div class="vkr-url-wrapper"><style>.vkr-url-wrapper {    padding: 10px;    border-radius: 5px;    border: 1px solid;    border-color: #eee #ddd #bbb;    box-shadow: rgba(0,0,0,.14) 0 1px 3px;    margin-bottom: 10px;    display: flex;}.vkr-url-wrapper .desc-wrapper > hr {    margin: 10px 0;    height: 1px;}.vkr-url-wrapper .avatar {    width: 100px;    height: 100px;    border: solid 1px #eee;    box-shadow: none!important;    margin: 0;    margin-right: 10px;}.vkr-url-wrapper h2 {    border: none;    margin: 0;    padding: 0;}.vkr-url-wrapper .desc-wrapper {    flex: 1;}.vkr-url-wrapper .desc-wrapper a {    font-size: 22px;    font-weight: 700;}</style>            <a target="_blank" rel="noopener" href="https://github.com/toastsgithub/valkyr-ssh"><img class="avatar" src="http://images2.dzmtoast.top/post-cover/github-logo_hub2899c31b6ca7aed8d6a218f0e752fe4_46649_1200x1200_fill_box_center_2.png"></a>        <div class="desc-wrapper">        <a target="_blank" rel="noopener" href="https://github.com/toastsgithub/valkyr-ssh">valkyr ssh manager</a>        <hr>        <div class="desc">valkyr-ssh, a simple commandline tool to help you store ssh login address</div>    </div></div><pre class="line-numbers language-none"><code class="language-none">{% valkyrurl[url=https://github.com/toastsgithub/valkyr-ssh][title="valkyr ssh manager"][avatar=http://images2.dzmtoast.top/post-cover/github-logo_hub2899c31b6ca7aed8d6a218f0e752fe4_46649_1200x1200_fill_box_center_2.png][desc="valkyr-ssh, a simple commandline tool to help you store ssh login address"]%}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">{% valkyrurl [url=http://example.com] [otherOpt=value] %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>avatar</code> image that describe your link (optional)</li><li><code>title</code> title</li><li><code>desc</code> description</li><li><code>url</code> destination when you click image url or title</li><li>空格要用引号包裹起来！</li></ul><h2 id="BILIBILI卡片"><a target="_blank" rel="noopener" href="https://github.com/MaxChang3/hexo-bilibili-card">BILIBILI卡片</a></h2><div class="bvideo">    <a href="//www.bilibili.com/video/BV1sr4y1K7Be" target="_blank">        <div class="bvideo-box">            <div class="bvideo-cover">                <div class="cover-default"></div>                <div class="bvideo-cover-layer" style="background-image:url(https://images.weserv.nl/?url=http://i1.hdslb.com/bfs/archive/ee23c0ab56c3e29838f1081a76cf55c5a6199bf0.jpg)">                    <i class="icon-video"></i>                </div>                <span class="duration">52:09:00</span>            </div>            <div class="bvideo-info">                <p class="title">【PKU】高等数学（全60讲)</p>                <p class="card-status">                    <span class="play-num">                        <i class="fa fa-youtube-play"></i>                        <span>26.5万</span></span>                    <span>                        <i class="fa fa-list-alt"></i>                        <span>147</span></span></p>                <div class="partition">                    <label class="card-label">视频</label>                    <label class="up-label"></label>                    <label class="up-name">沉迷学习的PickleFermi</label>                </div>                <div class="actions hide"></div>            </div>        </div>    </a></div><pre class="line-numbers language-none"><code class="language-none">{% bilicard your_video_id %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="hexo-github-card"><strong><a target="_blank" rel="noopener" href="https://github.com/Gisonrg/hexo-github-card">hexo-github-card</a></strong></h2><pre class="line-numbers language-none"><code class="language-none">{% githubCard user:your_user [repo:your_repo] [width:400] [height:200] [theme:default] [client_id:your_client_id] [client_secret:your_client_secret] [align:text-align_position] %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% githubCard user:appotry %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% githubCard user:appotry repo:hexo-github-card %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div style="text-align: center">  <div class="github-card" data-user="appotry" data-repo="" data-height="200" data-width="400" data-theme="default" data-target="" data-client-id="" data-client-secret=""></div></div><script src="/github-card-lib/githubcard.js"></script><div style="text-align: center">  <div class="github-card" data-user="appotry" data-repo="docker-hexo" data-height="200" data-width="400" data-theme="default" data-target="" data-client-id="" data-client-secret=""></div></div><script src="/github-card-lib/githubcard.js"></script><div style="text-align: center">  <div class="github-card" data-user="appotry" data-repo="PTtool" data-height="200" data-width="400" data-theme="default" data-target="" data-client-id="" data-client-secret=""></div></div><script src="/github-card-lib/githubcard.js"></script><h2 id="hexo-douban-card"><a target="_blank" rel="noopener" href="https://github.com/TankNee/hexo-douban-card">hexo-douban-card</a></h2><div class="douban-card-block">    <a class="douban-card" target="_blank" rel="noopener" href="https://movie.douban.com/subject/24745500">        <div class="douban-card-bgimg" style="background-image: url('https://images.weserv.nl/?url=https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2194066391.jpg');"></div>        <div class="douban-card-left">            <div class="douban-card-img" style="background-image: url('https://images.weserv.nl/?url=https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2194066391.jpg');"></div>            <div class="douban-card-status">灯影绰约</div>        </div>        <div class="douban-card-right">            <div class="douban-card-item"><span>电影名: </span><strong>绣春刀(2014)</strong></div>            <div class="douban-card-item"><span>导演: </span><span>路阳</span></div>            <div class="douban-card-item"><span>主演: </span><span>张震/刘诗诗</span></div>            <div class="douban-card-item"><span>上映时间: </span><span>2014-08-07(中国大陆)</span></div>            <div class="douban-card-item"><span>评分: </span><span>7.6</span></div>        </div>    </a></div><style>    .douban-card-block {    display: flex;    justify-content: center;    align-items: center;    width: 100%;    max-height: 400px;}.douban-card {    display: flex;    margin: 30px 10px;    padding: 15px;    border-radius: 15px;    position: relative;    justify-content: center;    align-items: center;    overflow: hidden;    color: antiquewhite;    text-decoration: none;}.douban-card:hover {    text-decoration: none;}.douban-card-bgimg {    position: absolute;    width: 115%;    height: 115%;    filter: blur(15px) brightness(0.6);    background-size: 100%;    background-position: center;    background-repeat: no-repeat;}.douban-card-img {    position: relative;    height: 130px;    width: 80px;    background-size: 100%;    background-position: center;    background-repeat: no-repeat;}.douban-card-left:hover .douban-card-img {    filter: blur(5px) brightness(0.6);    transform: perspective(800px) rotateX(180deg);}.douban-card-left .douban-card-img {    transition: all 500ms ease;}.douban-card-left {    position: relative;    display: flex;    flex-direction: column;    align-items: center;}.douban-card-left .douban-card-status {    height: 130px;    width: 80px;    text-align: center;    font-weight: bold;    position: absolute;    left: 0;    top: 30%;    transform: rotateX(180deg);    backface-visibility: hidden;    transition: all 500ms ease;}.douban-card-left:hover .douban-card-status {    transform: perspective(800px) rotateX(0deg);}.douban-card-right {    position: relative;    display: flex;    flex-direction: column;    margin-left: 12px;    font-size: 16px;    font-family: "Courier New", Courier, monospace;    line-height: 1.3;    color: antiquewhite;}.douban-card-item {    margin-top: 4px;}</style><div class="douban-card-block">    <a class="douban-card" target="_blank" rel="noopener" href="https://book.douban.com/subject/30376420">        <div class="douban-card-bgimg" style="background-image: url('https://images.weserv.nl/?url=https://img1.doubanio.com/view/subject/s/public/s30015279.jpg');">        </div>        <div class="douban-card-left">            <div class="douban-card-img" style="background-image: url('https://images.weserv.nl/?url=https://img1.doubanio.com/view/subject/s/public/s30015279.jpg');">            </div>            <div class="douban-card-status">见字如晤</div>        </div>        <div class="douban-card-right" style="line-height: 1.7;">            <div class="douban-card-item"><span>书名: </span><strong>一个人生活</strong></div>            <div class="douban-card-item"><span>作者: </span><span>[日]谷川俊太郎</span></div>            <div class="douban-card-item"><span>出版年份: </span><span>2019-3</span></div>            <div class="douban-card-item"><span>评分: </span><span>7.1</span></div>        </div>    </a></div><style>    .douban-card-block {    display: flex;    justify-content: center;    align-items: center;    width: 100%;    max-height: 400px;}.douban-card {    display: flex;    margin: 30px 10px;    padding: 15px;    border-radius: 15px;    position: relative;    justify-content: center;    align-items: center;    overflow: hidden;    color: antiquewhite;    text-decoration: none;}.douban-card:hover {    text-decoration: none;}.douban-card-bgimg {    position: absolute;    width: 115%;    height: 115%;    filter: blur(15px) brightness(0.6);    background-size: 100%;    background-position: center;    background-repeat: no-repeat;}.douban-card-img {    position: relative;    height: 130px;    width: 80px;    background-size: 100%;    background-position: center;    background-repeat: no-repeat;}.douban-card-left:hover .douban-card-img {    filter: blur(5px) brightness(0.6);    transform: perspective(800px) rotateX(180deg);}.douban-card-left .douban-card-img {    transition: all 500ms ease;}.douban-card-left {    position: relative;    display: flex;    flex-direction: column;    align-items: center;}.douban-card-left .douban-card-status {    height: 130px;    width: 80px;    text-align: center;    font-weight: bold;    position: absolute;    left: 0;    top: 30%;    transform: rotateX(180deg);    backface-visibility: hidden;    transition: all 500ms ease;}.douban-card-left:hover .douban-card-status {    transform: perspective(800px) rotateX(0deg);}.douban-card-right {    position: relative;    display: flex;    flex-direction: column;    margin-left: 12px;    font-size: 16px;    font-family: "Courier New", Courier, monospace;    line-height: 1.3;    color: antiquewhite;}.douban-card-item {    margin-top: 4px;}</style><div class="douban-card-block"><a class="douban-card" target="_blank" rel="noopener" href="https://music.douban.com/subject/35099703"><div class="douban-card-bgimg" style="background-image: url('https://images.weserv.nl/?url=https://img1.doubanio.com/view/subject/m/public/s33667479.jpg');"></div><div class="douban-card-left"><div class="douban-card-img" style="background-image: url('https://images.weserv.nl/?url=https://img1.doubanio.com/view/subject/m/public/s33667479.jpg');"></div>            <div class="douban-card-status">余音绕梁</div>        </div><div class="douban-card-right"><div class="douban-card-item"><span>音乐名: </span><strong>María</strong></div><div class="douban-card-item"><span>表演者: </span><span>화사/华莎</span></div><div class="douban-card-item"><span>发行时间: </span><span>2020-06-30</span></div><div class="douban-card-item"><span>评分: </span><span>8.3</span></div></div></a></div><style>    .douban-card-block {    display: flex;    justify-content: center;    align-items: center;    width: 100%;    max-height: 400px;}.douban-card {    display: flex;    margin: 30px 10px;    padding: 15px;    border-radius: 15px;    position: relative;    justify-content: center;    align-items: center;    overflow: hidden;    color: antiquewhite;    text-decoration: none;}.douban-card:hover {    text-decoration: none;}.douban-card-bgimg {    position: absolute;    width: 115%;    height: 115%;    filter: blur(15px) brightness(0.6);    background-size: 100%;    background-position: center;    background-repeat: no-repeat;}.douban-card-img {    position: relative;    height: 130px;    width: 80px;    background-size: 100%;    background-position: center;    background-repeat: no-repeat;}.douban-card-left:hover .douban-card-img {    filter: blur(5px) brightness(0.6);    transform: perspective(800px) rotateX(180deg);}.douban-card-left .douban-card-img {    transition: all 500ms ease;}.douban-card-left {    position: relative;    display: flex;    flex-direction: column;    align-items: center;}.douban-card-left .douban-card-status {    height: 130px;    width: 80px;    text-align: center;    font-weight: bold;    position: absolute;    left: 0;    top: 30%;    transform: rotateX(180deg);    backface-visibility: hidden;    transition: all 500ms ease;}.douban-card-left:hover .douban-card-status {    transform: perspective(800px) rotateX(0deg);}.douban-card-right {    position: relative;    display: flex;    flex-direction: column;    margin-left: 12px;    font-size: 16px;    font-family: "Courier New", Courier, monospace;    line-height: 1.3;    color: antiquewhite;}.douban-card-item {    margin-top: 4px;}</style><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% douban movie 24745500 %}{% douban book 30376420 %}{% douban music 35099703 %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="插入音乐和视频">插入音乐和视频</h2><blockquote><ul><li><a target="_blank" rel="noopener" href="https://github.com/MoePlayer/hexo-tag-aplayer">hexo-tag-aplayer</a></li><li><a target="_blank" rel="noopener" href="https://github.com/MoePlayer/hexo-tag-dplayer">hexo-tag-dplayer</a></li><li><a target="_blank" rel="noopener" href="https://github.com/u2sb/hexo-tag-mmedia">hexo-tag-mmedia</a> 推荐使用</li></ul></blockquote><h3 id="插入音乐">插入音乐</h3><blockquote><p><a target="_blank" rel="noopener" href="https://github.com/MoePlayer/hexo-tag-aplayer/blob/master/docs/README-zh_cn.md">官方教程</a></p></blockquote><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% aplayer title author url [picture_url, narrow, autoplay, width:xxx, lrc:xxx] %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>title</code> : 曲目标题</li><li><code>author</code>: 曲目作者</li><li><code>url</code>: 音乐文件 URL 地址</li><li><code>picture_url</code>: (可选) 音乐对应的图片地址</li><li><code>narrow</code>: （可选）播放器袖珍风格</li><li><code>autoplay</code>: (可选) 自动播放，移动端浏览器暂时不支持此能</li><li><code>width:xxx</code>: (可选) 播放器宽度 (默认: 100%)</li><li><code>lrc:xxx</code>: （可选）歌词文件 URL #### <em><strong>单曲附带歌词显示</strong></em></li></ul>        <div id="aplayer-MtsDkwgf" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;">            <pre class="aplayer-lrc-content"></pre>        </div>        <script>          var ap = new APlayer({            element: document.getElementById("aplayer-MtsDkwgf"),            narrow: false,            autoplay: false,            showlrc: 3,            music: {              title: "Hotel California",              author: "Camille and Kennerly",              url: "https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.mp3",              pic: "https://cdn.17lai.site/media/music/Hotel%20California/Hotel%20California.webp",              lrc: "https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.lrc"            }          });          window.aplayers || (window.aplayers = []);          window.aplayers.push(ap);        </script><h4 id="音乐播放列表"><strong>音乐播放列表</strong></h4><pre class="line-numbers language-none"><code class="language-none">{% aplayerlist %}{    "narrow": false,                          // （可选）播放器袖珍风格    "autoplay": true,                         // （可选) 自动播放，移动端浏览器暂时不支持此功能    "mode": "random",                         // （可选）曲目循环类型，有 'random'（随机播放）, 'single' (单曲播放), 'circulation' (循环播放), 'order' (列表播放)， 默认：'circulation'     "showlrc": 3,                             // （可选）歌词显示配置项，可选项有：1,2,3    "mutex": true,                            // （可选）该选项开启时，如果同页面有其他 aplayer 播放，该播放器会暂停    "theme": "#e6d0b2",                      // （可选）播放器风格色彩设置，默认：#b7daff    "preload": "metadata",                    // （可选）音乐文件预载入模式，可选项： 'none' 'metadata' 'auto', 默认: 'auto'    "listmaxheight": "513px",                 // (可选) 该播放列表的最大长度    "music": [        {            "title": "CoCo",            "author": "Jeff Williams",            "url": "caffeine.mp3",            "pic": "caffeine.jpeg",            "lrc": "caffeine.txt"        },        {            "title": "アイロニ",            "author": "鹿乃",            "url": "irony.mp3",            "pic": "irony.jpg"        }    ]}{% endaplayerlist %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>        <div id="aplayer-ZgGnkCnm" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;"></div>  <script>  var options = {"narrow":false,"autoplay":true,"showlrc":3,"mode":"random","mutex":true,"theme":"#e6d0b2","preload":"metadata","listmaxheight":"513px","music":[{"title":"Hotel California","author":"Camille and Kennerly","url":"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.mp3","pic":"https://cdn.17lai.site/media/music/Hotel%20California/Hotel%20California.webp","lrc":"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.lrc"},{"title":"Sold Out","author":"Diamonds","url":"https://cdn.17lai.site/media/music/Diamonds/05%20Sold%20Out.flac","pic":"https://cdn.17lai.site/media/music/Diamonds/Diamonds.jpg"}]};  options.element = document.getElementById("aplayer-ZgGnkCnm");  var ap = new APlayer(options);    window.aplayers || (window.aplayers = []);  window.aplayers.push(ap);  </script><h3 id="插入视频">插入视频</h3><blockquote><p><a target="_blank" rel="noopener" href="http://dplayer.js.org/guide.html">官方教程</a></p></blockquote><pre class="line-numbers language-none"><code class="language-none">{% dplayer key=value ... %}例：{% dplayer "url=http://www.nenu.edu.cn/_upload/article/videos/03/5f/7c999eed42e3aadc413d7f851f0e/0f50b3eb-9285-41d2-ac4d-6cc363651aad_B.mp4"  "autoplay=true" "preload=metadata" "hotkey=true" %} <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>有关的选项列表如下:</p><table><thead><tr><th style="text-align:left">选项</th><th style="text-align:left">默认值</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">url</td><td style="text-align:left"><strong>必须值</strong></td><td style="text-align:left">视频地址</td></tr><tr><td style="text-align:left">loop</td><td style="text-align:left"><code>false</code></td><td style="text-align:left">视频循环播放</td></tr><tr><td style="text-align:left">volume</td><td style="text-align:left"><code>0.7</code></td><td style="text-align:left">播放器音量</td></tr><tr><td style="text-align:left">hotkey</td><td style="text-align:left"><code>true</code></td><td style="text-align:left">开启热键</td></tr><tr><td style="text-align:left">autoplay</td><td style="text-align:left"><code>true</code></td><td style="text-align:left">自动播放，移动端浏览器暂时不支持此功能</td></tr><tr><td style="text-align:left">logo</td><td style="text-align:left"><code>-</code></td><td style="text-align:left">在左上角展示一个 logo，你可以通过 CSS 调整它的大小和位置</td></tr><tr><td style="text-align:left">mutex</td><td style="text-align:left"><code>true</code></td><td style="text-align:left">该选项开启时，如果同页面有其他播放，该播放器会暂停</td></tr><tr><td style="text-align:left">highlight</td><td style="text-align:left"><code>[]</code></td><td style="text-align:left">自定义进度条提示点</td></tr><tr><td style="text-align:left">preload</td><td style="text-align:left"><code>auto</code></td><td style="text-align:left">视频文件预载入模式，可选项： <code>none</code>, <code>metadata</code>, <code>auto</code></td></tr><tr><td style="text-align:left">theme</td><td style="text-align:left"><code>#ad7a86</code></td><td style="text-align:left">播放器风格色彩设置</td></tr></tbody></table><p>注：如果使用腾讯视频、优酷视频等在线视频网站的资源，需要先进行视频地址解析，如<a target="_blank" rel="noopener" href="http://old.flvurl.cn/">点量视频解析</a>，获取到实际的视频地址。</p><p>在使用优酷或者腾讯视频时可以直接复制分享代码到文章中，如：</p><pre class="line-numbers language-none"><code class="language-none">&lt;iframe height=498 width=510 src='https://player.youku.com/embed/XMjk4ODAyMzIyOA==' frameborder=0 'allowfullscreen'&gt;&lt;/iframe&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><strong>dplayer</strong></li></ul><pre class="line-numbers language-none"><code class="language-none">{% dplayer "url=http://www.nenu.edu.cn/_upload/article/videos/03/5f/7c999eed42e3aadc413d7f851f0e/0f50b3eb-9285-41d2-ac4d-6cc363651aad_B.mp4"  "autoplay=false" "preload=metadata" "hotkey=true" %} <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><strong>iframe</strong></li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>498</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>510</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>https://player.youku.com/embed/XMjk4ODAyMzIyOA==<span class="token punctuation">'</span></span> <span class="token attr-name">frameborder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>0</span> <span class="token attr-name">'allowfullscreen'</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="hexo-tag-mmedia使用"><a target="_blank" rel="noopener" href="https://github.com/u2sb/hexo-tag-mmedia">hexo-tag-mmedia</a>使用</h3><blockquote><p><a target="_blank" rel="noopener" href="https://www.u2sb.com/pages/7c33e5/">官方教程</a></p></blockquote><h4 id="audio"><strong>audio</strong></h4><blockquote><p>此部分请熟读 <a target="_blank" rel="noopener" href="https://www.w3.org/TR/2014/REC-html5-20141028/embedded-content-0.html#the-audio-element">Audio 相关介绍</a></p><p>目前主题中不可用</p></blockquote><ul><li>使用 <code>:</code> 或 <code>=</code> 分割。</li><li>所有 <code>&lt;audio&gt;</code> 标签的原生参数均可添加，只要能写进去就可以。</li><li>具体能否实现相关标准，取决于客户端浏览器。</li></ul><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">mmedia</span></span> <span class="token string"><span class="token punctuation">"</span>audio<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>src:a.mp3<span class="token punctuation">"</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">mmedia</span></span> <span class="token string"><span class="token punctuation">"</span>audio<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>src:https://baidu.com/a.mp3<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>autoplay:true<span class="token punctuation">"</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="video">video</h4><blockquote><p>此部分请熟读 <a target="_blank" rel="noopener" href="https://www.w3.org/TR/2014/REC-html5-20141028/embedded-content-0.html#the-video-element">Video 相关介绍</a></p><p>目前主题中不可用</p></blockquote><ul><li>使用 <code>:</code> 或 <code>=</code> 分割。</li><li>所有 <code>&lt;video&gt;</code> 标签的原生参数均可添加，只要能写进去就可以。</li><li>具体能否实现相关标准，取决于客户端浏览器。</li></ul><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">mmedia</span></span> <span class="token string"><span class="token punctuation">"</span>video<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>src:a.mp4<span class="token punctuation">"</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">mmedia</span></span> <span class="token string"><span class="token punctuation">"</span>video<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>src:https://baidu.com/a.mp4<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>autoplay:true<span class="token punctuation">"</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="MetingJS"><strong>MetingJS</strong></h4><blockquote><p>此部分请熟读 <a target="_blank" rel="noopener" href="https://github.com/metowolf/MetingJS#option">MetingJS 文档</a></p></blockquote><table><thead><tr><th style="text-align:left">option</th><th style="text-align:center">default</th><th style="text-align:left">description</th></tr></thead><tbody><tr><td style="text-align:left">id</td><td style="text-align:center"><strong>require</strong></td><td style="text-align:left">song id / playlist id / album id / search keyword</td></tr><tr><td style="text-align:left">server</td><td style="text-align:center"><strong>require</strong></td><td style="text-align:left">music platform: <code>netease</code>, <code>tencent</code>, <code>kugou</code>, <code>xiami</code>, <code>baidu</code></td></tr><tr><td style="text-align:left">type</td><td style="text-align:center"><strong>require</strong></td><td style="text-align:left"><code>song</code>, <code>playlist</code>, <code>album</code>, <code>search</code>, <code>artist</code></td></tr><tr><td style="text-align:left">auto</td><td style="text-align:center">options</td><td style="text-align:left">music link, support: <code>netease</code>, <code>tencent</code>, <code>xiami</code></td></tr><tr><td style="text-align:left">fixed</td><td style="text-align:center"><code>false</code></td><td style="text-align:left">enable fixed mode</td></tr><tr><td style="text-align:left">mini</td><td style="text-align:center"><code>false</code></td><td style="text-align:left">enable mini mode</td></tr><tr><td style="text-align:left">autoplay</td><td style="text-align:center"><code>false</code></td><td style="text-align:left">audio autoplay</td></tr><tr><td style="text-align:left">theme</td><td style="text-align:center"><code>#2980b9</code></td><td style="text-align:left">main color</td></tr><tr><td style="text-align:left">loop</td><td style="text-align:center"><code>all</code></td><td style="text-align:left">player loop play, values: ‘all’, ‘one’, ‘none’</td></tr><tr><td style="text-align:left">order</td><td style="text-align:center"><code>list</code></td><td style="text-align:left">player play order, values: ‘list’, ‘random’</td></tr><tr><td style="text-align:left">preload</td><td style="text-align:center"><code>auto</code></td><td style="text-align:left">values: ‘none’, ‘metadata’, ‘auto’</td></tr><tr><td style="text-align:left">volume</td><td style="text-align:center"><code>0.7</code></td><td style="text-align:left">default volume, notice that player will remember user setting, default volume will not work after user set volume themselves</td></tr><tr><td style="text-align:left">mutex</td><td style="text-align:center"><code>true</code></td><td style="text-align:left">prevent to play multiple player at the same time, pause other players when this player start play</td></tr><tr><td style="text-align:left">lrc-type</td><td style="text-align:center"><code>0</code></td><td style="text-align:left">lyric type</td></tr><tr><td style="text-align:left">list-folded</td><td style="text-align:center"><code>false</code></td><td style="text-align:left">indicate whether list should folded at first</td></tr><tr><td style="text-align:left">list-max-height</td><td style="text-align:center"><code>340px</code></td><td style="text-align:left">list max height</td></tr><tr><td style="text-align:left">storage-name</td><td style="text-align:center"><code>metingjs</code></td><td style="text-align:left">localStorage key that store player setting</td></tr></tbody></table><p>Documentation for APlayer can be found at <a target="_blank" rel="noopener" href="https://aplayer.js.org/#/home?id=options">https://aplayer.js.org/#/home?id=options</a></p><p><strong>单曲</strong></p><pre class="line-numbers language-none"><code class="language-none">{% mmedia "meting" "auto=https://y.qq.com/n/ryqq/songDetail/0005RQAO3FqG5K" %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js metin="meting" auto="https://y.qq.com/n/ryqq/songDetail/0005RQAO3FqG5K"></meting-js><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">mmedia</span></span> <span class="token string"><span class="token punctuation">"</span>meting<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>auto=https://y.qq.com/n/yqq/song/001RGrEX3ija5X.html<span class="token punctuation">"</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">mmedia</span></span> <span class="token string"><span class="token punctuation">"</span>meting<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>server=netease<span class="token punctuation">"</span></span><span class="token string"><span class="token punctuation">"</span>type=playlist<span class="token punctuation">"</span></span><span class="token string"><span class="token punctuation">"</span>id=60198<span class="token punctuation">"</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="Aplayer"><strong>Aplayer</strong></h4><p>详细参数表：</p><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">默认</th><th style="text-align:left">解释</th></tr></thead><tbody><tr><td style="text-align:left">name</td><td style="text-align:left">-</td><td style="text-align:left">audio name</td></tr><tr><td style="text-align:left">artist</td><td style="text-align:left">-</td><td style="text-align:left">audio artist</td></tr><tr><td style="text-align:left">url</td><td style="text-align:left">-</td><td style="text-align:left">audio url</td></tr><tr><td style="text-align:left">cover</td><td style="text-align:left">-</td><td style="text-align:left">audio cover</td></tr><tr><td style="text-align:left">lrc</td><td style="text-align:left">-</td><td style="text-align:left">audio lrc</td></tr><tr><td style="text-align:left">theme</td><td style="text-align:left">-</td><td style="text-align:left">audio theme</td></tr><tr><td style="text-align:left">type</td><td style="text-align:left">auto</td><td style="text-align:left">audio type 可选 ‘auto’, ‘hls’, ‘normal’</td></tr><tr><td style="text-align:left">autoplay</td><td style="text-align:left">false</td><td style="text-align:left">autoplay</td></tr><tr><td style="text-align:left">loop</td><td style="text-align:left">‘all’</td><td style="text-align:left">player loop play, values: ‘all’, ‘one’, ‘none’</td></tr><tr><td style="text-align:left">order</td><td style="text-align:left">‘list’</td><td style="text-align:left">player play order, values: ‘list’, ‘random’</td></tr><tr><td style="text-align:left">volume</td><td style="text-align:left">0.7</td><td style="text-align:left">default volume,</td></tr><tr><td style="text-align:left">tlistMaxHeight</td><td style="text-align:left">-</td><td style="text-align:left">list max height</td></tr></tbody></table><p>不在表格内的参数请使用下面 JSON 类型的参数。</p><p>mmedia 插件允许在 contents 部分使用 JSON 编写配置，由于允许使用 JSON5，此项配置几乎与 APlayer 完全一致。</p><ul><li><strong>单曲</strong></li></ul><pre class="line-numbers language-none"><code class="language-none">{% mmedia "aplayer" "name:Hotel California" "artist:Camille and Kennerly" "url:https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.mp3" "lrc:https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.lrc" "cover:https://cdn.17lai.site/media/music/Hotel%20California/Hotel%20California.webp" "volume:0.66" %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><div id="mmedia-mbryNBALWUmFPCWe"></div><script> var mbryNBALWUmFPCWe_options = JSON.parse('{\"lrcType\":3,\"volume\":0.66,\"autoplay\":false,\"audio\":[{\"name\":\"Hotel California\",\"artist\":\"Camille and Kennerly\",\"url\":\"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.mp3\",\"lrc\":\"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.lrc\",\"cover\":\"https://cdn.17lai.site/media/music/Hotel%20California/Hotel%20California.webp\"}]}'); mbryNBALWUmFPCWe_options.container = document.getElementById("mmedia-mbryNBALWUmFPCWe"); const ap_mbryNBALWUmFPCWe = new APlayer(mbryNBALWUmFPCWe_options); </script><ul><li><strong>列表</strong></li></ul><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><div id="mmedia-KAfLyejObEomYxIS"></div><script> var KAfLyejObEomYxIS_options = JSON.parse('{\"lrcType\":3,\"volume\":0.8,\"autoplay\":false,\"audio\":[{\"name\":\"Hotel California\",\"artist\":\"Camille and Kennerly\",\"url\":\"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.mp3\",\"cover\":\"https://cdn.17lai.site/media/music/Hotel%20California/Hotel%20California.webp\",\"lrc\":\"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.lrc\",\"theme\":\"#ebd0c2\"},{\"name\":\"Sold Out\",\"artist\":\"Diamonds\",\"url\":\"https://cdn.17lai.site/media/music/Diamonds/05%20Sold%20Out.flac\",\"cover\":\"https://cdn.17lai.site/media/music/Diamonds/Diamonds.jpg\",\"theme\":\"#ebd0c2\"},{\"name\":\"The Final Bell\",\"artist\":\"Rocky_Original Motion Picture Score\",\"url\":\"https://cdn.17lai.site/media/music/Rocky_%20Original%20Motion%20Picture%20Score/12%20Bill%20Conti%20-%20The%20Final%20Bell.mp3\",\"cover\":\"https://cdn.17lai.site/media/music/Rocky_%20Original%20Motion%20Picture%20Score/Rocky_%20Original%20Motion%20Picture%20Score.jpg\",\"theme\":\"#ebd0c2\"},{\"name\":\" Croatian Rhapsody\",\"artist\":\"The Piano Player\",\"url\":\"https://cdn.17lai.site/media/music/The%20Piano%20Player/11%20Croatian%20Rhapsody.mp3\",\"cover\":\"https://cdn.17lai.site/media/music/The%20Piano%20Player/The%20Piano%20Player.jpg\",\"theme\":\"#ebd0c2\"}]}'); KAfLyejObEomYxIS_options.container = document.getElementById("mmedia-KAfLyejObEomYxIS"); const ap_KAfLyejObEomYxIS = new APlayer(KAfLyejObEomYxIS_options); </script><p><strong>例子</strong></p><pre class="line-numbers language-none"><code class="language-none">{% mmedias "aplayer" "autoplay:false" %}{  "volume": 0.8,  "audio":  [    {      "name": "name1",      "artist": "artist1",      "url": "url1.mp3",      "cover": "cover1.jpg",      "lrc": "lrc1.lrc",      "theme": "#ebd0c2"    },    {      "name": "name2",      "artist": "artist2",      "url": "url2.mp3",      "cover": "cover2.jpg",      "lrc": "lrc2.lrc",      "theme": "#46718b"    }  ]}{% endmmedias %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Dplayer">Dplayer</h4><blockquote><p>此部分请熟读 <a target="_blank" rel="noopener" href="http://dplayer.js.org/">DPlayer 文档</a></p></blockquote><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">mmedia</span></span> <span class="token string"><span class="token punctuation">"</span>dplayer<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>url:a.mp4<span class="token punctuation">"</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">mmedias</span></span> <span class="token string"><span class="token punctuation">"</span>dplayer<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>flv:<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>url:https://dandoc.u2sb.com/video/%E5%AE%89%E8%A3%85/1-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E8%A3%85.mp4<span class="token punctuation">"</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span class="token other">{  "contextmenu":  [    {      text: "custom1",      link: "https://github.com/DIYgod/DPlayer"    }  ]}</span><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">endmmedias</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">{% mmedia "dplayer" "url:https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4" %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><script src="https://cdn.jsdelivr.net/npm/dplayer@1/dist/DPlayer.min.js"></script><div id="mmedia-PQyfLjOihBqYNRZh"></div><script> var PQyfLjOihBqYNRZh_options = JSON.parse('{\"video\":{\"url\":\"https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4\"}}'); PQyfLjOihBqYNRZh_options.container = document.getElementById("mmedia-PQyfLjOihBqYNRZh"); const dp_PQyfLjOihBqYNRZh = new DPlayer(PQyfLjOihBqYNRZh_options); </script><pre class="line-numbers language-none"><code class="language-none">{% mmedias "dplayer" %}{  video:   {    url: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4"  }}{% endmmedias %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="哔哩哔哩">哔哩哔哩</h4><p>详细参数表：</p><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">默认</th><th style="text-align:left">解释</th></tr></thead><tbody><tr><td style="text-align:left">aid</td><td style="text-align:left">-</td><td style="text-align:left">aid</td></tr><tr><td style="text-align:left">bvid</td><td style="text-align:left">-</td><td style="text-align:left">bvid，与 aid 同时出现时以 bvid 为准</td></tr><tr><td style="text-align:left">page</td><td style="text-align:left">1</td><td style="text-align:left">page</td></tr><tr><td style="text-align:left">danmaku</td><td style="text-align:left">true</td><td style="text-align:left">是否有弹幕 ture or false</td></tr><tr><td style="text-align:left">allowfullscreen</td><td style="text-align:left">allowfullscreen</td><td style="text-align:left">允许全屏， allowfullscreen 或 true 允许，其他选项不允许</td></tr><tr><td style="text-align:left">sandbox</td><td style="text-align:left">见 <a target="_blank" rel="noopener" href="https://www.u2sb.com/pages/19d343/#%E9%85%8D%E7%BD%AE">配置</a></td><td style="text-align:left">iframe sandbox</td></tr><tr><td style="text-align:left">width</td><td style="text-align:left">100%</td><td style="text-align:left">css 属性</td></tr><tr><td style="text-align:left">max_width</td><td style="text-align:left">850px</td><td style="text-align:left">css 属性</td></tr><tr><td style="text-align:left">margin</td><td style="text-align:left">auto</td><td style="text-align:left">css 属性</td></tr></tbody></table><p>mmedia 插件允许在 contents 部分使用 JSON 编写配置，使用 JSON5 标准。</p><style>.bbplayer{width: 100%; max-width: 850px; margin: auto}</style><div class="bbplayer"><iframe class="bbplayer" id="mmedia-AyogcYKehpvqOQWv" src="https://player.bilibili.com/player.html?bvid=BV1fs411S7u7&amp;page=1&amp;high_quality=1&amp;danmaku=true" allowfullscreen="allowfullscreen" scrolling="no" border="0" frameborder="0" framespacing="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts allow-popups"></iframe></div><script> document.getElementById("mmedia-AyogcYKehpvqOQWv").style.height=document.getElementById("mmedia-AyogcYKehpvqOQWv").scrollWidth*0.76+"px";    window.onresize = function(){      document.getElementById("mmedia-AyogcYKehpvqOQWv").style.height=document.getElementById("mmedia-AyogcYKehpvqOQWv").scrollWidth*0.76+"px";    }; </script><pre class="line-numbers language-none"><code class="language-none">{% mmedia "bilibili" "bvid:BV1fs411S7u7" %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="西瓜视频">西瓜视频</h4><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">mmedia</span></span> <span class="token string"><span class="token punctuation">"</span>xigua<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>xid=6925997698269053453<span class="token punctuation">"</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">mmedia</span></span> <span class="token string"><span class="token punctuation">"</span>xigua<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>xid:6925997698269053453<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>autoplay:true<span class="token punctuation">"</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>详细参数表：</p><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">默认</th><th style="text-align:left">解释</th></tr></thead><tbody><tr><td style="text-align:left">xid</td><td style="text-align:left">-</td><td style="text-align:left">西瓜视频的 ID，就是那一串数字</td></tr><tr><td style="text-align:left">id</td><td style="text-align:left">-</td><td style="text-align:left">一般情况下不需要填写</td></tr><tr><td style="text-align:left">autoplay</td><td style="text-align:left">false</td><td style="text-align:left">autoplay</td></tr><tr><td style="text-align:left">startTime</td><td style="text-align:left">0</td><td style="text-align:left">开始时间，秒</td></tr><tr><td style="text-align:left">allowfullscreen</td><td style="text-align:left">allowfullscreen</td><td style="text-align:left">允许全屏， allowfullscreen 或 true 允许，其他选项不允许</td></tr><tr><td style="text-align:left">sandbox</td><td style="text-align:left">见 <a target="_blank" rel="noopener" href="https://www.u2sb.com/pages/a0c4a7/#%E9%85%8D%E7%BD%AE">配置</a></td><td style="text-align:left">iframe sandbox</td></tr><tr><td style="text-align:left">width</td><td style="text-align:left">100%</td><td style="text-align:left">css 属性</td></tr><tr><td style="text-align:left">max_width</td><td style="text-align:left">850px</td><td style="text-align:left">css 属性</td></tr><tr><td style="text-align:left">margin</td><td style="text-align:left">auto</td><td style="text-align:left">css 属性</td></tr></tbody></table><style>.xgplayer{width: 100%; max-width: 850px; margin: auto}</style><div class="xgplayer"><iframe class="xgplayer" id="mmedia-vFhEJvWAGVjjebxl" src="https://www.ixigua.com/iframe/6925997698269053453?autoplay=0&amp;startTime=undefined" allowfullscreen="allowfullscreen" scrolling="no" border="0" frameborder="0" framespacing="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts allow-popups"></iframe></div><script> document.getElementById("mmedia-vFhEJvWAGVjjebxl").style.height=document.getElementById("mmedia-vFhEJvWAGVjjebxl").scrollWidth*0.7+"px";    window.onresize = function(){      document.getElementById("mmedia-vFhEJvWAGVjjebxl").style.height=document.getElementById("mmedia-vFhEJvWAGVjjebxl").scrollWidth*0.7+"px";    }; </script><pre class="line-numbers language-none"><code class="language-none">{% mmedia "xigua" "xid=6925997698269053453" %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="ArtPlayer">ArtPlayer</h4><blockquote><p>此部分请熟读 <a target="_blank" rel="noopener" href="https://artplayer.org/document/#/options">ArtPlayer 文档</a></p></blockquote><ul><li>使用 <code>:</code> 或 <code>=</code> 分割。</li></ul><p>详细参数表：</p><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">默认</th><th style="text-align:left">解释</th></tr></thead><tbody><tr><td style="text-align:left">url</td><td style="text-align:left">-</td><td style="text-align:left">url</td></tr><tr><td style="text-align:left">title</td><td style="text-align:left">-</td><td style="text-align:left">title</td></tr><tr><td style="text-align:left">poster</td><td style="text-align:left">-</td><td style="text-align:left">poster</td></tr><tr><td style="text-align:left">type</td><td style="text-align:left">-</td><td style="text-align:left">type</td></tr><tr><td style="text-align:left">autoplay</td><td style="text-align:left">false</td><td style="text-align:left">video autoplay</td></tr><tr><td style="text-align:left">loop</td><td style="text-align:left">false</td><td style="text-align:left">video loop</td></tr><tr><td style="text-align:left">volume</td><td style="text-align:left">0.7</td><td style="text-align:left">default volume</td></tr><tr><td style="text-align:left">style</td><td style="text-align:left">-</td><td style="text-align:left">style</td></tr></tbody></table><p>上面有一个比较特殊的参数 flv，这里单独解释一下，这个参数是用于引入其他 js 文件的，目前支持的有： <code>hls</code> <code>dash</code> <code>shaka_dash</code> <code>flv</code> <code>webtorrent</code> ，上述参数可多个一起使用，如果后面带有 js 地址，将直接使用，否则将使用 <code>_config.yml</code> 配置或插件默认配置，如：</p><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">mmedia</span></span> <span class="token string"><span class="token punctuation">"</span>artplayer<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>flv:<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>url:a.flv<span class="token punctuation">"</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">mmedias</span></span> <span class="token string"><span class="token punctuation">"</span>artplayer<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>flv:<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>hls:https://cdn.jsdelivr.net/npm/hls.js/dist/hls.min.js<span class="token punctuation">"</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span class="token other">{  ...}</span><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">endmmedias</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">mmedia</span></span> <span class="token string"><span class="token punctuation">"</span>artplayer<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>url:https://dandoc.u2sb.com/video/%E5%AE%89%E8%A3%85/1-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E8%A3%85.mp4<span class="token punctuation">"</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">mmedias</span></span> <span class="token string"><span class="token punctuation">"</span>artplayer<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>flv:<span class="token punctuation">"</span></span>  <span class="token rd"><span class="token punctuation">%}</span></span></span><span class="token other">{  url: "https://dandoc.u2sb.com/video/%E5%AE%89%E8%A3%85/1-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E8%A3%85.mp4"}</span><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">endmmedias</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">{% mmedia "artplayer" "url:https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_2mb.mp4" %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><script src="https://cdn.jsdelivr.net/npm/artplayer@3/dist/artplayer.js"></script><div id="mmedia-DuqoSRkpTQsWUVge" style="width:100%;height:650px;max-width:1200px;center"></div><script> var DuqoSRkpTQsWUVge_options = JSON.parse('{\"style\":\"width:100%;height:650px;max-width:1200px;center\",\"autoSize\":true,\"autoMini\":true,\"fullscreen\":true,\"fullscreenWeb\":true,\"url\":\"https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_2mb.mp4\"}'); DuqoSRkpTQsWUVge_options.container = "#mmedia-DuqoSRkpTQsWUVge"; const art_DuqoSRkpTQsWUVge = new Artplayer(DuqoSRkpTQsWUVge_options); </script><pre class="line-numbers language-none"><code class="language-none">{% mmedias "artplayer" %}{  url: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_2mb.mp4"}{% endmmedias %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="脑图"><a target="_blank" rel="noopener" href="https://github.com/MaxChang3/hexo-markmap">脑图</a></h2><blockquote><p><a target="_blank" rel="noopener" href="https://zhangmaimai.com/2021/02/23/hexo-mindmap-plugin/">原作者记录</a></p></blockquote>    <div class="markmap-container" style="height:250px">      <svg data="{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:1,&quot;p&quot;:{&quot;lines&quot;:[0,1]},&quot;v&quot;:&quot;思维导图？&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[1,2]},&quot;v&quot;:&quot;使用现有的插件或组件？&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[2,3]},&quot;v&quot;:&quot;Mermaid：更偏向流程图&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[3,4]},&quot;v&quot;:&quot;Kityminder&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[4,5]},&quot;v&quot;:&quot;现成hexo插件有些小问题。&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[5,6]},&quot;v&quot;:&quot;二次开发，失败&quot;}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[6,7]},&quot;v&quot;:&quot;找寻相关项目？&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[8,9]},&quot;v&quot;:&quot;Markmap大法！&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[9,10]},&quot;v&quot;:&quot;直接弄，失败&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[10,11]},&quot;v&quot;:&quot;使用jsdom，失败&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[11,12]},&quot;v&quot;:&quot;寻找现成库，成功&quot;}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[12,13]},&quot;v&quot;:&quot;咕咕咕咕咕咕咕咕咕咕咕咕&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[13,14]},&quot;v&quot;:&quot;凑一下行数让版面好看点&quot;}]}"></svg>    </div>  <pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% markmap 250px %}<span class="token title important"><span class="token punctuation">#</span> 思维导图？</span><span class="token title important"><span class="token punctuation">##</span> 使用现有的插件或组件？</span><span class="token title important"><span class="token punctuation">###</span> Mermaid：更偏向流程图</span><span class="token title important"><span class="token punctuation">###</span> Kityminder</span><span class="token title important"><span class="token punctuation">####</span> 现成hexo插件有些小问题。</span><span class="token title important"><span class="token punctuation">####</span> 二次开发，失败</span><span class="token title important"><span class="token punctuation">##</span> 找寻相关项目？</span><span class="token title important"><span class="token punctuation">###</span> Markmap大法！</span><span class="token title important"><span class="token punctuation">####</span> 直接弄，失败</span><span class="token title important"><span class="token punctuation">####</span> 使用jsdom，失败</span><span class="token title important"><span class="token punctuation">####</span> 寻找现成库，成功</span><span class="token title important"><span class="token punctuation">##</span> 咕咕咕咕咕咕咕咕咕咕咕咕</span><span class="token title important"><span class="token punctuation">##</span> 凑一下行数让版面好看点</span>{% endmarkmap %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>Here is the footnote. <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p>Here's one with multiple blocks.</p><p>Subsequent paragraphs are indented to show that they <a href="#fnref2" class="footnote-backref">↩︎</a></p></li></ol></section><link rel="stylesheet" href="/css/bilicard.css" type="text/css">    <style>.markmap-container{display:flex;justify-content:center;margin:0 auto;width:90%;height:500px}.markmap-container svg{width:100%;height:100%}@media(max-width:768px){.markmap-container{height:400px}}</style>    <script src="https://cdn.jsdelivr.net/npm/d3@6"></script>    <script src="https://cdn.jsdelivr.net/npm/markmap-view"></script>    <script> document.querySelectorAll('.markmap-container>svg').forEach(mindmap => markmap.Markmap.create(mindmap, null, JSON.parse(mindmap.getAttribute('data'))))</script>  ]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="web" scheme="https://blog.17lai.site/categories/web/"/>
    
    
    <category term="hexo" scheme="https://blog.17lai.site/tags/hexo/"/>
    
    <category term="mermaid" scheme="https://blog.17lai.site/tags/mermaid/"/>
    
    <category term="plantuml" scheme="https://blog.17lai.site/tags/plantuml/"/>
    
    <category term="mathjax" scheme="https://blog.17lai.site/tags/mathjax/"/>
    
  </entry>
  
  <entry>
    <title>第一次使用VS CODE时你应该指导的一切配置</title>
    <link href="https://blog.17lai.site/posts/44557ab0/"/>
    <id>https://blog.17lai.site/posts/44557ab0/</id>
    <published>2021-10-18T04:25:00.000Z</published>
    <updated>2022-03-16T11:18:36.817Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="前言-2">前言</h2><blockquote><p>文章标题：《第一次使用 VS Code 时你应该知道的一切配置》。本文的最新内容，更新于 2021-10-09。大家完全不用担心这篇文章会过时，因为随着 VS Code 的版本更新和插件更新，本文也会随之更新。</p></blockquote><blockquote><p>本文的最新内容，也会在<a target="_blank" rel="noopener" href="https://github.com/qianguyihao/Web/blob/master/00-%E5%89%8D%E7%AB%AF%E5%B7%A5%E5%85%B7/01-VS%20Code%E7%9A%84%E4%BD%BF%E7%94%A8.md">GitHub</a>上同步更新，欢迎 star。</p></blockquote><p>VS Code 软件实在是太酷、太好用了，越来越多的新生代互联网民工正在使用它。</p><p>前端男神<strong>尤雨溪</strong>大大这样评价 VS Code：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201152.png" alt=""></p><p>有一点你可能会感到惊讶：VS Code 这款软件本身，是用 JavaScript 语言编写的（具体请自行查阅基于 JS 的 PC 客户端开发框架 <code>Electron</code>）。Jeff Atwood 在 2007 年提出了著名的 Atwood 定律：</p><blockquote><p><strong>任何能够用 JavaScript 实现的应用系统，最终都必将用 JavaScript 实现</strong>。</p></blockquote><p>Jeff Atwood 这个人是谁不重要（他是 Stack Overflow 网站的联合创始人），重要的是这条定律。</p><p>前端目前是处在春秋战国时代，各路英雄豪杰成为后浪，各种框架工具层出不穷，VS Code 软件无疑是大前端时代最骄傲的工具。</p><p>如果你是做前端开发（JavaScript 编程语言为主），则完全可以将 VS Code 作为「<strong>主力开发工具</strong>」。这款软件是为前端同学量身定制的，开箱即用。</p><p>如果你是做其他语言方向的开发，并且不需要太复杂的集成开发环境，那么，你可以把 VS Code 作为「<strong>代码编辑器</strong>」来使用，纵享丝滑。</p><p>甚至是一些写文档、写作的同学，也经常把 VS Code 作为 markdown <strong>写作工具</strong>，毫无违和感。</p><p>退而求其次，即便你不属于以上任何范畴，你还可以把 VS Code 当作最简单的<strong>文本编辑器</strong>来使用，完胜 Windows 系统自带的记事本。</p><p>写下这篇文章，是顺势而为。</p><h2 id="一、惊艳登场：VS-Code-的介绍">一、惊艳登场：VS Code 的介绍</h2><p>VS Code 的全称是 Visual Studio Code，是一款开源的、免费的、跨平台的、高性能的、轻量级的代码编辑器。它在性能、语言支持、开源社区方面，都做得很不错。</p><p>微软有两种软件：一种是 VS Code，一种是其他软件。</p><p>在2015年4月29日的微软Build开发者大会上，微软宣布推出 VS Code之后，这个轻量级的编辑器成为全球无数开发者们最喜爱的开发工具。VS Code基于开源且跨平台的理念，每月都会进行迭代，并提供每天发布的 insider 版本（insider是微软的一种公测计划，类似于国内软件所说的内测版）。它拥有至少几万个插件，生态极为活跃和丰富。</p><h3 id="IDE-与-编辑器的对比">IDE 与 编辑器的对比</h3><p>IDE 和编辑器是有区别的：</p><ul><li><p><strong>IDE</strong>（Integrated Development Environment，集成开发环境）：对代码有较好的智能提示和相互跳转，同时侧重于工程项目，对项目的开发、调试工作有较好的图像化界面的支持，因此比较笨重。比如 Eclipse 的定位就是 IDE。</p></li><li><p><strong>编辑器</strong>：要相对轻量许多，侧重于文本的编辑。比如 Sublime Text 的定位就是编辑器。再比如 Windows 系统自带的「记事本」就是最简单的编辑器。</p></li></ul><p>需要注意的是，VS Code 的定位是<strong>编辑器</strong>，而非 IDE ，但 VS Code 又比一般的编辑器的功能要丰富许多。可以这样理解：VS Code 的体量是介于编辑器和 IDE 之间。VS Code 的使命，是让开发者在编辑器里拥有 IDE 那样的开发体验。</p><p>VS Code流行起来之后，使用 Sublime Text、Atom 这类编辑器软件的人，自然就越来越少了。</p><h3 id="VS-Code-的特点">VS Code 的特点</h3><ul><li>跨平台：支持 MacOS、Windows 和 Linux 等多个平台。在这多种平台下，拥有一致的用户界面和开发体验。</li><li>开源：VS Code 的源代码以 MIT 协议开源。不仅代码开源，而且整个产品的开发计划和发布管理也都是开源的。VS Code团队每年都会在 GitHub 的Wiki上发布 <a target="_blank" rel="noopener" href="https://github.com/microsoft/vscode/wiki/Roadmap">Roadmap</a>，列出一整年的规划图。VS Code 软件的官方文档也托管在了 <a target="_blank" rel="noopener" href="https://github.com/Microsoft/vscode-docs">GitHub</a> 上。</li><li>自带终端、图形化的调试工具、Git 版本控制。</li><li>插件扩展：支持第三方插件，功能强大。既有中心化的插件市场，也可以直接在 VS Code里搜索你想要的插件。</li><li>生态：社区生态活跃且丰富，社区氛围浓厚。</li><li>自带  emmet：支持代码自动补全，快速生成简单的语法结构。要知道，这个功能在 Sublime Text中，得先安装插件才行。</li><li>语法支持：VS Code 自带了 JavaScript、TypeScript 和 Node.js 的<strong>语法支持</strong>，包括：<strong>语法高亮、代码智能提示和补全、括号匹配、颜色区分、代码片段提示</strong>等。也就是说，你在书写 JS 和 TS 时，这些语法支持都是自带的。其他的一些语言，你需要先安装相应的<strong>扩展包</strong>插件，就出现语法支持。</li><li>在修改配置方面，既有图形化的配置界面，也有 基于 JSON 文件的配置方式，满足不同人群的使用习惯。</li></ul><h3 id="前端利器之争：-VS-Code-与-WebStorm">前端利器之争： VS Code 与 WebStorm</h3><p>前端小白最喜欢问的一个问题是：哪个编辑器/IDE 好用？是 VS Code 还是 WebStorm （WebStorm 其实是 IntelliJ IDEA 的定制版）？我来做个对比：</p><ul><li><p><strong>哪个更酷</strong>：显然 VS Code 更酷。</p></li><li><p><strong>内存占用情况</strong>：根据我的观察，VS Code 是很占内存的（尤其是当你打开多个窗口的时候），但如果你的内存条够用，使用起来是不会有任何卡顿的感觉的。相比之下，IntelliJ IDEA 不仅非常占内存，而且还非常卡顿。如果你想换个既轻量级、又不占内存的编辑器，最好还是使用「Sublime Text」编辑器。</p></li><li><p><strong>使用比例</strong>：当然是 VS Code 更胜一筹。先不说别的，我就拿数据说话，我目前所在的研发团队有 200 人左右（120个后台、80个前端），他们绝大部分人都在用 VS Code 编码，妥妥的。</p></li></ul><p>所以，如果你以后还问这个问题，那就真有些掉底了。</p><h3 id="VS-Code-的技术栈、核心组件">VS Code 的技术栈、核心组件</h3><p>了解 VS Code的技术栈和核心组件，可以让我们对 VS Code 有更深入的认识。此小段，了解即可。</p><ul><li>开发框架：Electron。Electron可以使用 Node.js + JS这样的技术栈开发桌面GUI应用程序。</li><li>编辑器：Monaco Editor。Monaco Editor 是一款开源的在线代码编辑器，是 <strong>VS Code 浏览器版本</strong>的最核心组件。<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/88828576">#</a></li><li>编程语言：TypeScript。TypeScript 是  JavaScript的严格超集。TS 在JS的基础上添加了许多功能，引入了声明文件，而且支持类型扩展。TS 适合长期的、多人开发的大型项目开发。</li><li>让编辑器支持语言功能：Language Server Protocol （LSP） 语言服务协议。LSP是编辑器/IDE 与语言服务器之间的一种协议，通过 JSON-PRC 传输消息，可以让编辑器嵌入并支持各种编程语言。开发者可以在编辑器中使用各种语言来编写程序。</li><li>让编辑器支持调试功能：Debug Adapter Protocol（DAP）。DAP 是基于 JSON的协议，它抽象了开发工具与调试工具质检的通信。</li><li>集成终端：Xterm.js。VS Code的集成终端是基于开源项目 <a target="_blank" rel="noopener" href="https://github.com/xtermjs/xterm.js/">Xterm.js</a> 进行开发的。Xterm.js 是一个使用 TS 开发的终端组件。另外，Xterm.js 并不是直接下来下来就能用的终端应用，它只是一个前端组件，可以与 bash这样的进程进行连接，然后让用户通过  Xterm.js 进行交互。</li></ul><h3 id="VS-Code-的安装">VS Code 的安装</h3><ul><li>VS Code 官网：<a target="_blank" rel="noopener" href="https://code.visualstudio.com">https://code.visualstudio.com</a></li></ul><p>VS Code 的安装很简单，直接去官网下载安装包，然后双击安装即可。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201230.png" alt=""></p><p>上图中，直接点击 download，一键下载安装即可。</p><p>VS Code支持以下平台：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201146.png" alt=""></p><p>安装完成后的界面如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201237.png" alt=""></p><p>VS  Code被分为以下五个区域：</p><ul><li>编辑器</li><li>侧边栏</li><li>状态栏</li><li>活动栏</li><li>面板</li></ul><p>VS Code在功能上非常克制，只包含了大多数开发流程中所需要的基础模块，包括：编辑器、文件管理、窗口管理、首选项设置、终端等。</p><p>你需要根据具体需要安装额外的组件或者插件。比如说，如果开发TS项目，则需要安装 TS编译器、ESLint、TSLint等编译工具。如果开发C语言项目，则需要安装gcc、Clang等编辑工具。</p><h2 id="二、崭露锋芒：VS-Code-快捷键">二、崭露锋芒：VS Code 快捷键</h2><p>VS Code 用得熟不熟，首先就看你是否会用快捷键。以下列出的内容，都是常用快捷键，而加粗部分的快捷键，使用频率则非常高。</p><p>任何工具，掌握 20%的技能，足矣应对 80% 的工作。既然如此，你可能会问：那就只保留 20% 的特性，不久可以满足 80%的用户了吗？</p><p>但我想说的是：<strong>那从来都不是同样的 20%</strong>，每个人都会用到不同的功能。</p><p>掌握下面这些高频核心快捷键，你和你的工具，足矣露出锋芒。</p><h3 id="1、工作区快捷键">1、工作区快捷键</h3><table><thead><tr><th style="text-align:left">Mac 快捷键</th><th style="text-align:left">Win 快捷键</th><th style="text-align:left">作用</th><th style="text-align:left">备注</th></tr></thead><tbody><tr><td style="text-align:left"><strong>Cmd + Shift + P</strong></td><td style="text-align:left"><strong>Ctrl + Shift + P</strong>，F1</td><td style="text-align:left">显示命令面板</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><strong>Cmd + B</strong></td><td style="text-align:left"><strong>Ctrl + B</strong></td><td style="text-align:left">显示/隐藏侧边栏</td><td style="text-align:left">很实用</td></tr><tr><td style="text-align:left"><code>Cmd + \</code></td><td style="text-align:left"><code>Ctrl + \</code></td><td style="text-align:left"><strong>拆分为多个编辑器</strong></td><td style="text-align:left">【重要】抄代码利器</td></tr><tr><td style="text-align:left"><strong>Cmd + 1、2</strong></td><td style="text-align:left"><strong>Ctrl + 1、2</strong></td><td style="text-align:left">聚焦到第 1、第 2 个编辑器</td><td style="text-align:left">同上重要</td></tr><tr><td style="text-align:left"><strong>Cmd + +、Cmd + -</strong></td><td style="text-align:left"><strong>ctrl + +、ctrl + -</strong></td><td style="text-align:left">将工作区放大/缩小（包括代码字体、左侧导航栏）</td><td style="text-align:left">在投影仪场景经常用到</td></tr><tr><td style="text-align:left">Cmd + J</td><td style="text-align:left">Ctrl + J</td><td style="text-align:left">显示/隐藏控制台</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><strong>Cmd + Shift + N</strong></td><td style="text-align:left"><strong>Ctrl + Shift + N</strong></td><td style="text-align:left">重新开一个软件的窗口</td><td style="text-align:left">很常用</td></tr><tr><td style="text-align:left">Cmd + Shift + W</td><td style="text-align:left">Ctrl + Shift + W</td><td style="text-align:left">关闭软件的当前窗口</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Cmd + N</td><td style="text-align:left">Ctrl + N</td><td style="text-align:left">新建文件</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Cmd + W</td><td style="text-align:left">Ctrl + W</td><td style="text-align:left">关闭当前文件</td><td style="text-align:left"></td></tr></tbody></table><h3 id="2、跳转操作">2、跳转操作</h3><table><thead><tr><th style="text-align:left">Mac 快捷键</th><th style="text-align:left">Win 快捷键</th><th style="text-align:left">作用</th><th style="text-align:left">备注</th></tr></thead><tbody><tr><td style="text-align:left">Cmd + `</td><td style="text-align:left">没有</td><td style="text-align:left">在同一个软件的<strong>多个工作区</strong>之间切换</td><td style="text-align:left">使用很频繁</td></tr><tr><td style="text-align:left"><strong>Cmd + Option + 左右方向键</strong></td><td style="text-align:left">Ctrl + Pagedown/Pageup</td><td style="text-align:left">在已经打开的<strong>多个文件</strong>之间进行切换</td><td style="text-align:left">非常实用</td></tr><tr><td style="text-align:left">Ctrl + Tab</td><td style="text-align:left">Ctrl + Tab</td><td style="text-align:left">在已经打开的多个文件之间进行跳转</td><td style="text-align:left">不如上面的快捷键快</td></tr><tr><td style="text-align:left">Cmd + Shift + O</td><td style="text-align:left">Ctrl + shift + O</td><td style="text-align:left">在当前文件的各种<strong>方法之间</strong>（符号：Symbol）进行跳转</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Cmd + T</td><td style="text-align:left">Ctrl + T</td><td style="text-align:left">在当前<strong>工作区</strong>的各种方法之间（符号：Symbol）进行跳转</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Ctrl + G</td><td style="text-align:left">Ctrl + G</td><td style="text-align:left">跳转到指定行</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><code>Cmd+Shift+\</code></td><td style="text-align:left"><code>Ctrl+Shift+\</code></td><td style="text-align:left">跳转到匹配的括号</td><td style="text-align:left"></td></tr></tbody></table><h3 id="3、移动光标">3、移动光标</h3><table><thead><tr><th style="text-align:left">Mac 快捷键</th><th style="text-align:left">Win 快捷键</th><th style="text-align:left">作用</th><th style="text-align:left">备注</th></tr></thead><tbody><tr><td style="text-align:left">方向键</td><td style="text-align:left">方向键</td><td style="text-align:left">在<strong>单个字符</strong>之间移动光标</td><td style="text-align:left">大家都知道</td></tr><tr><td style="text-align:left"><strong>option + 左右方向键</strong></td><td style="text-align:left"><strong>Ctrl + 左右方向键</strong></td><td style="text-align:left">在<strong>单词</strong>之间移动光标</td><td style="text-align:left">很常用</td></tr><tr><td style="text-align:left"><strong>Cmd + 左右方向键</strong></td><td style="text-align:left"><strong>Fn + 左右方向键</strong>（或 Win + 左右方向键）</td><td style="text-align:left">将光标定位到当前行的最左侧、最右侧（在<strong>整行</strong>之间移动光标）</td><td style="text-align:left">很常用</td></tr><tr><td style="text-align:left"><strong>Option + Alt + 左右方向键</strong></td><td style="text-align:left"><strong>Alt + Shift + 左右方向键</strong></td><td style="text-align:left">左右扩大/缩小选中的范围</td><td style="text-align:left">很酷，极为高效</td></tr><tr><td style="text-align:left">Cmd + ↑</td><td style="text-align:left">Ctrl + Home</td><td style="text-align:left">将光标定位到文件的第一行</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Cmd + ↓</td><td style="text-align:left">Ctrl + End</td><td style="text-align:left">将光标定位到文件的最后一行</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Cmd + Shift + \</td><td style="text-align:left"></td><td style="text-align:left">在<strong>代码块</strong>之间移动光标</td><td style="text-align:left"></td></tr></tbody></table><h3 id="4、编辑操作">4、编辑操作</h3><table><thead><tr><th style="text-align:left">Mac 快捷键</th><th style="text-align:left">Win 快捷键</th><th style="text-align:left">作用</th><th style="text-align:left">备注</th></tr></thead><tbody><tr><td style="text-align:left">Cmd + C</td><td style="text-align:left">Ctrl + C</td><td style="text-align:left">复制</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Cmd + X</td><td style="text-align:left">Ctrl + X</td><td style="text-align:left">剪切</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Cmd + C</td><td style="text-align:left">Ctrl + V</td><td style="text-align:left">粘贴</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><strong>Cmd + Enter</strong></td><td style="text-align:left"><strong>Ctrl + Enter</strong></td><td style="text-align:left">在当前行的下方新增一行，然后跳至该行</td><td style="text-align:left">即使光标不在行尾，也能快速向下插入一行</td></tr><tr><td style="text-align:left">Cmd+Shift+Enter</td><td style="text-align:left">Ctrl+Shift+Enter</td><td style="text-align:left">在当前行的上方新增一行，然后跳至该行</td><td style="text-align:left">即使光标不在行尾，也能快速向上插入一行</td></tr><tr><td style="text-align:left"><strong>Option + ↑</strong></td><td style="text-align:left"><strong>Alt + ↑</strong></td><td style="text-align:left">将代码向上移动</td><td style="text-align:left">很常用</td></tr><tr><td style="text-align:left"><strong>Option + ↓</strong></td><td style="text-align:left"><strong>Alt + ↓</strong></td><td style="text-align:left">将代码向下移动</td><td style="text-align:left">很常用</td></tr><tr><td style="text-align:left">Option + Shift + ↑</td><td style="text-align:left">Alt + Shift + ↑</td><td style="text-align:left">将代码向上复制一行</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><strong>Option + Shift + ↓</strong></td><td style="text-align:left"><strong>Alt + Shift + ↓</strong></td><td style="text-align:left">将代码向下复制一行</td><td style="text-align:left">写重复代码的利器</td></tr></tbody></table><p>另外再补充一点：将光标点击到某一行的任意位置时，默认就已经是<strong>选中全行</strong>了，此时可以直接<strong>复制</strong>或<strong>剪切</strong>，无需点击鼠标。这个非常实用，是所有的编辑操作中，使用得最频繁的。它可以有以下使用场景：</p><ul><li>场景1：假设光标现在处于第5行的<strong>任意位置</strong>，那么，直接依次按下 <code>Cmd + C</code> 和 <code>Cmd + V</code>，就会把这行代码复制到第6行。继续按 <code>Cmd + C</code> 和 <code>Cmd + V</code>，就会把这行代码复制到第7行。copy代码so easy。</li><li>场景2：假设光标现在处于第5行，那么，先按下 <code>Cmd + C</code>，然后按两下<code>↑</code> 方向键，此时光标处于第3行；紧接着，继续按下<code>Cmd + V</code>，就会把刚刚那行代码复制到第3行，原本处于第3行的代码会整体<strong>下移</strong>。</li></ul><p>你看到了没？上面的两个场景，我全程没有使用鼠标，只通过简单的复制粘贴和方向键，就做到了如此迅速的copy代码。你说是不是很高效？</p><h3 id="5、删除操作">5、删除操作</h3><table><thead><tr><th style="text-align:left">Mac 快捷键</th><th style="text-align:left">Win 快捷键</th><th style="text-align:left">作用</th><th style="text-align:left">备注</th></tr></thead><tbody><tr><td style="text-align:left">Cmd + shift + K</td><td style="text-align:left">Ctrl + Shift + K</td><td style="text-align:left">删除整行</td><td style="text-align:left">「Cmd + X」的作用是剪切，但也可以删除整行</td></tr><tr><td style="text-align:left"><strong>option + Backspace</strong></td><td style="text-align:left"><strong>Ctrl + Backspace</strong></td><td style="text-align:left">删除光标之前的一个单词</td><td style="text-align:left">英文有效，很常用</td></tr><tr><td style="text-align:left">option + delete</td><td style="text-align:left">Ctrl + delete</td><td style="text-align:left">删除光标之后的一个单词</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><strong>Cmd + Backspace</strong></td><td style="text-align:left"></td><td style="text-align:left">删除光标之前的整行内容</td><td style="text-align:left">很常用</td></tr><tr><td style="text-align:left">Cmd + delete</td><td style="text-align:left"></td><td style="text-align:left">删除光标之后的整行内容</td><td style="text-align:left"></td></tr></tbody></table><p>备注：上面所讲到的移动光标、编辑操作、删除操作的快捷键，在其他编辑器里，大部分都适用。</p><h3 id="6、多光标选择-多光标编辑">6、多光标选择/多光标编辑</h3><p>多光标选择在编程的<strong>提效</strong>方面可谓立下了汗马功劳。因为比较难记住，所以你要时不时回来复习这一段。</p><table><thead><tr><th>Mac 快捷键</th><th>Win 快捷键</th><th>作用</th><th>备注</th></tr></thead><tbody><tr><td><strong>Option + 鼠标连续点击任意位置</strong></td><td><strong>Alt + 鼠标连续点击任意位置</strong></td><td>在任意位置，同时出现多个光标</td><td>很容易记住</td></tr><tr><td>Cmd + D</td><td>Ctrl + D</td><td>将光标放在某个单词的位置（或者先选中某个单词），然后反复按下「 <strong>Cmd + D</strong> 」键， 即可将下一个相同的词逐一加入选择。</td><td>较常用</td></tr><tr><td><strong>Cmd + Shift + L</strong></td><td><strong>Ctrl + Shift + L</strong></td><td>将光标放在某个单词的位置（或者先选中某个单词），然后按下快捷键，则所有的相同内容处，都会出现光标。</td><td>很常用。比如变量重命名的时候，就经常用到</td></tr></tbody></table><h3 id="7、多列选择-多列编辑">7、多列选择/多列编辑</h3><p>多列选择是更高效的多光标选择，所以单独列成一小段。</p><table><thead><tr><th>Mac 快捷键</th><th>Win 快捷键</th><th>作用</th><th>备注</th></tr></thead><tbody><tr><td>Cmd + Option + 上下键</td><td>Ctrl + Alt + 上下键</td><td>在连续的多列上，同时出现多个光标</td><td>较常用</td></tr><tr><td>Option + Shift + 鼠标拖动</td><td>Alt + Shift + 鼠标拖动</td><td>按住快捷键，然后把鼠标从区域的左上角拖至右下角，即可在选中区域的每一行末尾，出现光标。</td><td>很神奇的操作，较常用</td></tr><tr><td><strong>Option + Shift + i</strong></td><td><strong>Alt + Shift + I</strong></td><td>选中一堆文本后，按下快捷键，既可在<strong>每一行的末尾</strong>都出现一个光标。</td><td>很常用</td></tr></tbody></table><h3 id="8、编程语言相关">8、编程语言相关</h3><table><thead><tr><th style="text-align:left">Mac 快捷键</th><th style="text-align:left">Win 快捷键</th><th style="text-align:left">作用</th><th style="text-align:left">备注</th></tr></thead><tbody><tr><td style="text-align:left">Cmd + /</td><td style="text-align:left">Ctrl + /</td><td style="text-align:left">添加单行注释</td><td style="text-align:left">很常用</td></tr><tr><td style="text-align:left"><strong>Option + Shift + F</strong></td><td style="text-align:left">Alt + shift + F</td><td style="text-align:left">代码格式化</td><td style="text-align:left">很常用</td></tr><tr><td style="text-align:left">F2</td><td style="text-align:left">F2</td><td style="text-align:left">以重构的方式进行<strong>重命名</strong></td><td style="text-align:left">改代码备</td></tr><tr><td style="text-align:left">Ctrl + J</td><td style="text-align:left"></td><td style="text-align:left">将多行代码合并为一行</td><td style="text-align:left">Win 用户可在命令面板搜索”合并行“</td></tr><tr><td style="text-align:left">Cmd +</td><td style="text-align:left"></td><td style="text-align:left"></td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Cmd + U</td><td style="text-align:left">Ctrl + U</td><td style="text-align:left">将光标的移动回退到上一个位置</td><td style="text-align:left">撤销光标的移动和选择</td></tr></tbody></table><h3 id="9、搜索相关">9、搜索相关</h3><table><thead><tr><th style="text-align:left">Mac 快捷键</th><th style="text-align:left">Win 快捷键</th><th style="text-align:left">作用</th><th style="text-align:left">备注</th></tr></thead><tbody><tr><td style="text-align:left"><strong>Cmd + Shift + F</strong></td><td style="text-align:left"><strong>Ctrl + Shift +F</strong></td><td style="text-align:left">全局搜索代码</td><td style="text-align:left">很常用</td></tr><tr><td style="text-align:left"><strong>Cmd + P</strong></td><td style="text-align:left"><strong>Ctrl + P</strong></td><td style="text-align:left">在当前的项目工程里，<strong>全局</strong>搜索文件名</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Cmd + F</td><td style="text-align:left">Ctrl + F</td><td style="text-align:left">在当前文件中搜索代码，光标在搜索框里</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><strong>Cmd + G</strong></td><td style="text-align:left"><strong>F3</strong></td><td style="text-align:left">在当前文件中搜索代码，光标仍停留在编辑器里</td><td style="text-align:left">很巧妙</td></tr></tbody></table><h3 id="10、自定义快捷键">10、自定义快捷键</h3><p>按住快捷键「Cmd + Shift + P」，弹出命令面板，在命令面板中输入“快捷键”，可以进入快捷键的设置。</p><p>当然，你也可以选择菜单栏「偏好设置 --&gt; 键盘快捷方式」，进入快捷键的设置：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201244.png" alt=""></p><h3 id="11、快捷键列表">11、快捷键列表</h3><p>你可以点击 VS Code 左下角的齿轮按钮，效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201139.png" alt=""></p><p>上图中，在展开的菜单中选择「键盘快捷方式」，就可以查看和修改所有的快捷键列表了：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201333.png" alt=""></p><h3 id="快捷键参考表（官方）">快捷键参考表（官方）</h3><p>VS Code官网提供了 PDF版本的键盘快捷键参考表，转需：</p><ul><li>Windows版本：<a target="_blank" rel="noopener" href="https://code.visualstudio.com/shortcuts/keyboard-shortcuts-windows.pdf">https://code.visualstudio.com/shortcuts/keyboard-shortcuts-windows.pdf</a></li><li>Mac 版本：<a target="_blank" rel="noopener" href="https://code.visualstudio.com/shortcuts/keyboard-shortcuts-macos.pdf">https://code.visualstudio.com/shortcuts/keyboard-shortcuts-macos.pdf</a></li><li>Linux版本：<a target="_blank" rel="noopener" href="https://code.visualstudio.com/shortcuts/keyboard-shortcuts-linux.pdf">https://code.visualstudio.com/shortcuts/keyboard-shortcuts-linux.pdf</a></li></ul><p>我们在 VS  Code软件里通过菜单栏「帮助--&gt;键盘快捷方式参考」也可以打开相应平台的快捷键大全（PDF版本）。</p><h2 id="三、高端访问：命令面板的使用">三、高端访问：命令面板的使用</h2><p>Mac 用户按住快捷键 <code>Cmd+Shift+P</code> （Windows 用户按住快捷键<code>Ctrl+Shift+P</code>），可以打开快速命令面板。效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201339.png" alt=""></p><p>命令面板的作用是<strong>希望解放开发者的鼠标，让一些操作和配置可以直接通过键盘进行</strong>。如果让开发者记住所有的配置项在菜单的哪个位置是不现实的，而且有些命令并不在菜单中。</p><p>有了命令面板之后，如果你需要修改一些设置项，或者进行一些快捷操作，则可以通过「命令面板」来操作，效率会更高。接下来列举一些。</p><h3 id="1、VS-Code-设置为中文语言">1、VS Code 设置为中文语言</h3><p>Mac 用户按住快捷键 <code>Cmd+Shift+P</code> （Windows 用户按住快捷键<code>Ctrl+Shift+P</code>），打开命令面板。</p><p>在命令面板中，输入<code>Configure Display Language</code>，选择<code>Install additional languages</code>，然后安装插件<code>Chinese (Simplified) Language Pack for Visual Studio Code</code>即可。</p><p>或者，我们可以直接安装插件<code>Chinese (Simplified) Language Pack for Visual Studio Code</code>，是一样的。</p><p>安装完成后，重启 VS Code。</p><h3 id="2、设置字体大小">2、设置字体大小</h3><p>在命令面板输入“字体”，可以进行字体的设置，效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201251.png" alt=""></p><p>当然，你也可以在菜单栏，选择「首选项-设置-常用设置」，在这个设置项里修改字体大小。</p><h3 id="3、快捷键设置">3、快捷键设置</h3><p>在命令面板输入“快捷键”，就可以进入快捷键的设置。</p><h3 id="4、大小写转换">4、大小写转换</h3><p>选中文本后，在命令面板中输入<code>transfrom</code>，就可以修改文本的大小写了。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201132.png" alt=""></p><h3 id="5、使用命令行启动-VS-Code">5、使用命令行启动 VS Code</h3><p>（1）输入快捷键「Cmd + Shift + P 」，选择<code>install code command</code>：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201258.png" alt=""></p><p>（2）使用命令行：</p><ul><li><code>code</code>命令：启动 VS Code 软件</li><li><code>code pathName/fileName</code>命令：通过 VS Code 软件打开指定目录/指定文件。</li></ul><p>备注：这种方法快捷简单，但是在电脑重启之后就失效了。稍后在第五段，我会介绍更常见的方法。</p><h3 id="6、修改特定编程语言的设置项">6、修改特定编程语言的设置项</h3><p>输入快捷键「Cmd + Shift + P 」打开命令面板，然后输入并执行 <code>Configure Language Specific Settings</code>即可。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201304.png" alt=""></p><h2 id="四、私人订制：VS-Code-的常见配置">四、私人订制：VS Code 的常见配置</h2><h3 id="0、设置项介绍">0、设置项介绍</h3><p>在修改 VS Code配置之前，我们需要知道，在哪里可以找到设置项的入口。</p><p><strong>方式1</strong>：Mac用户选择菜单栏「Code--&gt; 首选项--&gt;设置」，即可打开配置项：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201346.png" alt=""></p><p><strong>方式2</strong>：点击软件右下角的设置图标：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201347.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201125.png" alt=""></p><p>如上图所示，VS Code提供两种不同范围的设置：</p><ul><li><strong>用户</strong>设置：全局生效。</li><li><strong>工作区</strong>设置：只针对当前项目生效。工作区设置会覆盖用户设置。适用于团队协作场景。工作区的设置文件是保存在当前项目根目录的<code>.vscode/settings.json</code>中，可以被提交到Git仓库，方便共享给项目组的其他成员。</li></ul><p>操作技巧：</p><p>（1）我们可以在设置面板的顶部搜索框，输入关键词，就能迅速定位到你想要的设置项。</p><p>（2）上图中，点击右上角的icon，可以通过 json文件的形式修改设置项。</p><h3 id="1、修改主题">1、修改主题</h3><p>1）修改颜色主题：</p><p>选择菜单栏「Code --&gt; 首选项 --&gt; 颜色主题」：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201353.png" alt=""></p><p>在弹出的对话框中，挑选你一个你喜欢的的颜色主题吧，或者安装其他颜色的主题：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201119.png" alt="20211013_1018"></p><p>或者在设置项里搜索<code>Workbench: Color Theme</code>，进行修改。</p><p>2）修改文件图标的主题：</p><p>选择菜单栏「Code --&gt; 首选项 --&gt; 文件图标主题」：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201113.png" alt="20211013_1015"></p><p>在弹出的对话框中，挑选你一个你喜欢的的主题吧，或者安装其他的主题：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201112.png" alt="20211013_1019"></p><p>或者在设置项里搜索<code>Workbench: Icon Theme</code>，进行修改。</p><h3 id="2、面包屑（Breadcrumb）导航">2、面包屑（Breadcrumb）导航</h3><p>打开 VS Code 的设置项，选择「用户设置 -&gt; 工作台 -&gt; 导航路径」，如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201400.png" alt=""></p><p>上图中，将红框部分打钩即可。</p><p>设置成功后，我们就可以查看到当前文件的「层级结构」，非常方便。如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201106.png" alt=""></p><p>有了这个面包屑导航，我们可以点击它，在任意目录、任意文件之间随意跳转。使用频繁非常高。</p><h3 id="3、是否显示代码的行号">3、是否显示代码的行号</h3><p>VS Code 默认显示代码的行号。你可以在设置项里搜索 <code>editor.lineNumbers</code>修改设置，配置项如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201105.png" alt=""></p><p>我建议保留这个设置项，无需修改。</p><h3 id="4、右侧是否显示代码的缩略图">4、右侧是否显示代码的缩略图</h3><p>如果某个文件的代码量很大，缩略图就很有用了，可以预览全局，并在当前文件中快速跳转。</p><p>VS Code 会在代码的右侧，默认显示缩略图。你可以在设置项里搜索 <code>editor.minimap</code> 进行设置，配置项如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201407.png" alt=""></p><p>上面这张图，你仔细琢磨下会发现，中文翻译十分精准。</p><h3 id="5、将当前行代码高亮显示（更改光标所在行的背景色）">5、将当前行代码高亮显示（更改光标所在行的背景色）</h3><p>当我们把光标放在某一行时，这一行的背景色并没有发生变化。如果想<strong>高亮显示</strong>当前行的代码，需要设置两步：</p><p>（1）在设置项里搜索<code>editor.renderLineHighlight</code>，将选项值设置为<code>all</code>或者<code>line</code>。</p><p>（2）在设置项里增加如下内容：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"workbench.colorCustomizations"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"editor.lineHighlightBackground"</span><span class="token operator">:</span> <span class="token string">"#00000090"</span><span class="token punctuation">,</span>    <span class="token property">"editor.lineHighlightBorder"</span><span class="token operator">:</span> <span class="token string">"#ffffff30"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>上方代码，第一行代码的意思是：修改光标所在行的背景色（背景色设置为全黑，不透明度 90%）；第二行代码的意思是：修改光标所在行的边框色。</p><h3 id="6、改完代码后立即自动保存">6、改完代码后立即自动保存</h3><p><strong>方式一</strong>：</p><p>改完代码后，默认不会自动保存。你可以在设置项里搜索<code>files.autoSave</code>，修改参数值为<code>afterDelay</code>  ，即可自动保存。如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201514.png" alt=""></p><p>files.autoSave的参数值有以下几种：</p><ul><li>off（默认值）：不自动保存。</li><li>afterDelay（建议配置）：文件修改超过一定时间（默认1秒）后，就自动保存。</li><li>onFocusChange：当前编辑器失去焦点时，则自动保存。如果我们将配置项修改为<code>onFocusChange</code>之后，那么，当光标离开该文件后，这个文件就会自动保存了。</li><li>onWindowChange：VS  Code软件失去焦点时，则自动保存。</li></ul><p><strong>方式二</strong>：</p><p>当然，你也可以直接在菜单栏选择「文件-自动保存」。勾选后，当你写完代码后，文件会立即实时保存。</p><h3 id="7、热退出">7、热退出</h3><p>当VS Code退出后，它可以记住未保存的文件。如果你希望达到这种效果，那么，你需要先将设置项<code>files.hotExit</code>的值改为 <code>onExitAndWindowClose</code>。这个配置项要不要改，看你个人需要。比如我自己平时设置的值是<code>onExit</code>。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201413.png" alt="20211012_2014"></p><h3 id="8、保存代码后，是否立即格式化">8、保存代码后，是否立即格式化</h3><p>保存代码后，默认<strong>不会立即</strong>进行代码的格式化。你可以在设置项里搜索<code>editor.formatOnSave</code>查看该配置项：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201058.png" alt=""></p><p>我觉得这个配置项保持默认就好，不用打钩。</p><h3 id="9、自动格式化粘贴的内容">9、自动格式化粘贴的内容</h3><p>在设置项里搜索 <code>editor.formatOnPaste</code>，将设置项改为<code>true</code>：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201059.png" alt="20211012_1049"></p><h3 id="10、设置字体大小">10、设置字体大小</h3><p>在设置项里搜索<code>fontSize</code>，然后根据需要设置各种模块的字体大小：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201420.png" alt="20211012_1053"></p><h3 id="11、空格-or-制表符">11、空格 or 制表符</h3><p>VS Code 会根据你所打开的文件来决定该使用空格还是制表。也就是说，如果你的项目中使用的都是制表符，那么，当你在写新的代码时，按下 tab 键后，编辑器就会识别成制表符。</p><p>（1）建议的设置项如下：</p><ul><li><strong>editor.detectIndentation</strong>：自动检测（默认开启）。建议把这个配置项修改为 false，截图如下：</li></ul><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201052.png" alt="20211012_1139"></p><p>这样做，是为了取消系统的自动缩进，建议自己手动格式化比较好。 参考链接：<a target="_blank" rel="noopener" href="https://www.yisu.com/zixun/327399.html">https://www.yisu.com/zixun/327399.html</a></p><ul><li><strong>editor.insertSpaces</strong>：按 Tab 键时插入空格（默认值为true）。截图如下：</li></ul><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201523.png" alt=""></p><ul><li><strong>editor.tabSize</strong>：一个制表符默认等于四个空格。截图如下：</li></ul><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201530.png" alt=""></p><p>（2）状态栏也会显示当前的缩进值。点击状态栏，可以直接修改 tabSize 缩进值：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201045.png" alt=""></p><p>（3）另外，我们还可以安装 prettier 插件，设置代码在格式化时默认缩进值。prettier 是做代码格式化的最常见工具。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201536.png" alt=""></p><p>（4）去掉每一行末尾的空格。在设置项里搜索<code>空格</code>或者<code>"files.trimTrailingWhitespace"</code>，将值设置为 true：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201858.png" alt="20211012_1231"></p><p>一般来说，每一行代码末尾的空格是多余的，所以建议去掉。</p><h3 id="12、直观地显示代码里的空格和缩进-✨">12、直观地显示代码里的空格和缩进 ✨</h3><p>代码里如果有缩进或者空格，肉眼是看不出来的，但是我们可以修改配置项，把它揪出来。</p><p>在配置项里搜索<code>editor.renderWhitespace</code>，修改为<code>all</code>：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201039.png" alt="20211012_1150"></p><p>修改之后，代码里的空格、缩进的展示效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201905.png" alt="20211012_1258"></p><p>看到了没？哪里有空格、哪里是缩进，全都一目了然。</p><h3 id="13、新建文件后的默认文件类型">13、新建文件后的默认文件类型</h3><p>当我们按下快捷键「Cmd + N」新建文件时，VS Code 默认无法识别这个文件到底是什么类型的，因此也就无法识别相应的语法高亮。</p><p>如果你想修改默认的文件类型，可以在设置项里搜索<code>files.defaultLanguage</code>，设置项如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201542.png" alt=""></p><p>上图中的红框部分，填入你期望的默认文件类型。我填的是<code>html</code>类型，你也可以填写成 <code>javascript</code> 或者 <code>markdown</code>，或者其他的语言类型。</p><h3 id="14、删除文件时，是否弹出确认框">14、删除文件时，是否弹出确认框</h3><p>当我们在 VS Code 中删除文件时，默认会弹出确认框。如果你想修改设置，可以在设置项里搜索<code>xplorer.confirmDelete</code>。截图如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201032.png" alt=""></p><p>我建议这个设置项保持默认的打钩就好，不用修改。删除文件前的弹窗提示，也是为了安全考虑，万一手贱不小心删了呢？</p><h3 id="15、在新窗口打开文件-文件夹">15、在新窗口打开文件/文件夹</h3><p>通过 <code>window.openFoldersInNewWindow</code>（默认值为off）和<code>window.openFilesInNewWindow</code>（默认值为default），可以配置在打开文件夹、打开文件时，是否开启一个新的窗口。我个人建议，把这两个配置项都设置为 on，避免旧的窗口被覆盖：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201549.png" alt=""></p><p>补充知识—— <code>window.restoreWindows</code>可以用来配置 如何恢复之前的会话窗口。涉及到的场景是：你把 VS Code 关闭了，然后又打开了，是否要展示之前打开过的文件、文件夹？参数值有以下几种：</p><ul><li>one（默认配置）：只会重新打开上一次回话中最后操作的那一个窗口。</li><li>none：打开一个空的窗口，不包含任何文件、文件夹。</li><li>all（建议配置）：恢复上一次会话中的所有窗口。</li><li>folders：恢复上一次会话中包含文件夹的窗口。</li></ul><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201026.png" alt="20211012_1704"></p><blockquote><p>接下来，我们来讲一些更高级的操作。</p></blockquote><h2 id="五、纵享丝滑：常见操作和使用技巧">五、纵享丝滑：常见操作和使用技巧</h2><h3 id="1、快速生成HTML骨架">1、快速生成HTML骨架</h3><p>先新建一个空的html文件，然后通过以下方式，可以快速生成html骨架。</p><p><strong>方式1</strong>：输入<code>!</code>，然后按下<code>enter</code>键，即可生成html骨架。如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201555.gif" alt=""></p><p><strong>方式2</strong>：输入<code>html:5</code>，然后按住 <code>Tab</code>键，即可生成html骨架。</p><p>生成的骨架，内容如下：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>有了上面的html骨架之后，我们就可以快乐地在里面插入CSS 代码和 JS 代码。</p><h3 id="2、并排编辑：左右（上下）显示多个编辑器窗口（copy代码利器）">2、并排编辑：左右（上下）显示多个编辑器窗口（copy代码利器）</h3><blockquote><p>并排编辑是所有的编辑操作中最常用的一个技巧，十分有用。比如我们在开发一个项目时，可能需要同时打开 HTML 文件和 CSS 文件，很常见。</p></blockquote><p>Mac 用户按住快捷键 <code>Cmd + \</code>， Windows 用户按住快捷键<code>Ctrl + \</code>，即可同时打开多个编辑器窗口，进行并排编辑。效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201020.gif" alt=""></p><p>按快捷键「Cmd + 1 」切换到左边的窗口，按快捷键「Cmd + 2 」切换到右边的窗口，以此类推。随时随地，想切就切。</p><p>学会了这一招，以后 copy 代码的时候，leader 再也不用担心我抄得慢了，一天工资到手。</p><hr><p>当然，使用快捷键<code>Cmd + \</code>只是其中一种方式，我们还有很多种方式打开并行编辑。我们来做一个汇总。</p><p>如果你已经打开了一个编辑器，那么可以通过以下几种方式在另一侧打开另一个编辑器：（按照使用频率，从高到低排序）</p><ul><li>使用快捷键<code>Cmd + \</code>将编辑器一分为二。</li><li>使用快捷键<code>Cmd + P</code>调出文件列表，选择要打开的文件，然后按下 <code>Cmd + Enter</code>快捷键。【重要】</li><li>按住 Option 键的同时，单击资源管理器的文件（Windows 用户是按 Alt 键）。</li><li>点击编辑器右上角的 <code>Split Editor</code>按钮。</li><li>选择菜单栏「查看--&gt; 编辑器布局」，然后选择你具体想要的布局，如下图所示：</li></ul><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201602.png" alt="20211012_1451"></p><ul><li>通过拖拽，把当前文件移动到任意一侧。</li></ul><p>补充知识：通过配置项<code>worbench.editor.OpenSideBySideDirection</code>可以控制编辑器在并排打开时出现的默认位置（默认值为right，你也可以根据需要改为 down）。如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201019.png" alt="20211012_1455"></p><h3 id="3、从终端-code-命令启动-VS-Code（Mac电脑）">3、从终端 code 命令启动 VS Code（Mac电脑）</h3><p>在终端输入<code>code</code>或者输入 <code>code + 指定项目的目录</code>，就可以启动 VS  Code，十分便捷。即：</p><ul><li><code>code</code> 命令：启动 VS Code 软件。</li><li><code>code pathName/fileName</code> 命令：通过 VS Code 软件打开指定目录/指定文件。</li></ul><p>为了达到目的，我们需要先将 VS Code的软件安装路径添加到环境变量，一劳永逸。具体操作如下：</p><p>（1）打开 <code>bash_profile</code>文件：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~<span class="token function">vim</span> ./bash_profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>（2）在 bash_profile 中添加如下内容：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 从终端启动VS Code，并设置vscode启动的命令别名</span><span class="token builtin class-name">alias</span> <span class="token assign-left variable">code</span><span class="token operator">=</span><span class="token string">"/Applications/Visual\ Studio\ Code.app/Contents/Resources/app/bin/code"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>注意，由于<code>Visual Studio Code.app</code>这个路径里有空格，所以需要在空格前面加上反斜杠<code>\</code>。</p><p>（3）重启环境变量的配置：</p><pre class="line-numbers language-none"><code class="language-none"># 重启source ~/.bash_profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>大功告成。</p><p>改完之后，如果没生效，那你把  <code>bash_profile</code>文件 换成 <code>zshrc</code>文件试试。</p><p>参考链接：</p><ul><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/logan_LG/article/details/106800904">mac通过终端code 命令打开vscode</a></li></ul><h3 id="3、从终端-code-命令启动-VS-Code（Windows电脑）">3、从终端 code 命令启动 VS Code（Windows电脑）</h3><p>在终端输入<code>code</code>或者输入 <code>code + 指定项目的目录</code>，就可以启动 VS  Code，十分便捷。即：</p><ul><li><code>code</code> 命令：启动 VS Code 软件。</li><li><code>code pathName/fileName</code> 命令：通过 VS Code 软件打开指定目录/指定文件。</li></ul><p>为了达到目的，我们需要先将 VS Code的软件安装路径添加到环境变量，一劳永逸。具体操作如下：</p><p>（1）打开 VS Code 的安装位置，进入bin文件夹，复制路径。比如：<code>D:\Microsoft VS Code\bin</code>。</p><p>（2）回到桌面，右键我的电脑--&gt;高级系统设置--&gt;环境变量--&gt;编辑path值，在原来的path后面，追加内容<code>;D:\Microsoft VS Code\bin</code>（即英文的分号+VS  Code 的 bin 路径)</p><p>（3）重启电脑，大功告成。</p><p>改完之后，如果没生效，那八成是因为你填的 path 值有问题。</p><p>参考链接：</p><ul><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zyl-Tara/p/10642704.html">windows使用 code . 命令打开vscode</a></li></ul><h3 id="4、在当前文件中搜索">4、在当前文件中搜索</h3><p>在上面的快捷键列表中，我们已经知道如下快捷键：</p><ul><li><p>Cmd + F（Win 用户是 Ctrl + F）：在当前文件中搜索，光标在搜索框里</p></li><li><p>Cmd + G（Win 用户是 F3）：在当前文件中搜索，光标仍停留在编辑器里</p></li></ul><p>多个搜索结果出来之后，按下 Enter 键之后跳转到下一个搜索结果，按下 Shift + Enter 键之后跳转到上一个搜索结果。</p><p>另外，你可能会注意到，搜索框里有很多按钮，每个按钮都对应着不同的功能，如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201012.png" alt=""></p><p>上图中，你可以通过「Tab」键和「Shift + Tab」键在输入框和替换框之间进行切换。</p><p>「在选定内容中查找」这个功能还是比较实用的。你也可以在设置项里搜索 <code>editor.find.autoFindInSelection</code>，勾选该设置项后，那么，当你选中指定内容后，然后按住「Cmd + F」，就可以<strong>自动</strong>只在这些内容里进行查找。该设置项如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201608.png" alt=""></p><h3 id="5、全局搜索">5、全局搜索</h3><p>在上面的快捷键列表中，我们已经知道如下快捷键：</p><ul><li>Cmd + Shift + F（Win 用户是 Ctrl + Shift +F）：在全局的文件夹中进行搜索。效果如下：</li></ul><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201013.png" alt="20211012_1548"></p><p>上图中，你可以点击<strong>红框</strong>部分，展开更多的配置项。然后点击<strong>红圈</strong>部分，进行过滤搜索。注意，第二个红圈那里会经常用到，它可以在搜索时过滤掉  <code>.git</code>、<code>.node_modules</code>等忽略文件。</p><p>上图中，我们还可以点击“在编辑器中打开”，在一个单独的文件中聚合展示搜索结果：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201615.png" alt=""></p><h3 id="6、文件名-文件夹的搜索">6、文件名/文件夹的搜索</h3><p>前面的快捷键那一段我们讲过，通过 「Cmd + P」可以快速搜索并打开<strong>文件</strong>/文件夹。这种方式，一般用于快速打开最近编辑过的文件。</p><p>其实还有一种很巧妙的方式，可以在整个项目里，既能搜到文件，也能搜到<strong>文件夹</strong>。这种方式，常用于<strong>过滤项目的目录</strong>。操作方法很简单：</p><blockquote><p>直接在文件资源管理器输入关键字就行。搜索结果会自动出现；使用方向键进行上下移动，可以在搜索的文件和文件夹之间进行跳转。</p><p>另外，右上角会看到一个过滤器，点击下图中的红圈部分，则只显示匹配的文件和文件夹。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201006.png" alt="20211012_1616"></p><p>当然，这招也有一点不足：不能搜中文。</p><h3 id="7、大纲视图">7、大纲视图</h3><p>如下图所示，大纲视图可以展示当前代码的方法结构、文件的目录结构：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201621.png" alt="20211012_1628"></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201929.png" alt="20211012_1636"></p><h3 id="8、文件对比">8、文件对比</h3><p>VS Code 默认支持<strong>对比两个文件的内容</strong>。选中两个文件，然后右键选择「将已选项进行比较」即可，效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200959.png" alt=""></p><p>VS Code 自带的对比功能并不够强大，我们可以安装插件<code>compareit</code>，进行更丰富的对比。比如说，安装完插件<code>compareit</code>之后，我们可以将「当前文件」与「剪切板」里的内容进行对比：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201628.png" alt=""></p><p>如果你安装了 GitLens 插件，还可以将两个git分支的代码进行比对，非常完美。</p><h3 id="9、查找某个函数在哪些地方被调用了">9、查找某个函数在哪些地方被调用了</h3><p>比如我已经在<code>a.js</code>文件里调用了 <code>foo()</code>函数。那么，如果我想知道<code>foo()</code>函数在其他文件中是否也被调用了，该怎么做呢？</p><p>做法如下：在 <code>a.js</code> 文件里，选中<code>foo()</code>函数（或者将光标放置在<code>foo()</code>函数上），然后按住快捷键「Shift + F12」，就能看到 <code>foo()</code>函数在哪些地方被调用了，比较实用。</p><h3 id="10、鼠标操作">10、鼠标操作</h3><ul><li><p>在当前行的位置，鼠标三击，可以选中当前行。</p></li><li><p>用鼠标单击文件的<strong>行号</strong>，可以选中当前行。</p></li><li><p>在某个<strong>行号</strong>的位置，<strong>上下移动鼠标，可以选中多行</strong>。</p></li></ul><h3 id="11、重构">11、重构</h3><p>重构分很多种，我们来举几个例子。</p><p><strong>命名重构</strong>：</p><p>当我们尝试去修改某个函数（或者变量名）时，我们可以把光标放在上面，然后按下「F2」键，那么，这个函数（或者变量名）出现的地方都会被修改。</p><p><strong>方法重构</strong>：</p><p>选中某一段代码，这个时候，代码的左侧会出现一个「灯泡图标」，点击这个图标，就可以把这段代码提取为一个单独的函数。</p><h3 id="12：终端配置">12：终端配置</h3><p>VS Code软件自带了终端，但我个人认为不是很好用，而且VS Code 软件关了之后，终端也没了。建议大家使用其他的终端软件，专业的事情交给专业的人做。</p><ul><li>Windows平台的终端：推荐 PowerShell 软件。远程终端推荐 xshell 软件。</li><li>Mac平台的终端：推荐 <a target="_blank" rel="noopener" href="https://iterm2.com/">iTerm2 </a>。 iTerm2 是Mac平台最好用的终端软件，没有之一。</li></ul><p><strong>右键行为</strong>：</p><blockquote><p>在终端上，单击右键所产生的行为在不同的系统里是不同的。</p></blockquote><ul><li>Windows：如果有<strong>选定</strong>文本，则复制当前文本；如果没有选定文本，则粘贴。</li><li>macOS：选中光标所在位置的单词，并显示右键菜单。</li><li>Linux：显示右键菜单。</li></ul><h3 id="13、Git-版本管理">13、Git 版本管理</h3><p>在 VS Code中使用Git之前，需要你先安装 Git 环境。</p><p>VS Code 自带了 Git 版本管理的功能，如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200958.png" alt=""></p><p>上图中，我们可以在这里进行常见的 git 命令操作。如果你还不熟悉 <strong>Git 版本管理</strong>，可以先去补补课。</p><p>我自己用的最多的功能是<strong>diff 代码</strong>和<strong>合并冲突</strong>，自从用上了  VS Code 的这两个功能，简直离不开它。</p><p>我们先来看看 diff 代码的效果：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201634.png" alt="20211013_1411"></p><p>上图中，点击右上角的<code>...</code>，然后点击<code>内联视图</code>，则可以换一种视图 diff 代码：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201937.png" alt=""></p><p><strong>Git状态栏</strong>：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200952.png" alt="20211013_1421"></p><p>在VS Code的左下角会显示Git状态栏。如果当前代码仓库配置了远程仓库，那么“同步更改”会显示以下信息：</p><ul><li>左边的数字：表示远程分支比本地分支多了XX个 Git commit。</li><li>右边的数字：表示本地分支比远程分支多了XX个 Git commit。</li></ul><p>点击“同步更改”按钮，会拉取（pull）远程分支到本地分支，并推送（push）本地的Git commit到远程分支。</p><p>如果当前代码仓库没有配置远程仓库，则会显示“发布更改”的按钮。点击“发布更改”按钮，会把当前分支push到远程仓库。</p><hr><p>另外，我建议安装插件<code>GitLens</code>搭配使用，它是 VS Code 中我最推荐的一个插件，简直是 Git 神器，码农必备。</p><p>我还要补充一句：</p><p>有人说，高手都是直接用命令行操作Git。然而，根据我多年的经验来看，如果你的代码仓库需要管理的分支特别多，与团队的其他成员需要经常协作，那么，我建议你<strong>优先使用</strong> GUI 图形化工具来操作Git，避免出错。</p><p>我推荐的GUI版的Git工具有：</p><ul><li><a target="_blank" rel="noopener" href="https://www.git-tower.com/">Tower</a></li><li><a target="_blank" rel="noopener" href="https://www.sourcetreeapp.com/">Sourcetree</a></li><li><a target="_blank" rel="noopener" href="https://www.gitkraken.com/">GitKraken</a></li></ul><h3 id="14、将工作区放大-缩小">14、将工作区放大/缩小</h3><p>我们在上面的设置项里修改字体大小后，仅仅只是修改了代码的字体大小。</p><p>如果你想要缩放整个工作区（包括代码的字体、左侧导航栏的字体等），可以按下快捷键「<strong>cmd +/-</strong>」。windows 用户是按下「ctrl +/-」</p><p><strong>当我们在投影仪上给别人演示代码的时候，这一招十分管用</strong>。</p><p>如果你想恢复默认的工作区大小，可以在命令面板输入<code>重置缩放</code>（英文是<code>reset zoom</code>）</p><p>f### 11、创建多层子文件夹</p><p>我们可以在新建文件夹的时候，如果直接输入<code>aa/bb/cc</code>，比如：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201641.png" alt=""></p><p>那么，就可以创建多层子文件夹，效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200945.png" alt=""></p><h3 id="15、-vscode-文件夹的作用">15、<code>.vscode</code> 文件夹的作用</h3><p>为了统一团队的 vscode 配置，我们可以在项目的根目录下建立<code>.vscode</code>目录，在里面放置一些配置内容，比如：</p><ul><li><p><code>settings.json</code>：工作空间设置、代码格式化配置、插件配置。</p></li><li><p><code>sftp.json</code>：ftp 文件传输的配置。</p></li></ul><p><code>.vscode</code>目录里的配置只针对当前项目范围内生效。将<code>.vscode</code>提交到代码仓库，大家统一配置时，会非常方便。</p><h3 id="16、自带终端">16、自带终端</h3><p>我们可以按下「Ctrl + `」打开 VS Code 自带的终端。我认为内置终端并没有那么好用，我更建议你使用第三方的终端 <strong>item2</strong>。</p><h3 id="17、markdown-语法支持">17、markdown 语法支持</h3><p>VS Code 自带 markdown 语法高亮。也就是说，如果你是用 markdown 格式写文章，则完全可以用 VS Code 进行写作。</p><p>写完 md 文件之后，你可以点击右上角的按钮进行预览，如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201648.png" alt=""></p><p>我一般是安装「Markdown Preview Github Styling」插件，以 GitHub 风格预览 Markdown 样式。样式十分简洁美观。</p><p>你也可以在控制面板输入<code>Markdown: 打开预览</code>，直接全屏预览 markdown 文件。</p><h3 id="18、Emmet-in-VS-Code">18、Emmet in VS Code</h3><p><code>Emmet</code>可以极大的提高 html 和 css 的编写效率，它提供了一种非常简练的语法规则。</p><p>举个例子，我们在编辑器中输入缩写代码：<code>ul&gt;li*6</code> ，然后按下 Tab 键，即可得到如下代码片段：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>VS Code 默认支持 Emmet。更多 Emmet 语法规则，可以自行查阅。</p><h3 id="19、修改字体，使用「Fira-Code」字体">19、修改字体，使用「Fira Code」字体</h3><p>这款字体很漂亮，很适合用来写代码：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201655.png" alt=""></p><p>安装步骤如下：</p><p>（1）进入 <a target="_blank" rel="noopener" href="https://github.com/tonsky/FiraCode">https://github.com/tonsky/FiraCode</a> 网站，下载并安装「Fira Code」字体。</p><p>（2）打开 VS Code 的「设置」，搜索<code>font</code>，修改相关配置为如下内容：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"editor.fontFamily"</span><span class="token operator">:</span> <span class="token string">"'Fira Code',Menlo, Monaco, 'Courier New', monospace"</span><span class="token punctuation">,</span> <span class="token comment">// 设置字体显示</span><span class="token property">"editor.fontLigatures"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">//控制是否启用字体连字，true启用，false不启用</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>上方的第二行配置，取决于个人习惯，我是直接设置为<code>"editor.fontLigatures": null</code>，因为我不太习惯连字。</p><h3 id="20、代码格式化">20、代码格式化</h3><p>VS Code 默认对 JavaScript、TypeScript、JSON、HTML 提供了开箱即用的代码格式化支持。其他语言则需要先安装相应的插件才能支持。</p><p>另外，我们还可以安装 Prettier 插件进行<strong>更精细</strong>的代码格式化。下一段将插件的时候，会讲解。</p><h3 id="21、智能提示-IntelliSense">21、智能提示 IntelliSense</h3><p>VS Code 默认对 JavaScript、TypeScript、JSON、HTML、CSS、SCSS、Less这7种语言（文件）提供了<strong>智能提示</strong>的支持。其他编程语言则需要先安装相应的插件才能支持。</p><p>在 VS Code插件职场中，下图是最受欢迎的8种<a href="https://marketplace.visualstudio.com/search?target=VSCode&amp;category=Programming%20Languages&amp;sortBy=Installs">编程语言插件</a>：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201656.png" alt="20211013_1120"></p><p>智能提示的功能很强大， 包括函数介绍、代码自动补全等等。</p><h3 id="22、调试与运行">22、调试与运行</h3><p>VS Code <strong>内置</strong>了对 Node.js 运行时的调试支持，可以直接调试  JavaScript 和 TypeScript。其他编程语言的调试，则需要先安装相应的插件才能支持。</p><p>在 VS Code插件市场中，下图是最受欢迎的几种调试插件：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200938.png" alt=""></p><h3 id="23、文件传输：sftp">23、文件传输：sftp</h3><p>如果你需要将本地文件通过 ftp 的形式上传到局域网的服务器（需要先把服务端的配置搭建好），可以安装<code>sftp</code>这个插件，很好用。在公司会经常用到。</p><p>步骤如下：</p><p>（1）安装插件<code>sftp</code>。</p><p>（2）配置 <code>sftp.json</code>文件。 插件安装完成后，输入快捷键「cmd+shift+P」弹出命令面板，然后输入<code>sftp:config</code>，回车，当前工程的<code>.vscode</code>文件夹下就会自动生成一个<code>sftp.json</code>文件，我们需要在这个文件里配置的内容可以是：</p><ul><li><p><code>host</code>：服务器的 IP 地址</p></li><li><p><code>username</code>：用户名</p></li><li><p><code>privateKeyPath</code>：存放在本地的已配置好的用于登录工作站的密钥文件（也可以是 ppk 文件）</p></li><li><p><code>remotePath</code>：工作站上与本地工程同步的文件夹路径，需要和本地工程文件根目录同名，且在使用 sftp 上传文件之前，要手动在工作站上 mkdir 生成这个根目录</p></li><li><p><code>ignore</code>：指定在使用 sftp: sync to remote 的时候忽略的文件及文件夹，注意每一行后面有逗号，最后一行没有逗号</p></li></ul><p>举例如下：(注意，其中的注释需要去掉)</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"host"</span><span class="token operator">:</span> <span class="token string">"192.168.xxx.xxx"</span><span class="token punctuation">,</span> <span class="token comment">//服务器ip</span>  <span class="token property">"port"</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token comment">//端口，sftp模式是22</span>  <span class="token property">"username"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token comment">//用户名</span>  <span class="token property">"password"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token comment">//密码</span>  <span class="token property">"protocol"</span><span class="token operator">:</span> <span class="token string">"sftp"</span><span class="token punctuation">,</span> <span class="token comment">//模式</span>  <span class="token property">"agent"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>  <span class="token property">"privateKeyPath"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>  <span class="token property">"passphrase"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>  <span class="token property">"passive"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token property">"interactiveAuth"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token property">"remotePath"</span><span class="token operator">:</span> <span class="token string">"/root/node/build/"</span><span class="token punctuation">,</span> <span class="token comment">//服务器上的文件地址</span>  <span class="token property">"context"</span><span class="token operator">:</span> <span class="token string">"./server/build"</span><span class="token punctuation">,</span> <span class="token comment">//本地的文件地址</span>  <span class="token property">"uploadOnSave"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//监听保存并上传</span>  <span class="token property">"syncMode"</span><span class="token operator">:</span> <span class="token string">"update"</span><span class="token punctuation">,</span>  <span class="token property">"watcher"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token comment">//监听外部文件</span>    <span class="token property">"files"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//外部文件的绝对路径</span>    <span class="token property">"autoUpload"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token property">"autoDelete"</span><span class="token operator">:</span> <span class="token boolean">false</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"ignore"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token comment">//忽略项</span>    <span class="token string">"**/.vscode/**"</span><span class="token punctuation">,</span>    <span class="token string">"**/.git/**"</span><span class="token punctuation">,</span>    <span class="token string">"**/.DS_Store"</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>（3）在 VS Code 的当前文件里，选择「右键 -&gt; upload」，就可以将本地的代码上传到 指定的 ftp 服务器上（也就是在上方 <code>host</code> 中配置的服务器 ip）。</p><p>我们还可以选择「右键 -&gt; Diff with Remote」，就可以将本地的代码和 ftp 服务器上的代码做对比，非常方便。</p><h3 id="24、沉浸模式-禅模式">24、沉浸模式/禅模式</h3><p>程序员写代码需要专注，有时需要进入一种心流。VS Code给我们提供了一种全屏下的沉浸模式，周围的面板都会被隐藏起来，只显示编辑器部分。</p><p>操作方法：菜单栏选择「查看-外观-禅模式」即可；或者按下快捷键<code>Cmd + K</code>，放手，再按<code>Z</code>也可以达到目的。</p><h3 id="正则表达式批量删除字符串">正则表达式批量删除字符串</h3><p><strong>需求</strong>：将文本中的字符串<code>axxxxb</code>，批量替换为<code>ab</code>。其中，开头字符 a 和 结尾字符 b 固定，中间xxx长度不确定。</p><p><strong>解决</strong>：传统查找替换无法胜任。可以使用VScode正则表达式功能，查找<code>a.*?b</code>替换为<code>ab</code>即可。其中<code>?</code>是禁止贪婪匹配，否则会误删很多内容。</p><hr><p><strong>拓展需求</strong>：需求——将文本中的字符串<code>axxxx</code>，批量替换为<code>a</code>。其中，开头字符 a 固定，后面的xxx长度不确定。</p><p><strong>解决</strong>：传统查找替换无法胜任。可以使用VScode正则表达式功能，查找<code>a.*?\n</code>替换为<code>a\n</code>即可。</p><h2 id="六、三头六臂：VS-Code-插件介绍-插件推荐">六、三头六臂：VS Code 插件介绍 &amp; 插件推荐</h2><p>VS Code 有一个很强大的功能就是支持插件扩展，让你的编辑器仿佛拥有了三头六臂。</p><h3 id="安装插件-4">安装插件</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201702.png" alt=""></p><p>上图中，点击红框部分，即可在顶部输入框里，查找你想要的插件名，然后进行安装。</p><p>插件安装完成后，记得重启软件（或者点击插件位置的“重新加载”），插件才会生效。</p><p>另外，我们还可以访问官网的插件市场来安装插件：</p><ul><li>VS Code插件市场（官方）：<a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/vscode">https://marketplace.visualstudio.com/vscode</a></li></ul><p><strong>插件的安装目录</strong>：</p><ul><li>Windows：：<code>%USERPROFILE%\.vscode\extensions</code></li><li>macOS：<code>~/.vscode/extensions</code></li><li>macOS：<code>~/.vscode/extensions</code></li></ul><h3 id="插件的类型">插件的类型</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201709.png" alt="20211013_1757_2"></p><p>插件市场的首页有四个模块，可以作为重要的信息来源：</p><ul><li>Featured：由  VS Code团队精心推荐的插件。</li><li>Trending：近期热门插件。</li><li>Most Popular：按总安装量排序的插件。</li><li>Recently Added：最新发布的插件。</li></ul><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200932.png" alt="20211013_1758"></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200925.png" alt="20211013_1955"></p><p>插件市场至少有17种类型的插件：（按照数量排序）</p><ul><li>Themes：主题插件</li><li>Programming Languages：编程语言插件</li><li>Snippets：代码片段</li><li>Extension Packs：插件包，里面包括多个插件</li><li>Formatters：代码格式化</li><li>Linters：静态检查</li><li>Debuggers：调试器</li><li>Keymaps：快捷键映射</li><li>Visualization：可视化</li><li>Language Packs：各国的语言插件</li><li>Azure：Azure 云计算</li><li>Data Science：数据科学</li><li>SCM Providers：源代码控制管理器（source control manager）</li><li>Notebooks</li><li>Education：教育</li><li>Testing：测试相关</li><li>Machine Learning：机器学习</li><li>Others：其他</li></ul><h3 id="插件的过滤显示">插件的过滤显示</h3><p>在 VS  Code中打开插件管理视图，可以针对已安装的插件，进行过滤展示。</p><p>1）点击插件视图右上角的<code>...</code>按钮，可以展示不同状态的插件：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201958.png" alt="20211013_2011"></p><p>2）在搜索框输入字符<code>@</code>，会展示出不同类型的过滤器：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201716.png" alt="20211013_2015"></p><p><strong>常见的过滤器如下</strong>：</p><p>1）按大类搜：</p><ul><li><code>@builtin</code>：显示 VS Code内置的插件</li><li><code>@disabled</code>：显示被禁用的插件</li><li><code>@enabled</code>：显示已启用的插件</li><li><code>@installed</code>：显示已安装的插件</li><li><code>@outdated</code>：显示待更新的插件</li></ul><p>2）精准搜索：</p><ul><li><code>@id</code>：按id显示插件</li><li><code>@tag</code>：根据标签显示插件。</li></ul><p>3）对插件进行排序：</p><ul><li><code>@sort:installs</code>：根据插件的安装量排序</li><li><code>@sourt:rating</code>：根据插件的评分排序</li><li><code>@sort:name</code>：根据插件名字的字母顺序排序</li></ul><p>4）组合搜索：（举例）</p><ul><li><code>@installed @category:themes</code>：显示已安装的主题插件。</li><li><code>@sort:installs java</code>：对 Java 相关的插件按照安装量排序。</li></ul><p>下面的内容，我来列举一些常见的插件，这些插件都很实用，小伙伴们可以按需安装。注意：每一类插件里，<strong>顺序越靠前，越实用</strong>。</p><h3 id="1、基本插件">1、基本插件</h3><h4 id="Chinese-Simplified-Language-Pack-for-Visual-Studio-Code">Chinese (Simplified) Language Pack for Visual Studio Code</h4><p>让软件显示为简体中文语言。</p><h3 id="2、Git-相关插件">2、Git 相关插件</h3><h4 id="GitLens-【荐】">GitLens 【荐】</h4><p>我强烈建议你安装插件<code>GitLens</code>，它是 VS Code 中我最推荐的一个插件，简直是 Git 神器，码农必备。如果你不知道，那真是 out 了。</p><p>GitLens 在 Git 管理上有很多强大的功能，比如：</p><ul><li>将光标放置在代码的当前行，可以看到这样代码的提交者是谁，以及提交时间。这一点，是 GitLens 最便捷的功能。</li><li>查看某个 commit 的代码改动记录</li><li>查看不同的分支</li><li>可以将两个 commit 进行代码对比</li><li>甚至可以将两个 branch 分支进行整体的代码对比。这一点，简直是 GitLens 最强大的功能。当我们在不同分支 review 代码的时候，就可以用到这一招。</li></ul><p>打开你的 Git仓库，未安装  GitLens 时是这样的：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200918.png" alt=""></p><p>安装了  GitLens 之后是这样的：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201723.png" alt=""></p><p>上图中，红框部分就是  GitLens 的功能，诸君可以自由发挥。</p><p>补充一个有意思的趣事：Python插件、Ruby插件、GitLens插件、Vetur插件，这四个插件的开发者先后加入了微软。</p><h4 id="Git-History">Git History</h4><p>有些同学习惯使用编辑器中的 Git 管理工具，而不太喜欢要打开另外一个 Git UI 工具的同学，这一款插件满足你查询所有 Git 记录的需求。</p><h4 id="Local-History-【荐】">Local History 【荐】</h4><p>维护文件的本地历史记录。代码意外丢失时，有时可以救命。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201729.png" alt=""></p><h3 id="3、代码智能提示插件">3、代码智能提示插件</h3><h4 id="Vetur">Vetur</h4><p>Vue 多功能集成插件，包括：语法高亮，智能提示，emmet，错误提示，格式化，自动补全，debugger。VS Code 官方钦定 Vue 插件，Vue 开发者必备。</p><h4 id="ES7-React-Redux-GraphQL-React-Native-snippets">ES7 React/Redux/GraphQL/React-Native snippets</h4><p>React/Redux/react-router 的语法智能提示。</p><h4 id="JavaScript-ES6-code-snippets">JavaScript(ES6) code snippets</h4><p>ES6 语法智能提示，支持快速输入。</p><h4 id="javascript-console-utils：快速打印-log-日志【荐】">javascript console utils：快速打印 log 日志【荐】</h4><p>安装这个插件后，当我们按住快捷键「Cmd + Shift + L」后，即可自动出现日志 <code>console.log()</code>。简直是日志党福音。</p><p>当我们选中某个变量 <code>name</code>，然后按住快捷键「Cmd + Shift + L」，即可自动出现这个变量的日志 <code>console.log(name)</code>。</p><p>其他的同类插件还有：Turbo Console Log。</p><p>不过，生产环境的代码，还是尽量少打日志比较好，避免出现一些异常。</p><p>编程有三等境界：</p><ul><li><p>第三等境界是打日志，这是最简单、便捷的方式，略显低级，一般新手或资深程序员偷懒时会用。</p></li><li><p>第二等境界是断点调试，在前端、Java、PHP、iOS 开发时非常常用，通过断点调试可以很直观地跟踪代码执行逻辑、调用栈、变量等，是非常实用的技巧。</p></li><li><p>第一等境界是测试驱动开发，在写代码之前先写测试。与第二等的断点调试刚好相反，大部分人不是很习惯这种方式，但在国外开发者或者敏捷爱好者看来，这是最高效的开发方式，在保证代码质量、重构等方面非常有帮助，是现代编程开发必不可少的一部分。</p></li></ul><h4 id="Code-Spell-Checker：单词拼写错误检查">Code Spell Checker：单词拼写错误检查</h4><p>这个拼写检查程序的目标是帮助捕获常见的单词拼写错误，可以检测驼峰命名。从此告别 Chinglish.</p><h4 id="Auto-Close-Tag、Auto-Rename-Tag">Auto Close Tag、Auto Rename Tag</h4><p>自动闭合配对的标签、自动重命名配对的标签。</p><h3 id="4、代码显示增强插件">4、代码显示增强插件</h3><h4 id="Bracket-Pair-Colorizer-2：突出显示成对的括号【荐】">Bracket Pair Colorizer 2：突出显示成对的括号【荐】</h4><p><code>Bracket Pair Colorizer 2</code>插件：以不同颜色显示成对的括号，并用连线标注括号范围。简称<strong>彩虹括号</strong>。</p><p>另外，还有个<code>Rainbow Brackets</code>插件，也可以突出显示成对的括号。</p><h4 id="highlight-icemode：选中相同的代码时，让高亮显示更加明显【荐】">highlight-icemode：选中相同的代码时，让高亮显示更加明显【荐】</h4><p>VSCode 自带的高亮显示，实在是不够显眼。用插件支持一下吧。</p><p>所用了这个插件之后，VS Code 自带的高亮就可以关掉了：</p><p>在用户设置里添加<code>"editor.selectionHighlight": false</code>即可。</p><p>参考链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/palmer_kai/article/details/79548164">vscode 选中后相同内容高亮插件推荐</a></p><h4 id="vscode-icons">vscode-icons</h4><p>vscode-icons 会根据文件的后缀名来显示不同的图标，让你更直观地知道每种文件是什么类型的。</p><h4 id="indent-rainbow：突出显示代码缩进">indent-rainbow：突出显示代码缩进</h4><p><code>indent-rainbow</code>插件：突出显示代码缩进。</p><p>安装完成后，效果如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200911.png" alt=""></p><h4 id="TODO-Highlight">TODO Highlight</h4><p>写代码过程中，突然发现一个 Bug，但是又不想停下来手中的活，以免打断思路，怎么办？按照代码规范，我们一般是在代码中加个 TODO 注释。比如：（注意，一定要写成大写<code>TODO</code>，而不是小写的<code>todo</code>）</p><pre class="line-numbers language-none"><code class="language-none">//TODO:这里有个bug，我一会儿再收拾你<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>或者：</p><pre class="line-numbers language-none"><code class="language-none">//FIXME:我也不知道为啥， but it works only that way.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>安装了插件 <code>TODO Highlight</code>之后，按住「Cmd + Shift + P」打开命令面板，输入「Todohighlist」，选择相关的命令，我们就可以看到一个 todoList 的清单。</p><h4 id="Better-Comments">Better Comments</h4><p>为注释添加更醒目、带分类的色彩。</p><h3 id="5、代码格式化插件">5、代码格式化插件</h3><h4 id="Prettier：代码格式化">Prettier：代码格式化</h4><p>Prettier 是一个代码格式化工具，<strong>只关注格式化，但不具备校验功能</strong>。在一个多人协同开发的团队中，统一的代码编写规范非常重要。一套规范可以让我们编写的代码达到一致的风格，提高代码的可读性和统一性。自然维护性也会有所提高，代码的展示也会更加美观。</p><p>步骤如下：</p><p>（1）安装插件 <code>Prettier</code>。</p><p>（2）在项目的根路径下，新建文件<code>.prettierrc</code>，并在文件中添加如下内容：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"printWidth"</span><span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span>  <span class="token property">"tabWidth"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token property">"semi"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token property">"singleQuote"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token property">"trailingComma"</span><span class="token operator">:</span> <span class="token string">"es5"</span><span class="token punctuation">,</span>  <span class="token property">"tslintIntegration"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token property">"insertSpaceBeforeFunctionParenthesis"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的内容，是我自己的配置，你可以参考。更多配置，可见官方文档：<a target="_blank" rel="noopener" href="https://prettier.io/docs/en/options.html">https://prettier.io/docs/en/options.html</a></p><p>（3）Mac用户按快捷键「Option + Shift + F」，Win 用户按快捷键「Alt + shift + F」，即可完成代码的格式化。如果你的VS Code 设置的是自动格式化代码，那么这一步可以忽略。</p><h4 id="ESLint：代码格式的校验">ESLint：代码格式的校验</h4><p>日常开发中，建议用 Prettier 做<strong>代码格式化</strong>，然后用 eslint 做<strong>格式校验</strong>。很多人把这两个插件的功能弄混了。</p><p>一般做法是：格式化建议是由程序员手动触发，格式校验由系统强制校验。通过 Prettier <strong>手动</strong>触发格式化，是为了让用户有感知；通过eslint 做<strong>强制</strong>校验之后，如果代码的格式不符合要求，系统就禁止你提交代码。</p><h4 id="Beautify">Beautify</h4><p>代码格式化工具。</p><p>备注：相比之下，Prettier 是当前最流行的代码格式化工具，比 Beautify 用得更多。</p><h4 id="Paste-JSON-as-Code">Paste JSON as Code</h4><p>此插件可以将剪贴板中的 JSON 字符串转换成工作代码。支持多种语言。</p><h4 id="JS-CSS-HTML-Formatter【荐】">JS-CSS-HTML Formatter【荐】</h4><p>保存文件时，自动格式化 HTML、CSS、JS代码。</p><h3 id="6、图片相关插件">6、图片相关插件</h3><h4 id="Polacode-2020：生成代码截图-【荐】">Polacode-2020：生成代码截图 【荐】</h4><p>可以把代码片段保存成美观的图片，主题不同，代码的配色方案也不同，也也可以自定义设置图片的边框颜色、大小、阴影。</p><p>尤其是在我们做 PPT 分享时需要用到代码片段时，或者需要在网络上优雅地分享代码片段时，这一招很有用。</p><p>生成的效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200904.png" alt=""></p><p>其他同类插件：<code>CodeSnap</code>。我们也可以通过 <a target="_blank" rel="noopener" href="https://carbon.now.sh/">https://carbon.now.sh/</a>这个网站生成代码图片</p><p>有人可能会说：直接用 QQ 截图不行吗？可以是可以，但不够美观、不够干净。</p><h4 id="Image-Preview-【荐】">Image Preview 【荐】</h4><p>图片预览。鼠标移动到图片 url 上的时候，会自动显示图片的预览和图片尺寸。</p><h3 id="7、CSS相关插件">7、CSS相关插件</h3><h4 id="CSS-Peek">CSS Peek</h4><p>增强 HTML 和 CSS 之间的关联，快速查看该元素上的 CSS 样式。</p><h4 id="Vue-CSS-Peek">Vue CSS Peek</h4><p>CSS Peek 对 Vue 没有支持，该插件提供了对 Vue 文件的支持。</p><h4 id="Color-Info">Color Info</h4><p>这个便捷的插件，将为你提供你在 CSS 中使用颜色的相关信息。你只需在颜色上悬停光标，就可以预览色块中色彩模型的（HEX、 RGB、HSL 和 CMYK）相关信息了。</p><h3 id="8、Mardown-相关插件">8、Mardown 相关插件</h3><h4 id="Markdown-Preview-Github-Styling-【荐】">Markdown Preview Github Styling 【荐】</h4><p>以 GitHub 风格预览 Markdown 样式，十分简洁优雅。就像下面这样，左侧书写 Markdown 文本，右侧预览 Markdown 的渲染效果：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201736.png" alt=""></p><h4 id="Markdown-Preview-Enhanced">Markdown Preview Enhanced</h4><p>预览 Markdown 样式。</p><h4 id="Markdown-All-in-One">Markdown All in One</h4><p>这个插件将帮助你更高效地在 Markdown 中编写文档。</p><h3 id="9、通用工具类插件">9、通用工具类插件</h3><h4 id="sftp：文件传输-【荐】">sftp：文件传输 【荐】</h4><p>如果你需要将本地文件通过 ftp 的形式上传到局域网的服务器，可以安装<code>sftp</code>这个插件，很好用。在公司会经常用到。</p><p>详细配置已经在上面讲过。</p><h4 id="Live-Server-【荐】">Live Server 【荐】</h4><p>在本地启动一个服务器，代码写完后可以实现「热更新」，实时地在网页中看到运行效果。就不需要每次都得手动刷新页面了。</p><p>使用方式：安装插件后，开始写代码；代码写完后，右键选择「Open with Live Server」。</p><h4 id="open-in-browser">open in browser</h4><p>安装<code>open in browser</code>插件后，在 HTML 文件中「右键选择 --&gt; Open in Default Browser」，即可在浏览器中预览网页。</p><h4 id="Project-Manager">Project Manager</h4><p>工作中，我们经常会来回切换多个项目，每次都要找到对应项目的目录再打开，比较麻烦。Project Manager 插件可以解决这样的烦恼，它提供了专门的视图来展示你的项目，我们可以把常用的项目保存在这里，需要时一键切换，十分方便。</p><h4 id="WakaTime-【荐】">WakaTime 【荐】</h4><p>统计在 VS Code 里写代码的时间。统计效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200858.png" alt=""></p><h4 id="Code-Time">Code Time</h4><p><code>Code Time</code>插件：记录编程时间，统计代码行数。</p><p>安装该插件后，VS Code 底部的状态栏右下角可以看到时间统计。点击那个位置之后，选择「Code Time Dashboard」，即可查看统计结果。</p><p>备注：团长试了一下这个 code time 插件，发现统计结果不是很准。</p><h4 id="File-Tree-to-Text-Generator：快速生成文件的目录树">File Tree to Text Generator：快速生成文件的目录树</h4><p>如题。</p><h4 id="Settings-Sync">Settings Sync</h4><ul><li><p>地址：<a target="_blank" rel="noopener" href="https://github.com/shanalikhan/code-settings-sync">https://github.com/shanalikhan/code-settings-sync</a></p></li><li><p>作用：多台设备之间，同步 VS Code 配置。通过登录 GitHub 账号来使用这个同步工具。</p></li></ul><p>同步的详细操作，下一段会讲。</p><p>另外，北京时间的<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/184868336">2020年8月14日</a>，微软发布 Visual Studio Code 1.48 稳定版。此版本<strong>原生</strong>支持用户同步 VS Code的配置，只需要登录微软账号或者 GitHub账号即可。</p><h4 id="vscode-syncing">vscode-syncing</h4><ul><li><p>地址：<a target="_blank" rel="noopener" href="https://github.com/nonoroazoro/vscode-syncing">https://github.com/nonoroazoro/vscode-syncing</a></p></li><li><p>作用：多台设备之间，同步 VS Code 配置。</p></li></ul><h4 id="minapp：小程序支持">minapp：小程序支持</h4><p>小程序开发必备插件。</p><h4 id="Search-node-modules">Search node_modules</h4><p><code>node_modules</code>模块里面的文件夹和模块实在是太多了，根本不好找。好在安装 <code>Search node_modules</code> 这个插件后，输入快捷键「Cmd + Shift + P」，然后输入 <code>node_modules</code>，在弹出的选项中选择 <code>Search node_modules</code>，即可搜索 node_modules 里的模块。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200857.jpeg" alt=""></p><h4 id="RemoteHub">RemoteHub</h4><p>不要惊讶，RemoteHub 和 GitLens 是同一个作者开发出来的。</p><p><code>RemoteHub</code>插件的作用是：可以在本地查看 GitHub 网站上的代码，而不需要将代码下载到本地。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200857.png" alt=""></p><p>这个插件目前使用的人还不多，赶紧安装起来尝尝鲜吧。</p><h4 id="Live-Share：实时编码分享">Live Share：实时编码分享</h4><p><code>Live Share</code>这个神奇的插件是由微软官方出品，它的作用是：<strong>实时编码分享</strong>。也就是说，它可以实现你和你的同伴一起写代码。这绝对就是<strong>结对编程</strong>的神器啊。</p><p>安装方式：</p><p>打开插件管理，搜索“live share”，安装。安装后重启 VS Code，在左侧会多出一个按钮：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201743.png" alt=""></p><p>上图中，点击红框部分，登录后就可以分享你的工作空间了。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200850.png" alt=""></p><h4 id="Import-Cost">Import Cost</h4><p>在项目开发过程中，我们会引入很多 npm 包，有时候可能只用到了某个包里的一个方法，却引入了整个包，导致代码体积增大很多。<code>Import Cost</code>插件可以在代码中友好的提示我们，当前引入的包会增加多少体积，这很有助于帮我们优化代码的体积。</p><h3 id="10、主题插件">10、主题插件</h3><p>给你的 VS Code 换个皮肤吧，免费的那种。</p><ul><li><p>Dracula Theme</p></li><li><p>Material Theme</p></li><li><p>Nebula Theme</p></li><li><p><a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=zhuangtongfa.Material-theme">One Dark Pro</a></p></li><li><p>One Monokai Theme</p></li><li><p>Monokai Pro</p></li><li><p>Ayu</p></li><li><p><a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=akarlsten.vscode-snazzy-akarlsten">Snazzy Plus</a></p></li><li><p><a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=alexanderte.dainty-vscode">Dainty</a></p></li><li><p><code>SynthWave '84</code></p></li><li><p>GitHub Plus Theme：白色主题</p></li><li><p>Horizon Theme：红色主题</p></li></ul><h2 id="七、无缝切换：VS-Code-配置云同步">七、无缝切换：VS Code 配置云同步</h2><p>我们可以将配置云同步，这样的话，当我们换个电脑时，即可将配置一键同步到本地，就不需要重新安装插件了，也不需要重新配置软件。</p><p>下面讲的两个同步方法，都可以，看你自己需要。方法1是 VS Code自带的同步功能，操作简单。方法2 需要安装插件，支持更多的自定义配置。</p><h3 id="方法1：使用-VS-Code-自带的同步功能">方法1：使用 VS Code 自带的同步功能</h3><p>1、<strong>配置同步</strong>：</p><p>（1）在菜单栏选择「 Code --&gt; 首选项 --&gt; 打开设置同步」：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201750.png" alt=""></p><p>（2）选择需要同步的配置：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200843.png" alt=""></p><p>（3）通过Microsoft或者GitHub账号登录。 上图中，点击“登录并打开”，然后弹出如下界面：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201757.png" alt=""></p><p>上图中，使用  微软账号或者 GitHub账号登录：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201803.png" alt=""></p><p>（4）同步完成后，菜单栏会显示“首先项同步已打开”，最左侧也会多出一个同步图标，如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312202032.png" alt=""></p><p>2、<strong>管理同步</strong>：</p><p>（1）点击菜单栏「Code --&gt; 首选项 --&gt; 设置同步已打开」，会弹出如下界面，进行相应的同步管理即可：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200836.png" alt=""></p><p>（2）换另外一个电脑时，登录相同的账号，即可完成同步。</p><p>参考链接：</p><ul><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/baidu_33340703/article/details/106967884">VS Code原生的配置同步功能——Settings Sync</a></li></ul><h3 id="方法2：使用插件-settings-sync">方法2：使用插件 <code>settings-sync</code></h3><p>使用方法2，我们还可以把配置分享其他用户，也可以把其他用户的配置给自己用。</p><p>1、<strong>配置同步</strong>：（将自己本地的配置云同步到 GitHub）</p><p>（1）安装插件 <code>settings-sync</code>。</p><p>（2）安装完插件后，在插件里使用 GitHub 账号登录。</p><p>（3）登录后在 vscode 的界面中，可以选择一个别人的 gist；也可以忽略掉，然后创建一个属于自己的 gist。</p><p>（4）使用快捷键 「Command + Shift + P」，在弹出的命令框中输入 sync，并选择「更新/上传配置」，这样就可以把最新的配置上传到 GitHub。</p><p>2、<strong>管理同步</strong>：（换另外一个电脑时，从云端同步配置到本地）</p><p>（1）当我们换另外一台电脑时，可以先在 VS Code 中安装 <code>settings-sync</code> 插件。</p><p>（2）安装完插件后，在插件里使用 GitHub 账号登录。</p><p>（3）登录之后，插件的界面上，会自动出现之前的同步记录：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200829.png" alt=""></p><p>上图中，我们点击最新的那条记录，就可将云端的最新配置同步到本地：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200825.png" alt=""></p><p>如果你远程的配置没有成功同步到本地，那可能是网络的问题，此时，可以使用快捷键 「Command + Shift + P」，在弹出的命令框中输入 sync，并选择「下载配置」，多试几次。</p><p><strong>使用其他人的配置</strong>：</p><p>如果我们想使用别人的配置，首先需要对方提供给你 gist。具体步骤如下：</p><p>（1）安装插件 <code>settings-sync</code>。</p><p>（2）使用快捷键 「Command + Shift + P」，在弹出的命令框中输入 sync，并选择「下载配置」</p><p>（3）在弹出的界面中，选择「Download Public Gist」，然后输入别人分享给你的 gist。注意，这一步不需要登录 GitHub 账号。</p><h2 id="最后一段">最后一段</h2><p>如果你还有什么推荐的 VS Code 插件，欢迎留言。</p><p>大家完全不用担心这篇文章会过时，随着 VS Code 的版本更新和插件更新，本文也会随之更新。关于 VS Code 内容的后续更新，你可以关注我在 GitHub 上的前端入门项目，项目地址是：</p><blockquote><p><a target="_blank" rel="noopener" href="https://github.com/qianguyihao/Web">https://github.com/qianguyihao/Web</a></p></blockquote><p>一个超级详细和真诚的前端入门项目。</p><h2 id="todo">todo</h2><ul><li><a target="_blank" rel="noopener" href="https://github.com/qianguyihao/Web/issues/84">issues 84</a></li></ul><h2 id="参考链接">参考链接</h2><h3 id="2021年">2021年</h3><ul><li>中文版 Awesome VS Code：<a target="_blank" rel="noopener" href="https://github.com/formulahendry/awesome-vscode-cn">https://github.com/formulahendry/awesome-vscode-cn</a></li></ul><h3 id="2020年">2020年</h3><ul><li><a target="_blank" rel="noopener" href="https://juejin.im/post/5ea40c6751882573b219777d">VSCode 插件大全｜ VSCode 高级玩家之第二篇</a></li><li><a target="_blank" rel="noopener" href="http://www.supuwoerc.xyz/tools/vscode/plugins.html">http://www.supuwoerc.xyz/tools/vscode/plugins.html</a></li><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/99462672">如何让 VS Code 更好用 10 倍？这里有一份 VS Code 新手指南</a></li><li><a target="_blank" rel="noopener" href="https://lyreal666.com/%E9%82%A3%E4%BA%9B%E4%BD%A0%E5%BA%94%E8%AF%A5%E8%80%83%E8%99%91%E5%8D%B8%E8%BD%BD%E7%9A%84-VSCode-%E6%89%A9%E5%B1%95/#more">那些你应该考虑卸载的 VSCode 扩展</a></li><li><a target="_blank" rel="noopener" href="https://juejin.im/post/5d74eb5c51882525017787d9">VS Code 折腾记 - (16) 推荐一波实用的插件集</a></li><li><a target="_blank" rel="noopener" href="https://juejin.im/post/5db66672f265da4d0e009aad">VSCode 前端必备插件，有可能你装了却不知道如何使用？</a></li><li><a target="_blank" rel="noopener" href="https://juejin.im/post/5a08d1d6f265da430f31950e">能让你开发效率翻倍的 VSCode 插件配置（上）</a></li><li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000012811886">https://segmentfault.com/a/1190000012811886</a></li><li><a target="_blank" rel="noopener" href="https://idoubi.cc/2019/07/08/vscode-sublime-theme/">「Vscode」打造类 sublime 的高颜值编辑器</a></li><li><a target="_blank" rel="noopener" href="https://lsqy.tech/2020/03/14/20200314Mac-Vscode%E5%BF%AB%E6%8D%B7%E9%94%AE/">Mac Vscode 快捷键</a></li><li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?src=11&amp;timestamp=1591581536&amp;ver=2387&amp;signature=i4xLZlLe1Gkl7OiBIhPO*VSeNB5lzFgTY-dgNW9E9ZbtIAv4bnJ1RdAAZdhvDw*cg-DmMcUa-V8NSUdV-tthmXZCq3ht4edCweq6v0QxKjnh8IuAxyyh5qymdRui*8iE&amp;new=1">使用 VSCode 的一些技巧</a></li><li>转载来源，[GitHub](<a target="_blank" rel="noopener" href="https://github.com/qianguyihao/Web/blob/master/00-%E5%89%8D%E7%AB%AF%E5%B7%A5%E5%85%B7/01-VS">https://github.com/qianguyihao/Web/blob/master/00-前端工具/01-VS</a> <a target="_blank" rel="noopener" href="http://xn--Code-et6fu80rt8b.md">Code的使用.md</a>) 推荐关注star！</li></ul><hr><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="tools" scheme="https://blog.17lai.site/categories/tools/"/>
    
    
    <category term="vscode" scheme="https://blog.17lai.site/tags/vscode/"/>
    
    <category term="插件" scheme="https://blog.17lai.site/tags/%E6%8F%92%E4%BB%B6/"/>
    
    <category term="编码" scheme="https://blog.17lai.site/tags/%E7%BC%96%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>如何使用Traefik V2 在Ubuntu20.04 上面来做 Dockers Containers 的反向代理</title>
    <link href="https://blog.17lai.site/posts/465d2738/"/>
    <id>https://blog.17lai.site/posts/465d2738/</id>
    <published>2021-10-14T11:25:00.000Z</published>
    <updated>2022-03-16T12:29:06.969Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>How To Use Traefik v2 as a Reverse Proxy for Docker Containers on Ubuntu 20.04</p><blockquote><p>Traefik 适合配合Dockers swarm 做服务， Dockers portainer 做管理，ELK集群做监控日志。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1420211014200800.png" alt="Traefik"></p><p><code>traefik</code> 与 <code>nginx</code> 一样，是一款优秀的反向代理工具，或者叫 <code>Edge Router</code>。至于使用它的原因则基于以下几点</p><ul><li>无须重启即可更新配置</li><li>自动的服务发现与负载均衡</li><li>与 <code>docker</code> 完美集成，基于 <code>container label</code> 的配置</li><li>漂亮的 <code>dashboard</code> 界面</li><li><code>metrics</code> 的支持，支持对 <code>prometheus</code> 和 <code>k8s</code> 集成</li></ul><h3 id="Introduction">Introduction</h3><p><a target="_blank" rel="noopener" href="https://www.docker.com/">Docker</a> can be an efficient way to run web applications in production, but you may want to run multiple applications on the same Docker host. In this situation, you’ll need to set up a reverse proxy. This is because you only want to expose ports <code>80</code> and <code>443</code> to the rest of the world.</p><p><a target="_blank" rel="noopener" href="https://traefik.io/">Traefik</a> is a Docker-aware reverse proxy that includes a monitoring dashboard. Traefik v1 has been widely used for a while, and <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-use-traefik-as-a-reverse-proxy-for-docker-containers-on-ubuntu-20-04">you can follow this earlier tutorial to install Traefik v1</a>). But in this tutorial, you’ll install and configure Traefik v2, which includes quite a few differences.</p><p>The biggest difference between Traefik v1 and v2 is that <em>frontends</em> and <em>backends</em> were removed and their combined functionality spread out across <em>routers</em>, <em>middlewares</em>, and <em>services</em>. Previously a backend did the job of making modifications to requests and getting that request to whatever was supposed to handle it. Traefik v2 provides more separation of concerns by introducing middlewares that can modify requests before sending them to a service. Middlewares make it easier to specify a single modification step that might be used by a lot of different routes so that they can be reused (such as HTTP Basic Auth, which you’ll see later). A router can also use many different middlewares.</p><p>In this tutorial you’ll configure Traefik v2 to route requests to two different web application containers: a <a target="_blank" rel="noopener" href="http://wordpress.org/">Wordpress</a> container and an <a target="_blank" rel="noopener" href="https://www.adminer.org/">Adminer</a> container, each talking to a <a target="_blank" rel="noopener" href="https://www.mysql.com/">MySQL</a> database. You’ll configure Traefik to serve everything over HTTPS using <a target="_blank" rel="noopener" href="https://letsencrypt.org/">Let’s Encrypt</a>.</p><h2 id="Prerequisites">Prerequisites</h2><p>To complete this tutorial, you will need the following:</p><ul><li><a target="_blank" rel="noopener" href="https://www.digitalocean.com/products/linux-distribution/ubuntu/">One Ubuntu 20.04 server</a> with a sudo non-root user and a firewall. You can set this up by following our <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-20-04">Ubuntu 20.04 initial server setup guide</a>.</li><li>Docker installed on your server, which you can accomplish by following <strong>Steps 1 and 2</strong> of <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-20-04">How to Install and Use Docker on Ubuntu 20.04</a>.</li><li>Docker Compose installed using the instructions from <strong>Step 1</strong> of <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-compose-on-ubuntu-20-04">How to Install Docker Compose on Ubuntu 20.04</a>.</li><li>A domain and three A records, <code>db-admin.your_domain</code>, <code>blog.your_domain</code> and <code>monitor.your_domain</code>. Each should point to the IP address of your server. You can learn how to point domains to DigitalOcean Droplets by reading through <a target="_blank" rel="noopener" href="https://www.digitalocean.com/docs/networking/dns/">DigitalOcean’s Domains and DNS documentation</a>. Throughout this tutorial, substitute your domain for <code>your_domain</code> in the configuration files and examples.</li></ul><h2 id="Step-1-—-Configuring-and-Running-Traefik">Step 1 — Configuring and Running Traefik</h2><p>The Traefik project has an <a target="_blank" rel="noopener" href="https://hub.docker.com/_/traefik">official Docker image</a>, so you will use that to run Traefik in a Docker container.</p><p>But before you get your Traefik container up and running, you need to create a configuration file and set up an encrypted password so you can access the monitoring dashboard.</p><p>You’ll use the <code>htpasswd</code> utility to create this encrypted password. First, install the utility, which is included in the <code>apache2-utils</code> package:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> apache2-utils<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Then generate the password with <code>htpasswd</code>. Substitute <code>secure_password</code> with the password you’d like to use for the Traefik admin user:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">htpasswd -nb admin secure_password<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>The output from the program will look like this:</p><pre class="line-numbers language-none"><code class="language-none">Outputadmin:$apr1$ruca84Hq$mbjdMZBAG.KWn7vfN/SNK/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>You’ll use this output in the Traefik configuration file to set up HTTP Basic Authentication for the Traefik health check and monitoring dashboard. Copy the entire output line so you can paste it later.</p><p>To configure the Traefik server, you’ll create two new configuration files called <code>traefik.toml</code> and <code>traefik_dynamic.toml</code> using the TOML format. <a target="_blank" rel="noopener" href="https://github.com/toml-lang/toml">TOML</a> is a configuration language similar to INI files, but standardized. <a target="_blank" rel="noopener" href="https://docs.traefik.io/providers/overview/">These files let us configure the Traefik server and various integrations</a>, or <code>providers</code>, that you want to use. In this tutorial, you will use three of Traefik’s available providers: <code>api</code>, <code>docker</code>, and <code>acme</code>. The last of these, <code>acme</code>, supports TLS certificates using Let’s Encrypt.</p><p>Create and open <code>traefik.toml</code> using <code>nano</code> or your preferred text editor:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">nano</span> traefik.toml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>First, you want to specify the ports that Traefik should listen on using the <code>entryPoints</code> section of your config file. You want two because you want to listen on port <code>80</code> and <code>443</code>. Let’s call these <code>web</code> (port <code>80</code>) and <code>websecure</code> (port <code>443</code>).</p><p>Add the following configurations:</p><p>traefik.toml</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">entryPoints</span><span class="token punctuation">]</span>  <span class="token punctuation">[</span><span class="token table class-name">entryPoints.web</span><span class="token punctuation">]</span>    <span class="token key property">address</span> <span class="token punctuation">=</span> <span class="token string">":80"</span>    <span class="token punctuation">[</span><span class="token table class-name">entryPoints.web.http.redirections.entryPoint</span><span class="token punctuation">]</span>      <span class="token key property">to</span> <span class="token punctuation">=</span> <span class="token string">"websecure"</span>      <span class="token key property">scheme</span> <span class="token punctuation">=</span> <span class="token string">"https"</span>  <span class="token punctuation">[</span><span class="token table class-name">entryPoints.websecure</span><span class="token punctuation">]</span>    <span class="token key property">address</span> <span class="token punctuation">=</span> <span class="token string">":443"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Note that you are also automatically redirecting traffic to be handled over TLS.</p><p>Next, configure the Traefik <code>api</code>, which gives you access to both the API and your dashboard interface. The heading of <code>[api]</code> is all that you need because the dashboard is then enabled by default, but you’ll be explicit for the time being.</p><p>Add the following code:</p><p>traefik.toml</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token table class-name">api</span><span class="token punctuation">]</span>  <span class="token key property">dashboard</span> <span class="token punctuation">=</span> <span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>To finish securing your web requests you want to use Let’s Encrypt to generate valid TLS certificates. Traefik v2 supports Let’s Encrypt out of the box and you can configure it by creating a <em>certificates resolver</em> of the type <code>acme</code>.</p><p>Let’s configure your certificates resolver now using the name <code>lets-encrypt</code>:</p><p>traefik.toml</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token table class-name">certificatesResolvers.lets-encrypt.acme</span><span class="token punctuation">]</span>  <span class="token key property">email</span> <span class="token punctuation">=</span> <span class="token string">"your_email@your_domain"</span>  <span class="token key property">storage</span> <span class="token punctuation">=</span> <span class="token string">"acme.json"</span>  <span class="token punctuation">[</span><span class="token table class-name">certificatesResolvers.lets-encrypt.acme.tlsChallenge</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This section is called <code>acme</code> because <a target="_blank" rel="noopener" href="https://github.com/ietf-wg-acme/acme/">ACME</a> is the name of the protocol used to communicate with Let’s Encrypt to manage certificates. The Let’s Encrypt service requires registration with a valid email address, so to have Traefik generate certificates for your hosts, set the <code>email</code> key to your email address. You then specify that you will store the information that you will receive from Let’s Encrypt in a JSON file called <code>acme.json</code>.</p><p>The <code>acme.tlsChallenge</code> section allows us to specify how Let’s Encrypt can verify that the certificate. You’re configuring it to serve a file as part of the challenge over port <code>443</code>.</p><p>Finally, you need to configure Traefik to work with Docker.</p><p>Add the following configurations:</p><p>traefik.toml</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token table class-name">providers.docker</span><span class="token punctuation">]</span>  <span class="token key property">watch</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>  <span class="token key property">network</span> <span class="token punctuation">=</span> <span class="token string">"web"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>The <code>docker</code> provider enables Traefik to act as a proxy in front of Docker containers. You’ve configured the provider to <code>watch</code> for new containers on the <code>web</code> network, which you’ll create soon.</p><p>Our final configuration uses the <code>file</code> provider. With Traefik v2, static and dynamic configurations can’t be mixed and matched. To get around this, you will use <code>traefik.toml</code> to define your static configurations and then keep your dynamic configurations in another file, which you will call <code>traefik_dynamic.toml</code>. Here you are using the <code>file</code> provider to tell Traefik that it should read in dynamic configurations from a different file.</p><p>Add the following <code>file</code> provider:</p><p>traefik.toml</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>providers.file<span class="token punctuation">]</span>  filename <span class="token operator">=</span> <span class="token string">"traefik_dynamic.toml"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Your completed <code>traefik.toml</code> will look like this:</p><p>traefik.toml</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">entryPoints</span><span class="token punctuation">]</span>  <span class="token punctuation">[</span><span class="token table class-name">entryPoints.web</span><span class="token punctuation">]</span>    <span class="token key property">address</span> <span class="token punctuation">=</span> <span class="token string">":80"</span>    <span class="token punctuation">[</span><span class="token table class-name">entryPoints.web.http.redirections.entryPoint</span><span class="token punctuation">]</span>      <span class="token key property">to</span> <span class="token punctuation">=</span> <span class="token string">"websecure"</span>      <span class="token key property">scheme</span> <span class="token punctuation">=</span> <span class="token string">"https"</span>  <span class="token punctuation">[</span><span class="token table class-name">entryPoints.websecure</span><span class="token punctuation">]</span>    <span class="token key property">address</span> <span class="token punctuation">=</span> <span class="token string">":443"</span><span class="token punctuation">[</span><span class="token table class-name">api</span><span class="token punctuation">]</span>  <span class="token key property">dashboard</span> <span class="token punctuation">=</span> <span class="token boolean">true</span><span class="token punctuation">[</span><span class="token table class-name">certificatesResolvers.lets-encrypt.acme</span><span class="token punctuation">]</span>  <span class="token key property">email</span> <span class="token punctuation">=</span> <span class="token string">"your_email@your_domain"</span>  <span class="token key property">storage</span> <span class="token punctuation">=</span> <span class="token string">"acme.json"</span>  <span class="token punctuation">[</span><span class="token table class-name">certificatesResolvers.lets-encrypt.acme.tlsChallenge</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token table class-name">providers.docker</span><span class="token punctuation">]</span>  <span class="token key property">watch</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>  <span class="token key property">network</span> <span class="token punctuation">=</span> <span class="token string">"web"</span><span class="token punctuation">[</span><span class="token table class-name">providers.file</span><span class="token punctuation">]</span>  <span class="token key property">filename</span> <span class="token punctuation">=</span> <span class="token string">"traefik_dynamic.toml"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Save and close the file.</p><p>Now let’s create <code>traefik_dynamic.toml</code>.</p><p>The dynamic configuration values that you need to keep in their own file are the <em>middlewares</em> and the <em>routers</em>. To put your dashboard behind a password you need to customize the API’s <em>router</em> and configure a <em>middleware</em> to handle HTTP basic authentication. Let’s start by setting up the middleware.</p><p>The middleware is configured on a per-protocol basis and since you’re working with HTTP you’ll specify it as a section chained off of <code>http.middlewares</code>. Next comes the name of your middleware so that you can reference it later, followed by the type of middleware that it is, which will be <code>basicAuth</code> in this case. Let’s call your middleware <code>simpleAuth</code>.</p><p>Create and open a new file called <code>traefik_dynamic.toml</code>:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">nano</span> traefik_dynamic.toml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Add the following code. This is where you’ll paste the output from the <code>htpasswd</code> command:</p><p>traefik_dynamic.toml</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">http.middlewares.simpleAuth.basicAuth</span><span class="token punctuation">]</span>  <span class="token key property">users</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>    <span class="token string">"admin:$apr1$ruca84Hq$mbjdMZBAG.KWn7vfN/SNK/"</span>  <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>To configure the router for the api you’ll once again be chaining off of the protocol name, but instead of using <code>http.middlewares</code>, you’ll use <code>http.routers</code> followed by the name of the router. In this case, the <code>api</code> provides its own named router that you can configure by using the <code>[http.routers.api]</code> section. You’ll configure the domain that you plan on using with your dashboard also by setting the <code>rule</code> key using a host match, the entrypoint to use <code>websecure</code>, and the middlewares to include <code>simpleAuth</code>.</p><p>Add the following configurations:</p><p>traefik_dynamic.toml</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token table class-name">http.routers.api</span><span class="token punctuation">]</span>  <span class="token key property">rule</span> <span class="token punctuation">=</span> <span class="token string">"Host(`monitor.your_domain`)"</span>  <span class="token key property">entrypoints</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"websecure"</span><span class="token punctuation">]</span>  <span class="token key property">middlewares</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"simpleAuth"</span><span class="token punctuation">]</span>  <span class="token key property">service</span> <span class="token punctuation">=</span> <span class="token string">"api@internal"</span>  <span class="token punctuation">[</span><span class="token table class-name">http.routers.api.tls</span><span class="token punctuation">]</span>    <span class="token key property">certResolver</span> <span class="token punctuation">=</span> <span class="token string">"lets-encrypt"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The <code>web</code> entry point handles port <code>80</code>, while the <code>websecure</code> entry point uses port <code>443</code> for TLS/SSL. You automatically redirect all of the traffic on port <code>80</code> to the <code>websecure</code> entry point to force secure connections for all requests.</p><p>Notice the last three lines here configure a <em>service</em>, enable tls, and configure <code>certResolver</code> to <code>"lets-encrypt"</code>. Services are the final step to determining where a request is finally handled. The <code>api@internal</code> service is a built-in service that sits behind the API that you expose. Just like routers and middlewares, services can be configured in this file, but you won’t need to do that to achieve your desired result.</p><p>Your completed <code>traefik_dynamic.toml</code> file will look like this:</p><p>traefik_dynamic.toml</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">http.middlewares.simpleAuth.basicAuth</span><span class="token punctuation">]</span>  <span class="token key property">users</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>    <span class="token string">"admin:$apr1$ruca84Hq$mbjdMZBAG.KWn7vfN/SNK/"</span>  <span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token table class-name">http.routers.api</span><span class="token punctuation">]</span>  <span class="token key property">rule</span> <span class="token punctuation">=</span> <span class="token string">"Host(`monitor.your_domain`)"</span>  <span class="token key property">entrypoints</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"websecure"</span><span class="token punctuation">]</span>  <span class="token key property">middlewares</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"simpleAuth"</span><span class="token punctuation">]</span>  <span class="token key property">service</span> <span class="token punctuation">=</span> <span class="token string">"api@internal"</span>  <span class="token punctuation">[</span><span class="token table class-name">http.routers.api.tls</span><span class="token punctuation">]</span>    <span class="token key property">certResolver</span> <span class="token punctuation">=</span> <span class="token string">"lets-encrypt"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Save the file and exit the editor.</p><p>With these configurations in place, you will now start Traefik.</p><h2 id="Step-2-–-Running-the-Traefik-Container">Step 2 – Running the Traefik Container</h2><p>In this step you will create a Docker network for the proxy to share with containers. You will then access the Traefik dashboard. The Docker network is necessary so that you can use it with applications that are run using Docker Compose.</p><p>Create a new Docker network called <code>web</code>:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker network create web<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>When the Traefik container starts, you will add it to this network. Then you can add additional containers to this network later for Traefik to proxy to.</p><p>Next, create an empty file that will hold your Let’s Encrypt information. You’ll share this into the container so Traefik can use it:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">touch</span> acme.json<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Traefik will only be able to use this file if the root user inside of the container has unique read and write access to it. To do this, lock down the permissions on <code>acme.json</code> so that only the owner of the file has read and write permission.</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> <span class="token number">600</span> acme.json<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Once the file gets passed to Docker, the owner will automatically change to the <strong>root</strong> user inside the container.</p><p>Finally, create the Traefik container with this command:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker run -d <span class="token punctuation">\</span>  -v /var/run/docker.sock:/var/run/docker.sock <span class="token punctuation">\</span>  -v <span class="token environment constant">$PWD</span>/traefik.toml:/traefik.toml <span class="token punctuation">\</span>  -v <span class="token environment constant">$PWD</span>/traefik_dynamic.toml:/traefik_dynamic.toml <span class="token punctuation">\</span>  -v <span class="token environment constant">$PWD</span>/acme.json:/acme.json <span class="token punctuation">\</span>  -p <span class="token number">80</span>:80 <span class="token punctuation">\</span>  -p <span class="token number">443</span>:443 <span class="token punctuation">\</span>  --network web <span class="token punctuation">\</span>  --name traefik <span class="token punctuation">\</span>  traefik:v2.2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This command is a little long. Let’s break it down.</p><p>You use the <code>-d</code> flag to run the container in the background as a daemon. You then share your <code>docker.sock</code> file into the container so that the Traefik process can listen for changes to containers. You also share the <code>traefik.toml</code> and <code>traefik_dynamic.toml</code> configuration files into the container, as well as <code>acme.json</code>.</p><p>Next, you map ports <code>:80</code> and <code>:443</code> of your Docker host to the same ports in the Traefik container so Traefik receives all HTTP and HTTPS traffic to the server.</p><p>You set the network of the container to <code>web</code>, and you name the container <code>traefik</code>.</p><p>Finally, you use the <code>traefik:v2.2</code> image for this container so that you can guarantee that you’re not running a completely different version than this tutorial is written for.</p><p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#entrypoint">A Docker image’s <code>ENTRYPOINT</code> is a command that always runs when a container is created from the image</a>. In this case, the command is the <code>traefik</code> binary within the container. You can pass additional arguments to that command when you launch the container, but you’ve configured all of your settings in the <code>traefik.toml</code> file.</p><p>With the container started, you now have a dashboard you can access to see the health of your containers. You can also use this dashboard to visualize the routers, services, and middlewares that Traefik has registered. You can try to access the monitoring dashboard by pointing your browser to <code>https://monitor.your_domain/dashboard/</code> (the trailing <code>/</code> is required).</p><p>You will be prompted for your username and password, which are <strong>admin</strong> and the password you configured in Step 1.</p><p>Once logged in, you’ll see the Traefik interface:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1420211014200207.png" alt="Empty Traefik dashboard"></p><p>You will notice that there are already some routers and services registered, but those are the ones that come with Traefik and the router configuration that you wrote for the API.</p><p>You now have your Traefik proxy running, and you’ve configured it to work with Docker and monitor other containers. In the next step you will start some containers for Traefik to proxy.</p><h2 id="Step-3-—-Registering-Containers-with-Traefik">Step 3 — Registering Containers with Traefik</h2><p>With the Traefik container running, you’re ready to run applications behind it. Let’s launch the following containers behind Traefik:</p><ol><li>A blog using the <a target="_blank" rel="noopener" href="https://hub.docker.com/_/wordpress/">official WordPress image</a>.</li><li>A database management server using the <a target="_blank" rel="noopener" href="https://hub.docker.com/_/adminer/">official Adminer image</a>.</li></ol><p>You’ll manage both of these applications with Docker Compose using a <code>docker-compose.yml</code> file.</p><p>Create and open the <code>docker-compose.yml</code> file in your editor:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">nano</span> docker-compose.yml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Add the following lines to the file to specify the version and the networks you’ll use:</p><p>docker-compose.yml</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span><span class="token key atrule">networks</span><span class="token punctuation">:</span>  <span class="token key atrule">web</span><span class="token punctuation">:</span>    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">internal</span><span class="token punctuation">:</span>    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>You use Docker Compose version <code>3</code> because it’s the newest major version of the Compose file format.</p><p>For Traefik to recognize your applications, they must be part of the same network, and since you created the network manually, you pull it in by specifying the network name of <code>web</code> and setting <code>external</code> to <code>true</code>. Then you define another network so that you can connect your exposed containers to a database container that you won’t expose through Traefik. You’ll call this network <code>internal</code>.</p><p>Next, you’ll define each of your <code>services</code>, one at a time. Let’s start with the <code>blog</code> container, which you’ll base on the official WordPress image. Add this configuration to the bottom of the file:</p><p>docker-compose.yml</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">...</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">blog</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> wordpress<span class="token punctuation">:</span>4.9.8<span class="token punctuation">-</span>apache    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">WORDPRESS_DB_PASSWORD</span><span class="token punctuation">:</span>    <span class="token key atrule">labels</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> traefik.http.routers.blog.rule=Host(`blog.your_domain`)      <span class="token punctuation">-</span> traefik.http.routers.blog.tls=true      <span class="token punctuation">-</span> traefik.http.routers.blog.tls.certresolver=lets<span class="token punctuation">-</span>encrypt      <span class="token punctuation">-</span> traefik.port=80    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> internal      <span class="token punctuation">-</span> web    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The <code>environment</code> key lets you specify environment variables that will be set inside of the container. By not setting a value for <code>WORDPRESS_DB_PASSWORD</code>, you’re telling Docker Compose to get the value from your shell and pass it through when you create the container. You will define this environment variable in your shell before starting the containers. This way you don’t hard-code passwords into the configuration file.</p><p>The <code>labels</code> section is where you specify configuration values for Traefik. Docker labels don’t do anything by themselves, but Traefik reads these so it knows how to treat containers. Here’s what each of these labels does:</p><ul><li><code>traefik.http.routers.adminer.rule=Host(`````blog.your_domain`````)</code> creates a new <em>router</em> for your container and then specifies the routing rule used to determine if a request matches this container.</li><li><code>traefik.routers.custom_name.tls=true</code> specifies that this router should use TLS.</li><li><code>traefik.routers.custom_name.tls.certResolver=lets-encrypt</code> specifies that the certificates resolver that you created earlier called <code>lets-encrypt</code> should be used to get a certificate for this route.</li><li><code>traefik.port</code> specifies the exposed port that Traefik should use to route traffic to this container.</li></ul><p>With this configuration, all traffic sent to your Docker host on port <code>80</code> or <code>443</code> with the domain of <code>blog.your_domain</code> will be routed to the <code>blog</code> container.</p><p>You assign this container to two different networks so that Traefik can find it via the <code>web</code> network and it can communicate with the database container through the <code>internal</code> network.</p><p>Lastly, the <code>depends_on</code> key tells Docker Compose that this container needs to start <em>after</em> its dependencies are running. Since WordPress needs a database to run, you must run your <code>mysql</code> container before starting your <code>blog</code> container.</p><p>Next, configure the MySQL service:</p><p>docker-compose.yml</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">services</span><span class="token punctuation">:</span><span class="token punctuation">...</span>  <span class="token key atrule">mysql</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span>    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> internal    <span class="token key atrule">labels</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> traefik.enable=false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>You’re using the official MySQL 5.7 image for this container. You’ll notice that you’re once again using an <code>environment</code> item without a value. The <code>MYSQL_ROOT_PASSWORD</code> and <code>WORDPRESS_DB_PASSWORD</code> variables will need to be set to the same value to make sure that your WordPress container can communicate with the MySQL. You don’t want to expose the <code>mysql</code> container to Traefik or the outside world, so you’re only assigning this container to the <code>internal</code> network. Since Traefik has access to the Docker socket, the process will still expose a router for the <code>mysql</code> container by default, so you’ll add the label <code>traefik.enable=false</code> to specify that Traefik should not expose this container.</p><p>Finally, define the Adminer container:</p><p>docker-compose.yml</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">services</span><span class="token punctuation">:</span><span class="token punctuation">...</span>  <span class="token key atrule">adminer</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> adminer<span class="token punctuation">:</span>4.6.3<span class="token punctuation">-</span>standalone    <span class="token key atrule">labels</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> traefik.http.routers.adminer.rule=Host(`db<span class="token punctuation">-</span>admin.your_domain`)      <span class="token punctuation">-</span> traefik.http.routers.adminer.tls=true      <span class="token punctuation">-</span> traefik.http.routers.adminer.tls.certresolver=lets<span class="token punctuation">-</span>encrypt      <span class="token punctuation">-</span> traefik.port=8080    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> internal      <span class="token punctuation">-</span> web    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This container is based on the official Adminer image. The <code>network</code> and <code>depends_on</code> configuration for this container exactly match what you’re using for the <code>blog</code> container.</p><p>The line <code>traefik.http.routers.adminer.rule=Host(`````db-admin.your_domain`````)</code> tells Traefik to examine the host requested. If it matches the pattern of <code>db-admin.your_domain</code>, Traefik will route the traffic to the <code>adminer</code> container over port <code>8080</code>.</p><p>Your completed <code>docker-compose.yml</code> file will look like this:</p><p>docker-compose.yml</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span><span class="token key atrule">networks</span><span class="token punctuation">:</span>  <span class="token key atrule">web</span><span class="token punctuation">:</span>    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">internal</span><span class="token punctuation">:</span>    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">blog</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> wordpress<span class="token punctuation">:</span>4.9.8<span class="token punctuation">-</span>apache    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">WORDPRESS_DB_PASSWORD</span><span class="token punctuation">:</span>    <span class="token key atrule">labels</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> traefik.http.routers.blog.rule=Host(`blog.your_domain`)      <span class="token punctuation">-</span> traefik.http.routers.blog.tls=true      <span class="token punctuation">-</span> traefik.http.routers.blog.tls.certresolver=lets<span class="token punctuation">-</span>encrypt      <span class="token punctuation">-</span> traefik.port=80    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> internal      <span class="token punctuation">-</span> web    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> mysql  <span class="token key atrule">mysql</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span>    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> internal    <span class="token key atrule">labels</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> traefik.enable=false  <span class="token key atrule">adminer</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> adminer<span class="token punctuation">:</span>4.6.3<span class="token punctuation">-</span>standalone    <span class="token key atrule">labels</span><span class="token punctuation">:</span>    <span class="token key atrule">labels</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> traefik.http.routers.adminer.rule=Host(`db<span class="token punctuation">-</span>admin.your_domain`)      <span class="token punctuation">-</span> traefik.http.routers.adminer.tls=true      <span class="token punctuation">-</span> traefik.http.routers.adminer.tls.certresolver=lets<span class="token punctuation">-</span>encrypt      <span class="token punctuation">-</span> traefik.port=8080    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> internal      <span class="token punctuation">-</span> web    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Save the file and exit the text editor.</p><p>Next, set values in your shell for the <code>WORDPRESS_DB_PASSWORD</code> and <code>MYSQL_ROOT_PASSWORD</code> variables:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">WORDPRESS_DB_PASSWORD</span><span class="token operator">=</span>secure_database_password<span class="token builtin class-name">export</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>secure_database_password<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Substitute <code>secure_database_password</code> with your desired database password. Remember to use the same password for both <code>WORDPRESS_DB_PASSWORD</code> and <code>MYSQL_ROOT_PASSWORD</code>.</p><p>With these variables set, run the containers using <code>docker-compose</code>:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker-compose up -d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Now watch the Traefik admin dashboard while it populates.</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1420211014200110.png" alt="Populated Traefik dashboard"></p><p>If you explore the <strong>Routers</strong> section you will find routers for <code>adminer</code> and <code>blog</code> configured with TLS:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1420211014200142.png" alt="HTTP Routers w/ TLS"></p><p>Navigate to <code>blog.your_domain</code>, substituting <code>your_domain</code> with your domain. You’ll be redirected to a TLS connection and you can now complete the WordPress setup:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1420211014200114.png" alt="WordPress setup screen"></p><p>Now access Adminer by visiting <code>db-admin.your_domain</code> in your browser, again substituting <code>your_domain</code> with your domain. The <code>mysql</code> container isn’t exposed to the outside world, but the <code>adminer</code> container has access to it through the <code>internal</code> Docker network that they share using the <code>mysql</code> container name as a hostname.</p><p>On the Adminer login screen, enter <code>root</code> for <strong>Username</strong>, enter <code>mysql</code> for <strong>Server</strong>, and enter the value you set for <code>MYSQL_ROOT_PASSWORD</code> for the <strong>Password</strong>. Leave <strong>Database</strong> empty. Now press <strong>Login</strong>.</p><p>Once logged in, you’ll see the Adminer user interface.</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1420211014200132.png" alt="Adminer connected to the MySQL database"></p><p>Both sites are now working, and you can use the dashboard at <code>monitor.your_domain</code> to keep an eye on your applications.</p><h2 id="Conclusion">Conclusion</h2><p>In this tutorial, you configured Traefik v2 to proxy requests to other applications in Docker containers.</p><p>Traefik’s declarative configuration at the application container level makes it easy to configure more services, and there’s no need to restart the <code>traefik</code> container when you add new applications to proxy traffic to since Traefik notices the changes immediately through the Docker socket file it’s monitoring.</p><p>To learn more about what you can do with Traefik v2, head over to <a target="_blank" rel="noopener" href="https://doc.traefik.io/traefik/">the official Traefik documentation</a>.</p><h2 id="服务集群">服务集群</h2><blockquote><p>k8s 太重了,虽然也有 k3s 之类的轻量级 k8s 解决方案，不过我还是选择了原生的 docker swarm。VPS 安装好 Docker 之后，不需要额外安装软件，就可以马上建立集群。</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 集群初始化，节点成为 manager 节点</span>docker swarm init --advertise-addr<span class="token operator">=</span>x.x.x.x<span class="token comment"># 集群丢失 Leader 时，强制重建集群</span>docker swarm init --advertise-addr<span class="token operator">=</span>x.x.x.x --force-new-cluster<span class="token comment"># 获取作为 worker 节点加入集群的命令</span>docker swarm join-token worker<span class="token comment"># 获取作为 manager 节点加入集群的命令</span>docker swarm join-token manager<span class="token comment"># 加入集群</span>docker swarm <span class="token function">join</span> --token xxx x.x.x.x:xxx --advertise-addr<span class="token operator">=</span>x.x.x.x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="参考：-3">参考：</h2><ul><li><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-use-traefik-v2-as-a-reverse-proxy-for-docker-containers-on-ubuntu-20-04">digitalocean</a></li><li><a target="_blank" rel="noopener" href="https://shanyue.tech/op/traefik.html">shanyue</a></li></ul><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="web" scheme="https://blog.17lai.site/categories/web/"/>
    
    
    <category term="docker" scheme="https://blog.17lai.site/tags/docker/"/>
    
    <category term="traefik" scheme="https://blog.17lai.site/tags/traefik/"/>
    
    <category term="proxy" scheme="https://blog.17lai.site/tags/proxy/"/>
    
    <category term="swarm" scheme="https://blog.17lai.site/tags/swarm/"/>
    
    <category term="ubuntu" scheme="https://blog.17lai.site/tags/ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>通过IPV6访问Qnap NAS中Docker的服务</title>
    <link href="https://blog.17lai.site/posts/462f1e5c/"/>
    <id>https://blog.17lai.site/posts/462f1e5c/</id>
    <published>2021-10-12T05:42:55.000Z</published>
    <updated>2022-03-16T10:52:11.433Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="环境">环境</h2><p>系统：QTS 4.3.6<br>网络：IPV4 &amp; IPV6<br>Docker: 由Container Station提供</p><h2 id="问题-2">问题</h2><p>通过ipv6地址可以打开NAS的管理页面，但是无法访问Docker对应端口的服务。</p><h2 id="排查">排查</h2><p>QTS中Docker使用的虚拟交换机网络没有启动IPV6，且无法在虚拟交换机设置中手动启动。<br>这样一来，Docker只监听了tcp4的端口，对于主机上tcp6的端口的访问无法映射到docker容器上。</p><h2 id="解决方案-2">解决方案</h2><p>在主机上开一个tcp6的端口，将其转发到主机上与docker关联的tcp4端口。<br>即：<br>docker(tcp4)–&gt;host(tcp4)–&gt;host(tcp6)</p><ul><li>在qts上安装包管理器：Entware. <a target="_blank" rel="noopener" href="https://github.com/Entware/Entware/wiki/Install-on-QNAP-NAS">https://github.com/Entware/Entware/wiki/Install-on-QNAP-NAS</a></li><li>执行opkg update,更新</li><li>安装端口转发工具，这里使用socat：opkg install socat</li><li>设置转发host(tcp6)–&gt;host(tcp4):(socat TCP6-LISTEN:6880,reuseaddr,fork TCP4:127.0.0.1:7880 &amp;)</li><li>大功告成</li></ul><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="nas" scheme="https://blog.17lai.site/categories/nas/"/>
    
    
    <category term="nas" scheme="https://blog.17lai.site/tags/nas/"/>
    
    <category term="docker" scheme="https://blog.17lai.site/tags/docker/"/>
    
    <category term="qnap" scheme="https://blog.17lai.site/tags/qnap/"/>
    
    <category term="ipv6" scheme="https://blog.17lai.site/tags/ipv6/"/>
    
  </entry>
  
  <entry>
    <title>CMake快速入门教程</title>
    <link href="https://blog.17lai.site/posts/495db4d3/"/>
    <id>https://blog.17lai.site/posts/495db4d3/</id>
    <published>2021-10-12T04:25:00.000Z</published>
    <updated>2022-03-16T10:52:11.506Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="1-cmake简介">1.cmake简介</h2><p>cmake是跨平台的makefile文件生成工具,是为了解决各个平台下面make工具不同造成的makefile文件格式不同的问题.也就是cmake是用来解决跨平台编译问题的.常见的还有autotool工具集，该工具集用于GNU软件协议的makefile文件生成，方便GNU包的编译和安装。</p><h2 id="2-cmake文件编辑规则">2.cmake文件编辑规则</h2><ul><li>1)<strong>命令不区分大小写，但是变量区分大小写</strong>。</li><li>2)<strong>注释</strong>使用#符号</li><li>3)命令如果有多个参数，互相之间用空格隔开</li></ul><h2 id="3-cmake保留变量">3.cmake保留变量</h2><p>cmake里面有很多的预定义变量,是程序环境固有的,比如CUDA_NVCC_FLAGS,不同的变量有固定的作用,比如CUDA_NVCC_FLAGS是nvcc的参数list,变量可以使用set命令和list命令进行赋值和追加值,要注意的是变量可能可以有多个值,值与值之间用分号分开,可以使用set(var a b c)给var赋值a b c,还可以使用list命令给var追加删除插入值等,不同的变量有不同的值域,需要查阅<a target="_blank" rel="noopener" href="https://cmake.org/documentation/">手册</a></p><h2 id="4-cmake变量引用">4.cmake变量引用</h2><p>cmake里面变量的取值引用要使用${var}的形式,但是在赋值的时候是不需要的,和shell命令有点相似.</p><h2 id="5-cmake指定Debug和Release版本">5.cmake指定Debug和Release版本</h2><p>指定Debug和Release一共有三种方法：</p><p>1.使用ADD_COMPILE_OPTIONS()加入-g指定Debug版本.</p><p>2.使用SET( CMAKE_BUILD_TYPE Debug/Rrelease)指定Debug<br>在下面加入：</p><pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token function">SET</span><span class="token punctuation">(</span><span class="token variable">CMAKE_CXX_FLAGS_DEBUG</span> <span class="token string">"$ENV{CXXFLAGS} -O0 -Wall -g2 -ggdb"</span><span class="token punctuation">)</span><span class="token function">SET</span><span class="token punctuation">(</span><span class="token variable">CMAKE_CXX_FLAGS_RELEASE</span> <span class="token string">"$ENV{CXXFLAGS} -O3 -Wall"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>上面的设置C++编译选项，对于C语言，设置CMAKE_C_FLAGS_DEBUG、CMAKE_._FLAGS_RELEASE变量，一般来说最好两个都设置原因是CMake 中有一个变量 CMAKE_BUILD_TYPE ,可以的取值是 Debug Release等.当这个变量值为 Debug 的时候,CMake 会使用变量 CMAKE_CXX_FLAGS_DEBUG 和 CMAKE_C_FLAGS_DEBUG 中的字符串作为编译选项生成 Makefile</p><p>编译动态库or静态库时，最好通过修改CXXFLAGS和CFLAGS，以支持-fPIC，这个选项有时是默认开启，有时默认关闭，但为了以后的应用，库文件最好都使用-fPIC编译</p><ol start="3"><li>在使用cmake命令时加上-DCMAKE_BUILD_TYPE=Debug/Release</li></ol><h2 id="5-cmake指定生成文件">5.cmake指定生成文件</h2><p>CUDA_ADD_LIBRARY()指明目标文件是库文件,CUDA_ADD_EXECUTABLE()指明生成的文件为可执行文件</p><h2 id="6-配置模板">6.配置模板</h2><p>通常我们要在工程目录下面创建include、src文件夹，include文件夹里面存放头文件，src文件夹里面存放源代码，注意这时候的源代码里面包含头文件的路径应该是“../include/xx.h”，然后在工程根目录下面创建CMakeLists.txt文件，里面写入命令.在编译的时候为了不搞乱工程目录，在工程根目录下面创建build文件夹，在里面使用“cmake ..”命令创建CMakefile,再make即可。</p><pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token comment">#指定cmake最低版本号</span><span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.2</span><span class="token punctuation">)</span><span class="token comment">#指定项目名称</span><span class="token function">PROJECT</span><span class="token punctuation">(</span>Liner_Struct<span class="token punctuation">)</span><span class="token comment">#指定头文件目录，不同目录用空格隔开,目录中有空格可用引号</span><span class="token comment">#如果是相对路径，相对于CMakeLists.txt文件</span><span class="token property">INCLUDE_DIRECTORIES</span><span class="token punctuation">(</span>include<span class="token punctuation">)</span><span class="token comment">#指定源文件目录，DIR_SRCS值自定义变量，下面的命令对其进行了赋值</span><span class="token function">AUX_SOURCE_DIRECTORY</span><span class="token punctuation">(</span>src DIR_SRCS<span class="token punctuation">)</span><span class="token comment">#设置变量用于存放所有的编译文件，</span><span class="token comment">#TEST_LINER_STRUCT是自定义变量，使用SET给其赋值</span><span class="token function">SET</span><span class="token punctuation">(</span>TEST_LINER_STRUCT <span class="token punctuation">${</span>DIR_SRCS<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">#增加编译选项</span><span class="token comment">#判断是否为gcc编译器，如果是，增加编译选项</span><span class="token comment">#c99是c语言的标准，常用的还有c++标准c++11</span><span class="token comment">#下面的命令判断是否编译器是gcc</span><span class="token comment">#message命令是输出信息,例如下面的输出“optional:-std=c99”</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">CMAKE_COMPILER_IS_GNUCXX</span><span class="token punctuation">)</span>    <span class="token function">ADD_COMPILE_OPTIONS</span><span class="token punctuation">(</span>-std=c99<span class="token punctuation">)</span>    <span class="token keyword">message</span><span class="token punctuation">(</span>STATUS <span class="token string">"optional:-std=c99"</span><span class="token punctuation">)</span><span class="token keyword">endif</span><span class="token punctuation">(</span><span class="token variable">CMAKE_COMPILER_IS_GNUCXX</span><span class="token punctuation">)</span><span class="token comment">#配置生成文件</span><span class="token comment">#${PROJECT_NAME}是cmake自带变量，其值和PROJECT()命令指定的一样</span><span class="token comment">#${TEST_LINER_STRUCT}是自定义变量，上文赋值的</span><span class="token function">ADD_EXECUTABLE</span><span class="token punctuation">(</span><span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span> <span class="token punctuation">${</span>TEST_LINER_STRUCT<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="7-if-else语句">7.<a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/v3.0/command/if.html">if-else</a>语句</h2><p>cmake中的if-else语句</p><pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">if</span><span class="token punctuation">(</span>exp<span class="token punctuation">)</span>     cmdA     cmdB<span class="token keyword">elseif</span><span class="token punctuation">(</span>exp<span class="token punctuation">)</span>      cmdC<span class="token keyword">endif</span><span class="token punctuation">(</span>exp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最简单得到一个应用</p><pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">if</span><span class="token punctuation">(</span>ARM<span class="token punctuation">)</span>   <span class="token comment">#ARM平台</span><span class="token keyword">else</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#非ARM平台 </span><span class="token keyword">endif</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用cmake -DARM=1 .. 时编译ARM代码，使用cmake -DAMR=0 ..编译非ARM代码</p><h2 id="8-与平台编译器的结合">8.与平台编译器的结合</h2><h3 id="8-1windows">8.1windows</h3><p>在windows上运行cmake可以生成对应的VS的工程文件，然后使用相应的VS打开工程就可以进行编译。要注意的是如果使用VS2010及其以前的版本，C不支持C99，也就是变量的命名必须放在函数或者域的最前面，不能放在中间，特别麻烦。VS2015在安装后可能还需要打开VS，新建工程时选择VC<ins>可能相关组件还没有安装，如果这时候使用cmake会提示找不到C、C</ins>编译器（类似yuNo CMAKE_CXX_COMPILER could be found）的错误。安装了相关的组件后cmake即不会有错误。</p><h3 id="8-2-为VS2015生成的项目">8.2 为VS2015生成的项目</h3><p>打开工程文件后可以看到有3个项目，其中只有一个和我们有直接关系，就是我们在CMakeLists.txt里面定义的PROJECT_NAME,剩下的两个是ALL_BUILD和ZERO_CHECK.</p><p><strong>ZERO_CHECK</strong><br>该目标会检查生成工程的 CMake 配置文件（ CMakeLists.txt ）是否更新。如更新，将运行 CMake 重新生成工程文件。</p><p>如果确信 CMakeLists.txt 不会被更新，或者希望手工运行 CMake 重新生成工程文件，可以在 CMakeLists.txt 配置文件中添加 set(CMAKE_SUPPRESS_REGENERATION FALSE) 命令， ZERO_CHECK 目标将不会生成。</p><p><strong>ALL_BUILD</strong><br>该目标会导致工程中所有项目被构建，类似 Visual Studio 的 Build All 或者 make 的 make all命令。</p><p>转载 <a target="_blank" rel="noopener" href="https://lightzhan.xyz/index.php/2020/03/11/cmake-quick-tutorial/">CMake快速入门教程</a></p><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="linux" scheme="https://blog.17lai.site/categories/linux/"/>
    
    
    <category term="linux" scheme="https://blog.17lai.site/tags/linux/"/>
    
    <category term="cmake" scheme="https://blog.17lai.site/tags/cmake/"/>
    
    <category term="develop" scheme="https://blog.17lai.site/tags/develop/"/>
    
  </entry>
  
  <entry>
    <title>如何使用tinyMediaManager刮削电影和电视剧，动画，并自动下载字幕</title>
    <link href="https://blog.17lai.site/posts/e6d40157/"/>
    <id>https://blog.17lai.site/posts/e6d40157/</id>
    <published>2021-10-11T11:25:00.000Z</published>
    <updated>2022-03-16T12:29:06.798Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>注意使用V3版本，V4版本收费！</p><p>所以升级V3版本即可，不要升级到V4版本！不要升级到V4版本！不要升级到V4版本！</p></blockquote><ul><li><strong>Plex</strong>是一款很好用的个人媒体中心软件，但是因为国内网络的原因，使用默认的TMDB刮削器挂出来的效果并不好，要么就是影片信息不正确，要么就是海报不正常显示，实在让人头疼。</li><li><strong>tinyMediaManager</strong>是一款电影信息刮削和整理的软件，正好可以和plex配合，完美的解决这一问题。tinyMediaManager在刮削影片的过程中会把影片的海报、演员表、背景图片等等都保存到影片所在文件夹，自动生成电影的nfo信息文件，并对文件和文件夹进行重新命名的操作。在plex设置刮削代理的时候，需要用一款插件可以直接读取nfo的信息，完成刮削，下面把使用方法分享给大家，</li></ul><h2 id="下载和安装tinyMediaManager"><strong>下载和安装tinyMediaManager</strong></h2><p><strong>官网下载地址：<a href="www.tinymediamanager.org/download/">https://www.tinymediamanager.org/download/</a></strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181048.jpeg" alt=""></p><h3 id="tmm下载">tmm下载</h3><p><strong>下载后直接解压文件夹</strong></p><p>客户端需要java支持，先在电脑安装java</p><p>客户端下载后是一个压缩包，解压之后就可以用</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181054.jpeg" alt=""></p><p><strong>解压之后打开tinyMediaManager.exe</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181101.png" alt="tmm目录"></p><h2 id="TMM设置">TMM设置</h2><h3 id="TMM代理设置">TMM代理设置</h3><blockquote><p>重要：很多源都需要代理才能访问。这里正确的配置才能正确的刮削！</p><p>可以调整这里使用的内存，大内存可以极大加速刮削速度。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011211402.png" alt=""></p><h2 id="电影刮削设置">电影刮削设置</h2><p><strong>进行相关设置。Tmm可以对电影和电视剧的刮削进行分别设置，打开设置后选择电影选项，可以选择分级标准、自动重命名等选项。</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181337.png" alt=""></p><p>电影信息选项</p><p><strong>点击侧边栏媒体库目录，添加电影目录</strong></p><p><strong>刮削器设置</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181107.jpeg" alt=""></p><p>选择电影刮削器</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181107.png" alt=""></p><p>刮削器选项</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181114.png" alt=""></p><p>nfo选项，建议选择生成两种命名放视的nfo</p><p><strong>图片刮削器选择全选，图片文件名建议两边都选上，会分别生成两组命名格式不同的图片，为了保证plex能读取</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181331.png" alt=""></p><p>图片命名选项</p><p>Tmm还可以自动下载预告片，字幕。字幕下载时可以输入opensubtitles账户</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181115.png" alt=""></p><p>字幕下载选项</p><p><strong>重命名规则</strong></p><p>这里重点讲一下重命名规则，刮削完后可以选择对电影文件和文件夹进行重命名，可能对于pt用户重命名可能会影响资源上传，可以不进行重命名操作。</p><p>一般情况下电影刮削出来的信息，title是电影的中文标题名称，originaltitle是电影的原标题名称，一般是英文名称。软件默认的设置是文件和文件夹都命名成title，也就是中文标题，但是我发现这样在后期使用的时候有弊端。英文电影在检索字幕时会用文件名来检索，而用中文名称很多情况下检索不出来，所以这里把文件的命名规则改一下，改成originaltitle，并去掉年份信息的括号，中间连接符改成点，文件名设置成<img src="https://math.now.sh?inline=%7Boriginaltitle%7D" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;">{- ,edition,}.<img src="https://math.now.sh?inline=%7Byear%7D." style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;">{videoFormat}.${audioCodec}的格式。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181121.png" alt=""></p><p>电影文件重命名选项</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181127.png" alt=""></p><p>刮削完的文件夹内文件信息</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181323.png" alt=""></p><p>刮削完的电影文件夹目录</p><p><strong>电视节目刮削设置类似，如果挂不出来可以用the tvdb来刮削。</strong></p><p><strong>tmm有时候会出现网络不稳定，刮不到的情况，可以修改host解决</strong></p><p>改host 在host文件最后加一行13.224.161.90 <a href="https://link.zhihu.com/?target=http%3A//api.themoviedb.org">http://api.themoviedb.org</a></p><p><strong>退出设置，开始刮削</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181317.png" alt=""></p><p>更新电影源</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181128.jpeg" alt=""></p><p>选中要刮削的电影自动匹配</p><h3 id="电影手动刮削">电影手动刮削</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011183942.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011184131.png" alt=""></p><h2 id="电视剧-动画手动刮削">电视剧&amp;动画手动刮削</h2><h3 id="电视剧元数据刮削">电视剧元数据刮削</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011184909.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011185747.png" alt=""></p><h3 id="季和集元数据刮削前整理">季和集元数据刮削前整理</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011185049.png" alt=""></p><h3 id="刮削季元素">刮削季元素</h3><p>整理好正确的季和集之后，才能正确的刮削季元素</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011185146.png" alt=""></p><h3 id="TMM整理完效果">TMM整理完效果</h3><blockquote><p>这里用海贼王做展示，一个季和集都特别多的剧。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011185448.png" alt=""></p><h2 id="TMM目录重命名整理">TMM目录重命名整理</h2><blockquote><p>刮削完后，可以重命名视频文件，并进行目录整理。</p></blockquote><p>方法1</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181133.jpeg" alt=""></p><p>方法2</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011184315.png" alt=""></p><p>等所有电影的信息刮削完后，选择重命名和清理，这样就完成了刮削的操作。以后下载了新电影，直接打开tmm,更新源之后直接选择搜索未刮削过的电影完成刮削。刮削出来的信息kodi，emby等软件也都能用。</p><h2 id="Plex设置">Plex设置</h2><h3 id="plex插件的安装和设置"><strong>plex插件的安装和设置</strong></h3><p><strong>下载plex的插件</strong></p><p>插件XBMCnfoMoviesImporter和XBMCnfoTVImporter分别是刮削电影和电视剧的插件</p><p>下载地址：<a href="https%3A//github.com/gboudreau/XBMCnfoMoviesImporter.bundle">https://github.com/gboudreau/XBMCnfoMoviesImporter.bundle</a></p><p>如果不能下载的话可以联系我获取，还有几个很好用的plex插件</p><p>下载完插件后就需要把插件解压到plex的插件目录：C:\Users\用户名\AppData\Local\Plex Media Server\Plug-ins</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181134.png" alt=""></p><p>plex插件目录</p><p>注意解压后要把文件夹名后边的master去掉。</p><p><strong>plex代理设置</strong></p><p>Plex的代理设置就是选择刮削电影所用的刮削器及优先级。</p><p>装好插件后重启plex，进行plex的设置。在代理设置中选择XBMCnfoMoviesImporter，把它的优先级调到最高，第二个可以设置成字幕插件。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181140.jpeg" alt=""></p><p><strong>设置电影资料库的刮削器代理</strong></p><p>点击设置界面下方管理里边的资料库，选择电影资料夹的高级设置，设置如下</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181140.png" alt=""><br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181146.png" alt=""></p><p>plex代理设置</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181152.png" alt=""></p><p><strong>刷新电影源数据资料</strong></p><p>设置完成后就可以在plex主页对电影文件夹刷新元数据了。等待刷新完后就可以载入所有的电影信息了。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181152.jpeg" alt=""></p><p>管理资料库-刷新电影元数据</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181153.jpeg" alt=""></p><p>更新后的电影信息</p><p>采用类似的设置，电视剧信息也能刮削。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181159.jpeg" alt=""></p><p>电视剧更新后的信息</p><h2 id="Emby设置">Emby设置</h2><blockquote><p>Emby内置刮削工具，但是速度较慢。下面设置基于外部刮削工具TMM，所以没有勾选Emby刮削源！</p></blockquote><p>最终效果演示</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011190035.png" alt="最终效果"></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011190347.png" alt=""></p><h3 id="开始设置">开始设置</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181946.png" alt=""></p><h3 id="新增媒体库">新增媒体库</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011182142.png" alt=""></p><h3 id="已有媒体库属性设置">已有媒体库属性设置</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011182244.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011182350.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011183115.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011183157.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011183336.png" alt=""></p><h3 id="Emby字幕设置">Emby字幕设置</h3><p>字幕下载设置，字幕下载工具见后面的[字幕下载]章节</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011182554.png" alt=""></p><h2 id="字幕下载-2"><strong>字幕下载</strong></h2><p>想要较好的自动下载字幕，最好用前面介绍的tmm刮削改名之后再使用下面工具。</p><h3 id="subfinder-自动下载字幕-2">subfinder 自动下载字幕</h3><ul><li>Docker： <a target="_blank" rel="noopener" href="https://hub.docker.com/r/superng6/subfinder">superng6/subfinder</a></li></ul><p>下载完成，刮削后的目录，挂载到subfinder的media目录，就会自动下载字幕。</p><p>字幕下载对电影，英文剧集支持较好。对于一些tv，动画手动下载字幕会更好一些。</p><p>注意：官方的配置文件有问题，时效问题。修改URL到最新即可。</p><h3 id="chinesesubfinder-2">chinesesubfinder</h3><ul><li>Docker： <a target="_blank" rel="noopener" href="https://hub.docker.com/r/allanpk716/chinesesubfinder">allanpk716/chinesesubfinder</a></li><li>新开发的中文字幕查找工具，上面那个很久没更新了，这个刚出来。使用nfo里面刮削出来的文件名来匹配字幕。所以就原理来说，这个字幕匹配更准确。</li></ul><h3 id="bazarr-2">bazarr</h3><ul><li>Docker：<a target="_blank" rel="noopener" href="https://hub.docker.com/r/linuxserver/bazarr">linuxserver/bazarr</a></li><li>字幕下载管理，配合sonarr, radarr 使用效果更好。对于英文剧集命名规范的支持较好，比如<code>[name]S01E01</code></li></ul><h2 id="参考-3">参考</h2><ul><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/112167546?from_voters_page=true">利用tinyMediaManager刮削影片，解决家用nas软件plex电影墙的问题</a></li></ul><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="video" scheme="https://blog.17lai.site/categories/video/"/>
    
    
    <category term="刮削" scheme="https://blog.17lai.site/tags/%E5%88%AE%E5%89%8A/"/>
    
    <category term="tmm" scheme="https://blog.17lai.site/tags/tmm/"/>
    
    <category term="字幕" scheme="https://blog.17lai.site/tags/%E5%AD%97%E5%B9%95/"/>
    
    <category term="emby" scheme="https://blog.17lai.site/tags/emby/"/>
    
    <category term="plex" scheme="https://blog.17lai.site/tags/plex/"/>
    
  </entry>
  
  <entry>
    <title>如何使用media Go,MusicBrainz,Mp3tag工具刮削音乐 整理音乐资料库</title>
    <link href="https://blog.17lai.site/posts/3847ad58/"/>
    <id>https://blog.17lai.site/posts/3847ad58/</id>
    <published>2021-10-11T01:25:00.000Z</published>
    <updated>2022-03-16T12:29:06.715Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="背景">背景</h2><p>动画、电影、剧集可使用TinyMediaManager生成nfo元数据文件，多媒体软件解析生成海报墙展示丰富的影片信息。</p><p>而音乐文件则是将歌名、歌手、专辑、发行时间、歌词、封面图等信息写入文件标签，称为ID3 Tag 。桌面软件、多媒体管理软件（Foobar2000/Plex/Emby/Jellyfin等）都能解析展现歌曲信息。ID3标签是MP3音乐档案中的歌曲附加讯息，它能够在MP3中附加曲子的演出者、作者以及其它类别资讯，方便众多乐曲的管理。缺少ID3标签并不会影响 MP3的播放，但若没有的话，管理音乐文件也会相当的麻烦。</p><h2 id="刮削效果">刮削效果</h2><h3 id="Foobar2000读取效果：">Foobar2000读取效果：</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173843.jpeg" alt=""></p><h3 id="Jellyfin读取效果：">Jellyfin读取效果：</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173846.jpeg" alt=""></p><h2 id="Mp3tag">Mp3tag</h2><blockquote><p>纯手工修改，开源工具。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011174402.png" alt="Mp3tag"></p><h2 id="Media-Go">Media Go</h2><blockquote><p>不要使用最新版！老版本才有我们最需要的功能。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011174641.png" alt="Media Go"></p><h3 id="添加媒体库">添加媒体库</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011175356.png" alt="Media Go"></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011175429.png" alt=""></p><h3 id="自动获取属性">自动获取属性</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011175852.png" alt=""></p><h3 id="歌曲属性修改">歌曲属性修改</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011175602.png" alt=""></p><h2 id="MusicBrainz">MusicBrainz</h2><blockquote><ul><li>MusicBrainz官网：<a target="_blank" rel="noopener" href="https://musicbrainz.org/">https://musicbrainz.org/</a></li><li>MusicBrainz Picard下载地址：<a target="_blank" rel="noopener" href="https://picard.musicbrainz.org/">https://picard.musicbrainz.org/</a></li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173854.jpeg" alt="MusicBrainz"><br>MusicBrainz Picard可以修改音乐的Tag标签信息，根据标签重命名文件。它的数据来源于非营利互联网音乐专辑数据库MusicBrainz项目，歌曲资源非常丰富。尤其它能根据声纹（音频指纹）识别Mp3文件进行匹配取信息，匹配率极高。不管是英文、中文歌曲，还是录音室版本、演唱会版本，都能很好地匹配出来。<br>支持MP3、FLAC、OGG、M4A、WMA、WAV等主流的音频格式，wav,ape格式不支持，需要要转换成支持的格式。<br>写入前后对比：<br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173901.jpeg" alt=""></p><p><strong>MusicBrainz Picard使用教程：</strong><br>将音乐文件/文件夹拖入左侧窗口，点上方“查询“按钮，在MusicBrainz数据库里搜索对应音乐。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173901.png" alt=""><br>如果搜索不到，点击”扫描“，使用声纹匹配，准确度更高。<br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173907.png" alt=""><br>如果以上两种方法都搜索不到，或者添加的文件名变成乱码，右击”查找相似的音轨“<br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173942.png" alt=""><br>手动输入歌曲名字，搜索，选择正确的歌曲信息，载入Picard。<br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173914.png" alt=""></p><p>右侧窗口载入专辑信息。展开列表，绿色方块的就是匹配成功的音乐。底部窗口展示文件原始标签信息和MusicBrainz网站上的信息对照。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173948.png" alt=""><br>如果匹配的不是正确的专辑信息，右击”查找相似的音轨“，选择正确的专辑信息载入Picard。<br>如果搜索出了多张专辑，可点击错误的专辑拖动到目标专辑上完成匹配，省的一个一个文件的修改。<br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173955.png" alt=""></p><p>最后点“保存”，将标签信息写入音乐文件。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011174018.png" alt=""></p><p><strong>如何重命名文件：</strong><br>菜单栏-选项-勾选“重命名文件”，保存的时候会同时写入信息+重命名。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011174002.png" alt=""><br>默认设置是：序号 歌名.mp3，适合一个专辑一个文件夹使用。<br>如果是单文件的话要去创建命名规则，选项-正在重命名文件-保存时重命名文件，填写命名规则。<br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173929.jpeg" alt=""></p><h2 id="参考：-2">参考：</h2><ul><li><a target="_blank" rel="noopener" href="http://www.92nas.com/forum.php?mod=viewthread&amp;tid=115">使用MusicBrainz Picard刮削音乐 整理音乐资料库</a></li></ul><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="music" scheme="https://blog.17lai.site/categories/music/"/>
    
    
    <category term="music" scheme="https://blog.17lai.site/tags/music/"/>
    
    <category term="刮削" scheme="https://blog.17lai.site/tags/%E5%88%AE%E5%89%8A/"/>
    
    <category term="MusicBrainz" scheme="https://blog.17lai.site/tags/MusicBrainz/"/>
    
    <category term="mp3tag" scheme="https://blog.17lai.site/tags/mp3tag/"/>
    
  </entry>
  
  <entry>
    <title>http 错误代码表</title>
    <link href="https://blog.17lai.site/posts/80906b88/"/>
    <id>https://blog.17lai.site/posts/80906b88/</id>
    <published>2021-10-06T11:25:00.000Z</published>
    <updated>2022-03-16T10:52:11.175Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>所有 HTTP 状态代码及其定义。<br>　代码&nbsp;&nbsp;指示&nbsp;&nbsp;<br>2xx&nbsp;&nbsp;成功&nbsp;&nbsp;<br>200&nbsp;&nbsp;正常；请求已完成。&nbsp;&nbsp;<br>201&nbsp;&nbsp;正常；紧接 POST 命令。&nbsp;&nbsp;<br>202&nbsp;&nbsp;正常；已接受用于处理，但处理尚未完成。&nbsp;&nbsp;<br>203&nbsp;&nbsp;正常；部分信息 — 返回的信息只是一部分。&nbsp;&nbsp;<br>204&nbsp;&nbsp;正常；无响应 — 已接收请求，但不存在要回送的信息。&nbsp;&nbsp;<br>3xx&nbsp;&nbsp;重定向&nbsp;&nbsp;<br>301&nbsp;&nbsp;已移动 — 请求的数据具有新的位置且更改是永久的。&nbsp;&nbsp;<br>302&nbsp;&nbsp;已找到 — 请求的数据临时具有不同 URI。&nbsp;&nbsp;<br>303&nbsp;&nbsp;请参阅其它 — 可在另一 URI 下找到对请求的响应，且应使用 GET 方法检索此响应。&nbsp;&nbsp;<br>304&nbsp;&nbsp;未修改 — 未按预期修改文档。&nbsp;&nbsp;<br>305&nbsp;&nbsp;使用代理 — 必须通过位置字段中提供的代理来访问请求的资源。&nbsp;&nbsp;<br>306&nbsp;&nbsp;未使用 — 不再使用；保留此代码以便将来使用。&nbsp;&nbsp;<br>4xx&nbsp;&nbsp;客户机中出现的错误&nbsp;&nbsp;<br>400&nbsp;&nbsp;错误请求 — 请求中有语法问题，或不能满足请求。&nbsp;&nbsp;<br>401&nbsp;&nbsp;未授权 — 未授权客户机访问数据。&nbsp;&nbsp;<br>402&nbsp;&nbsp;需要付款 — 表示计费系统已有效。&nbsp;&nbsp;<br>403&nbsp;&nbsp;禁止 — 即使有授权也不需要访问。&nbsp;&nbsp;<br>404&nbsp;&nbsp;找不到 — 服务器找不到给定的资源；文档不存在。&nbsp;&nbsp;<br>407&nbsp;&nbsp;代理认证请求 — 客户机首先必须使用代理认证自身。&nbsp;&nbsp;<br>415&nbsp;&nbsp;介质类型不受支持 — 服务器拒绝服务请求，因为不支持请求实体的格式。&nbsp;&nbsp;<br>5xx&nbsp;&nbsp;服务器中出现的错误&nbsp;&nbsp;<br>500&nbsp;&nbsp;内部错误 — 因为意外情况，服务器不能完成请求。&nbsp;&nbsp;<br>501&nbsp;&nbsp;未执行 — 服务器不支持请求的工具。&nbsp;&nbsp;<br>502&nbsp;&nbsp;错误网关 — 服务器接收到来自上游服务器的无效响应。&nbsp;&nbsp;<br>503&nbsp;&nbsp;无法获得服务 — 由于临时过载或维护，服务器无法处理请求。</p><hr><p>HTTP&nbsp;400&nbsp;-&nbsp;请求无效&nbsp;<br>HTTP&nbsp;401.1&nbsp;-&nbsp;未授权：登录失败&nbsp;<br>HTTP&nbsp;401.2&nbsp;-&nbsp;未授权：服务器配置问题导致登录失败&nbsp;<br>HTTP&nbsp;401.3&nbsp;-&nbsp;ACL&nbsp;禁止访问资源&nbsp;<br>HTTP&nbsp;401.4&nbsp;-&nbsp;未授权：授权被筛选器拒绝&nbsp;<br>HTTP&nbsp;401.5&nbsp;-&nbsp;未授权：ISAPI&nbsp;或&nbsp;CGI&nbsp;授权失败&nbsp;&nbsp;<br>HTTP&nbsp;403&nbsp;-&nbsp;禁止访问&nbsp;<br>HTTP&nbsp;403&nbsp;-&nbsp;对&nbsp;Internet&nbsp;服务管理器&nbsp;(HTML)&nbsp;的访问仅限于&nbsp;Localhost&nbsp;<br>HTTP&nbsp;403.1&nbsp;禁止访问：禁止可执行访问&nbsp;<br>HTTP&nbsp;403.2&nbsp;-&nbsp;禁止访问：禁止读访问&nbsp;<br>HTTP&nbsp;403.3&nbsp;-&nbsp;禁止访问：禁止写访问&nbsp;<br>HTTP&nbsp;403.4&nbsp;-&nbsp;禁止访问：要求&nbsp;SSL&nbsp;<br>HTTP&nbsp;403.5&nbsp;-&nbsp;禁止访问：要求&nbsp;SSL&nbsp;128&nbsp;<br>HTTP&nbsp;403.6&nbsp;-&nbsp;禁止访问：IP&nbsp;地址被拒绝&nbsp;<br>HTTP&nbsp;403.7&nbsp;-&nbsp;禁止访问：要求客户证书&nbsp;<br>HTTP&nbsp;403.8&nbsp;-&nbsp;禁止访问：禁止站点访问&nbsp;<br>HTTP&nbsp;403.9&nbsp;-&nbsp;禁止访问：连接的用户过多&nbsp;<br>HTTP&nbsp;403.10&nbsp;-&nbsp;禁止访问：配置无效&nbsp;<br>HTTP&nbsp;403.11&nbsp;-&nbsp;禁止访问：密码更改&nbsp;<br>HTTP&nbsp;403.12&nbsp;-&nbsp;禁止访问：映射器拒绝访问&nbsp;<br>HTTP&nbsp;403.13&nbsp;-&nbsp;禁止访问：客户证书已被吊销&nbsp;<br>HTTP&nbsp;403.15&nbsp;-&nbsp;禁止访问：客户访问许可过多&nbsp;<br>HTTP&nbsp;403.16&nbsp;-&nbsp;禁止访问：客户证书不可信或者无效&nbsp;<br>HTTP&nbsp;403.17&nbsp;-&nbsp;禁止访问：客户证书已经到期或者尚未生效&nbsp;<br>HTTP&nbsp;404.1&nbsp;-&nbsp;无法找到&nbsp;Web&nbsp;站点&nbsp;<br>HTTP&nbsp;404&nbsp;-&nbsp;无法找到文件&nbsp;<br>HTTP&nbsp;405&nbsp;-&nbsp;资源被禁止&nbsp;<br>HTTP&nbsp;406&nbsp;-&nbsp;无法接受&nbsp;<br>HTTP&nbsp;407&nbsp;-&nbsp;要求代理身份验证&nbsp;<br>HTTP&nbsp;410&nbsp;-&nbsp;永远不可用&nbsp;<br>HTTP&nbsp;412&nbsp;-&nbsp;先决条件失败&nbsp;<br>HTTP&nbsp;414&nbsp;-&nbsp;请求&nbsp;-&nbsp;URI&nbsp;太长&nbsp;<br>HTTP&nbsp;500&nbsp;-&nbsp;内部服务器错误&nbsp;<br>HTTP&nbsp;500.100&nbsp;-&nbsp;内部服务器错误&nbsp;-&nbsp;ASP&nbsp;错误&nbsp;<br>HTTP&nbsp;500-11&nbsp;服务器关闭&nbsp;<br>HTTP&nbsp;500-12&nbsp;应用程序重新启动&nbsp;<br>HTTP&nbsp;500-13&nbsp;-&nbsp;服务器太忙&nbsp;<br>HTTP&nbsp;500-14&nbsp;-&nbsp;应用程序无效&nbsp;<br>HTTP&nbsp;500-15&nbsp;-&nbsp;不允许请求&nbsp;global.asa&nbsp;<br>Error&nbsp;501&nbsp;-&nbsp;未实现&nbsp;<br>HTTP&nbsp;502&nbsp;-&nbsp;网关错误</p><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="web" scheme="https://blog.17lai.site/categories/web/"/>
    
    
    <category term="web" scheme="https://blog.17lai.site/tags/web/"/>
    
    <category term="http" scheme="https://blog.17lai.site/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>解决Thinkpad笔记本喇叭破音问题！</title>
    <link href="https://blog.17lai.site/posts/c945eae1/"/>
    <id>https://blog.17lai.site/posts/c945eae1/</id>
    <published>2021-10-05T01:25:00.000Z</published>
    <updated>2022-03-16T12:29:06.658Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="问题">问题</h2><p>主力笔记本笔记本播放音乐再次出现破音，换了几首音乐后问题依旧，前后对比强烈。</p><h2 id="分析">分析</h2><p>从几年前上一次维修经验来看，应该是喇叭老化破裂了！拆机查看，发现的确事喇叭破裂。</p><h2 id="解决方案">解决方案</h2><p>如是，网购了一个新喇叭，拆机，换上，完美解决问题！</p><p>喇叭施压后，能明显看到断裂痕迹。这样的喇叭音色就会出现明显的破音！如下图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/0520211005175831.jpg" alt="喇叭破裂施压图"></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/0520211005175843.jpg" alt="喇叭破裂未施压图"></p><blockquote><p>这已经是这台笔记本第二次出现喇叭破裂问题了！  感觉喇叭材料或者工艺有问题。</p><p>型号：Thinkpad T4X0S</p></blockquote><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="notebook" scheme="https://blog.17lai.site/categories/notebook/"/>
    
    
    <category term="thinkpad" scheme="https://blog.17lai.site/tags/thinkpad/"/>
    
    <category term="sound" scheme="https://blog.17lai.site/tags/sound/"/>
    
    <category term="speaker" scheme="https://blog.17lai.site/tags/speaker/"/>
    
  </entry>
  
  <entry>
    <title>从文学的角度，分析韩红的《天亮了》</title>
    <link href="https://blog.17lai.site/posts/cb623532/"/>
    <id>https://blog.17lai.site/posts/cb623532/</id>
    <published>2021-10-02T16:25:00.000Z</published>
    <updated>2022-03-16T10:52:11.024Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="现场MV">现场MV</h2><style>.bbplayer{width: 100%; max-width: 850px; margin: auto}</style><div class="bbplayer"><iframe class="bbplayer" id="mmedia-cUziebaqpUcPFSmC" src="https://player.bilibili.com/player.html?bvid=BV1B7411p7aD&amp;page=1&amp;high_quality=1&amp;danmaku=true" allowfullscreen="allowfullscreen" scrolling="no" border="0" frameborder="0" framespacing="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts allow-popups"></iframe></div><script> document.getElementById("mmedia-cUziebaqpUcPFSmC").style.height=document.getElementById("mmedia-cUziebaqpUcPFSmC").scrollWidth*0.76+"px";    window.onresize = function(){      document.getElementById("mmedia-cUziebaqpUcPFSmC").style.height=document.getElementById("mmedia-cUziebaqpUcPFSmC").scrollWidth*0.76+"px";    }; </script><blockquote><p>精品分析： 原作：石晶兰 <a target="_blank" rel="noopener" href="https://tieba.baidu.com/p/5313070309?red_tag=2537504175">短文吧</a></p><p>再做个传送门： <a target="_blank" rel="noopener" href="https://www.baidu.com/s?ie=UTF-8&amp;wd=%E9%9F%A9%E7%BA%A2%20%E5%A4%A9%E4%BA%AE%E4%BA%86">天亮了</a>，听歌时，关灯，准备纸巾。</p></blockquote><h2 id="先分析结构。">先分析结构。</h2><p>看歌词。</p><p>那是一个秋天，风儿那么缠绵，<br>让我想起他们那双无助的眼。<br>就在那美丽风景相伴的地方，<br>我听到一声巨响震彻山谷。<br>就是那个秋天，再看不到爸爸的脸。<br>他用他的双肩，托起我重生的起点。<br>黑暗中泪水沾满了双眼，<br>不要离开不要伤害。</p><p>共八行，等于两个四行。<br>两个四行一一对应，前三行，旋律基本是相同的。只有最后一行，为了与后面衔接，所以不同。<br>两个四行的布置，等于是一种重复。<br>这样的重要，在文学结构上，常见于起承。<br>但歌，相当于诗。囿于篇幅，在结构上，通常会有所缺失。起承两者，一般缺失的，都是起。那样的做法，也就是直接叙事，存在让受众猝不及防的弊病。<br>然后，《天亮了》并不是。<br>“那是一个秋天，风儿那么缠绵”和“就是那个秋天”分明是起。<br>所以，《天亮了》并没有进行文学结构上的省略。<br>“那是一个秋天，风儿那么缠绵”是起，接紧着的三行歌词，自然就是承了。<br>那么，第五行“就是那个秋天”怎么又来一个起呢？<br>自然是因为篇幅太短，叙事不够（前面承得不够），所以，还需要再承一下。<br>不能够不要第五行的起，直接往下写吗？<br>真要说的话，其实也能。不过，再加四行承，真的就能把事情说清楚吗？<br>显然，韩红想要表达的东西很多，她认为，不能。<br>仅靠精练语言，明显是不够的，还需要换角度陈述。<br>第五行的再起，实际上，就是为后面的换角度承，打基础的。<br>这种写法，也是有先例的。请看邓丽君《相见在明天》歌词：<br>记得我俩初相见，<br>风吹花儿飞满天。<br>你说我的笑容像花朵，<br>比那花儿更娇艳。<br>我还记得那一天，<br>送你送到小河边。<br>手牵着手呀心里有千言，<br>相对却无言。<br>跟《天亮了》一样，《相见在明天》也是两个四行，也是起承起承。<br>并且，两起两承，还跟诗词的押韵一样，其重复，不仅有加深印象的作用，更有共鸣回旋的作用，正是唐陈子昂所说的“音情顿挫”的顿挫，极大的提升了作品的美感，让受众的接受度大大提高，</p><h2 id="继续看《天亮了》歌词：">继续看《天亮了》歌词：</h2><p>我看到爸爸妈妈就这么走远，<br>留下我在这陌生的人世间。<br>不知道未来还会有什么风险。<br>我想要紧紧抓住他的手。<br>妈妈告诉我希望还会有。<br>看到太阳出来妈妈笑了。<br>天亮了。</p><p>六行都是转。具体在这里，自然不是转折，而是高那个潮。</p><p>此处值得一说的是合，只有三个字“天亮了”。<br>这三个字，正好也是这首歌的歌名。<br>但是这三个字表达的，到底是什么意思、什么情感呢？</p><p>题都城南庄/唐/崔护<br>去年今日此门中，人面桃花相映红。<br>人面不知何处去，桃花依旧笑春风。</p><p>不难看出，最后一句“桃花依旧笑春风”跟前面三句的叙述，是接不上的。<br>去年这儿，有人面有桃花。今年这儿人面没有了，接下来说的通常是：还真是让人怀念啊。<br>俗吗？的确俗。并且，还不仅仅是俗，还存在因为什么而怀念那个姑娘的严重问题。<br>动机不纯的话，写出来就会玷污那个姑娘。动机纯粹，只是单纯的对美好事物的欣赏，写出来的话，又有自夸之嫌。<br>还真是不好写啊。<br>不好写，干脆就不写，另起一笔：“桃花依旧笑春风”。究竟表达的是什么样的滋味，让受众自己去想。</p><p>《天亮了》末尾的合“天亮了”，就是“桃花依旧笑春风”这种表现手法。太多的感情，千言万语，加总在一起，实在难以挽上疙瘩。于是，就另起一行，来了句看似关系不大的“天亮了”，让一切，尽在无言中。<br>不同的受众，会有不同的感受。因而这种让受众自己去想的结尾，总是余味无穷。</p><p>文学结构分析，就到这儿。第二段的结构跟第一段相同，就不讲了。</p><h2 id="下面进行逐句评讲。">下面进行逐句评讲。</h2><p>“那是一个秋天，风儿那么缠绵，”没毛病。“那是”开头，虽然不出彩，但是很自然，容易被人接受，接着往下听。<br>“让我想起他们那双无助的眼。”这里，“他们”是两个人；“那双”眼睛虽然是复数，但落实到人，却是单数。因此，这是一个小错误。<br>很显然，用相同性质的词语直接替换是不行的，譬如“四只”。四，数量较多，会分散受众的注意力，让受众去思考为什么是四。因而，如果硬要改的话，只能用其它性质的词语去替换，譬如“彷徨”。<br>但“彷徨无助”，又稍显生僻，会影响听者的接受速度，形成不怎么大的接受障碍。而如果也用“无”的话，无什么呢？无神？听上去，岂不是比“彷徨无助”更不容易分辨。<br>所以，实在要改，就只能把“他们”二字挪到这儿。<br>那样一来，“让我想起”就要掺进两个水字了，譬如“风儿让我想起”。<br>是不是太水了？<br>于是，我最终感觉，还是不改为好。<br>小错误嘛，存在也无妨。这就像文豪写书法一样，多一点少一点，多一笔少一笑，根本不算错误，关键是，那个字不能被错认为是别的字。<br>“那双无助的眼”也一样，虽然存在小错误，但由于不影响表达内容，听者一听，就知道是怎么回事。由于没有影响信息传递，所以不改也是行的。</p><p>“就在那美丽风景相伴的地方，我听到一声巨响震彻山谷。”这两小句，没有基础毛病。<br>值得注意的是，这两小句，存在一个对比：一个美丽的地方，一件悲惨的事。颇有一种把美好的事情撕烂了给读者看的悲剧色彩。</p><p>“就是那个秋天，再看不到爸爸的脸。”<br>为什么提到爸爸没提到妈妈？爸爸妈妈，可以一起提，也可以先后提。这里，实际上是先后提。先提爸爸，后面会提到妈妈。<br>先提爸爸，又比先提妈妈要好。这是因为，时至今日，最不令人怀疑的，是父女情。虽然背景事件中，那是个儿子，但韩红是女的，唱出来的声音又带有明显的女性特征。女声，提到爸爸，无形中，就相当于女儿提到爸爸。其中的感情，就往父女情的方向靠近了那么一点，让听者一下就能接受，丝毫没有怀疑。<br>“他用他的双肩，托起我重生的起点。”<br>背景事件的具体经过，可能生还的当事人都已经记不清楚了。这一句，属于带有归纳性、比拟性的描述。因而不需要因为“用”“双肩托起”，去询问是不是父亲从洪水中救起了儿子那样的细节。<br>“黑暗中泪水沾满了双眼，”<br>“黑暗中”很妙。只描述了环境，没有指明时间。那其实表达的是，若干个“黑暗中”。包括当时，也包括事后。并且，“黑暗”有天然的，也有人为的。天然的，譬如天黑加停电；人为的，譬如钻进被窝里。这些，都被包括了进去。<br>“不要离开、不要伤害。”这句，就有些难度了。<br>“不要离开”好理解。可以是儿子对父母的呼唤。但“不要伤害”呢？<br>“不要伤害”，到底是谁对谁发出的呐喊，后面再讲。</p><p>“我看到爸爸妈妈就这么走远，留下我在这陌生的人世间。不知道未来还会有什么风险。”<br>三小句，基础上没毛病。直接看上去，字面意思表达能力似乎稍弱。真是不是，后面再说。<br>“我想要紧紧抓住他的手”中的“他”，指父亲，也可以指母亲。<br>“妈妈告诉我希望还会有。看到太阳出来妈妈笑了。”这是绝望中的回忆。这一家人，以前也是经受过苦难的。在曾经难熬的岁月中，妈妈曾经多次鼓励过儿子。鼓励的时候，有直述“告诉我希望还会有”，也有以身作则“看到太阳出来，妈妈笑了”。</p><p>“天亮了。”尽在不言中，就不再讲了。</p><p>“这是一个夜晚天上宿星点点，我在梦里看见我的妈妈。”<br>继“那是”之后，此处出现了“这是”。表示已经是事后，灾难之后。<br>“一个人在世上要学会坚强”，很明显，这不是儿子对父母能够说出的话。<br>结合前一小句“我在梦里看见我的妈妈”，可以发现，这是妈妈对儿子说的话。并且还是死去之后的妈妈对儿子所说的话。<br>“我在梦里看见我的妈妈。一个人在世上要学会坚强”紧接着的两句，主语变了。前一句是“我”，后一句是“妈妈”。同时，又因为死去的人继续说话这一违反科学常理的设定，使得后一句主语“妈妈”变得有些难以理解。<br>其实，受众的心，也是强大的。多听两遍，也还是能够理解的。<br>这两句主语的变化，从玄学的角度看，简单。但从文学的角度看，跳跃就非常大了。</p><p>唐/李白有句：“千里江陵一日还”。“千里江陵”说的是千里之外的江陵。站在什么地方能够说出此话，自然是白帝城。“还”，指回来，站在什么地方能够说“还”，当然只能是江陵。就这么一句，视角就从白帝城跳到了江陵。<br>《天亮了》中，这两句紧挨着的歌词的主语跳跃，其实跟“千里江陵一日还”的视角跳跃，是相似的类型。</p><p>“你不要离开不要伤害”上一段出现过，就不讲了。</p><p>“我看到爸爸妈妈就这么走远，留下我在这陌生的人世间。我愿为他建造一个美丽的花园。”<br>比较上一段，区别的，是第三小句。此处的第三小句，从陈述中跳脱出来了，相当于插入了一个事后的心愿。</p><p>“我想要紧紧抓住他的手。妈妈告诉我希望还会有，看到太阳出来、天亮了。”<br>比较上一段，区别的仍然是第三小句。“妈妈笑了”变成“天亮了”。但此处的“天亮了”，跟前面不一样，并不是起承转合的合，不是收尾，而就是一个简单的陈述，其实质，就相当于“妈妈笑了”。</p><p>“我看到爸爸妈妈就这么走远，留下我在这陌生的人世间。我愿为他建造一个美丽的花园。<br>“我想要紧紧抓住他的手。妈妈告诉我希望还会有。看到太阳出来，他们笑了。”<br>重复，强调，加倍。略有不同的，就是“妈妈笑了”变成“他们笑了”。由“妈妈”变成“他们”，实际上也在告诉受众，马上就要收尾了。<br>以什么收尾，收到哪里呢？依然还是“天亮了”，尽在不言中，让受众自己去想，</p><p>不知道是哪年哪天了，无意中，我就这么偶然听到了这首歌。<br>一听，就感受很好听。<br>一听，就听出来了，里面讲述了一场事故。因为有“我听到一声巨响震彻山谷”、“再看不到爸爸的脸”。<br>另外，还听出了事故中，父母对孩子的救助。因为有“他用他的双肩托起我重生的起点”。<br>很明显，事故是悲惨的，事故中的父母是可歌可泣的，事故之后的儿子或女儿（从歌词中听不出孩子的性别）是可怜的。<br>但是，就这么算了么？<br>这么好听的歌，最后一句“天亮了”到底表述的是怎样的感情？<br>没弄清楚，怎么能算完。</p><p>生活中，有各种各样的事故。最常见的，恐怕应该是车祸。<br>车祸事故，几乎每天都能够在地方新闻上看到。<br>看到车祸事故的新闻，心中有什么感受？<br>悲伤么？自然没有。<br>一般来说，亲人，才会悲伤。陌生人，通常只是略带同情、怜悯。<br>此处说的是，同样的事，因为自身角度的不同，感受大不相同。<br>那么，《天亮了》应该站在什么样的角度去欣赏呢？</p><p>最容易想到的角度，有两个。<br>一是生还的儿子或女儿。但是，站在这个角度欣赏，“我看到爸爸妈妈就这么走远，留下我在这陌生的人世间，不知道未来还会有什么风险。”真的弱爆了。<br>另一个角度，则是富有同情心的旁观善良人士。这个角度的存在，是因为韩红。因为，就这么看过去，韩红，对于此次事故，似乎就是富有同情心的旁观善良人士。<br>但这个角度还是不行。“黑暗中泪水沾满了双眼”，没什么感觉。<br>于是乎，就剩下了不常见的角度——死去父母的角度！<br>我试着想象了这样的角度，再听《天亮了》，眼泪一下子就出来了。<br>我是在这之后，才搜索得知了《天亮了》的创作背景。</p><p>是的，韩红，把自己当作那个孩子的父母，并且还把自己当作了孩子死去的父母。《天亮了》这首歌，表达的是死者对生者的寄托！<br>重新再看歌词。“黑暗中泪水沾满了双眼”，所指的，就不仅仅是事后孩子多次在被窝里痛哭，并且还指死去的父母在地狱中带泪含悲。<br>“不要离开”，只是孩子对父母的呼唤么？已然不是。以父母为参照物，生存的孩子，又何尝不是一种离开。<br>当然不是说想要孩子一起死，否则就不会用双肩托起重生的起点了。<br>“不要伤害”的答案，此时就出来了。那就是死去的父母发出的呐喊。呐喊的对象是天地——老天爷，不要伤害我们的孩子！<br>“一个人在世上要学会坚强”不再是父母对自己的叮嘱，而是自己，对自己幸存的子女的叮嘱。<br>于是乎，最后一句合中的“天亮了”，就表达了深深的无奈。<br>天亮了，通常指清晨，代表的是希望。但是，对于死者来说，天亮了，就代表魂魄状态的死者必须离开。<br>这是自然规律，死者必须离开。不想离开，也必须离开。因为——天亮了。<br>难怪韩红唱这三个字的时候，泣不成声。</p><p>题外话又冒出来了。<br>我曾经进行过无数次评论。有那么一个人，曾经对于我的少部分评论非常不服。那就是，关于李白的诗的评论。<br>他认为，一件事物，可以从好坏两方面去说。他认为，李白的诗，就像打油诗，水平并不高。只是因为我的评论，才变得水平绝高了。<br>具体的说法就是，我先假定李诗水平绝高，然后往去往绝高的方向分析。<br>我的确也是这样做的。<br>但是，别人的诗，也可以假定为水平绝高啊，难道说真的就能分析出水平绝高来吗？<br>譬如杜甫的“三顾频烦天下计”。“顾频烦”三字的“页”旁，看不见吗？不擅书法，才会视而不见，所以杜甫不擅书法。是“频烦天下计”么？明明就只烦了一次。次数相对较多的，反而是“顾”，顾了三次。于是这句应该读成“三顾频、烦天下计”。这水平还怎么绝高呢？<br>相似的例子还有很多。无论是谁的作品，都能事先假定为水平绝高。但只有李白的诗，才会真的分析出水平绝高的答案出来。<br>所以，李诗的水平，是真的绝高。</p><p>这番题外话，表达的是，前面关于《天亮了》的评论，或许韩红自己并没那么想，或者韩红没想那么多，或许《天亮了》就仅仅是韩红的偶然之得。<br>我要说的是，《天亮了》既然已经成为作品，那么它就脱离了作者韩红，变成了一种独立的存在。不能因为韩红的文学水平不够高，而去否认《天亮了》的文学成就。<br>我的确是抱着欣赏的态度，先假定《天亮了》文学水平很高，然后真往极高文学水平的方向去分析的。但是很幸运，我得出了《天亮了》文学水平果然很高的结论。<br>换首别的歌，行吗？<br>谁说行，谁上。</p><p>最后，我还要说的是，文学水平，所指的，并不仅仅是文字方面的能力。<br>在打基础的时候，在斟酌字词句，在训练表达力、说服力的阶段，的确单指文字方面。<br>但是，在跨入感染力阶段之后，就不是了。<br>更多的，是提高心性。<br>心性高了，视角就不同了，感受也随之不同了，不管是写出来的作品，还是唱出来的歌，那都是不同的。<br>很多人说邓丽君的演唱水平并不高，那是不对的。应该说，邓丽君的演唱水平，其实很多人都达到过。个别的，譬如韩红，偶尔还超越过。<br>但是，为什么邓丽君流传下来的歌曲就那么多呢？其他歌者流传下来的歌就那么少呢？<br>就是因为心性。<br>心性与感染力关系，最容易明白的例子，就是翻唱。<br>《何日君在来》、《船歌》在邓丽君翻唱之前，并不好听，结果邓丽君一唱，就化腐朽为神奇了。<br>恰好，韩红也有过化腐朽为神奇的表现，譬如《妹妹找哥泪花流》、《天之大》（可搜）。<br>心性如此之高的韩红，偶得《天亮了》极高文学水准的作品，就是正常的了。</p><p>（全文完）</p><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="music" scheme="https://blog.17lai.site/categories/music/"/>
    
    
    <category term="music" scheme="https://blog.17lai.site/tags/music/"/>
    
    <category term="韩红" scheme="https://blog.17lai.site/tags/%E9%9F%A9%E7%BA%A2/"/>
    
  </entry>
  
  <entry>
    <title>1.5 万字 CSS 基础拾遗（核心知识、常见需求）</title>
    <link href="https://blog.17lai.site/posts/448f849b/"/>
    <id>https://blog.17lai.site/posts/448f849b/</id>
    <published>2021-09-15T11:25:00.000Z</published>
    <updated>2022-03-16T12:29:06.527Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="1-5-万字-CSS-基础拾遗（核心知识、常见需求）">1.5 万字 CSS 基础拾遗（核心知识、常见需求）</h2><p>本篇文章围绕了 CSS 的核心知识点和项目中常见的需求来展开。虽然行文偏长，但偏基础，适合初级中级前端阅读，阅读的时候请适当跳过已经掌握的部分。</p><p>这篇文章断断续续写了比较久，也参考了许多优秀的文章，但或许文章里还是存在不好或不对的地方，请多多指教，可以评论里直接提出来哈。</p><p>小tip：后续内容更精彩哦。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912192327.png" alt=""></p><h2 id="核心概念和知识点">核心概念和知识点</h2><h3 id="语法">语法</h3><p>CSS 的核心功能是将 CSS 属性设定为特定的值。一个属性与值的键值对被称为<strong>声明</strong>（declaration）。</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>而如果将一个或者多个声明用 <code>{}</code> 包裹起来后，那就组成了一个<strong>声明块</strong>（declaration block）。</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token punctuation">{</span>      <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>      <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>声明块如果需要作用到对应的 HTML 元素，那还需要加上<strong>选择器</strong>。选择器和声明块组成了<strong>CSS 规则集</strong>（CSS ruleset），常简称为 CSS 规则。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914005346.png" alt=""></p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">span</span> <span class="token punctuation">{</span>      <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>      <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>“</p><p>规则集中最后一条声明可以省略分号，但是并不建议这么做，因为容易出错。</p></blockquote><p>CSS 中的<strong>注释</strong>：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* 单行注释 */</span><span class="token comment">/*      多行      注释  */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 CSS 文件中，除了注释、CSS 规则集以及 @规则 外，定义的一些别的东西都将被浏览器忽略。</p><h3 id="规则">@规则</h3><p>CSS 规则是样式表的主体，通常样式表会包括大量的规则列表。但有时候也需要在样式表中包括其他的一些信息，比如字符集，导入其它的外部样式表，字体等，这些需要专门的语句表示。</p><p>而 @规则 就是这样的语句。CSS 里包含了以下 @规则：</p><ul><li><p>@namespace 告诉 CSS 引擎必须考虑XML命名空间。</p></li><li><p>@media, 如果满足媒体查询的条件则条件规则组里的规则生效。</p></li><li><p>@page, 描述打印文档时布局的变化.</p></li><li><p>@font-face, 描述将下载的外部的字体。</p></li><li><p>@keyframes, 描述 CSS 动画的关键帧。</p></li><li><p>@document, 如果文档样式表满足给定条件则条件规则组里的规则生效。 (推延至 CSS Level 4 规范)</p></li></ul><p>除了以上这几个之外，下面还将对几个比较生涩的 @规则 进行介绍。</p><h4 id="charset">@charset</h4><p>@charset[1] 用于定义样式表使用的字符集。它必须是样式表中的第一个元素。如果有多个 <code>@charset</code> 被声明，只有第一个会被使用，而且不能在HTML元素或HTML页面的 <code>&lt;style&gt;</code> 元素内使用。</p><p>注意：值必须是双引号包裹，且和</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token atrule"><span class="token rule">@charset</span> <span class="token string">"UTF-8"</span><span class="token punctuation">;</span></span>  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>平时写样式文件都没写 @charset 规则，那这个 CSS 文件到底是用的什么字符编码的呢？</p><p>某个样式表文件到底用的是什么字符编码，浏览器有一套识别顺序（优先级由高到低）：</p><ul><li><p>文件开头的 Byte order mark[2] 字符值，不过一般编辑器并不能看到文件头里的 BOM 值；</p></li><li><p>HTTP 响应头里的 <code>content-type</code> 字段包含的 <code>charset</code> 所指定的值，比如：</p><p><code>Content-Type: text/css; charset=utf-8  </code><br>`</p></li><li><p>CSS 文件头里定义的 @charset 规则里指定的字符编码；</p></li><li><p><code>&lt;link&gt;</code> 标签里的 charset 属性，该条已在 HTML5 中废除；</p></li><li><p>默认是 <code>UTF-8</code>。</p></li></ul><h4 id="import">@import</h4><p>@import[3] 用于告诉 CSS 引擎引入一个外部样式表。</p><p>link 和 @import 都能导入一个样式文件，它们有什么区别嘛？</p><ul><li><p>link 是 HTML 标签，除了能导入 CSS 外，还能导入别的资源，比如图片、脚本和字体等；而 @import 是 CSS 的语法，只能用来导入 CSS；</p></li><li><p>link 导入的样式会在页面加载时同时加载，@import 导入的样式需等页面加载完成后再加载；</p></li><li><p>link 没有兼容性问题，@import 不兼容 ie5 以下；</p></li><li><p>link 可以通过 JS 操作 DOM 动态引入样式表改变样式，而@import不可以。</p></li></ul><h4 id="supports">@supports</h4><p>@supports[4] 用于查询特定的 CSS 是否生效，可以结合 not、and 和 or 操作符进行后续的操作。</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* 如果支持自定义属性，则把 body 颜色设置为变量 varName 指定的颜色 */</span>  <span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">--foo</span><span class="token punctuation">:</span> green<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>      <span class="token selector">body</span> <span class="token punctuation">{</span>          <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--varName<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="层叠性">层叠性</h3><p>层叠样式表，这里的层叠怎么理解呢？其实它是 CSS 中的核心特性之一，用于合并来自多个源的属性值的算法。比如说针对某个 HTML 标签，有许多的 CSS 声明都能作用到的时候，那最后谁应该起作用呢？层叠性说的大概就是这个。</p><p>针对不同源的样式，将按照如下的顺序进行层叠，越往下优先级越高：</p><ul><li><p>用户代理样式表中的声明(例如，浏览器的默认样式，在没有设置其他样式时使用)。</p></li><li><p>用户样式表中的常规声明(由用户设置的自定义样式。由于 Chrome 在很早的时候就放弃了用户样式表的功能，所以这里将不再考虑它的排序。)。</p></li><li><p>作者样式表中的常规声明(这些是我们 Web 开发人员设置的样式)。</p></li><li><p>作者样式表中的 !important 声明。</p></li><li><p>用户样式表中的 !important 声明S。</p></li></ul><p>理解层叠性的时候需要结合 CSS 选择器的优先级以及继承性来理解。比如针对同一个选择器，定义在后面的声明会覆盖前面的；作者定义的样式会比默认继承的样式优先级更高。</p><h3 id="选择器">选择器</h3><p>CSS 选择器无疑是其核心之一，对于基础选择器以及一些常用伪类必须掌握。下面列出了常用的选择器。 想要获取更多选择器的用法可以看 MDN CSS Selectors[5]。</p><h4 id="基础选择器">基础选择器</h4><ul><li><p>标签选择器：<code>h1</code></p></li><li><p>类选择器：<code>.checked</code></p></li><li><p>ID 选择器：<code>#picker</code></p></li><li><p>通配选择器：<code>*</code></p></li></ul><p><strong>属性选择器</strong></p><ul><li><p><code>[attr]</code>：指定属性的元素；</p></li><li><p><code>[attr=val]</code>：属性等于指定值的元素；</p></li><li><p><code>[attr*=val]</code>：属性包含指定值的元素；</p></li><li><p><code>[attr^=val]</code> ：属性以指定值开头的元素；</p></li><li><p><code>[attr$=val]</code>：属性以指定值结尾的元素；</p></li><li><p><code>[attr~=val]</code>：属性包含指定值(完整单词)的元素(不推荐使用)；</p></li><li><p><code>[attr|=val]</code>：属性以指定值(完整单词)开头的元素(不推荐使用)；</p></li></ul><h4 id="组合选择器">组合选择器</h4><ul><li><p>相邻兄弟选择器：<code>A + B</code></p></li><li><p>普通兄弟选择器：<code>A ~ B</code></p></li><li><p>子选择器：<code>A &gt; B</code></p></li><li><p>后代选择器：<code>A B</code></p></li></ul><h4 id="伪类">伪类</h4><p><strong>条件伪类</strong></p><ul><li><p><code>:lang()</code>：基于元素语言来匹配页面元素；</p></li><li><p><code>:dir()</code>：匹配特定文字书写方向的元素；</p></li><li><p><code>:has()</code>：匹配包含指定元素的元素；</p></li><li><p><code>:is()</code>：匹配指定选择器列表里的元素；</p></li><li><p><code>:not()</code>：用来匹配不符合一组选择器的元素；</p></li></ul><p><strong>行为伪类</strong></p><ul><li><p><code>:active</code>：鼠标激活的元素；</p></li><li><p><code>:hover</code>： 鼠标悬浮的元素；</p></li><li><p><code>::selection</code>：鼠标选中的元素；</p></li></ul><p><strong>状态伪类</strong></p><ul><li><p><code>:target</code>：当前锚点的元素；</p></li><li><p><code>:link</code>：未访问的链接元素；</p></li><li><p><code>:visited</code>：已访问的链接元素；</p></li><li><p><code>:focus</code>：输入聚焦的表单元素；</p></li><li><p><code>:required</code>：输入必填的表单元素；</p></li><li><p><code>:valid</code>：输入合法的表单元素；</p></li><li><p><code>:invalid</code>：输入非法的表单元素；</p></li><li><p><code>:in-range</code>：输入范围以内的表单元素；</p></li><li><p><code>:out-of-range</code>：输入范围以外的表单元素；</p></li><li><p><code>:checked</code>：选项选中的表单元素；</p></li><li><p><code>:optional</code>：选项可选的表单元素；</p></li><li><p><code>:enabled</code>：事件启用的表单元素；</p></li><li><p><code>:disabled</code>：事件禁用的表单元素；</p></li><li><p><code>:read-only</code>：只读的表单元素；</p></li><li><p><code>:read-write</code>：可读可写的表单元素；</p></li><li><p><code>:blank</code>：输入为空的表单元素；</p></li><li><p><code>:current()</code>：浏览中的元素；</p></li><li><p><code>:past()</code>：已浏览的元素；</p></li><li><p><code>:future()</code>：未浏览的元素；</p></li></ul><p><strong>结构伪类</strong></p><ul><li><p><code>:root</code>：文档的根元素；</p></li><li><p><code>:empty</code>：无子元素的元素；</p></li><li><p><code>:first-letter</code>：元素的首字母；</p></li><li><p><code>:first-line</code>：元素的首行；</p></li><li><p><code>:nth-child(n)</code>：元素中指定顺序索引的元素；</p></li><li><p><code>:nth-last-child(n)</code>：元素中指定逆序索引的元素；；</p></li><li><p><code>:first-child</code>：元素中为首的元素；</p></li><li><p><code>:last-child</code> ：元素中为尾的元素；</p></li><li><p><code>:only-child</code>：父元素仅有该元素的元素；</p></li><li><p><code>:nth-of-type(n)</code>：标签中指定顺序索引的标签；</p></li><li><p><code>:nth-last-of-type(n)</code>：标签中指定逆序索引的标签；</p></li><li><p><code>:first-of-type</code> ：标签中为首的标签；</p></li><li><p><code>:last-of-type</code>：标签中为尾标签；</p></li><li><p><code>:only-of-type</code>：父元素仅有该标签的标签；</p></li></ul><h4 id="伪元素">伪元素</h4><ul><li><p><code>::before</code>：在元素前插入内容；</p></li><li><p><code>::after</code>：在元素后插入内容；</p></li></ul><h3 id="优先级">优先级</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912192225.png" alt=""></p><p>优先级就是分配给指定的 CSS 声明的一个权重，它由匹配的选择器中的每一种选择器类型的数值决定。为了记忆，可以把权重分成如下几个等级，数值越大的权重越高：</p><ul><li><p>10000：!important；</p></li><li><p>01000：内联样式；</p></li><li><p>00100：ID 选择器；</p></li><li><p>00010：类选择器、伪类选择器、属性选择器；</p></li><li><p>00001：元素选择器、伪元素选择器；</p></li><li><p>00000：通配选择器、后代选择器、兄弟选择器；</p></li></ul><p>可以看到内联样式（通过元素中 style 属性定义的样式）的优先级大于任何选择器；而给属性值加上 <code>!important</code> 又可以把优先级提至最高，就是因为它的优先级最高，所以需要谨慎使用它，以下有些使用注意事项：</p><ul><li><p>一定要优先考虑使用样式规则的优先级来解决问题而不是 !important；</p></li><li><p>只有在需要覆盖全站或外部 CSS 的特定页面中使用 !important；</p></li><li><p>永远不要在你的插件中使用 !important；</p></li><li><p>永远不要在全站范围的 CSS 代码中使用 !important；</p></li></ul><h3 id="继承性">继承性</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912192218.jpeg" alt=""></p><p>在 CSS 中有一个很重要的特性就是子元素会继承父元素对应属性计算后的值。比如页面根元素 html 的文本颜色默认是黑色的，页面中的所有其他元素都将继承这个颜色，当申明了如下样式后，H1 文本将变成橙色。</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>      <span class="token property">color</span><span class="token punctuation">:</span> orange<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector">h1</span> <span class="token punctuation">{</span>      <span class="token property">color</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>设想一下，如果 CSS 中不存在继承性，那么我们就需要为不同文本的标签都设置一下 color，这样一来的后果就是 CSS 的文件大小就会无限增大。</p><p>CSS 属性很多，但并不是所有的属性默认都是能继承父元素对应属性的，那哪些属性存在默认继承的行为呢？一定是那些不会影响到页面布局的属性，可以分为如下几类：</p><ul><li><p>字体相关：<code>font-family</code>、<code>font-style</code>、<code>font-size</code>、<code>font-weight</code> 等；</p></li><li><p>文本相关：<code>text-align</code>、<code>text-indent</code>、<code>text-decoration</code>、<code>text-shadow</code>、<code>letter-spacing</code>、<code>word-spacing</code>、<code>white-space</code>、<code>line-height</code>、<code>color</code> 等；</p></li><li><p>列表相关：<code>list-style</code>、<code>list-style-image</code>、<code>list-style-type</code>、<code>list-style-position</code> 等；</p></li><li><p>其他属性：<code>visibility</code>、<code>cursor</code> 等；</p></li></ul><p>对于其他默认不继承的属性也可以通过以下几个属性值来控制继承行为：</p><ul><li><p><code>inherit</code>：继承父元素对应属性的计算值；</p></li><li><p><code>initial</code>：应用该属性的默认值，比如 color 的默认值是 <code>#000</code>；</p></li><li><p><code>unset</code>：如果属性是默认可以继承的，则取 <code>inherit</code> 的效果，否则同 <code>initial</code>；</p></li><li><p><code>revert</code>：效果等同于 <code>unset</code>，兼容性差。</p></li></ul><h3 id="文档流">文档流</h3><p>在 CSS 的世界中，会把内容按照从左到右、从上到下的顺序进行排列显示。正常情况下会把页面分割成一行一行的显示，而每行又可能由多列组成，所以从视觉上看起来就是从上到下从左到右，而这就是 CSS 中的流式布局，又叫文档流。文档流就像水一样，能够自适应所在的容器，一般它有如下几个特性：</p><ul><li><p>块级元素默认会占满整行，所以多个块级盒子之间是从上到下排列的；</p></li><li><p>内联元素默认会在一行里一列一列的排布，当一行放不下的时候，会自动切换到下一行继续按照列排布；</p></li></ul><p><strong>如何脱离文档流呢？</strong></p><p>脱流文档流指节点脱流正常文档流后，在正常文档流中的其他节点将忽略该节点并填补其原先空间。文档一旦脱流，计算其父节点高度时不会将其高度纳入，脱流节点不占据空间。有两种方式可以让元素脱离文档流：浮动和定位。</p><ul><li><p>使用浮动（float）会将元素脱离文档流，移动到容器左/右侧边界或者是另一个浮动元素旁边，该浮动元素之前占用的空间将被别的元素填补，另外浮动之后所占用的区域不会和别的元素之间发生重叠；</p></li><li><p>使用绝对定位（<code>position: absolute;</code>）或者固定定位（<code>position: fixed;</code>）也会使得元素脱离文档流，且空出来的位置将自动被后续节点填补。</p></li></ul><h3 id="盒模型">盒模型</h3><p>在 CSS 中任何元素都可以看成是一个盒子，而一个盒子是由 4 部分组成的：内容（content）、内边距（padding）、边框（border）和外边距（margin）。</p><p>盒模型有 2 种：标准盒模型和 IE 盒模型，本别是由 W3C 和 IExplore 制定的标准。</p><p>如果给某个元素设置如下样式：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.box</span> <span class="token punctuation">{</span>      <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>      <span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>      <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>      <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #eee<span class="token punctuation">;</span>      <span class="token property">margin</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>标准盒模型认为：盒子的实际尺寸 = 内容（设置的宽/高） + 内边距 + 边框</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912192143.png" alt=""></p><p>所以 <code>.box</code> 元素内容的宽度就为 <code>200px</code>，而实际的宽度则是 <code>width</code> + <code>padding-left</code> + <code>padding-right</code> + <code>border-left-width</code> + <code>border-right-width</code> = 200 + 10 + 10 + 1 + 1 = 222。</p><p>IE 盒模型认为：盒子的实际尺寸 = 设置的宽/高 = 内容 + 内边距 + 边框</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912192137.png" alt=""></p><p><code>.box</code> 元素所占用的实际宽度为 <code>200px</code>，而内容的真实宽度则是 <code>width</code> - <code>padding-left</code> - <code>padding-right</code> - <code>border-left-width</code> - <code>border-right-width</code> = 200 - 10 - 10 - 1 - 1 = 178。</p><p>现在高版本的浏览器基本上默认都是使用标准盒模型，而像 IE6 这种老古董才是默认使用 IE 盒模型的。</p><p>在  CSS3 中新增了一个属性 <code>box-sizing</code>，允许开发者来指定盒子使用什么标准，它有 2 个值：</p><ul><li><p><code>content-box</code>：标准盒模型；</p></li><li><p><code>border-box</code>：IE 盒模型；</p></li></ul><h3 id="视觉格式化模型">视觉格式化模型</h3><p>视觉格式化模型（Visual formatting model）是用来处理和在视觉媒体上显示文档时使用的计算规则。CSS 中一切皆盒子，而视觉格式化模型简单来理解就是规定这些盒子应该怎么样放置到页面中去，这个模型在计算的时候会依赖到很多的因素，比如：盒子尺寸、盒子类型、定位方案（是浮动还是定位）、兄弟元素或者子元素以及一些别的因素。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912192137.jpeg" alt=""></p><p>Visual formatting model</p><p>从上图中可以看到视觉格式化模型涉及到的内容很多，有兴趣深入研究的可以结合上图看这个 W3C 的文档 Visual formatting model[6]。所以这里就简单介绍下盒子类型。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912192129.png" alt=""></p><p>盒子类型由 display 决定，同时给一个元素设置 display 后，将会决定这个盒子的 2 个显示类型（display type）：</p><ul><li><p>outer display type（对外显示）：决定了该元素本身是如何布局的，即参与何种格式化上下文；</p></li><li><p>inner display type（对内显示）：其实就相当于把该元素当成了容器，规定了其内部子元素是如何布局的，参与何种格式化上下文；</p></li></ul><h4 id="outer-display-type">outer display type</h4><p>对外显示方面，盒子类型可以分成 2 类：block-level box（块级盒子） 和 inline-level box（行内级盒子）。</p><p>依据上图可以列出都有哪些块级和行内级盒子：</p><ul><li><p>块级盒子：display 为 block、list-item、table、flex、grid、flow-root 等；</p></li><li><p>行内级盒子：display 为 inline、inline-block、inline-table 等；</p></li></ul><p>所有块级盒子都会参与 BFC，呈现垂直排列；而所有行内级盒子都参会 IFC，呈现水平排列。</p><p>除此之外，block、inline 和 inline-block 还有什么更具体的区别呢？</p><p><strong>block</strong></p><ul><li><p>占满一行，默认继承父元素的宽度；多个块元素将从上到下进行排列；</p></li><li><p>设置 width/height 将会生效；</p></li><li><p>设置 padding 和 margin 将会生效；</p></li></ul><p><strong>inline</strong></p><ul><li><p>不会占满一行，宽度随着内容而变化；多个 inline 元素将按照从左到右的顺序在一行里排列显示，如果一行显示不下，则自动换行；</p></li><li><p>设置 width/height 将不会生效；</p></li><li><p>设置竖直方向上的 padding 和 margin 将不会生效；</p></li></ul><p><strong>inline-block</strong></p><ul><li><p>是行内块元素，不单独占满一行，可以看成是能够在一行里进行左右排列的块元素；</p></li><li><p>设置 width/height 将会生效；</p></li><li><p>设置 padding 和 margin 将会生效；</p></li></ul><h4 id="inner-display-type">inner display type</h4><p>对内方面，其实就是把元素当成了容器，里面包裹着文本或者其他子元素。container box 的类型依据 display 的值不同，分为 4 种：</p><ul><li><p>block container：建立 BFC 或者 IFC；</p></li><li><p>flex container：建立 FFC；</p></li><li><p>grid container：建立 GFC;</p></li><li><p>ruby container：接触不多，不做介绍。</p></li></ul><p>值得一提的是如果把 img 这种替换元素（replaced element）申明为 block 是不会产生 container box 的，因为替换元素比如 img 设计的初衷就仅仅是通过 src 把内容替换成图片，完全没考虑过会把它当成容器。</p><p>参考：</p><ul><li><p>CSS 原理 - 你所不知道的 display[7]</p></li><li><p>格式化上下文[8]</p></li></ul><h3 id="格式化上下文">格式化上下文</h3><p>格式化上下文（Formatting Context）是 CSS2.1 规范中的一个概念，大概说的是页面中的一块渲染区域，规定了渲染区域内部的子元素是如何排版以及相互作用的。</p><p>不同类型的盒子有不同格式化上下文，大概有这 4 类：</p><ul><li><p>BFC (Block Formatting Context) 块级格式化上下文；</p></li><li><p>IFC (Inline Formatting Context) 行内格式化上下文；</p></li><li><p>FFC (Flex Formatting Context) 弹性格式化上下文；</p></li><li><p>GFC (Grid Formatting Context) 格栅格式化上下文；</p></li></ul><p>其中 BFC 和 IFC 在 CSS 中扮演着非常重要的角色，因为它们直接影响了网页布局，所以需要深入理解其原理。</p><h4 id="BFC">BFC</h4><p>块格式化上下文，它是一个独立的渲染区域，只有块级盒子参与，它规定了内部的块级盒子如何布局，并且与这个区域外部毫不相干。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912192122.png" alt=""></p><p>图来源于 yachen168</p><p><strong>BFC 渲染规则</strong></p><ul><li><p>内部的盒子会在垂直方向，一个接一个地放置；</p></li><li><p>盒子垂直方向的距离由 margin 决定，属于同一个 BFC 的两个相邻盒子的 margin 会发生重叠；</p></li><li><p>每个元素的 margin 的左边，与包含块 border 的左边相接触(对于从左往右的格式化，否则相反)，即使存在浮动也是如此；</p></li><li><p>BFC 的区域不会与 float 盒子重叠；</p></li><li><p>BFC 就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。反之也如此。</p></li><li><p>计算 BFC 的高度时，浮动元素也参与计算。</p></li></ul><p><strong>如何创建 BFC？</strong></p><ul><li><p>根元素：html</p></li><li><p>非溢出的可见元素：overflow 不为 visible</p></li><li><p>设置浮动：float 属性不为 none</p></li><li><p>设置定位：position 为 absolute 或 fixed</p></li><li><p>定义成块级的非块级元素：display: inline-block/table-cell/table-caption/flex/inline-flex/grid/inline-grid</p></li></ul><p><strong>BFC 应用场景</strong></p><p>1、 自适应两栏布局</p><p>应用原理：BFC 的区域不会和浮动区域重叠，所以就可以把侧边栏固定宽度且左浮动，而对右侧内容触发 BFC，使得它的宽度自适应该行剩余宽度。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912192107.gif" alt=""></p><pre class="line-numbers language-css" data-language="css"><code class="language-css">&lt;div class=<span class="token string">"layout"</span>&gt;      &lt;div class=<span class="token string">"aside"</span>&gt;aside&lt;/div&gt;      &lt;div class=<span class="token string">"main"</span>&gt;main&lt;/div&gt;  &lt;/div&gt;  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.aside</span> <span class="token punctuation">{</span>      <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>      <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector">.main</span> <span class="token punctuation">{</span>      &lt;!-- 触发 BFC --&gt;      <span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2、清除内部浮动</p><p>浮动造成的问题就是父元素高度坍塌，所以清除浮动需要解决的问题就是让父元素的高度恢复正常。而用     BFC 清除浮动的原理就是：计算 BFC 的高度时，浮动元素也参与计算。只要触发父元素的 BFC 即可。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912192102.png" alt=""></p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.parent</span> <span class="token punctuation">{</span>    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>3、 防止垂直 margin 合并</p><p>BFC 渲染原理之一：同一个 BFC 下的垂直 margin 会发生合并。所以如果让 2 个元素不在同一个 BFC 中即可阻止垂直 margin 合并。那如何让 2 个相邻的兄弟元素不在同一个 BFC 中呢？可以给其中一个元素外面包裹一层，然后触发其包裹层的 BFC，这样一来 2 个元素就不会在同一个 BFC 中了。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912192012.png" alt=""></p><pre class="line-numbers language-css" data-language="css"><code class="language-css">&lt;div class=<span class="token string">"layout"</span>&gt;  &lt;div class=<span class="token string">"a"</span>&gt;a&lt;/div&gt;      &lt;div class=<span class="token string">"contain-b"</span>&gt;          &lt;div class=<span class="token string">"b"</span>&gt;b&lt;/div&gt;      &lt;/div&gt;  &lt;/div&gt;  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.demo3 .a,  .demo3 .b</span> <span class="token punctuation">{</span>      <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #999<span class="token punctuation">;</span>      <span class="token property">margin</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector">.contain-b</span> <span class="token punctuation">{</span>      <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>针对以上 3 个 示例 ，可以结合这个 BFC 应用示例 配合观看更佳。</p><p>参考：CSS 原理 - Formatting Context[9]</p><h4 id="IFC">IFC</h4><p>IFC 的形成条件非常简单，块级元素中仅包含内联级别元素，需要注意的是当IFC中有块级元素插入时，会产生两个匿名块将父元素分割开来，产生两个 IFC。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912160820.png" alt=""></p><p><strong>IFC 渲染规则</strong></p><ul><li><p>子元素在水平方向上一个接一个排列，在垂直方向上将以容器顶部开始向下排列；</p></li><li><p>节点无法声明宽高，其中 margin 和 padding 在水平方向有效在垂直方向无效；</p></li><li><p>节点在垂直方向上以不同形式对齐；</p></li><li><p>能把在一行上的框都完全包含进去的一个矩形区域，被称为该行的线盒（line box）。线盒的宽度是由包含块（containing box）和与其中的浮动来决定；</p></li><li><p>IFC 中的 line box 一般左右边贴紧其包含块，但 float 元素会优先排列。</p></li><li><p>IFC 中的 line box 高度由 line-height 计算规则来确定，同个 IFC 下的多个 line box 高度可能会不同；</p></li><li><p>当内联级盒子的总宽度少于包含它们的 line box 时，其水平渲染规则由 text-align 属性值来决定；</p></li><li><p>当一个内联盒子超过父元素的宽度时，它会被分割成多盒子，这些盒子分布在多个 line box 中。如果子元素未设置强制换行的情况下，inline box 将不可被分割，将会溢出父元素。</p></li></ul><p>针对如上的 IFC 渲染规则，你是不是可以分析下下面这段代码的 IFC 环境是怎么样的呢？</p><p><code>&lt;p&gt;It can get &lt;strong&gt;very complicated&lt;/storng&gt; once you start looking into it.&lt;/p&gt;   </code></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912160815.jpeg" alt=""></p><p>对应上面这样一串 HTML 分析如下：</p><ul><li><p>p 标签是一个 block container，对内将产生一个 IFC；</p></li><li><p>由于一行没办法显示完全，所以产生了 2 个线盒（line box）；线盒的宽度就继承了 p 的宽度；高度是由里面的内联盒子的 line-height 决定；</p></li><li><p>It can get：匿名的内联盒子；</p></li><li><p>very complicated：strong 标签产生的内联盒子；</p></li><li><p>once you start：匿名的内联盒子；</p></li><li><p>looking into it.：匿名的内联盒子。</p></li></ul><p>参考：Inline formatting contexts[10]</p><p><strong>IFC 应用场景</strong></p><ul><li><p>水平居中：当一个块要在环境中水平居中时，设置其为 inline-block 则会在外层产生 IFC，通过 text-align 则可以使其水平居中。</p></li><li><p>垂直居中：创建一个 IFC，用其中一个元素撑开父元素的高度，然后设置其 vertical-align: middle，其他行内元素则可以在此父元素下垂直居中。</p></li></ul><p>偷个懒，demo 和图我就不做了。</p><h3 id="层叠上下文">层叠上下文</h3><p>在电脑显示屏幕上的显示的页面其实是一个三维的空间，水平方向是 X 轴，竖直方向是 Y 轴，而屏幕到眼睛的方向可以看成是 Z 轴。众 HTML 元素依据自己定义的属性的优先级在 Z 轴上按照一定的顺序排开，而这其实就是层叠上下文所要描述的东西。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912160813.png" alt=""></p><p>-w566</p><p>我们对层叠上下文的第一印象可能要来源于 z-index，认为它的值越大，距离屏幕观察者就越近，那么层叠等级就越高，事实确实是这样的，但层叠上下文的内容远非仅仅如此：</p><ul><li><p>z-index 能够在层叠上下文中对元素的堆叠顺序其作用是必须配合定位才可以；</p></li><li><p>除了 z-index 之外，一个元素在 Z 轴上的显示顺序还受层叠等级和层叠顺序影响；</p></li></ul><p>在看层叠等级和层叠顺序之前，我们先来看下如何产生一个层叠上下文，特定的 HTML 元素或者 CSS 属性产生层叠上下文，MDN 中给出了这么一个列表，符合以下任一条件的元素都会产生层叠上下文：</p><ul><li><p>html 文档根元素</p></li><li><p>声明 position: absolute/relative 且 z-index 值不为 auto 的元素；</p></li><li><p>声明 position: fixed/sticky 的元素；</p></li><li><p>flex 容器的子元素，且 z-index 值不为 auto；</p></li><li><p>grid 容器的子元素，且 z-index 值不为 auto；</p></li><li><p>opacity 属性值小于 1 的元素；</p></li><li><p>mix-blend-mode 属性值不为 normal 的元素；</p></li><li><p>以下任意属性值不为 none 的元素：</p></li><li><p>transform</p></li><li><p>filter</p></li><li><p>perspective</p></li><li><p>clip-path</p></li><li><p>mask / mask-image / mask-border</p></li><li><p>isolation 属性值为 isolate 的元素；</p></li><li><p>-webkit-overflow-scrolling 属性值为 touch 的元素；</p></li><li><p>will-change 值设定了任一属性而该属性在 non-initial 值时会创建层叠上下文的元素；</p></li><li><p>contain 属性值为 layout、paint 或包含它们其中之一的合成值（比如 contain: strict、contain: content）的元素。</p></li></ul><p><strong>层叠等级</strong></p><p>层叠等级指节点在三维空间 Z 轴上的上下顺序。它分两种情况：</p><ul><li><p>在同一个层叠上下文中，它描述定义的是该层叠上下文中的层叠上下文元素在 Z 轴上的上下顺序；</p></li><li><p>在其他普通元素中，它描述定义的是这些普通元素在 Z 轴上的上下顺序；</p></li></ul><p>普通节点的层叠等级优先由其所在的层叠上下文决定，层叠等级的比较只有在当前层叠上下文中才有意义，脱离当前层叠上下文的比较就变得无意义了。</p><p><strong>层叠顺序</strong></p><p>在同一个层叠上下文中如果有多个元素，那么他们之间的层叠顺序是怎么样的呢？</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912160807.png" alt=""></p><p>以下这个列表越往下层叠优先级越高，视觉上的效果就是越容易被用户看到（不会被其他元素覆盖）：</p><ul><li><p>层叠上下文的 border 和 background</p></li><li><p>z-index &lt; 0 的子节点</p></li><li><p>标准流内块级非定位的子节点</p></li><li><p>浮动非定位的子节点</p></li><li><p>标准流内行内非定位的子节点</p></li><li><p>z-index: auto/0 的子节点</p></li><li><p>z-index &gt; 0的子节点</p></li></ul><p><strong>如何比较两个元素的层叠等级？</strong></p><ul><li><p>在同一个层叠上下文中，比较两个元素就是按照上图的介绍的层叠顺序进行比较。</p></li><li><p>如果不在同一个层叠上下文中的时候，那就需要比较两个元素分别所处的层叠上下文的等级。</p></li><li><p>如果两个元素都在同一个层叠上下文，且层叠顺序相同，则在 HTML 中定义越后面的层叠等级越高。</p></li></ul><p>参考：彻底搞懂CSS层叠上下文、层叠等级、层叠顺序、z-index[11]</p><h3 id="值和单位">值和单位</h3><p>CSS 的声明是由属性和值组成的，而值的类型有许多种：</p><ul><li><p>数值：长度值 ，用于指定例如元素 width、border-width、font-size 等属性的值；</p></li><li><p>百分比：可以用于指定尺寸或长度，例如取决于父容器的 width、height 或默认的 font-size；</p></li><li><p>颜色：用于指定 background-color、color 等；</p></li><li><p>坐标位置：以屏幕的左上角为坐标原点定位元素的位置，比如常见的 background-position、top、right、bottom 和 left 等属性；</p></li><li><p>函数：用于指定资源路径或背景图片的渐变，比如 url()、linear-gradient() 等；</p></li></ul><p>而还有些值是需要带单位的，比如 width: 100px，这里的 px 就是表示长度的单位，长度单位除了 px 外，比较常用的还有 em、rem、vw/vh 等。那他们有什么区别呢？又应该在什么时候使用它们呢？</p><h4 id="px">px</h4><p>屏幕分辨率是指在屏幕的横纵方向上的像素点数量，比如分辨率 1920×1080 意味着水平方向含有 1920 个像素数，垂直方向含有 1080 个像素数。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912160800.png" alt=""></p><p>而 px 表示的是 CSS 中的像素，在 CSS 中它是绝对的长度单位，也是最基础的单位，其他长度单位会自动被浏览器换算成 px。但是对于设备而言，它其实又是相对的长度单位，比如宽高都为 2px，在正常的屏幕下，其实就是 4 个像素点，而在设备像素比(devicePixelRatio) 为 2 的 Retina 屏幕下，它就有 16 个像素点。所以屏幕尺寸一致的情况下，屏幕分辨率越高，显示效果就越细腻。</p><p>讲到这里，还有一些相关的概念需要理清下：</p><p><strong>设备像素（Device pixels）</strong></p><p>设备屏幕的物理像素，表示的是屏幕的横纵有多少像素点；和屏幕分辨率是差不多的意思。</p><p><strong>设备像素比（DPR）</strong></p><p>设备像素比表示 1 个 CSS 像素等于几个物理像素。</p><p>计算公式：DPR = 物理像素数 / 逻辑像素数；</p><p>在浏览器中可以通过 window.devicePixelRatio 来获取当前屏幕的 DPR。</p><p><strong>像素密度（DPI/PPI）</strong></p><p>像素密度也叫显示密度或者屏幕密度，缩写为 DPI(Dots Per Inch) 或者 PPI(Pixel Per Inch)。从技术角度说，PPI 只存在于计算机显示领域，而 DPI 只出现于打印或印刷领域。</p><p>计算公式：像素密度 = 屏幕对角线的像素尺寸 / 物理尺寸</p><p>比如，对于分辨率为 750 * 1334 的 iPhone 6 来说，它的像素密度为：</p><p><code>Math.sqrt(750 * 750 + 1334 * 1334) / 4.7 = 326ppi   </code></p><p><strong>设备独立像素（DIP）</strong></p><p>DIP 是特别针对 Android设备而衍生出来的，原因是安卓屏幕的尺寸繁多，因此为了显示能尽量和设备无关，而提出的这个概念。它是基于屏幕密度而计算的，认为当屏幕密度是 160 的时候，px = DIP。</p><p>计算公式：dip = px * 160 / dpi</p><h4 id="em">em</h4><p>em 是 CSS 中的相对长度单位中的一个。居然是相对的，那它到底是相对的谁呢？它有 2 层意思：</p><ul><li><p>在 font-size 中使用是相对于<strong>父元素</strong>的 font-size 大小，比如父元素 font-size: 16px，当给子元素指定 font-size: 2em 的时候，经过计算后它的字体大小会是 32px；</p></li><li><p>在其他属性中使用是相对于自身的字体大小，如 width/height/padding/margin 等；</p></li></ul><p>我们都知道每个浏览器都会给 HTML 根元素 html 设置一个默认的 font-size，而这个值通常是 16px。这也就是为什么 1em = 16px 的原因所在了。</p><p>em 在计算的时候是会层层计算的，比如：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">&lt;div&gt;      &lt;p&gt;&lt;/p&gt;  &lt;/div&gt;  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">{</span> <span class="token property">font-size</span><span class="token punctuation">:</span> 2em<span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token selector">p</span> <span class="token punctuation">{</span> <span class="token property">font-size</span><span class="token punctuation">:</span> 2em<span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>对于如上一个结构的 HTML，由于根元素 html 的字体大小是 16px，所以 p 标签最终计算出来后的字体大小会是 16 * 2 * 2 = 64px</p><h4 id="rem">rem</h4><p>rem(root em) 和 em 一样，也是一个相对长度单位，不过 rem 相对的是 HTML 的根元素 html。</p><p>rem 由于是基于 html 的 font-size 来计算，所以通常用于自适应网站或者 H5 中。</p><p>比如在做 H5 的时候，前端通常会让 UI 给 750px 宽的设计图，而在开发的时候可以基于 iPhone X 的尺寸 375px * 812px 来写页面，这样一来的话，就可以用下面的 JS 依据当前页面的视口宽度自动计算出根元素 html 的基准 font-size 是多少。</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">(function (doc, win)</span> <span class="token punctuation">{</span>      <span class="token selector">var docEl = doc.documentElement,          resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',          psdWidth = 750,  // 设计图宽度          recalc = function ()</span> <span class="token punctuation">{</span>              var clientWidth = docEl.clientWidth<span class="token punctuation">;</span>              if <span class="token punctuation">(</span> !clientWidth <span class="token punctuation">)</span> return<span class="token punctuation">;</span>              <span class="token selector">if ( clientWidth &gt;= 640 )</span> <span class="token punctuation">{</span>                  docEl.style.fontSize = 200 * <span class="token punctuation">(</span> 640 / psdWidth <span class="token punctuation">)</span> + <span class="token string">'px'</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span> <span class="token selector">else</span> <span class="token punctuation">{</span>                  docEl.style.fontSize = 200 * <span class="token punctuation">(</span> clientWidth / psdWidth <span class="token punctuation">)</span> + <span class="token string">'px'</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span>          <span class="token punctuation">}</span><span class="token punctuation">;</span>    if <span class="token punctuation">(</span> !doc.addEventListener <span class="token punctuation">)</span> return<span class="token punctuation">;</span>      // 绑定事件的时候最好配合防抖函数      win.<span class="token function">addEventListener</span><span class="token punctuation">(</span> resizeEvt<span class="token punctuation">,</span> <span class="token function">debounce</span><span class="token punctuation">(</span>recalc<span class="token punctuation">,</span> 1000<span class="token punctuation">)</span><span class="token punctuation">,</span> false <span class="token punctuation">)</span><span class="token punctuation">;</span>      doc.<span class="token function">addEventListener</span><span class="token punctuation">(</span> <span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> recalc<span class="token punctuation">,</span> false <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token selector">function debounce(func, wait)</span> <span class="token punctuation">{</span>          var timeout<span class="token punctuation">;</span>          <span class="token selector">return function ()</span> <span class="token punctuation">{</span>              var context = this<span class="token punctuation">;</span>              var args = arguments<span class="token punctuation">;</span>              <span class="token selector">clearTimeout(timeout)              timeout = setTimeout(function()</span><span class="token punctuation">{</span>                  func.<span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span>              <span class="token punctuation">}</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>      <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> window<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>比如当视口是 375px 的时候，经过计算 html 的 font-size 会是 100px，这样有什么好处呢？好处就是方便写样式，比如从设计图量出来的 header 高度是 50px 的，那我们写样式的时候就可以直接写：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">header</span> <span class="token punctuation">{</span>      <span class="token property">height</span><span class="token punctuation">:</span> 0.5rem<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912160740.png" alt=""></p><p>每个从设计图量出来的尺寸只要除于 100 即可得到当前元素的 rem 值，都不用经过计算，非常方便。偷偷告诉你，如果你把上面那串计算 html 标签 font-size 的 JS 代码中的 200 替换成 2，那在计算 rem 的时候就不需要除于 100 了，从设计图量出多大 px，就直接写多少个 rem。</p><h4 id="vw-vh">vw/vh</h4><p>vw 和 vh 分别是相对于屏幕视口宽度和高度而言的长度单位：</p><ul><li><p>1vw = 视口宽度均分成 100 份中 1 份的长度；</p></li><li><p>1vh = 视口高度均分成 100 份中 1 份的长度；</p></li></ul><p>在 JS 中 100vw = window.innerWidth，100vh = window.innerHeight。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912160734.jpeg" alt=""></p><p>vw/vh 的出现使得多了一种写自适应布局的方案，开发者不再局限于 rem 了。</p><p>相对视口的单位，除了 vw/vh 外，还有 vmin 和 vmax：</p><ul><li><p>vmin：取 vw 和 vh 中值较小的；</p></li><li><p>vmax：取 vw 和 vh 中值较大的；</p></li></ul><h3 id="颜色体系">颜色体系</h3><p>CSS 中用于表示颜色的值种类繁多，足够构成一个体系，所以这里就专门拿出一个小节来讲解它。</p><p>根据 CSS 颜色草案[12] 中提到的颜色值类型，大概可以把它们分为这几类：</p><ul><li><p>颜色关键字</p></li><li><p>transparent 关键字</p></li><li><p>currentColor 关键字</p></li><li><p>RGB 颜色</p></li><li><p>HSL 颜色</p></li></ul><h4 id="颜色关键字">颜色关键字</h4><p>颜色关键字（color keywords）是不区分大小写的标识符，它表示一个具体的颜色，比如 white（白），黑（black）等；</p><p>可接受的关键字列表在CSS的演变过程中发生了改变：</p><ul><li><p>CSS 标准 1 只接受 16 个基本颜色，称为 VGA 颜色，因为它们来源于 VGA 显卡所显示的颜色集合而被称为 VGA colors （视频图形阵列色彩）。</p></li><li><p>CSS 标准 2 增加了 orange 关键字。</p></li><li><p>从一开始，浏览器接受其它的颜色，由于一些早期浏览器是 X11 应用程序，这些颜色大多数是 X11 命名的颜色列表，虽然有一点不同。SVG 1.0 是首个正式定义这些关键字的标准；CSS 色彩标准 3 也正式定义了这些关键字。它们经常被称作扩展的颜色关键字， X11 颜色或 SVG 颜色 。</p></li><li><p>CSS 颜色标准 4 添加可 rebeccapurple 关键字来纪念 web 先锋 Eric Meyer。</p></li></ul><p>如下这张图是 16 个基础色，又叫 VGA 颜色。截止到目前为止 CSS 颜色关键字总共有 146 个，这里可以查看 完整的色彩关键字列表[13]。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912160733.png" alt=""></p><p>VGA 颜色</p><p>需要注意的是如果声明的时候的颜色关键字是错误的，浏览器会忽略它。</p><h4 id="transparent-关键字">transparent 关键字</h4><p>transparent 关键字表示一个完全透明的颜色，即该颜色看上去将是背景色。从技术上说，它是带有 alpha 通道为最小值的黑色，是 rgba(0,0,0,0) 的简写。</p><p>透明关键字有什么应用场景呢？</p><p><strong>实现三角形</strong></p><p>下面这个图是用 4 条边框填充的正方形，看懂了它你大概就知道该如何用 CSS 写三角形了。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912160726.png" alt=""></p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">{</span>      <span class="token property">border-top-color</span><span class="token punctuation">:</span> #ffc107<span class="token punctuation">;</span>      <span class="token property">border-right-color</span><span class="token punctuation">:</span> #00bcd4<span class="token punctuation">;</span>      <span class="token property">border-bottom-color</span><span class="token punctuation">:</span> #e26b6b<span class="token punctuation">;</span>      <span class="token property">border-left-color</span><span class="token punctuation">:</span> #cc7cda<span class="token punctuation">;</span>      <span class="token property">border-width</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>      <span class="token property">border-style</span><span class="token punctuation">:</span> solid<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>用 transparent 实现三角形的原理：</p><ul><li><p>首先宽高必须是 0px，通过边框的粗细来填充内容；</p></li><li><p>那条边需要就要加上颜色，而不需要的边则用 transparent；</p></li><li><p>想要什么样姿势的三角形，完全由上下左右 4 条边的中有颜色的边和透明的边的位置决定；</p></li><li><p>等腰三角形：设置一条边有颜色，然后紧挨着的 2 边是透明，且宽度是有颜色边的一半；直角三角形：设置一条边有颜色，然后紧挨着的任何一边透明即可。</p></li></ul><p>看下示例：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912160719.png" alt=""></p><p><strong>增大点击区域</strong></p><p>常常在移动端的时候点击的按钮的区域特别小，但是由于现实效果又不太好把它做大，所以常用的一个手段就是通过透明的边框来增大按钮的点击区域：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.btn</span> <span class="token punctuation">{</span>      <span class="token property">border</span><span class="token punctuation">:</span> 5px solid transparent<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="currentColor-关键字">currentColor 关键字</h4><p>currentColor 会取当前元素继承父级元素的文本颜色值或声明的文本颜色值，即 computed 后的 color 值。</p><p>比如，对于如下 CSS，该元素的边框颜色会是 red：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.btn</span> <span class="token punctuation">{</span>      <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>      <span class="token property">border</span><span class="token punctuation">:</span> 1px solid currentColor<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="RGB-A-颜色">RGB[A] 颜色</h4><p>RGB[A] 颜色是由 R(red)-G(green)-B(blue)-A(alpha) 组成的色彩空间。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912160707.png" alt=""></p><p>在 CSS 中，它有两种表示形式：</p><ul><li><p>十六进制符号；</p></li><li><p>函数符；</p></li></ul><p><strong>十六进制符号</strong></p><p>RGB 中的每种颜色的值范围是 00~ff，值越大表示颜色越深。所以一个颜色正常是 6 个十六进制字符加上 # 组成，比如红色就是 #ff0000。</p><p>如果 RGB 颜色需要加上不透明度，那就需要加上 alpha 通道的值，它的范围也是 00~ff，比如一个带不透明度为 67% 的红色可以这样写 #ff0000aa。</p><p>使用十六进制符号表示颜色的时候，都是用 2 个十六进制表示一个颜色，如果这 2 个字符相同，还可以缩减成只写 1 个，比如，红色 #f00；带 67% 不透明度的红色 #f00a。</p><p><strong>函数符</strong></p><p>当 RGB 用函数表示的时候，每个值的范围是 0~255 或者 0%~100%，所以红色是 rgb(255, 0, 0)， 或者 rgb(100%, 0, 0)。</p><p>如果需要使用函数来表示带不透明度的颜色值，值的范围是 0~1 及其之间的小数或者 0%~100%，比如带 67% 不透明度的红色是 rgba(255, 0, 0, 0.67) 或者 rgba(100%, 0%, 0%, 67%)</p><blockquote><p>“</p><p>需要注意的是 RGB 这 3 个颜色值需要保持一致的写法，要嘛用数字要嘛用百分比，而不透明度的值的可以不用和 RGB 保持一致写法。比如 rgb(100%, 0, 0) 这个写法是无效的；而 rgb(100%, 0%, 0%, 0.67) 是有效的。</p></blockquote><p>在第 4 代 CSS 颜色标准中，新增了一种新的函数写法，即可以把 RGB 中值的分隔逗号改成空格，而把 RGB 和 alpha 中的逗号改成 /，比如带 67% 不透明度的红色可以这样写 rgba(255 0 0 / 0.67)。另外还把 rgba 的写法合并到 rgb 函数中了，即 rgb 可以直接写带不透明度的颜色。</p><h4 id="HSL-A-颜色">HSL[A] 颜色</h4><p>HSL[A] 颜色是由色相(hue)-饱和度(saturation)-亮度(lightness)-不透明度组成的颜色体系。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912160701.png" alt=""></p><ul><li><p>色相（H）是色彩的基本属性，值范围是 0~360 或者 0deg~360deg， 0 (或 360) 为红色, 120 为绿色, 240 为蓝色；</p></li><li><p>饱和度（S）是指色彩的纯度，越高色彩越纯，低则逐渐变灰，取 0~100% 的数值；0% 为灰色， 100% 全色；</p></li><li><p>亮度（L），取 0~100%，0% 为暗，100% 为白；</p></li><li><p>不透明度（A），取 0<sub>100%，或者0</sub>1及之间的小数；</p></li></ul><p>写法上可以参考 RGB 的写法，只是参数的值不一样。</p><p>给一个按钮设置不透明度为 67% 的红色的 color 的写法，以下全部写法效果一致：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span>      <span class="token property">color</span><span class="token punctuation">:</span> #ff0000aa<span class="token punctuation">;</span>      <span class="token property">color</span><span class="token punctuation">:</span> #f00a<span class="token punctuation">;</span>      <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.67<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span>100% 0% 0% / 67%<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">hsla</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 100%<span class="token punctuation">,</span> 50%<span class="token punctuation">,</span> 67%<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">hsl</span><span class="token punctuation">(</span>0deg 100% 50% / 67%<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>小提示：在 Chrome DevTools 中可以按住 shift + 鼠标左键可以切换颜色的表示方式。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912160642.gif" alt=""></p><h3 id="媒体查询">媒体查询</h3><p>媒体查询是指针对不同的设备、特定的设备特征或者参数进行定制化的修改网站的样式。</p><p>你可以通过给 <code>&lt;link&gt;</code> 加上 media 属性来指定该样式文件只能对什么设备生效，不指定的话默认是 all，即对所有设备都生效：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">&lt;link rel=<span class="token string">"stylesheet"</span> src=<span class="token string">"styles.css"</span> media=<span class="token string">"screen"</span> /&gt;  &lt;link rel=<span class="token string">"stylesheet"</span> src=<span class="token string">"styles.css"</span> media=<span class="token string">"print"</span> /&gt;  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>都支持哪些设备类型？</p><ul><li><p>all：适用于所有设备；</p></li><li><p>print：适用于在打印预览模式下在屏幕上查看的分页材料和文档；</p></li><li><p>screen：主要用于屏幕；</p></li><li><p>speech：主要用于语音合成器。</p></li></ul><blockquote><p>需要注意的是：通过 media 指定的  资源尽管不匹配它的设备类型，但是浏览器依然会加载它。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155838.png" alt=""></p><p>除了通过 <code>&lt;link&gt;</code> 让指定设备生效外，还可以通过 <code>@media</code> 让 CSS 规则在特定的条件下才能生效。响应式页面就是使用了 @media 才让一个页面能够同时适配 PC、Pad 和手机端。</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> 1000px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>媒体查询支持逻辑操作符：</p><ul><li><p>and：查询条件都满足的时候才生效；</p></li><li><p>not：查询条件取反；</p></li><li><p>only：整个查询匹配的时候才生效，常用语兼容旧浏览器，使用时候必须指定媒体类型；</p></li><li><p>逗号或者 or：查询条件满足一项即可匹配；</p></li></ul><p>媒体查询还支持众多的媒体特性[14]，使得它可以写出很复杂的查询条件：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* 用户设备的最小高度为680px或为纵向模式的屏幕设备 */</span>  <span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">min-height</span><span class="token punctuation">:</span> 680px<span class="token punctuation">)</span><span class="token punctuation">,</span> screen <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">orientation</span><span class="token punctuation">:</span> portrait<span class="token punctuation">)</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="常见需求">常见需求</h2><h3 id="自定义属性">自定义属性</h3><p>之前我们通常是在预处理器里才可以使用变量，而现在 CSS 里也支持了变量的用法。通过自定义属性就可以在想要使用的地方引用它。</p><p>自定义属性也和普通属性一样具有级联性，申明在 :root 下的时候，在全文档范围内可用，而如果是在某个元素下申明自定义属性，则只能在它及它的子元素下才可以使用。</p><p>自定义属性必须通过 <code>--x</code> 的格式申明，比如：--theme-color: red; 使用自定义属性的时候，需要用 var 函数。比如：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">&lt;!-- 定义自定义属性 --&gt;  :root</span> <span class="token punctuation">{</span>      <span class="token property">--theme-color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token selector">&lt;!-- 使用变量 --&gt;  h1</span> <span class="token punctuation">{</span>      <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--theme-color<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155818.png" alt=""></p><p>上图这个是使用 CSS 自定义属性配合 JS 实现的动态调整元素的 box-shadow，具体可以看这个 codepen demo。</p><h3 id="1px-边框解决方案">1px 边框解决方案</h3><p>Retina 显示屏比普通的屏幕有着更高的分辨率，所以在移动端的 1px 边框就会看起来比较粗，为了美观通常需要把这个线条细化处理。这里有篇文章列举了 7 中方案可以参考一下：7种方法解决移动端Retina屏幕1px边框问题[15]</p><p>而这里附上最后一种通过伪类和 transform 实现的相对完美的解决方案：</p><p>只设置单条底部边框：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.scale-1px-bottom</span> <span class="token punctuation">{</span>      <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>      <span class="token property">border</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector">.scale-1px-bottom::after</span> <span class="token punctuation">{</span>      <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span>      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>      <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>      <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>      <span class="token property">background</span><span class="token punctuation">:</span> #000<span class="token punctuation">;</span>      <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>      <span class="token property">height</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span>      <span class="token property">-webkit-transform</span><span class="token punctuation">:</span> <span class="token function">scaleY</span><span class="token punctuation">(</span>0.5<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scaleY</span><span class="token punctuation">(</span>0.5<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token property">-webkit-transform-origin</span><span class="token punctuation">:</span> 0 0<span class="token punctuation">;</span>      <span class="token property">transform-origin</span><span class="token punctuation">:</span> 0 0<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同时设置 4 条边框：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.scale-1px</span> <span class="token punctuation">{</span>      <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>      <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>      <span class="token property">border</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector">.scale-1px::after</span> <span class="token punctuation">{</span>      <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span>      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>      <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>      <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>      <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #000<span class="token punctuation">;</span>      <span class="token property">-webkit-box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>      <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>      <span class="token property">width</span><span class="token punctuation">:</span> 200%<span class="token punctuation">;</span>      <span class="token property">height</span><span class="token punctuation">:</span> 200%<span class="token punctuation">;</span>      <span class="token property">-webkit-transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>0.5<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>0.5<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token property">-webkit-transform-origin</span><span class="token punctuation">:</span> left top<span class="token punctuation">;</span>      <span class="token property">transform-origin</span><span class="token punctuation">:</span> left top<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="清除浮动">清除浮动</h3><p>什么是浮动：浮动元素会脱离文档流并向左/向右浮动，直到碰到父元素或者另一个浮动元素。</p><p>为什么要清楚浮动，它造成了什么问题？</p><p>因为浮动元素会脱离正常的文档流，并不会占据文档流的位置，所以如果一个父元素下面都是浮动元素，那么这个父元素就无法被浮动元素所撑开，这样一来父元素就丢失了高度，这就是所谓的浮动造成的父元素高度坍塌问题。</p><p>父元素高度一旦坍塌将对后面的元素布局造成影响，为了解决这个问题，所以需要清除浮动，让父元素恢复高度，那该如何做呢？</p><p>这里介绍两种方法：通过 BFC 来清除、通过 clear 来清除。</p><h4 id="BFC-清除浮动">BFC 清除浮动</h4><p>前面介绍 BFC 的时候提到过，计算 BFC 高度的时候浮动子元素的高度也将计算在内，利用这条规则就可以清楚浮动。</p><p>假设一个父元素 parent 内部只有 2 个子元素 child，且它们都是左浮动的，这个时候 parent 如果没有设置高度的话，因为浮动造成了高度坍塌，所以 parent 的高度会是 0，此时只要给 parent 创造一个 BFC，那它的高度就能恢复了。</p><p>而产生 BFC 的方式很多，我们可以给父元素设置overflow: auto 来简单的实现 BFC 清除浮动，但是为了兼容 IE 最好用 overflow: hidden。</p><pre class="line-numbers language-none"><code class="language-none">.parent {      overflow: hidden;  }  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>通过 overflow: hidden 来清除浮动并不完美，当元素有阴影或存在下拉菜单的时候会被截断，所以该方法使用比较局限。</p><h4 id="通过-clear-清除浮动">通过 clear 清除浮动</h4><p>我先把结论贴出来：</p><pre class="line-numbers language-none"><code class="language-none">.clearfix {      zoom: 1;  }  .clearfix::after {      content: "";      display: block;      clear: both;  }  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这种写法的核心原理就是通过 ::after 伪元素为在父元素的最后一个子元素后面生成一个内容为空的块级元素，然后通过 clear 将这个伪元素移动到所有它之前的浮动元素的后面，画个图来理解一下。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155806.png" alt=""></p><p>可以结合这个 codepen demo 一起理解上图的 clear 清楚浮动原理。</p><p>上面这个 demo 或者图里为了展示需要所以给伪元素的内容设置为了 ::after，实际使用的时候需要设置为空字符串，让它的高度为 0，从而父元素的高度都是由实际的子元素撑开。</p><p>该方式基本上是现在人人都在用的清除浮动的方案，非常通用。</p><p>参考：CSS中的浮动和清除浮动，梳理一下[16]</p><h3 id="消除浏览器默认样式">消除浏览器默认样式</h3><p>针对同一个类型的 HTML 标签，不同的浏览器往往有不同的表现，所以在网站制作的时候，开发者通常都是需要将这些浏览器的默认样式清除，让网页在不同的浏览器上能够保持一致。</p><p>针对清除浏览器默认样式这件事，在很早之前 CSS 大师 Eric A. Meyer 就干过。它就是写一堆通用的样式用来重置浏览器默认样式，这些样式通常会放到一个命名为 reset.css 文件中。比如大师的 reset.css[17] 是这么写的：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">html, body, div, span, applet, object, iframe,  h1, h2, h3, h4, h5, h6, p, blockquote, pre,  a, abbr, acronym, address, big, cite, code,  del, dfn, em, img, ins, kbd, q, s, samp,  small, strike, strong, sub, sup, tt, var,  b, u, i, center,  dl, dt, dd, ol, ul, li,  fieldset, form, label, legend,  table, caption, tbody, tfoot, thead, tr, th, td,  article, aside, canvas, details, embed,   figure, figcaption, footer, header, hgroup,   menu, nav, output, ruby, section, summary,  time, mark, audio, video</span> <span class="token punctuation">{</span>      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>      <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>      <span class="token property">border</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>      <span class="token property">font-size</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>      <span class="token property">font</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>      <span class="token property">vertical-align</span><span class="token punctuation">:</span> baseline<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment">/* HTML5 display-role reset for older browsers */</span>  <span class="token selector">article, aside, details, figcaption, figure,   footer, header, hgroup, menu, nav, section</span> <span class="token punctuation">{</span>      <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector">body</span> <span class="token punctuation">{</span>      <span class="token property">line-height</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector">ol, ul</span> <span class="token punctuation">{</span>      <span class="token property">list-style</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector">blockquote, q</span> <span class="token punctuation">{</span>      <span class="token property">quotes</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector">blockquote:before, blockquote:after,  q:before, q:after</span> <span class="token punctuation">{</span>      <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span>      <span class="token property">content</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector">table</span> <span class="token punctuation">{</span>      <span class="token property">border-collapse</span><span class="token punctuation">:</span> collapse<span class="token punctuation">;</span>      <span class="token property">border-spacing</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>他的这份 reset.css 据说是被使用最广泛的重设样式的方案了。</p><p>除了 reset.css 外，后来又出现了 Normalize.css[18] 。关于 Normalize.css, 其作者 necolas 专门写了一篇文章介绍了它，并谈到了它和 reset.css 的区别。这个是他写那篇文章的翻译版：让我们谈一谈 Normalize.css[19]。</p><p>文章介绍到：Normalize.css 只是一个很小的CSS文件，但它在默认的 HTML 元素样式上提供了跨浏览器的高度一致性。相比于传统的 CSS reset，Normalize.css 是一种现代的、为 HTML5 准备的优质替代方案，现在已经有很多知名的框架和网站在使用它了。</p><p>Normalize.css 的具体样式可以看这里 Normalize.css</p><p>区别于 reset.css，Normalize.css 有如下特点：</p><ul><li><p>reset.css 几乎为所有标签都设置了默认样式，而 Normalize.css 则是有选择性的保护了部分有价值的默认值；</p></li><li><p>修复了很多浏览器的 bug，而这是 reset.css 没做到的；</p></li><li><p>不会让你的调试工具变的杂乱，相反 reset.css 由于设置了很多默认值，所以在浏览器调试工具中往往会看到一大堆的继承样式，显得很杂乱；</p></li><li><p>Normalize.css 是模块化的，所以可以选择性的去掉永远不会用到的部分，比如表单的一般化；</p></li><li><p>Normalize.css 有详细的说明文档；</p></li></ul><h3 id="长文本处理">长文本处理</h3><p><strong>默认：字符太长溢出了容器</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155744.png" alt=""></p><p><strong>字符超出部分换行</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914005529.png" alt=""></p><p><strong>字符超出位置使用连字符</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155738.png" alt=""></p><p><strong>单行文本超出省略</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914005537.png" alt=""></p><p><strong>多行文本超出省略</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914005552.png" alt=""></p><p>查看以上这些方案的示例： codepen demo</p><p>有意思的是刚好前两天看到 chokcoco 针对文本溢出也写了一篇文章，主要突出的是对整块的文本溢出处理。啥叫整块文本？比如，下面这种技术标签就是属于整块文本：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155731.png" alt=""></p><p>另外他还对 iOS/Safari 做了兼容处理，感兴趣的可以去阅读下：CSS 整块文本溢出省略特性探究[20]。</p><h3 id="水平垂直居中">水平垂直居中</h3><p>让元素在父元素中呈现出水平垂直居中的形态，无非就 2 种情况：</p><ul><li><p>单行的文本、inline 或者 inline-block 元素；</p></li><li><p>固定宽高的块级盒子；</p></li><li><p>不固定宽高的块级盒子；</p></li></ul><p>以下列到的所有水平垂直居中方案这里写了个 codepen demo，配合示例阅读效果更佳。</p><h4 id="单行的文本、inline-或-inline-block-元素">单行的文本、inline 或 inline-block 元素</h4><p><strong>水平居中</strong></p><p>此类元素需要水平居中，则父级元素必须是块级元素(<code>block level</code>)，且父级元素上需要这样设置样式：</p><pre class="line-numbers language-none"><code class="language-none">.parent {      text-align: center;  }  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>垂直居中</strong></p><p>方法一：通过设置上下内间距一致达到垂直居中的效果：</p><pre class="line-numbers language-none"><code class="language-none">.single-line {      padding-top: 10px;      padding-bottom: 10px;  }  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>方法二：通过设置 <code>height</code> 和 <code>line-height</code> 一致达到垂直居中：</p><pre class="line-numbers language-none"><code class="language-none">.single-line {      height: 100px;      line-height: 100px;  }  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="固定宽高的块级盒子">固定宽高的块级盒子</h4><p><strong>方法一：absolute + 负 margin</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914005614.png" alt=""></p><p><strong>方法二：absolute + margin auto</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155724.png" alt=""></p><p><strong>方法三：absolute + calc</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914005620.png" alt=""></p><h4 id="不固定宽高的块级盒子">不固定宽高的块级盒子</h4><p>这里列了 6 种方法，参考了颜海镜 写的文章 ，其中的两种 line-height 和 writing-mode 方案看后让我惊呼：还有这种操作？学到了学到了。</p><p><strong>方法一：absolute + transform</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155717.png" alt=""></p><p><strong>方法二：line-height + vertical-align</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914005627.png" alt=""></p><p><strong>方法三：writing-mode</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914005633.png" alt=""></p><p><strong>方法四：table-cell</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914005634.png" alt=""></p><p><strong>方法五：flex</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155710.png" alt=""></p><p><strong>方法六：grid</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155704.png" alt=""></p><h3 id="常用布局">常用布局</h3><h4 id="两栏布局（边栏定宽主栏自适应）">两栏布局（边栏定宽主栏自适应）</h4><p>针对以下这些方案写了几个示例： codepen demo</p><p><strong>方法一：float + overflow（BFC 原理）</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914005646.png" alt=""></p><p><strong>方法二：float + margin</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155657.png" alt=""></p><p><strong>方法三：flex</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914005701.png" alt=""></p><p><strong>方法四：grid</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155650.png" alt=""></p><h4 id="三栏布局（两侧栏定宽主栏自适应）">三栏布局（两侧栏定宽主栏自适应）</h4><p>针对以下这些方案写了几个示例： codepen demo</p><p><strong>方法一：圣杯布局</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155616.png" alt=""></p><p><strong>方法二：双飞翼布局</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155643.png" alt=""></p><p><strong>方法三：float + overflow（BFC 原理）</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155556.png" alt=""></p><p><strong>方法四：flex</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155633.png" alt=""></p><p><strong>方法五：grid</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155549.png" alt=""></p><h4 id="多列等高布局">多列等高布局</h4><p>结合示例阅读更佳：codepen demo</p><p><strong>方法一：padding + 负margin</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914005719.png" alt=""></p><p><strong>方法二：设置父级背景图片</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155542.png" alt=""></p><h4 id="三行布局（头尾定高主栏自适应）">三行布局（头尾定高主栏自适应）</h4><p>列了 4 种方法，都是基于如下的 HTML 和 CSS 的，结合示例阅读效果更佳：codepen demo</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">&lt;div class=<span class="token string">"layout"</span>&gt;      &lt;header&gt;&lt;/header&gt;      &lt;main&gt;          &lt;div class=<span class="token string">"inner"</span>&gt;&lt;/div&gt;      &lt;/main&gt;      &lt;footer&gt;&lt;/footer&gt;  &lt;/div&gt;  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">html,  body,  .layout</span> <span class="token punctuation">{</span>      <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector">body</span> <span class="token punctuation">{</span>      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector">header,   footer</span> <span class="token punctuation">{</span>      <span class="token property">height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector">main</span> <span class="token punctuation">{</span>      <span class="token property">overflow-y</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>方法一：calc</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155519.png" alt=""></p><p><strong>方法二：absolute</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155509.png" alt=""></p><p><strong>方法三：flex</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155502.png" alt=""></p><p><strong>方法四：grid</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1220210912155500.png" alt=""></p><h2 id="结了个尾">结了个尾</h2><p>这是我断断续续写了 2 周完成的文章，算是自己对 CSS 的一个总结，虽然写得很长，但不足以覆盖所有 CSS 的知识，比如动画和一些 CSS3 的新特性就完全没涉及，因为这要写下来估计得有大几万字（其实就是懒 😝 ）。</p><p>码字作图不易，如果喜欢或者对你有丝毫帮助的话，帮忙点个👍 哈，点赞就是我的动力。同时也希望自己能坚持认真的写下去，因为在总结提升自己的同时如果也能帮助更多的前端er，那将会让我感觉很开心。</p><h3 id="参考资料">参考资料</h3><p>[1]@charset: <em><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/@charset">https://developer.mozilla.org/zh-CN/docs/Web/CSS/@charset</a></em></p><p>[2]Byte order mark: <em><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Byte_order_mark">https://en.wikipedia.org/wiki/Byte_order_mark</a></em></p><p>[3]@import: <em><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/@import">https://developer.mozilla.org/zh-CN/docs/Web/CSS/@import</a></em></p><p>[4]@supports: <em><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/@supports">https://developer.mozilla.org/zh-CN/docs/Web/CSS/@supports</a></em></p><p>[5]MDN CSS Selectors: <em><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Selectors">https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Selectors</a></em></p><p>[6]Visual formatting model: <em><a target="_blank" rel="noopener" href="https://www.w3.org/TR/CSS2/visuren.html">https://www.w3.org/TR/CSS2/visuren.html</a></em></p><p>[7]CSS 原理 - 你所不知道的 display: <em><a target="_blank" rel="noopener" href="https://yachen168.github.io/article/display.html">https://yachen168.github.io/article/display.html</a></em></p><p>[8]格式化上下文: <em><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10223896?sc=pt">https://ithelp.ithome.com.tw/articles/10223896?sc=pt</a></em></p><p>[9]CSS 原理 - Formatting Context: <em><a target="_blank" rel="noopener" href="https://yachen168.github.io/article/Formatting-context.html">https://yachen168.github.io/article/Formatting-context.html</a></em></p><p>[10]Inline formatting contexts: <em><a target="_blank" rel="noopener" href="https://www.w3.org/TR/CSS2/visuren.html#inline-formatting">https://www.w3.org/TR/CSS2/visuren.html#inline-formatting</a></em></p><p>[11]彻底搞懂CSS层叠上下文、层叠等级、层叠顺序、z-index: <em><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903667175260174">https://juejin.cn/post/6844903667175260174</a></em></p><p>[12]CSS 颜色草案: <em><a target="_blank" rel="noopener" href="https://drafts.csswg.org/css-color-3/">https://drafts.csswg.org/css-color-3/</a></em></p><p>[13]完整的色彩关键字列表: <em><a target="_blank" rel="noopener" href="https://codepen.io/bulandent/pen/gOLovwL">https://codepen.io/bulandent/pen/gOLovwL</a></em></p><p>[14]众多的媒体特性: <em><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Media_queries#%E5%AA%92%E4%BD%93%E7%89%B9%E6%80%A7">https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Media_queries#媒体特性</a></em></p><p>[15]7种方法解决移动端Retina屏幕1px边框问题: <em><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7e63f5a32636">https://www.jianshu.com/p/7e63f5a32636</a></em></p><p>[16]CSS中的浮动和清除浮动，梳理一下: <em><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/09bd5873bed4">https://www.jianshu.com/p/09bd5873bed4</a></em></p><p>[17]reset.css: <em><a target="_blank" rel="noopener" href="https://meyerweb.com/eric/tools/css/reset/">https://meyerweb.com/eric/tools/css/reset/</a></em></p><p>[18]Normalize.css: <em><a target="_blank" rel="noopener" href="https://github.com/necolas/normalize.css">https://github.com/necolas/normalize.css</a></em></p><p>[19]让我们谈一谈 Normalize.css: <em><a target="_blank" rel="noopener" href="https://jerryzou.com/posts/aboutNormalizeCss/">https://jerryzou.com/posts/aboutNormalizeCss/</a></em></p><p>[20]CSS 整块文本溢出省略特性探究: <em><a target="_blank" rel="noopener" href="https://juejin.cn/post/6938583040469762055">https://juejin.cn/post/6938583040469762055</a></em></p><p>From <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/UtYENocSsl0R10h8fww7Iw">https://mp.weixin.qq.com/s/UtYENocSsl0R10h8fww7Iw</a></p><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="web" scheme="https://blog.17lai.site/categories/web/"/>
    
    
    <category term="web" scheme="https://blog.17lai.site/tags/web/"/>
    
    <category term="http" scheme="https://blog.17lai.site/tags/http/"/>
    
    <category term="ccs" scheme="https://blog.17lai.site/tags/ccs/"/>
    
  </entry>
  
  <entry>
    <title>Vim IDE Docker 以及中文指南</title>
    <link href="https://blog.17lai.site/posts/647e6265/"/>
    <id>https://blog.17lai.site/posts/647e6265/</id>
    <published>2021-09-15T04:25:00.000Z</published>
    <updated>2022-03-16T12:29:06.603Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>Docker Vim IDE 由博主定制，加入中文环境配置，支持CJK。并升级到最新版本！</p></blockquote><h2 id="Vim-Docker"><a target="_blank" rel="noopener" href="https://hub.docker.com/r/bloodstar/vim">Vim Docker</a></h2><p><img src="https://i.imgur.com/G6KybVM.png" alt="Vim Docker"></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker pull bloodstar/vim<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">alias</span> <span class="token assign-left variable">edit</span><span class="token operator">=</span><span class="token string">'docker run -ti --rm -v $(pwd):/home/developer/workspace bloodstar/vim'</span> edit some.file <span class="token builtin class-name">alias</span> <span class="token assign-left variable">edit_update</span><span class="token operator">=</span><span class="token string">"docker pull bloodstar/vim:latest"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="Vim-IDE-Docker"><a target="_blank" rel="noopener" href="https://hub.docker.com/r/bloodstar/drop-in">Vim IDE Docker</a></h2><p><img src="https://i.imgur.com/RVTlBBO.png" alt="drop-in"></p><h4 id="What-s-inside">What's inside:</h4><ul><li><a target="_blank" rel="noopener" href="http://www.alpinelinux.org/"><code>Alpine Linux</code></a></li><li><a target="_blank" rel="noopener" href="http://www.vim.org/"><code>Vim</code></a> + a ton of awesome plugins <em>see <a target="_blank" rel="noopener" href="https://hub.docker.com/r/bloodstar/vim/"><code>bloodstar/vim:latest</code></a></em></li><li>Good support of <a target="_blank" rel="noopener" href="https://golang.org/"><code>Golang</code></a> development with <a target="_blank" rel="noopener" href="https://hub.docker.com/r/bloodstar/go-tools/"><code>bloodstar/go-tools</code></a> container</li><li><a target="_blank" rel="noopener" href="https://tmux.github.io/"><code>tmux</code></a></li><li><a target="_blank" rel="noopener" href="https://powerline.readthedocs.io/"><code>powerline</code></a></li><li><a target="_blank" rel="noopener" href="https://mosh.mit.edu/"><code>Mosh</code></a></li><li>OpenSSH, Bash, OMF, Python, etc.</li></ul><h4 id="how-to-start-the-daemon-and-all-containers">how to start the daemon(and all containers)</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker create -v <span class="token string">'/usr/lib/go'</span> --name go-tools <span class="token punctuation">\</span><span class="token string">'bloodstar/go-tools'</span> <span class="token string">'/bin/true'</span>docker run -v <span class="token variable"><span class="token variable">$(</span>'pwd'<span class="token variable">)</span></span>:/home/developer/workspace <span class="token punctuation">\</span>--volumes-from go-tools <span class="token punctuation">\</span>-v ~/.ssh/pub_rsa:/etc/ssh_keys:ro <span class="token punctuation">\</span>-v /etc/localtime:/etc/localtime:ro <span class="token punctuation">\</span>-d -p <span class="token number">80</span>:80 -p <span class="token number">8080</span>:8080 -p <span class="token number">62222</span>:62222 -p <span class="token number">60001</span>:60001/udp <span class="token punctuation">\</span>--name drop-in bloodstar/drop-in<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><em><code>-v /etc/localtime:/etc/localtime:ro</code> - makes tmux display local time</em></p><h4 id="how-to-connect">how to connect:</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mosh --ssh<span class="token operator">=</span><span class="token string">"ssh -p 62222"</span> -- developer@$<span class="token operator">&lt;</span>ip<span class="token operator">&gt;</span> tmux -u<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="or-without-host-identity-check">or without host identity check:</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mosh --ssh<span class="token operator">=</span><span class="token string">"ssh -o StrictHostKeyChecking=no -p 62222"</span> -- developer@$<span class="token operator">&lt;</span>ip<span class="token operator">&gt;</span> tmux -u<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="Useful-Bash-scripts">Useful Bash scripts</h4><h6 id="Connect"><strong>Connect</strong></h6><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">ip</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>docker inspect --format <span class="token string">'{{ .NetworkSettings.IPAddress }}'</span> drop-in<span class="token variable">)</span></span>mosh --ssh<span class="token operator">=</span><span class="token string">"ssh -p 62222"</span> -- developer@<span class="token variable">$ip</span> tmux -u<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h6 id="start-the-daemon-and-all-containers"><strong>start the daemon(and all containers)</strong></h6><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">dtc_id</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>docker <span class="token function">ps</span> -a -q --filter <span class="token string">'name=vim-go-tools'</span><span class="token variable">)</span></span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> -z <span class="token string">"<span class="token variable">${dtc_id}</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token builtin class-name">echo</span> <span class="token string">'vim-go-tools container not found. Creating...'</span> docker create -v <span class="token string">'/usr/lib/go'</span> --name <span class="token string">'vim-go-tools'</span> <span class="token punctuation">\</span>   <span class="token string">'bloodstar/go-tools'</span> <span class="token string">'/bin/true'</span> <span class="token builtin class-name">echo</span> <span class="token string">'Done!'</span><span class="token keyword">fi</span><span class="token builtin class-name">echo</span> <span class="token string">'starting daemon...'</span>docker run -v <span class="token variable"><span class="token variable">$(</span>'pwd'<span class="token variable">)</span></span>:/home/developer/workspace <span class="token punctuation">\</span>  --volumes-from vim-go-tools <span class="token punctuation">\</span>  -v ~/.ssh/pub_rsa:/etc/ssh_keys:ro <span class="token punctuation">\</span>  -v /etc/localtime:/etc/localtime:ro <span class="token punctuation">\</span>  -e <span class="token string">"GEMAIL=&lt;github email&gt;"</span> <span class="token punctuation">\</span>  -e <span class="token string">"GNAME=&lt;github name&gt;"</span> <span class="token punctuation">\</span>  -d -p <span class="token number">80</span>:80 -p <span class="token number">8080</span>:8080 -p <span class="token number">62222</span>:62222 -p <span class="token number">60001</span>:60001/udp <span class="token punctuation">\</span>  --name drop-in bloodstar/drop-in<span class="token builtin class-name">echo</span> <span class="token string">'Done!'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Vim-中文快查表-戳这里"><a href="https://blog.17lai.site/cheatsheets/Vim_CN.docset/Contents/Resources/Documents/">Vim 中文快查表</a>   &lt;= 戳这里</h2><blockquote><p>Tips: 在网页上端导航栏，[快查] =&gt; [更多快查表]，有更多快查表！<br>快去看看吧。</p></blockquote><h2 id="Vim">Vim</h2><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1520210915150901.png" alt="vim速查"></p><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="ide" scheme="https://blog.17lai.site/categories/ide/"/>
    
    
    <category term="linux" scheme="https://blog.17lai.site/tags/linux/"/>
    
    <category term="vim" scheme="https://blog.17lai.site/tags/vim/"/>
    
    <category term="ide" scheme="https://blog.17lai.site/tags/ide/"/>
    
    <category term="docker" scheme="https://blog.17lai.site/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>深度学习之视频人脸识别系列</title>
    <link href="https://blog.17lai.site/posts/a0f3c838/"/>
    <id>https://blog.17lai.site/posts/a0f3c838/</id>
    <published>2021-09-14T04:25:00.000Z</published>
    <updated>2022-03-16T12:29:06.198Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="系列1-简介">系列1 简介</h2><p>出品 | 磐创AI技术团队</p><p>【磐创AI导读】本文是深度学习之视频<a target="_blank" rel="noopener" href="https://cloud.tencent.com/product/facerecognition?from=10680">人脸识别</a>系列的第一篇文章，介绍了人脸识别领域的一些基本概念，分析了深度学习在人脸识别的基本流程，并总结了近年来科研领域的研究进展，最后分析了静态数据与视频动态数据在人脸识别技术上的差异。欢迎大家点击上方篮子关注我们的公众号：磐创AI。</p><h2 id="一、基本概念"><strong>一、基本概念</strong></h2><h3 id="1-人脸识别（face-identification）"><strong>1. 人脸识别（face identification）</strong></h3><p>人脸识别是1对n的比对，给定一张人脸图片，如何在n张人脸图片中找到同一张人脸图片，相对于一个分类问题，将一张人脸划分到n张人脸中的一张。类似于管理人员进行的人脸识别门禁系统。</p><h3 id="2-人脸验证（face-verification）"><strong>2.人脸验证（face verification）</strong></h3><p>人脸验证的1对1的比对，给定两张人脸图片，判断这两张人脸是否为同一人，类似于手机的人脸解锁系统，事先在手机在录入自己的脸部信息，然后在开锁时比对摄像头捕捉到的人脸是否与手机上录入的人脸为同一个人。</p><h3 id="3-人脸检测（face-detection）"><strong>3.人脸检测（face detection）</strong></h3><p>人脸检测是在一张图片中把人脸检测出来，即在图片上把人脸用矩形框出来，并得到矩形的坐标，如下图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914140027.png" alt=""></p><h3 id="4-人脸关键点检测"><strong>4. 人脸关键点检测</strong></h3><p>根据输入的人脸图像，识别出面部关键特征点，如眼睛、鼻尖、嘴角点、眉毛以及人脸各部件轮廓点的坐标，如下图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914140105.png" alt=""></p><h3 id="5-人脸矫正（人脸对齐）"><strong>5. 人脸矫正（人脸对齐）</strong></h3><p>通过人脸关键点检测得到人脸的关键点坐标，然后根据人脸的关键点坐标调整人脸的角度，使人脸对齐，由于输入图像的尺寸是大小不一的，人脸区域大小也不相同，角度不一样，所以要通过坐标变换，对人脸图像进行归一化操作，如下图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914140120.png" alt=""></p><h2 id="二、基于深度学习的人脸识别算法基本流程"><strong>二、基于深度学习的人脸识别算法基本流程</strong></h2><p>随着神经网络的迅速发展和其对图像数据的强大的特征提取，深度学习运用于人脸识别也成为热点研究方向；2014年的开山之作DeepFace，第一个真正将<a target="_blank" rel="noopener" href="https://cloud.tencent.com/solution/bigdata?from=10680">大数据</a>和深度学习结合应用于人脸识别与验证，确立人脸识别的常规流程：图片-&gt;人脸与关键点检测-&gt;人脸对齐-&gt;人脸表征（representation）-&gt;分类。首先将图片中的人脸检测处理并通过关键点进行对齐，如何输入到神经网络，得到特征向量，通过分类训练过程，该向量即为人脸的特征向量。要求出两张人脸的相似度即计算两个特征的向量度量之差，方法包括：SVM、SiameseNetwork、JointBayesian、L1距离、L2距离、cos距离等。</p><h2 id="三、科研领域近期进展"><strong>三、科研领域近期进展</strong></h2><p>科研领域近期进展主要集中于loss函数的研究，包括DeepId2（Contrastive Loss）、FaceNet（Triplet loss）、L-Softmax、SphereFace（A-Softmax）、Center Loss、L2-Softmax、NormFace、CosFace（AM-Softmax）、ArcFace（AA-Softmax）等。</p><h2 id="四、基于视频人脸识别和图片人脸识别的区别"><strong>四、基于视频人脸识别和图片人脸识别的区别</strong></h2><p><strong>（<em>该小结部分参考于博客园 - 米罗西http://www.cnblogs.com/zhehan54/p/6727631.html</em>）</strong></p><p>相对于图片数据，目前视频人脸识别有很多挑战，包括：（1）视频数据一般为户外，视频图像质量比较差；（2）人脸图像比较小且模糊；（3）视频人脸识别对实时性要求更高。</p><p>但是视频数据也有一些优越性，视频数据同时具有空间信息和时间信息，在时间和空间的联合空间中描述人脸和识别人脸会具有一定提升空间。在视频数据中人脸跟踪是一个提高识别的方法，首先检测出人脸，然后跟踪人脸特征随时间的变化。当捕捉到一帧比较好的图像时，再使用图片人脸识别算法进行识别。这类方法中跟踪和识别是单独进行的，时间信息只在跟踪阶段用到。</p><p>【总结】：本期文章主要介绍了基于深度学习的人脸识别算法的一些基本入门知识，下一期我给大家介绍人脸识别中获取神经网络输入的算法，即关于人脸检测、人脸关键点检测与人脸对齐的一些重要算法和相关论文解析。</p><h2 id="系列2-人脸检测与对齐">系列2 人脸检测与对齐</h2><h2 id="一、人脸检测与关键点检测"><strong>一、人脸检测与关键点检测</strong></h2><h3 id="1-问题描述："><strong>1. 问题描述：</strong></h3><p>人脸检测解决的问题为给定一张图片，输出图片中人脸的位置，即使用方框框住人脸，输出方框的左上角坐标和右下角坐标或者左上角坐标和长宽。算法难点包括：人脸大小差异、人脸遮挡、图片模糊、角度与姿态差异、表情差异等。而关键检测则是输出人脸关键点的坐标，如左眼（x1，y1）、右眼（x2，y2）、鼻子（x3，y3）、嘴巴左上角（x4，y4）、嘴巴右上角（x5，y5）等。</p><h3 id="2-深度学习相关算法："><strong>2. 深度学习相关算法：</strong></h3><h4 id="（1）Cascade-CNN"><strong>（1）Cascade CNN</strong></h4><p>Cascade CNN源于发表于2015年CVPR上的一篇论文A Convolutional Neural Network Cascade for Face Detection【2】，作者提出了一种级连的CNN网络结构用于人脸检测。算法主体框架是基于V-J的瀑布流思想【1】，是传统技术和深度网络相结合的一个代表，Cascade CNN包含了多个分类器，这些分类器使用级联结构进行组织，与V-J不同的地方在于Cascade CNN采用卷积网络作为每一级的分类器。整个网络的处理流程如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914140330.png" alt=""></p><p>整个处理流程里包含了六个网络：12-net、12-calibration-net、24-net、24-calibration-net、48-net、48-calibration-net，其中三个二分类网络用于分类其是否为人脸，另外三个calibration网络用于矫正人脸框边界。其中第二个网络之后、第四个网络之后、第五个网络之后使用NMS算法过滤掉冗余的框。</p><p>12-net，24-net和48-net的网络结构如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914140401.png" alt=""></p><p>13-12-calibration-net，24-calibration-net，48-calibration-net的结构如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914140426.png" alt=""></p><p>该算法结合了V-J框架构造了级连的CNN网络结构并设计边界矫正网络用来专门矫正人脸框边界，在AFW数据集上准确率达到97.97%。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914140457.png" alt=""></p><h4 id="（2）Faceness-Net"><strong>（2）Faceness-Net</strong></h4><p>Faceness-Net源于论文A convolutional neural network cascade for face detection【3】，该算法基于DCNN网络【5】的人脸局部特征分类器，算法首先进行人脸局部特征的检测，使用多个基于DCNN网络的facial parts分类器对人脸进行评估，然后根据每个部件的得分进行规则分析得到Proposal的人脸区域，然后从局部到整体得到人脸候选区域，再对人脸候选区域进行<a target="_blank" rel="noopener" href="https://cloud.tencent.com/product/facerecognition?from=10680">人脸识别</a>和矩形框坐标回归，该过程分为两个步骤。</p><p>第一个步骤：每个人脸局部特征使用attribute-aware网络检测并生成人脸局部图，其中一共五个特征属性： 头发、眼睛、鼻子、嘴巴、胡子。然后通过人脸局部图根据评分构建人脸候选区域，具体如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914140529.png" alt=""></p><p>第二个步骤：训练一个多任务的卷积网络来完成人脸二分类和矩形框坐标回归，进一步提升其效果，具体如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914140548.png" alt=""></p><p>Faceness从脸部特征的角度来解决人脸检测中的遮挡和姿态角度问题，其整体性能在当时是非常好的，在AFW数据集上准确率可以达到98.05%。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914140611.png" alt=""></p><h4 id="（3）MTCNN"><strong>（3）MTCNN</strong></h4><p>MTCNN源于论文Joint Face Detection and Alignment using Multi-task Cascaded Convolutional Networks【6】，是基于多任务级联卷积神经网络来解决人脸检测和对齐问题，同时输出图片的人脸矩阵框和关键点坐标（左眼、右眼、鼻子、嘴巴左上角、嘴巴右上角）。MTCNN为三阶的级联卷积神经网络，整体框架如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914140644.png" alt=""></p><p>输入阶段：为应对目标多尺度问题，将原始图像resize到不同尺寸，构建图像金字塔，作为三阶级联架构的输入，这样处理可以更好地检测大小不一的人脸。</p><p>第一阶段：通过一个全部由卷积层组成的CNN，取名P-Net，获取候选人脸框、关键点坐标和人脸分类（是人脸或不是），之后采用NMS过滤掉高重叠率的候选窗口。如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914140717.png" alt=""></p><p>第二阶段：第一阶段输出的候选人脸框作为更为复杂的R-Net网络的输入，R-Net进一步筛除大量错误的候选人脸框，同样也通过NMS过滤掉高重叠率的候选窗口。如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914140741.png" alt=""></p><p>第三阶段：与第二阶段类似，最终网络输出人脸框坐标、关键点坐标和人脸分类（是人脸或不是）。如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914140801.png" alt=""></p><p>MTCNN通过三级的级联卷积神经网络对任务进行从粗到细的处理，还提出在线困难样本生成策略（online hard sample mining ）可以进一步提升性能。兼并了速度与准确率，速度在<a target="_blank" rel="noopener" href="https://cloud.tencent.com/product/gpu?from=10680">GPU</a>上可以达到99FPS，在 FDDB数据集上可以达到95.04准确率，具体如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914140818.png" alt=""></p><h2 id="二、人脸对齐（部分参考于GraceDD的博客文章）"><strong>二、人脸对齐（部分参考于GraceDD的博客文章）</strong></h2><p>人脸对齐通过人脸关键点检测得到人脸的关键点坐标，然后根据人脸的关键点坐标调整人脸的角度，使人脸对齐，由于输入图像的尺寸是大小不一的，人脸区域大小也不相同，角度不一样，所以要通过坐标变换，对人脸图像进行归一化操作。人脸关键点检测有很多算法可以使用包括：ASM、AAM、DCNN 、TCDCN 、MTCNN 、TCNN、TCNN等，这里就不详细介绍，主要说一下得到人脸关键点之后如何进行人脸对齐，是所有人脸达到归一化效果，该过程如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914140841.png" alt=""></p><p>该过程涉及到图像的仿射变换，简单来说，“仿射变换”就是：“线性变换”+“平移”，即坐标的变换。假如我们希望人脸图片归一化为尺寸大小600<em>600，左眼位置在（180，200），右眼位置在（420，200）。 这样人脸中心在图像高度的1/3位置，并且两个眼睛保持水平，所以我们选择左眼角位置为( 0.3</em>width, height / 3 )，右眼角位置为（0.7*width , height / 3） 。</p><p>利用这两个点计算图像的变换矩阵（similarity transform），该矩阵是一个2*3的矩阵，如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652.png" alt=""></p><p>如果我们想对一个矩形进行变换，其中x、y方向的缩放因为分别为sx，sy，同时旋转一个角度 ，然后再在x方向平移tx, 在y方向平移ty</p><p>利用opencv的estimateRigidTransform方法，可以获得这样的变换矩阵，但遗憾的是，estimateRigidTransform至少需要三个点，所以我们需要构选第三个点，构造方法是用第三个点与已有的两个点构成等边三角形，这样第三个点的坐标为：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914140918.png" alt=""></p><p>代码如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914140938.png" alt=""></p><p>经过上一步的处理之后，所有的图像都变成一样大小，并且又三个关键点的位置是保持一致的，但因为除了三个点对齐了之外，其他点并没有对齐。所以根据得到的变换矩阵对剩下所有的点进行仿射变换，opencv代码如下所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914141001.png" alt=""></p><p>img为输入图像;</p><p>warped为变换后图像，类型与src一致;</p><p>M为变换矩阵，需要通过其它函数获得，当然也可以手动输入;</p><p>Image_size为输出图像的大小;</p><h2 id="三、-总结"><strong>三、 总结</strong></h2><p>本期文章主要介绍了人脸检测与对齐的相关算法，下一期我给大家介绍一下人脸表征的相关算法，即通过深度学习提取人脸特征，通过比较人脸特征进行人脸识别与验证。</p><h3 id="参考文献：-2"><strong>参考文献：</strong></h3><ul><li>【1】 <a target="_blank" rel="noopener" href="http://S.Z.Li">S.Z.Li</a>, L.Zhu, Z.Q.Zhang, A.Blake, H.J.Zhang, H.Y.Shum. Statistical learning of multi-view face detection. In: Proceedings of the 7-th European Conference on Computer Vision. Copenhagen, Denmark: Springer, 2002.67-81.</li><li>【2】Li H, Lin Z, Shen X, et al. A convolutional neural network cascade for face detection[C]//Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition. 2015: 5325-5334.</li><li>【3】Yang S, Luo P, Loy C C, et al. Faceness-Net: Face detection through deep facial part responses[J]. IEEE transactions on pattern analysis and machine intelligence, 2017.</li><li>【4】Yang S, Luo P, Loy C C, et al. From facial parts responses to face detection: A deep learning approach[C]//Proceedings of the IEEE International Conference on Computer Vision. 2015: 3676-3684.</li><li>【5】Sun Y, Wang X, Tang X. Deep convolutional network cascade for facial point detection[C]//Proceedings of the IEEE conference on computer vision and pattern recognition. 2013: 3476-3483.</li><li>【6】Zhang K, Zhang Z, Li Z, et al. Joint face detection and alignment using multitask cascaded convolutional networks[J]. IEEE Signal Processing Letters, 2016, 23(10): 1499-1503.</li></ul><h2 id="系列3：人脸表征">系列3：人脸表征</h2><h2 id="一、人脸表征"><strong>一、人脸表征</strong></h2><p>把人脸图像通过神经网络，得到一个特定维数的特征向量，该向量可以很好地表征人脸数据，使得不同人脸的两个特征向量距离尽可能大，同一张人脸的两个特征向量尽可能小，这样就可以通过特征向量来进行人脸识别。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914141235.png" alt=""></p><h2 id="二、论文综述"><strong>二、论文综述</strong></h2><h3 id="1-DeepFace："><strong>1.</strong> <strong>DeepFace：</strong></h3><p>2014年论文DeepFace: Closing the Gap toHuman-Level Performance in Face Verification提出了DeepFace算法，第一个真正将<a target="_blank" rel="noopener" href="https://cloud.tencent.com/solution/bigdata?from=10680">大数据</a>和深度学习神经网络结合应用于人脸识别与验证。在该人脸识别模型中分为四个阶段：人脸检测 =&gt; 人脸对齐 =&gt; 人脸表征 =&gt; 人脸分类，在LFW数据集中可以达到97.00%的准确率。</p><p>（1）人脸检测与对齐：该模型使用3D模型来将人脸对齐，该方法过于繁琐，在实际应用中很少使用，经过3D对齐以后，形成的图像都是152×152的图像，具体步骤如下图。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-1.png" alt=""></p><p>分为如下几步：</p><p>a. 人脸检测，使用6个基点  b. 二维剪切，将人脸部分裁剪出来  c. 67个基点，然后Delaunay三角化，在轮廓处添加三角形来避免不连续  d. 将三角化后的人脸转换成3D形状  e. 三角化后的人脸变为有深度的3D三角网  f. 将三角网做偏转，使人脸的正面朝前。  g. 最后放正的人脸  h. 一个新角度的人脸（在论文中没有用到）</p><p>（2）人脸表征：人脸表征使用了5个卷积层和1个最大池化层、1个全连接层，如下图所示。前三层的目的在于提取低层次的特征,为了网络保留更多图像信息只使用了一层池化层；后面三层都是使用参数不共享的卷积核，因为主要是因为人脸不同的区域的特征是不一样的，具有很大的区分性，比如鼻子和眼睛所表示的特征是不一样的，但是使用参数不共享的卷积核也增加了模型计算量以及需要更多的训练数据。最后输出的4096维向量进行L2归一化。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914141316.png" alt=""></p><p>a. Conv：32个11×11×3的卷积核</p><p>b. max-pooling: 3×3， stride=2</p><p>c. Conv: 16个9×9的卷积核</p><p>d. Local-Conv: 16个9×9的卷积核，Local的意思是卷积核的参数不共享</p><p>e. Local-Conv: 16个7×7的卷积核，参数不共享</p><p>f. Local-Conv: 16个5×5的卷积核，参数不共享</p><p>g. Fully-connected: 4096维</p><p>h. Softmax: 4030维</p><p>（3）分类：论文介绍了两种方法进行分类，加权的卡方距离和使用Siamese网络结构，设f1和f2为特征向量，上一个步骤的输出，则有：</p><p>①加权卡方距离：计算公式如下，加权参数由线性SVM计算得到：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-2.png" alt=""></p><p>②Siamese网络：网络结构是成对进行训练，得到的特征表示再使用如下公式进行计算距离：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-3.png" alt=""></p><h3 id="2-DeepID1："><strong>2.</strong> <strong>DeepID1：</strong></h3><p>DeepID1 是2014年Deep LearningFace Representation from Predicting 10,000 Classes一文提出的，是DeepID三部曲的第一篇。DeepID1 使用softmax多分类训练，主要思想第一个是数据集的增大，包括训练集使用celebface，包含87628张图片，5436个人脸，增大了训练集；使用多尺寸输入，通过5个landmarks将每张人脸划分成10regions，每张图片提取60patches=10regions<em>3scales</em>2(RGB orgray)，第二个是网络结构，DeepID提取的人脸特征就是一个由连接第三层与第四层组成的全连接层特征，如下图所示，每个patches经过这个cnn网络，第四层的特征更加全局化（global），第三层的特征更加细节，因此DeepID连接了两者，以求同时包含全局，细节信息。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-4.png" alt=""></p><p>60个patches使用60个CNN,每个CNN提取2*160=320维特征（与水平翻转一起输入），总网络模型如下图所示，最后分别使用联合贝叶斯算法与神经网络进行分类，并比较结果。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-5.png" alt=""></p><p>模型最终以CelebFaces+中202,599图像作为训练集， patch数提升为100（10r<em>10s</em>2） ，特征数提升为100<em>160</em>2=32000 然后使用PCA降为150维 ，使用联合贝叶斯算法进行验证， 最终在LFW上达到97.20%的验证准确率。</p><h3 id="3-DeepID2："><strong>3.</strong> <strong>DeepID2：</strong></h3><p>DeepID2是Deep Learning Face Representationby Joint Identification-Verification一文提出的，对DeepID1进行了进一步的改进，提出了contrastive loss，在分类任务，我们需要的是减少类内差距（同一人脸），增加类间差距（不同人脸），softmax loss分类的监督信号可以增大类间差距，但是却对类内差距影响不大，所以DeepID2加入了另一个loss，contrastive loss，从而增加验证的监督信号，就可以减少类内差距。</p><p>网络结构类似DeepID1,不同之处在于使用了两种不同的损失函数，网络结构如下图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-6.png" alt=""></p><p>损失函数：</p><p>①分类信号，Softmax loss。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-7.png" alt=""></p><p>②验证信号，contrastiveloss，使用l2范数距离表示，m为阈值不参与训练，括号内的θve={m}，该损失函数可以让类间的距离给定一个限制margin，即m大小的距离。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-8.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-9.png" alt=""></p><p>两loss的组合方式： 首先使用2个输入，计算Softmax loss和contrastive loss,总损失为二者通过λ加权求和，通过总损失来执行梯度下降更新卷积参数，通过Softmax loss来更新softmax层的参数。</p><p>整个模型使用celebrate+数据集训练，每张图片使用了21 facial landmarks，分成200patches（20regions<em>5scales</em>2RGB&amp;Gray)，水平翻转后变为400patches，使用了200个卷积神经网络，提取400（200<em>2）个Deepid2特征，使用贪婪算法降为25个Deepid2特征，使用PCA将25</em>160Deepid2特征降为180维，最后使用联合贝叶斯算法进行验证，最终在LFW上得到的最终准确率是98.97%，使用7组25个Deepid2特征，SVM融合可得到准确率为99.15% 。DeepID2在2014 年是人脸领域非常有影响力的工作，也掀起了在人脸领域引进 MetricLearning 的浪潮。</p><h3 id="4-DeepID2-："><strong>4.</strong> <strong>DeepID2+：</strong></h3><p>DeepID2+源于论文Deeply learned facerepresentations are sparse, selective, and robust，DeepID2+是对DeepID2的改进。①卷积层在原来基础上再增加128维，第四层全连接层从160增加到512，训练数据增加了CelebFaces+ dataset，WDRef等，有12000个人脸的大约290,000张图片； ②每个卷积层的后面都加了一个512为的全连接层，并添加contrastive loss监督信号，而不仅在第四层全连接层上有 。网络结构如下图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-10.png" alt=""></p><p>最终在LFW数据集上准确率为99.47%。</p><h3 id="5-DeepID3："><strong>5.</strong> <strong>DeepID3：</strong></h3><p>DeepID3源于2015年的Deepid3:Face recognition with very deep neural networks论文，该论文探究了复杂神经网络对人脸识别的作用。论文研究VGG与GoogleNet用于人脸识别的效果，论文在VGG和GooLeNet的基础上进行构建合适的结构，使得方便人脸识别。结果发现DeepID3的结果和DeepID2+相当，可能是由于数据集的瓶颈，需要更大的数据才能有更好的提升，两个网络结构如下图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-11.png" alt=""></p><p>网络输出使用PCA降维到300维的向量，使用联合贝叶斯算法进行验证，最终在LFW上得到的最终准确率是99.53%。</p><h3 id="6-FaceNet："><strong>6.</strong> <strong>FaceNet：</strong></h3><p>FaceNet由论文Facenet: A unified embedding forface recognition and clustering提出，这篇 2015 年来自 Google 的 论文同样具有非常大的影响力，不仅仅成功应用了 TripletLoss 在 benchmark 上取得state-of-art 的结果，更因为他们提出了一个绝大部分人脸问题的统一解决框架，即：识别、验证、搜索等问题都可以放到特征空间里做，需要专注解决的仅仅是如何将人脸更好的映射到特征空间。FaceNet在DeepID的基础上，将 ContrastiveLoss 改进为 Triplet Loss，去掉softmaxloss。FaceNet实验了ZFNet类型网络和Inception类型网络，最终Inception类型网络效果更好，网络结构如下图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-12.png" alt=""></p><p>FaceNet没有使用PCA降维，而是在网络中直接训练输出128维的向量，用全连接层来完成降维，最后的128维的向量经过Triplet Loss。</p><p>Triplet Loss输入不再是 Image Pair，而是三张图片（Triplet），分别为 Anchor Face（xa），Negative Face（xn）和 Positive Face（xp）。Anchor 与 Positive Face 为同一人，与 Negative Face 为不同人，在特征空间里 Anchor 与 Positive 的距离要小于 Anchor 与 Negative 的距离，且相差超过一个 Margin Alpha。</p><p>loss的目标为：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-13.png" alt=""></p><p>总loss公式为：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-14.png" alt=""></p><p>Contrastive Loss与Triplet Loss的比较， Contrastive Loss目标是减少类内差距（两个蓝点），增加类间差距（蓝点与红点）；Triplet Loss则是输入三张图片，Anchor 与 Positive 的距离要小于 Anchor 与 Negative 的距离，且相差超过一个 Margin Alpha，即Triplet Loss同时约束了两个距离。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-15.png" alt=""></p><p>最后FaceNet在LFW数据集上达到了99.63%的准确率。</p><p>基于 ContrastiveLoss 和 Triplet Loss 的 MetricLearning 符合人的认知规律，在实际应用中也取得了不错的效果，但同时也有很多问题，由于ContrastiveLoss 和 Triplet Loss 的训练样本都基于pair 或者 triplet 的，可能的样本数是 O(N2) 或者 O (N3) 的，所以模型需要很久的计算才能拟合并且训练集需要足够大。</p><h2 id="三、总结"><strong>三、总结</strong></h2><p>本期文章主要介绍人脸表征相关算法和论文综述，主要是2014年到2016年的研究成果， ContrastiveLoss 和 Triplet Loss在实际应用中也取得了很好的效果，但是也有很多问题，由于Contrastive Loss 和 Triplet Loss 的训练样本都基于 pair 或者 triplet 的，可能的样本数是 O (N2) 或者 O (N3) 的，所以模型需要很久的计算才能拟合并且训练集要足够大，所以在之后的人脸识别研究中，大部分在于loss函数的研究，这部分将会在下一期给大家介绍。</p><h3 id="参考文献：-3"><strong>参考文献：</strong></h3><ul><li>【1】 Taigman Y, Yang M, Ranzato M A, et al.Deepface: Closing the gap to human-level performance in faceverification[C]//Proceedings of the IEEE conference on computer vision andpattern recognition. 2014: 1701-1708.</li><li>【2】Sun Y, Wang X, Tang X. Deep learning facerepresentation from predicting 10,000 classes[C]//Proceedings of the IEEEconference on computer vision and pattern recognition. 2014: 1891-1898.</li><li>【3】Sun Y, Chen Y, Wang X, et al. Deeplearning face representation by joint identification-verification[C]//Advancesin neural information processing systems. 2014: 1988-1996.</li><li>【4】Sun Y, Liang D, Wang X, et al. Deepid3:Face recognition with very deep neural networks[J]. arXiv preprintarXiv:1502.00873, 2015.</li><li>【5】Simonyan K, Zisserman A. Very deepconvolutional networks for large-scale image recognition[J]. arXiv preprintarXiv:1409.1556, 2014.</li><li>【6】Szegedy C, Liu W, Jia Y, et al. Goingdeeper with convolutions[C]//Proceedings of the IEEE conference on computervision and pattern recognition. 2015: 1-9.</li><li>【7】Sun Y, Wang X, Tang X. Deeply learned facerepresentations are sparse, selective, and robust[C]//Proceedings of the IEEEconference on computer vision and pattern recognition. 2015: 2892-2900.</li><li>【8】Schroff F, Kalenichenko D, Philbin J.Facenet: A unified embedding for face recognition andclustering[C]//Proceedings of the IEEE conference on computer vision andpattern recognition. 2015: 815-823.</li></ul><h2 id="系列4：人脸表征-续">系列4：人脸表征-续</h2><h2 id="一、人脸表征-2"><strong>一、人脸表征</strong></h2><p>把人脸图像通过神经网络，得到一个特定维数的特征向量，该向量可以很好地表征人脸数据，使得不同人脸的两个特征向量距离尽可能大，同一张人脸的两个特征向量尽可能小，这样就可以通过特征向量来进行人脸识别。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-16.png" alt=""></p><h2 id="二、论文综述-2"><strong>二、论文综述</strong></h2><h3 id="1-L-Softmax："><strong>1.</strong> <strong>L-Softmax：</strong></h3><p>Softmax Loss函数被广泛应用于深度学习，较为简单实用，但是它并不能够明确引导神经网络学习区分性较高的特征。L-Softmax能够有效地引导网络学习使得样本类内距离较小、类间距离较大的特征，L-Softmax不但能够调节类间距离的间隔（margin）大小，而且能够防止过拟合。</p><p>L-Softmax是对softmax loss的改进，softmax loss公式如下所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-17.png" alt=""></p><p>其中 fj 表示最终全连接层的类别输出向量 f的第 j个元素, N为训练样本的个数，则 fyi可以表示为 fyi=WTyi xi，其中 0≤θj≤π，最终的损失函数可得：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-18.png" alt=""></p><p>softmax的目的是使得WT1x&gt;WT2x，即 ∥W1∥∥x∥cos(θ1)&gt;∥W2∥∥x∥cos(θ2)，从而得到输入x（来自类别1）输出正确的分类结果。L-Softmax通过增加一个正整数变量m，从而产生一个决策余量，能够更加严格地约束上述不等式，即：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-19.png" alt=""></p><p>其中0≤θ1&lt;π/m。如果W1和W2能够满足∥W1∥∥x∥cos(mθ1)&gt;∥W2∥∥x∥cos(θ2)，那么就必然满足∥W1∥∥x∥cos(θ1)&gt;∥W2∥∥x∥cos(θ2)，这样的约束对学习W1和W2的过程提出了更高的要求，在训练学习过程中，类间要比之前多了一个m的间隔，从而使得1类和2类有了更宽的分类决策边界。这种Margin Based Classification使得学习更加的困难，从而使类间距离增加了一个margin距离，L-Softmax loss的总公式如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-20.png" alt=""></p><p>当m越大时，分类的边界越大，学习难度当然就越高。</p><p>论文仅使用了WebFace数据集作为训练集和一个简单的卷积网络，就在LFW上达到了98.71%的正确率，证明了L-Softmax loss取得了比softmax loss更好的结果。</p><h3 id="2-SphereFace"><strong>2.</strong> <strong>SphereFace :</strong></h3><p>SphereFace在MegaFace数据集上识别率在2017年排名第一，提出A-Softmax Loss使人脸识别达到不错的效果。A-Softmax Loss基于softmax loss和L-Softmax loss，在二分类模型中，softmax loss为：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-21.png" alt=""></p><p>如果x为类别一，则希望p1&gt;p2,则二分类的划分函数为：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-22.png" alt=""></p><p>权重归一化||w||为1，b为0，此时特征上的点映射到单位超球面上，则二分类的划分函数为：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-23.png" alt=""></p><p>然后使用与L-Softmax loss相同的原理，使</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-24.png" alt=""></p><p>则A-Softmax Loss最终为：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-25.png" alt=""></p><p>因此A-Softmax Loss是样本类别之间产生了角度距离，让决策函数更加严格并且更加具有可区分性。当m增大，角度距离也会增加。</p><p>A-Softmax与L-Softmax的最大区别在于A-Softmax的权重归一化了，而L-Softmax则没有。A-Softmax权重的归一化导致特征上的点映射到单位超球面上，A-Softmax仅仅能从角度上划分类别，而L-Softmax是在角度与长度方向进行考量，两个方向如果划分不一就会收到干扰，导致精度下降。</p><p>SphereFace使用的模型如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-26.png" alt=""></p><p>训练与测试过程如下图所示，在测试过程中使用余弦计算相似度：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-27.png" alt=""></p><p>最终SphereFace在训练集较小的情况下，LFW数据集上准确率为99.42%。Sphereface效果很好，但是它不优美。在测试阶段，Sphereface通过特征间的余弦值来衡量相似性，即以角度为相似性的度量，在训练阶段，其实Sphereface的损失函数并不是在直接优化特征与类中心的角度，而是优化特征与类中心的角度在乘上一个特征的长度，这就造成了训练跟测试之间目标不一致。</p><h3 id="3-Normface"><strong>3.</strong> <strong>Normface :</strong></h3><p>在优化人脸识别任务时，softmax本身优化的是没有归一化的内积结果，但是最后在预测的时候使用的一般是cosine距离或者欧式距离，这会导致优化目标和最终的距离度量其实并不一致。 Normface的核心思想是既然最后在特征对比的时候使用归一化的cosine距离，那么在训练的过程中把特征也做归一化处理，做了归一化之后，softmax的优化就变成了直接优化cosine距离了，归一化过程如下，其中e是为了防止除0的较小正数：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-28.png" alt=""></p><p>相应的损失函数如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-29.png" alt=""></p><p>其中 W 是归一化的权重，f_i 是归一化的特征，参数 s 的引入是因为保证梯度大小的合理性，去掉bias是因为softmax之前的fc有bias的情况下会使得有些类别在角度上没有区分性但是通过bias可以区分，在这种情况下如果对feature做normalize，会使得中间的那个小类别的feature变成一个单位球形并与其他的feature重叠在一起，所以在feature normalize的时候是不能加bias的。</p><p>Normface使用了较小的模型使用多种loss训练，然后在LFW数据集上测试，证明了feature normalize的效果，结果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142413.png" alt=""></p><h3 id="4-CosFace"><strong>4.</strong> <strong>CosFace :</strong></h3><p>Normface用特征归一化解决了Sphereface训练和测试不一致的问题。但是却没有了margin的惩罚，腾讯AI Lab的CosFace或者AM-softmax是在Normface的基础上引入了margin，损失函数为：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-30.png" alt=""></p><p>其中特征与权值都做了归一化：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-31.png" alt=""></p><p>分类决策为：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-32.png" alt=""></p><p>，比之前增加了m的margin，m 是一个超参数，控制惩罚的力度，m 越大，惩罚越强。</p><p>CosFace使用mtcnn进行人脸检测与对齐，人脸表征训练模型使用基于residual units 64层卷积网络的Sphere Face，在5M的训练集上训练，在LFW数据集上测试，精度达到99.73%。</p><h3 id="5-ArcFace"><strong>5.</strong> <strong>ArcFace :</strong></h3><p>ArcFace源于论文Additive angular margin lossfor deep face recognition，也叫做InsightFace，论文基本介绍了近期较为流行的人脸识别模型，loss变化从softmax到AM-softmax，然后提出ArcFace，可以说起到了很好的综述作用，论文从三个方面探讨影响人脸识别模型精度的主要因素。</p><p>（1）数据：数据方面，论文探讨了各个数据集的数据质量和优缺点，并对MS-Celeb-1M，MegaFace FaceScrub做了清洗，清洗后的数据公开。</p><p>（2）网络：详细对比了不同的主流网络结构的性能，包括输入层尺寸大小、最后输出几层的不同结构、基本网络单元残差网络的不同结构、主干网络的不同模型。经过实验的证明，最后的网络结构：输入图片大小112x112；第一层convLayer 卷积核为3<em>3 stride 1时，网络输出7</em>7；主干网络使用ResNet100，并使用改进后的改进的残差网络结构，如下图；最后的几层输出层为最后一个卷积层后+BN-Dropout-FC-BN的结构。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-33.png" alt=""></p><p>（3）损失函数：与 AM-softmax相比，区别在于Arcface引入margin的方式不同，损失函数为：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914142652-34.png" alt=""></p><p>Arcface的m是在余弦里面，AM-softmax的在外面，ArcFace更为直观并且在超球面维度上有更清晰的解释。Arcface在VGG2和MS-Celeb-1M数据集上训练，在LFW数据集上精度达到99.83%。</p><h2 id="三、总结-2"><strong>三、总结</strong></h2><p>本期文章主要介绍人脸表征相关算法和论文综述，人脸检测、对齐、特征提取等这些操作都可以在静态数据中完成，下一期将给大家介绍在视频数据中进行人脸识别的另一个重要的算法，视频人脸跟踪的概念与方法。</p><h3 id="参考文献：-4"><strong>参考文献：</strong></h3><ul><li>【1】 Liu W, Wen Y, Yu Z, et al. Large-MarginSoftmax Loss for Convolutional Neural Networks[C]//ICML. 2016: 507-516.1708.</li><li>【2】Liu W, Wen Y, Yu Z, et al. Sphereface:Deep hypersphere embedding for face recognition[C]//The IEEE Conference onComputer Vision and Pattern Recognition (CVPR). 2017, 1: 1.</li><li>【3】Wang F, Xiang X, Cheng J, et al. Normface:l 2 hypersphere embedding for face verification[C]//Proceedings of the 2017 ACMon Multimedia Conference. ACM, 2017: 1041-1049.</li><li>【4】Wang F, Cheng J, Liu W, et al. Additivemargin softmax for face verification[J]. IEEE Signal Processing Letters, 2018,25(7): 926-930.</li><li>【5】Wang H, Wang Y, Zhou Z, et al. CosFace:Large margin cosine loss for deep face recognition[J]. arXiv preprintarXiv:1801.09414, 2018.</li><li>【6】Deng J, Guo J, Zafeiriou S. Arcface:Additive angular margin loss for deep face recognition[J]. arXiv preprintarXiv:1801.07698, 2018.</li></ul><p>From： <a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1160037?from=article.detail.1344438">https://cloud.tencent.com/developer/article/1160037?from=article.detail.1344438</a></p><p>出品 | 磐创AI技术团队</p><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="ai" scheme="https://blog.17lai.site/categories/ai/"/>
    
    
    <category term="ai" scheme="https://blog.17lai.site/tags/ai/"/>
    
    <category term="face" scheme="https://blog.17lai.site/tags/face/"/>
    
  </entry>
  
  <entry>
    <title>自动曝光原理</title>
    <link href="https://blog.17lai.site/posts/509c7bd3/"/>
    <id>https://blog.17lai.site/posts/509c7bd3/</id>
    <published>2021-09-14T01:25:00.000Z</published>
    <updated>2022-03-16T12:29:05.978Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="自动曝光的原理">自动曝光的原理</h2><p>曝光是摄影中十分重要的一个环节，它决定了一张图片的明暗，如下图所示，第一张图片太暗，而第三种图片太亮。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914131959.jpeg" alt=""></p><h2 id="曝光由什么来决定"><strong>曝光由什么来决定</strong></h2><p>使用过数码相机的人都知道曝光由光圈、曝光时间、ISO三者共同决定，详细的关系就不赘述。</p><h3 id="光圈：控制进光量；"><strong>光圈</strong>：控制进光量；</h3><h3 id="曝光时间：光到达的时间长度；"><strong>曝光时间</strong>：光到达的时间长度；</h3><h3 id="ISO：增益；"><strong>ISO</strong>：增益；</h3><p>但是对于手机以及其他电子产品使用的微型摄像头，光圈大小是固定的，所以手机拍照的曝光由<strong>曝光时间</strong>和**增益(ISO)**来控制。</p><h2 id="什么是自动曝光"><strong>什么是自动曝光</strong></h2><p>数码相机中有一种手动模式，可手动设置光圈、曝光时间、ISO来控制曝光，该模式的使用对摄影师的要求会比较高。另外 数码相机的全自动模式、光圈优先模式、快门优先模式以及手机等电子产品的曝光都属于自动曝光。</p><p>自动曝光就是相机代替人的操作，自动调节曝光时间、光圈、ISO进行曝光，使得所摄物体亮度正常。这句话解释起来很简单，但是存在两个难点问题：第一，相机不如人眼这样可以直观的分辨图像明暗，如何判断这幅图像是否亮度合适；第二，如何调整曝光时间、光圈、ISO,这三者调节的比例。</p><h2 id="自动曝光的标准"><strong>自动曝光的标准</strong></h2><p>在此之前需要了解物体的亮度与色彩是由物体对光线的反射率来决定的。例如纯黑色的放射率是0，纯白色的反射率是100%，处于中间的灰度的反射率是18%，这就是18%中间灰度。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/09/1420210914132002.png" alt=""></p><p>具有一定反射率的物体在最终的图像中被还原到了其相应的灰度级，这就意味着达到了正确的曝光。例如摄影师们通常在拍摄之前使用中性灰卡测试曝光是否正常。</p><p>但是相机在各种场景下无法识别物体的反射率，因此采用了一个简单粗暴而又行之有效的方法，统一将图像整体平均亮度设置为中性灰的亮度。该方法基于**科学家认为自然界的平均反射率是18%**这一理论。当然，这个方法也不是走遍天下都不怕，比如拍摄雪景时需要增加曝光补偿，不然会偏暗，因为雪景的亮度远远大于中性灰度。这也就是摄影中的一句口诀的由来“白增黑减”。</p><h2 id="自动曝光算法"><strong>自动曝光算法</strong></h2><p>上面已经讲了自动曝光的标准，也就确立了曝光目标，要达到这一目标还要自动曝光算法来实现。</p><p>目前比较常见的算法有平均亮度法、权重均值法、亮度直方图等。其中最普遍的就是平均亮度法。<strong>平均亮度法</strong>就是对图像所以像素亮度求平均值，通过不断调整曝光参数最终达到目标亮度。而<strong>权重均值法</strong>是对图像不同区域设置不同权重来计算图像亮度，例如相机中的各种测光模式的选择就是改变不同区域的权重。<strong>亮度直方图法</strong>是通过为直方图中峰值分配不同权重来计算图像亮度。</p><p>自动曝光实现的过程：</p><p>第一步：对当前图像进行亮度统计；</p><p>第二步：根据当前图像亮度确定曝光值；</p><p>第三步：计算新的曝光参数，曝光时间、光圈、增益；</p><p>第四步：将新的曝光参数应用到相机；</p><p>第五步：重复步骤一到四，直到亮度满足要求。</p><h2 id="曝光参数调整-曝光表"><strong>曝光参数调整_曝光表</strong></h2><p>前面留下两个问题：“第一，相机不如人眼这样可以直观的分辨图像明暗，如何判断这幅图像是否亮度合适；第二，如何调整曝光时间、光圈、ISO,这三者调节的比例。” 第一个问题在前面有过解释，第二个问题也就是自动曝光实现步骤的第三步，曝光值由光圈、曝光时间、增益沟通决定，当计算出一个曝光量，曝光三要素有很多种组合方式。一般情况下有曝光曲线，每个曝光量对应一组参数。手机中曝光曲线可以通过Tuning调整。</p><p>From: <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/33462189">积极的悲观主义者</a></p><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="image" scheme="https://blog.17lai.site/categories/image/"/>
    
    
    <category term="3a" scheme="https://blog.17lai.site/tags/3a/"/>
    
    <category term="ae" scheme="https://blog.17lai.site/tags/ae/"/>
    
    <category term="image" scheme="https://blog.17lai.site/tags/image/"/>
    
  </entry>
  
</feed>
