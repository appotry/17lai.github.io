<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>夜法之书</title>
  
  <subtitle>深度思考，深入生活！文章持续滚动更新！</subtitle>
  <link href="https://blog.17lai.site/atom.xml" rel="self"/>
  
  <link href="https://blog.17lai.site/"/>
  <updated>2022-03-24T13:50:17.518Z</updated>
  <id>https://blog.17lai.site/</id>
  
  <author>
    <name>夜法之书</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ISP（图像信号处理）算法概述、工作原理、架构、处理流程</title>
    <link href="https://blog.17lai.site/posts/798e6e62/"/>
    <id>https://blog.17lai.site/posts/798e6e62/</id>
    <published>2022-03-24T13:50:17.399Z</published>
    <updated>2022-03-24T13:50:17.518Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉, 这个密码看着不太对, 请再试试." data-whm="抱歉, 这个文章不能被校验, 不过您还是能看看解密后的内容.">  <script id="hbeData" type="hbeData" data-hmacdigest="c5805803c01656600b3f981a838ea275b38769b9dc6b7c59e51e170edae62f98">9e6b07150603c85d3bb35cb0d64d79617e68d964baae8aadccd5ce24944ece1608f3081fa2577633745a1864efc962c1637ae08b208bb3faa6156941aeaf7d915fd0158c52410ede5fcb5adb8e57007292c749de62e16388419b10fc9f7cc6159d9679615d1270fbc5a6e02d54726938886d87595ef2a30fb184723fc8c5752af817f2b1d6b639e025b9495e299dedb81c99152914cef40248e861d7a2c692ddfc854182b2903c80b7f058ea2a4b356a68b5989d3fb5161ad967a412130fe43c296a075886615f89704be109935b51b5eba0201a6e5a277a29d2c92c27d2f4b3f12907855422a3d82c0cc55879682b4adac8cbdcf1f1bfa918690849e027a445641df02114d8ca7792324205829ae852aa4341abd5585f52e6a151ab0ca44c3310ce6581c95b621fc33b641ed53216ad22faf93a857b04a186472fd62190d6a25b92fcc74700f230cdea658c2648dc64351025d5490524a8a6b21514e66892b984a28181758b057452b6487754038aba4be24234c0deff8128f64c0d915a355dc7279e4f813d8074e127113fea259b1dd3d2e6e3b9537c2029de047be3b1458819e0480231d0c03218ae238d81fd365ed8aef705bec9d5e9d6b7ae982a3f57948886a4ddd62773ec4a4ca69fd6d6f1f353d3cfeddb41800b90f600ef4c61d5dede9f6716921aaacf4f6f679680476c2aa4eb9eb43fd8bde4c6ef6832f30fad3673a10f4789e46fdc9ed38fba9fe7812748dfee9dbbce38960f0ffa46e373d3a3bea16ff0f30673d14250debb2e1002d577383a10b99465184c9db5ac6f9423f2fff3f7d017d7ebdc819b1d75f8c76f85a5cdcdcd27c48bbaf59c504257a9d0465dfafc985c616202a2d3a3b650a1675e07182fdafe904ea9dc88e80afdf2227072b44b113a781742ddda51e357f7d5586272c4de9df545ddf54e581a245496df81bfdfd2c65d26cb34a4ae6ff4bce47963737485932775a5ca83add652fd7efb1090c722444e48416da2227f6d4c84dd9d3c483c02f243704292d3156031923f58e912ceaba76d3c27cb28a152bd69292c40f90b5744c0fa658f521c5f5b1a30da69640f6204a2b237fb0bf107c2529ae9956960c2478930164ea2c7af719902e3a31879695775c7d11e313fba81dcf7132f7078ffc9796542ea69a5850af3a836f00b929362e46fe7fa40c2a02abcc62bc0866a3c104972f841cbcf62db373de9aefcd3c886321525b824be6c60b45da66d33bcf43b6be5f28b076093c0c5035012e0a393d01cbdd258cb9ebe04e23f026b135d03d738aae504c4ddd41ba76ca2a92a86540a2b966783d59eef50012aadf82214fb8f5a1fd7e4a77ef0ff2ab17034f67f4309d86ee8dbd069bc54aae0e223a0b0ec41f3a4e1e81a0e4c47363efbca6d187775d5b544e561e97f5982f73728f75a3d72a197fe12c83b8154f7eecb3b3efb8ce96e0de51e06edb503d55f9b18fd7002e7deddfe2002232224645c243b0cbe891f6a647cc17fde3b346b2c65b224190b29d825be0286fa1eb79cf84637a8b07bfd8190592126f30d72bfad8c1a43ea8a06434c47330c3ab84497bfdd64818e8dfe08e13bb7e4cc50b6bfb9c3b149620dd36c3b68f604b6793a3e5f9ed2d29b5546193062f503792e2548fbc117a95eed6a1538eb9364b10b660970e2d58186a21851bedc99088b9622b792a6cd33471482c8905bd97dcc111d5f1d49c411e64767e8743f1ae897e94d8f84a2db17b1ded95e298adb0a673ba2437efa427184c79a781408190a0de260d6b4e715c952291c02a4a9c6f9d3dc053743d81f9b1c69d1917e80e5864eeab3186455ad3e5b00a6d62f23579ff120fc75e0da93f11506612943fde2e2c98ecc66ade83f358099629b7e2732e7c960552521d77084e1016b4be99076289193ad81f4b417767c145a3ef94b89a77ec558cc090503d1ffb51cdb95921a67379056ce3805fc7cb42383e40cf98873e124e43a6122db72868990f7852ea8d50eab5e3d70943312fc8edb25cae50918e7d13b4c13abd42172b5c5a989f6e88b24e4e13745b3260c118357bf728acfae3dbb1134d3ad6b3e9f47dde600c235abf70f729d79e4d852a2de258fb6b8b39d510bee76600ce2734dbe5c23c91a78d2fd66cb9dd6d1f4b3c4a012d67681601098ce8b4cce926ac3c224fadc6de42d99ebdcdd5db0c494347c19defccedc750d2df6347ddf6bdbc9743fd2b732995da97726bad1f3ff8352b2248d9e2f0409161c9fc6ca6ac4e1365b0b3344c1519a33e8217e2ba4c9ece00227028d9f6090177bd7582ea5dcd553d7355fdd114d306e1ea7c3eef4500b36070c364df8e6daef8caf7babda231c4898557b4081ba4d7089b540c808d4d4533f59669f9baf1734f368e745ed033258f22ba1db8dd224f112a7dbc6d4b4762aa97b3b6fda185b5eabffcb57c9a856c130f1f8ee382b53441adfd40b3d427360bbc1f953771095ce9ce5b69fc7ace4a50b8caab68335df55cab758083d40b9f9452e88743868302713bd8ef83a0d2594f9d15fb72a4822c4339cf745081c01ca11aa76beecc60bc0ad0ef17741e1e1468f39201991cd398f75cdd7d6852ade927e12087631ad7caa0e1e4af9fc317d32216fb1c9310304f9ebd0c161595fe7f0c4c4d92e2168d94cbfd85438e29ea6f2150414cf67e123cae7357be9c29caedb106334688798e4a94a194a43b059fc66367d17cc3f2416a2442b5e94975a0a5b65ba552ff376fffacf657447615fc8e34574471d1879b339de690ef4e34696f4aa66ffd9969c593ae9f96c1103141a75155fc469918ab7c65a8cfd2e5c667a38bf1eb0eaa6d6c8017fb27cfe921e4e0c3659c3b1f95848acc3df6fcb1dcd00f27fae59b79313ebafaef90229434bd1510b99aad8c95190ecf064ae02a1db83d5cf92d5b968e86df9a91dddc2183016dc2742172e5fa4bce177dd424572424d79b1136bb0b791360780ee54b4d7161e83937b9bd81ff7eb385ff3b66f45e4cab9bf0fd74254981a894669a9949d49656e5f4a8e852588409c930150695fc22aab2ccfb80cfe5ab8d708175c1ed95958b90a10b273149a98177eb03ed495c3b8a6a1c2d6bd5767d2334060d05df57d3efec039ba883e7351d820ff857403319f73be13c000874e9af0c910f1c855acf3c60253b53a5f33d7a9a66ec1d3520321b77a73d869c9cdd1f1f32772bce3797f3c205bf859adcffa6dc0db85504f7d39fcdb1dc6af38768e8644c8b8f6c9daf4979f8d604e1bdb5e1fc90c7228693f97b7039a6ce5dc6a488b822659289de8b5580b0bd5d12db21c9a852f65c538f35c3bc8471845cae302e418794c268e30f56eee76a614524ab3090f6b06d605b9bfdb0867aeeb48e268f3fd3537abf9504bde28dbb8df6b4942ff7cef66ec3a6c86e1dde39f302d817ad17e9aa6946eff8c4be7903fdc4bbd975997d1aeea634cb29149d29e3fa14373178dca51d3bbdb52bb308739d972e986c4500cf177bebf47a782b5615fea3064bdf4a5c5f452d7f7bb99bfba034a2092949142b8ba538d6b2ce51332b11080d100fa096cd14f319db3a7d1bfafb04ee253b175e2077cee862cc1ec57780cd010463373bdcf2acfc545c81d908ff51fd86b8152be3c892439e264a8355b529d47cc11d5076ab955010fa6066200eef49e023c1c960a6a97b580c4201f2a682d7f511407b590608a09e4ded3e10b0de25132c8499de6a0856dfc04db4d68d2c615231a2b7da3b243b941e65235a15293e80ff15ab4318c50e243ef11706113e3ba3619079e3fd5ec3ff7a12a1725411d3c78581b9fa9e8a1c5e072f19ae3716dd14b5921f625e168926bb3d080f07dc180afb7589d68617e6bc775e40f8da16560773cdcbee0582df7838203488108b891ae82ebb855932967a7ed85f4dbf8ef1a5cec3d8d38ce985d4b3951fd2b5b905f539da433392806b1bf7919ad486c02a58486b6b6d83ce2c280750efa06f78ae488fac5020f253929e810bb79f9cf41ab43fdd00225ee65a5d4179d0f8738e07f783a7d5a16ebb6a67cbf1e8a6b1c3cf3fbe617032bf85976949ee08e7d2953271019f4f384cede1011fca153992b6f8e2d929224f1ea90beb0b5f6ecbd3c90e2ccb9dc46307a39bbcc73c337786ed9c249b19711c691c3444e000fc47db8f1004d027f731df1c85e87ef92396482d50fec585fe71a43660710f50a23bfb43d5d04053c6d5dec2284a15fa1b63d53d2858d939a641b1e09ba26b3d1c9a952abb38e29360d63403ab7def5321fdcd9ace49ddb36bd724ae944f38a23207653172667a86f158ed3f76ff590a550011e769122530020e3e49b9a2ede5f1ee737bc78a4c30d0242367bb5c8023e198b9364256466719d4b6fa5c59a6802c5663eaa13271fdd8cedf551f0ebdddd6cc2f4ce4b854a34091456b987f40b9530147290a41ce7b5889cdf6cc9533c868b40fe49617baa396158d60f9a1dbf9a4a85145892827e2ff6b22ff0d18404ba99d70f7e2b53bb2044e5a4b4ebefd3ef1460f8fb59a9af30bb370e0a8983751bbf34a40aaab281c632356d48b5a3d9deeebdf88ea6da168a20383427837f9ca761265f70c7be9d10f285fda7898bd70c45b1117bbf495cc0d648bb88565d495eb6b87f6793707608be1f05484ed3037ea137529ac7cc0469d3d9e82acfdb5178dd4744affc69438e4e39c5049dce42e697da90926e799871e7f26cd0d02eafe5ffaad176c3e47f5ae3bf2c896a4dabb623479467232990783a910d6cb5c1eb8c6924105a9de79b21d5c7dc46738eb87c5c16918db67ca897199188e57b49f1186bd7ffb48d37e71717b8123eec393919eae6b4db3d452de104221f84637e79bb62d2e7787dd066bf0ea86b61c38c7028e0c81da5feb5f780d26baf6bb75585912ec676f7620f7eadd1ef063f3243d5cadf99719b7c4c412f776ec66a73dc3ba2e1c7eb6fbfb2c570a27ab72e555d6da0f6e288f9a0641e7f456b9af465b2a7f6715095ffbdeae715d27ec8df9a611c612fb679c58b4ab555f65b702117955de81c77649598a1d33052738140613ad0d2b490339820871d51a18110c7da7d5282b0bd0453b5635ed8353b09111d49586986cddd8ddb318a18041775487ec44ef3653661edd3e35c400a568911cf5cc010391beeb40c386fa015608affd447844c543bb8516a47d5ef49f6cd2cf3aa6c4879160441ea5ec04c652603d3ef784f897ba3071276cfd145754cbf8a5db2a889bfe4780268865b1dc7baf7044c68b1e4b829d91f2f6e699671f55b003209d3676644dc87b0b069130874449fa2f578c45d2b6b718d6aae0ae54cf077a6505b6be7d6aefa7b1c5658dd8348bb84c881dac1725f79d57d5fae168e611a289078789e22165ec68a9da6cb6f1d357c4fa586c973f4fca40d2f95d855c2d7080fa86d75b5b6bb7afabbe22b35a4fb5c52f18b2eb6d0efbdebce6ca643201277e8754be290aa2457cea0bcfd6add28fe9ba5f1d357fa3168a0bca12fd8be31faadb4888688e34d6adcf5186ba113da8342c3979e91a44739dc425d88d19c14f4d8b1f2b66706800d21c1bc5867b1bee99e8711b33f6aa47dc7744912a93542250b5eb706b5ae9b6a469178999926ac01ae00f7efb8913b709477a18a286f16b392785e630df77ab8ad8f6e7a078056adcad7dd1b6ed8156107bb60c8b7731682844af69c94e014618e6b2e5e62d33b234f50ed0179383afe8f72dfc93185427ce05b439a6ad97d56f8535938b0a9c3b5c537c4261b9b26bf75203580eebdc865d207ee2f3f433e84f157f79f71f268347bc0e4dea16327084a72d7aec2906e02c4812ce13a221502cf4cace1ef94080af959aa5efed4ef3378d40d367156df3f6718c307eb3eb4b928a0114947bb873c37d1c59376b396109def3be0765adccf6960cb0421c91245106c91e2f06a42265a5fc38417b6e72aab3fcb677eedff4b6abc94ce67a0d10ce44ee9a2abe18b1d5b8d181bb5746608ee2c4ea00ecce8dd37cda1ee9747938a683e23b244283a1b0da6637a61d517031c309b521973d1886332c4237be29cdb0e27f19749d979390e9542fccbe80dc9444ba09aedd7ef874858a7a33d9fdbd0dd62d185cfe24d4ddfe4cd8c35b8d39d61b798abcd36d0e65f1379a10385684b17b692e50bb88091ad33df90ffb51c69180f07b0d4e2bda92d235c6e49ccd951417258f39a6dd6c6578ca93aa3d55b2a5798844124ca102b50b37637f32c21fe0a9ee37f32c31beaf4222b2ad3f40b2e1daa6446a7a600e4a8f23109a96282222185fce3b41ed7643d1c7549bd47c490e10fb87ccda12a4c92b86601b933ea72ff0c97316e2ad281c2e48f1bde74435c2ef6eaee5afc4d2a607e88f931e4b17aaeee58c4d8e5c19c51765f869e9370ee8661566fb8fdbd08537034d030ca0c3c4bbf6740483e05dcaf6811d53dc128e6f2befe0e6db5337fce65d42d1820846080bef26ea43e825b71bc0a868e2e7535ac6a0891f1b4120325e5f0fd27f2a30d3dda3d1d977e99933e018acf0a6ff9af421de2b775d22d39092635c062fbcb8de0cf532bd24c45e2a53a9cc9fd24e562694bb1488d33b63dd871c0534e4153e4b026e83b86840583996a4e25ddc1abb5e7fb3cd0ff91055546258793ae581b18382771eb73f42052ff12b326016ae456c56e7c5261f86ecf0bb18d87013d102c5fea05c2b0268e69b7091beb638d74f9a9e39cd4b5c04c0325718c12371fc0404c80718df270d1773adb7918a26ee89bf571dcb8da982372126e39ae7df9276a45e9670519cfdac0337b6aa5d29b4c14003dbc2458c26269099d8b419adefc6667548a65b8067f2ab76012d125650031c95e59259016b74106e34001aabad9db98f3006151a6f2113d04a9736cff99088809d3240c9437768c04036d8ef32f5a8d7976a9fb91c2570018a1eb1800db28acfa02221b88a6f10a45fc22804d80857fd4a4d22718687e1db760cb7aaf9c1c6d3cfd3d007beda836ecfe6ddf59237b005c6b1de32b23ca5891923ab67a5b080daf352ae5971e9d00c7f649138fcc2b30c2f7a53188156ea30c8bea7dfa7c2ceaca0780679f33dd072fdf05cb871884fbe2fa78799eb4ccfa76a117595b22f7ddf5d5f0d4ad561d1c85813f40e6d5835b3f7d0b770529fc23be013f08869fca2ad30d74cf0e13d694e19bdcb5dfb092e7824ee43a422968ea9f6258046020f3d77ac0ac8976e2b6f6d2f0056fbcde9c2d4c034018c00afe42236052e1288134567a58968cb2cb0a2a825ee2ff5974ac78ea66def609318cbed5fed38ad45dc039c4fae3607ecb1aff8cccd218e9615114eaab8107b40db2b7d99a58fefe102a0ec195bf7e1c93e1ca1db159ea22ed453c236444e440616a66e99e8f1204c545e168d7450ca6b8147611f1262a10cc20d3ae87970b7dbac0299e07c8319d6a11bff4f00cbbfc90683f1ab3b2a54559e007de618ead429a855b0f16a2d2ed9dec10c5ebeddb7eac43dd2f6e9b0eaecec3f23f07bfe56b511762378e8ff80884c981d1bd94de0800cf0e73dda20e17c1e4f20a847a17ac43fbee7721bd228732460f1e7847e0e75b31a73cbb3f3dbe3ac5143410d689aa4883f9631107907cdbe320f40647f423a40ea4c1d23c9fd3c737763903fab08809097a877274564ad650fc723cab74c778f72f631062a228a01d02c39195645b63dfe2fb77d1c385cc09706bfe00cffccc03ea8805fe8298690394315bf087d3725d5394e6df7893f2fb39bbba4f45dc4e0691d8a001ff3f700306094de08d9cf4e42d0fe4362490b7a9b89bda3b7680daaa58e9c2332e767d9708a9b2dba1c4f1886394130cd5559d712d675c1a6e6af7a33a2474ca8cc427c83f96a09c261c2c842fafe312cbed5166d3792bfafcaf45706021feee5d722518e956706c1fdb4c9b86ef4c12b588c374c96c019bceb9a2130083843b55d5051e220d3dc92e366d876afc234775b0867d80860c9a5713878dd5f3b7684b5b2a2f7a38d7f4ff8e4eae06b702acdcb51fa32c70a7fbc6003d6163f7ee167343003158ef2d639d807788be4ca9ae30dfa9b3205f010cfb53eb277c8719b1b23eb0128556544ca949f63f7cd44197dfdec164a2368d1d8a15ac3ed125e2d90b5ecd2b6057c2cdcb2a4ce12b60247885eb6b1c06d7c172dab31ad54723cf58b597655b82680e3ea18597ad3bd2d99d458683d9dceaf9fd98ca9abf3846fee8dc4cd4812a45a1dc1308d40bc4b4eb33f940e1338a94a7dfe705085b1367583d3df13b9cb4a7d08e647d84d02d71c0a646ba8ccd5e76f0179bb1aee209061137d859e66f753294f0958a55276f70f79925e15641728867b0129743c839f14824f54a8f6e5c36edb46009b74c2415e67f987e42b04e06ad9c8657c08c914cb752ac08bb0ba1d645435580193bc45e54f9f7547cbe2e62d7cd51feeeab914113c53c93bb97f2104d297c614dd8615ce2d584c8dc1fb4a66a4e379fa28e01f3409cc6050f6227ec01aa8767240eb6cc2151ecac19b00c2b1f9ce8e203da3ca238a6046a2da3a934efbc5883575086da0c90b39c19691f62f1ea7bfcea17bc595afa9997a794e3c396fea2ccd6b7f66bfd991ed2740899a3c437be02710102cf25ee489718e7b0ae47c16722ed19f75f16e3058c0421628de9555fc549cc7bbf65ad71701f2ac34e5fc766cd6537030a1863148ed9999eef6c339ca4811eb803c026a04e34072456493e71263950e07e10be6185c8d2fb72bf9f4c00ea1f3c76bf2866c1986567d9ddda71b8508b65ae4c2c84f43c55fadf1839e49bd9bbfcd5ea63a6c5ddde3db4633b9a9a6e54a24edaa0b212b24e93e7f52218679d46f49e7ba2c4d793416e5b4d27b19de4df13929a15f0d649bd50b2247e9963c771aaaf738a1c6cce0812b419a7a0b07f825f4f66c67de66330949c9c133e4a79a514b9e00a1a5358ef5d3be0ebe678127f0c0e29db3894834b208102ec2b91b299a14bec18ba8b003ed6a4cda3b87710d30cdaa9be3dd54af1c95a1d95935bb8a0840c5c804365f0077138a844b89a5dca9f001d74192ae4eaefc4625920b189a2ceff0a2d0d0ce7d104a212d45429bd9780a5fc76aa865de59fafa75fc27ef37a9e6f53582c564e8a649886059b33e900e40e05756036574618477ca7940f55b4cef015ac212473a1d08fb5d134cd2a01e2823fb491e87e3516967f6c5388afc2ded7d79fe9c239c893779c584d40a5f2fa1efd97fb1c7ca4abbd6edd49477c1e7fdd051915adc7032ed8b81584d656d3e2da1d663c71d807591f81499fbe1e1822517ab21055585a5bd5d675d317f7517faf9266688ca4b41590ef25fe75ae1f854bebd6f8fceca633be218653158961719846b1ce828a1737a7c686fc4b820871cdb35674c0d30e091a0229f41fec2b65ede7177e75a90d17549c8c8da771d6e8005b7fc4dd31f0237640ecfefa497303dc5e13ff907e8942df56232842547a4f603bae817bfdeeacb4c2537b5b60ea134ef3f53c894e5cdc1797f4599a342b4a553a3097dd0c4373bd7f020193b263a954dee1a9aa696a74e249be102fb31314539b37b4a83c6726e2f7b8df4a7c3d57084b17f6baa12fb493363c7ea24d07485a0aa53f31d0dd4e5f29690777b247e832ba64172d11edf283847a5f0e0564947313f9eb8aa005f1a6a675505f4df214130b63009862966d3500fe5dd289d13d1ed92b0552bd3d35fc125c25a3478976f76ec58af0cdec6d37c7a7c6bdb752f499586627ee0149857b96b1115c4d227b4807863ac2d93d6dcbd548ade91d8a1e1d44c501ee2b2f631159eea096c50effd24696822bdbccacb744e0a4e7017443055cf895ca3773026c482d30ed3497ea503d2a30c727139f0c07b07af5cf8bdbf7d7839a2f5d3be088b9f575f1040a604503aeea26d6390430fde931dd3e6ca7effe0f35d4a8e554889975ef916a1b3bd37cfb422f72cddf307616701d9420fcae7928191c14e9bcf74a82b843871df9903366d8c9b81187eec89aa3cee04d2e86b04c26b2a81f3ece8ec0dc180d77fd0ddbc4530f42115eb6799e25dfc1139381718b9f6a284bda8848f6d95699568393aff0dcc0f4d93ffb9b7e972d4eb30af45c3c6f2817ea899fdd174be8692253ca3db8564948222c06e77f31078ee080ba4e5c5585ae576505c02475d54b1e1b5ff7b05ca0cd6d208125a35fdae7af69c5a612e74606a21b52f0365052c76836f381b2e034507955a87e5d914e4d447992c9007cf0a0480d436f9be42cd7a044a629e464f9b7fb02e7cb74e0acba4e1f7697cb89730a371735488b8b2d30e69eef83528d8933503be00e2137f8e0f4616e88599b0cf9ef994b2ea3273d2a3c26e3199ac57eba6f6b2cc8ebc7cdd8702d835e89699764ab1d8a7fe2fb98d0a72dfcc6515496005594c64b3eac4aac6dde1ec52fe929ef0e053b03576d38e1f6567528cf9926ea5cf73fb6c6ab775d94c774733306af54af2db7a30375e9364164dcaac12ead8963c39f7e50e12fe7ce577c4875033e36fd1d0074240891469785ae0867e2c425702ba9d3331b29eb7657f38f87e430936ad7d9a6aa5335c02cb3d6c43589efbdd8444f93e2189ee7d07e842f91304bb1ae10af4013eb2b4d525c280c396435859a566d5a91c88bdc26ff4981a104682648c71fc47692413727e3c9fe6e4a91f4a91dc3643b465ae6d511ce73561df044d59da9f78d173cf1802e041b6ea41595e2ba8be60f629db8e37e50ddf8185c6e610bc56822683d886cb2dac77e9238d5c75e51b619a499fa9c5fca75a54dc723336010c7b422ba447082348f03e4b123ecbce9269d87c96d959676692693d02703490c403d86426b96231dfe9201c7e1df8630022e0698ce70a33277762023d8f7046145e2a4b6bc296de5fafc5fca52849bf07930299cf18cec444793f57a7497ce6fd71b0e5ca1ffa4164ee799e05b9d1b92623fc035c93dea173e02795bddfad48890950550d36f173cf7793d714f0179f18474f27745a907b99da016c6fc1da0329fb2a3ab50618e178a26d199cb5bcabd676135f7131363e83500a4ce1bf0a3d81f77df1fbad5f58e4d6649e8f698d3615d75cef5bfb86adafe5aabc1b0df5ae676c6e171f45dbef5c272349c4a4ff5ce44c40bfa5b7effede80d53083d5450b7aff69693aa91b642ef0f028f11bc3127de1007e0466f92b4fc077b563961448884654f13d54b054624da190fa1ea6cc21b5d364b1cbcbd324438e50f97f8c0b211da62d085a38ed392d9bd3fd1d4a56592ecc6e736f2d76c58f3531b3f3c306aa2893b7921fdd77f8632357bd539200a4cc347ab952b7a03971472c81851a79ffa6aa17a0dd2b0accb54e36bf2a0908046a9118965b3657c15507fb86d2d116b8050b0660c70306e77a4ad8d38655c6624bbb902c0d22f5c3dde2a25fd63a3cf41e78860302a093a19f07c979954965b45d580e0a76fb730461a8a1a79b6d5a58f41bd4f40e387be1a50a6846fb696a8ec40c7ae50a6d81bcca40d571dca18251686f0423faf7926fa691cbf9e1a7a076a543fddd9d7bb041b1fc0a6b5b96dfa8a56ce26bd5007c138fab978dfdd3158cee8ae64f925fad1d39248f34a5becfe88d00b821d97147bcf5496924703eb56dfbf84209067a3927e5f6e29c9349cacbe3e32d0b61d5dc985643bcb2dae3da52581d9426d4d3401b262a9bf7be0ffc786ba41f9f78503e5c2d82c698c86e59aabb1f1190a22fc9ac4b0371b6a8937e9a6c1f84a7fedac9766b5b65e5768dc50f712982f6e4a6a3a625a01c796256b90d61fcbe8593684bf4996036021d7d0c5098b3f8bd74de28f0c2d5c6f6e1d2ab5e7f03cc47af47b088a25045bc696e11959c41cbe7543ad5eae7cb2da0f44a25c4aa97b097f7569b392bba5f4f04f22066f8566b41b650384befb6a42b01cd28fda1b97b37c4ac20e5371f27ea1d2ef08db0d97c40e6c167c6116c7821660ef2f20a328a4a1bdfee1eb79f04c5bcb0a80e615ccea8369901a93af6765b54d39fe8ea6d77097b6791ccb39a500725dcff2f381cfaa3afab5309c901c9dccbd8e5a16f6129d2d3519a1364c8d3bc4a4e1a43d00dc80caa0a20ed283a8d09936c02cea3d2d24d0a1e2f1191323128f283b167b85ef45bf5c285e7340b1f6a160e88635b015fbe0e09b5d34a663db0e7a6918b3ff0c5367b22a1ff5980d830668b07a79825495397a7a06546225d5d50050a026cf10e351b317407448aa6e214220904222983fdbc9ce178acebd58aed940f810183d939bac3a50d5ec21470ac98a441f23d2ff4e230d1d2f23be2f6768bf09cc4f7059115df02c9b4d7ec2021a5584d93107c38d052b209cea55f6106dded82142a34a62fcc2c322620785a0e14cbf37e09c2390acee063c0b0d2278a4685dce9fcb546611970bd1ff6162730860b8e96f2f155c11199911d6cc7a68b8e17b71b7a593c20ae14bd9e710660e6d44dd2902ffb5a14db13314b60857b3c2f9aa906362e3bad7a2f49717f41de2e15f6cb1028f31e9033ec991a634896b4e478a8747eef7dbf2ff34d9a45a0a55c4b4df3a8f2bff47884ce2244428b3b993da86b90cf890dba715e15de3d50431911f976167f20fe94f9bd8430e5907c5f3b07970153f7df27939c11ecc7a81c2407a26972ff58e00f738831449ac297c2809faf64275205d216a759bfbadd30c3f515a2a3277cf381002708c4cda70d2905a335993b73ce86b93760e68e6ca6e9125b8c212e23f31ade12e3a3a4a4790c4b6dc902409d312bf13a448c4e4ffaecf573b44117a5029761a4a790822fcb52061453c8a5dd123da5baca34bfaa92c49fce2e1877b52072398675eeba46b700b032b958ee4771ff75cb74b2ad366c619daf15999efae152fd888c04d93ca4bce9fce75d1f403b13290e501ac24043a52bf64722df7c3e4aa62ea1641942503d50d5e76f71176930ed6b120826d4bfb0155a7d284096e32577456c6c100cbee2fe256a5782e52755ce0a5124445555553203acbc33864d6154d33aa3b5b15ffc81328aed7a37a548e5e9c143cc81af8887720952f3c345927a4f4d9cee13382dbc8e656cb63341274b9f5e242f9daae0e614955bae69e6bd3185da9597fe5a593c2a6143022de92892f7416c1ce6e06767dab2c061764b1cc81c32c9848ebb64a74514cb9ffe70601cfb50a2a8af5a4eca5051d8ac64e7ff1a09eb2ebdd85d8278d346c6b081b063758593fb483d9109e27feb922730d674e72d7ec7237b96c7b0a89007c74dad9a7cfa4b5c606618fa42974bb97582088aa2e0969f623086f8552910893d59ac944ab3a1e263039afeb18d7297c62f6f94d54f3a3594f29d63e72a7081c177dd601d64b5fa0be4de48f47c8e93493d2e021ef1c641d49397c67579403a5cf7b34db6fc344c35f1382cd0e41c91b8d5285ff2d0774eaf6121c42d61e2658442a9c8f810a7fc4552d37bfd0af278dd4c11f0a8ce0bd6dbce967511e4b09a0f9691f0e567e393c9de5713bb38f0ef8e3c12c3a7ea433742770db9bd46c413f8de0c22bb549c8b9830c08d8f4d69ce78f97e7a4f4eea8d4366c4820565a087bbdd824d7c357e1f3486f34ac5c4f5469bb83d6013a4097f3a36e8081cacdbd2bf6b8a079be4d70dc3e7ec36ef8a3aae92eb713f7e36b670526786a4936dd705097a25854eca77de61bded85539df8e3282375b420c39c2468323aae04ff5ec53f8cd4dfc1ccb067b404ec9fa58ac3cea8ddd88e60f165cb32e1bfeabbcf92b7ca3a1b23bfd87eb68abd75e4984d71fa0f5e60a857ada7e7f5662bd348a0d10ceca17ab8330b5cb3fcaf6ce4ef059cc2427f930aee98d17e69c370f3355d6de601a524f07fbe3fabd17f55d6a82b18e3de8ad63e185f373214a24a20a225025c93af47ad65d08dcc620331d23e5816428ed623a4cfcfa899dbd69c96e239e75a1ca2378a0bb633f00e6a023ba56f6544527382335a9621720ea945a706abfaa908cc643d71573acb01babf98831b34001d815fda2cbe5ccc49f8e405c80edb476cf7aac93c0a8e00b5d772e46d9166d681322331347bb48c246aa14fbf62dff0672767fd372d90c7cd71f0b838c75a879f7c5bccd4e44b3009e18340c55000fa197e02b422e0254660946880e87aa8b9f8238a94d57d090d5f0699bc0e6221307a1e721c94e04684c030fece7a98ce013e81c81a4365a2e9c5adc41b8ef99ad8d4a74452e709d691d2bcd56116a87254e2004a7fce97efc2afe21467839e8a1f65c70f4fe56a4278aa99386d98865e1cb64bd9710b9bfbcb0eb386ffbaf7559fff665790f14c9ff9949a6cb6fc625f7da7a95cc58e9c557eba89a8de97c2b9b3cc2d168624251561a186afe232f6f92661fb83c54b9fd76eeec565ed9d75ce98597fdb4206f3a5a8c5548dc22b107364e05de990b0685f0c3006e9f45fad17de25fe92b9ea90a4e8f91caedc4e2660efef73bddc88993e2019c39b913647de2013629c5a26df7faf462e707c6c7728a2670336859fb90f81bc095ca36224a353fddfe4e8b24b0abb9027caa00575941814bab2800d329c067bba1ad372f5c13a24d647f297d4001bf53aae8b1997b8c1929a173cf334569109a30bed75eb750b6d0455b41e9863a9154d77146ea68cf78bc108e981efe1f4119edb4f521701b7f7a94b406509f121e499632a42e82e328a82ddf806516407476711c1e65be750bd74c5b74beba3d89cc35b1ac17e38298936bf58e0f19a9c7174b7315de88e4cfe2ebdc946ffe7ad9374bcb31872313980399448df48bfdae2c3dd2274fc77a71892c143dce0cd8a25acd217a8718eab29dce6e4de0700d9f0bb84fc73535c6039924b86ab806f818fca7e37580ffe22e904b70ea64c567ee7f853c9fbe5967de083502e93285814444709137d3a29fdf324ebb251563febd6c1d39fc7454988cc8bfc812bce7da4d03ea851f427ac6645361fc3a650ba8f5771b84e88fc61a882aaec5961386deab43c8818af2984483c773c1a67f95d089be68953a06fa6b865819bb149302e34e5c5e955df22e223ea0c4ef9b74ae66477164180b0d3599226c3a6ba49f2f48f2ada6459ad3d727ddc04dca31f4d7a000d02d22ddb2523112da0fea3d08b5a1dc2cd104d8ad3bcc4030cd448ff6ca8e9be5f423b1e272e68dcb610b793b0130fd0acc735cf7f1ed5370667dfcabd3388e97854235b945f885a220733ca408ad617f5cc1e624d1f2229ecd752271449ff2a74d9e733b40323a68781fb0e292fc10283be2cee68068e04c8da6eb9281011d5699ab4de166927b667ea2517a4e146f9d9dd84f55dd6b308a947e93d92107a8964740514e0720fd3fb637a2a7336fec94fa113e721d20e85c448b500c2e7420978ee57dc32fadd90540843bcd9fe25f97216854e131826b29211abf5aad8a60fa1af997f057e30321e81a0794290edfb3a309373b16b03be76cd27fd2dac3332db7e3dd964a904654c777b19a91e25e900c670ba59cc3242ffb3085579ec8a7dab4fd39b937e87273e64821dc2d9c4709c8dc5823bfc3e2670d0d92b89fdf782eb32246e2e646662c97454805e8ff4e8cacd912e4e9e9ffaf2d010287910fc19ab9b7f91c94d6d2aba927beb4d3370f85dd27c97c090b353e8f5e24f0d45bae65b8243c3f5c5ab15c943a61375e042423d0619efafb05aa03dfa06205af3fad338d1f86cd400e17c41e854ac464a633283a630376598c37564ab1fdc37ceeb1d4b72ead199abf763070e8684e6a4f785e80cd90eab4635b23d5af1d667f8ffe5e11211430a2b5cdbaf8b958b9e275ce444c6a2ead9832957c0bf08cf1e218fd9dee0997334e6ae96c35ae4721f67f25bc4fc45fd6adef1c550b9af5008a09da43bfb5ae834485d6ab287478a51c49326bbc493676a79188ff0e6b6f9f3e5bac0c5875b843e8148ded816d24da62733041883c15eae34452ba2a36f76d0ebedab1c26a0829fc0df76413e9113e27eb4940a69435950cba939be4806c33b9f3be43dd8844f824ce184b324e8c9a89c93b1fe9d00f0111560014acbd5122c4f5ff73ae3a36a18a00635d9d8804fb056869bce028eb551e962c86ffa020e1c9727b77fe023ddb9c2594fa5edd619071b666e427928a785f63ba1633f49d3e32e0d5fc0f388e0d8f78afac57a3bcdae7292d3ab3529b87de4db15276987c6397dae01cc02e14d938c92890c09758ed93fc5fd2de863da3bc5517602b9d4128ae6d9b7f8b70805092a2a81678ac82f9c66c608769369c05b1303e8da683f8e67e426e63dad135b0b39062c29436c9fd951dee03207f8d1f9ee00e4ea88fcb87d86d157bd03c2dad2befb9b804c4a0f100b2029418654e1c9d26d3525738bf0ca21f270789707833a6b9065339252b5b7d0dd10f6b492d00dade3a50c30b01b1f840d8d4a4634803664ee1190e863f20eaab5bbb594d1e5a8271493fe61ae379d3f7aaebda4c56575143b8f721fe0deb786a6d7193d0e4ae16c31dac20ba82577369b3bfc22d903a2edd058f578144809ba251ba9f8bc4c82490edc6ebe45b5710e0d2154c3510d55402c32221ae85e1465f32a23c6684692e23d12f1616212f3979d1a535c24b360a6912d79286ffa7a0f3f49802d630a88b5b4fa6c9c0b1d5943e8758f34441930907d7783f9dea43e93e1475a74f8f786fa11a5c33c575ee0aa7a408b27bd79117d240bae82aa5f98896a51edb89902244e305e882e490719cc858e8d8615e7550a9566efd8f657f8450aab76020fcdd89116936f199cfca015703bda0d95432e7a1ddb2d1e83af5527af12d7d6150c14afdc3e9f97c8d50c6e9bdf64ebeae6a91e0cde67b0dc6c86ec06fedab3faf0ba77269d647bc6a507944476c3e6b1c8534695a12497aec9e3e1bec8a0ce6e8903ca5b225c110462982fab6428ed0b2e439f306d62ccb02137e800d3849636b0f2469fcb32cf44d7cc92725bd59a2d3da4fe0dba3cbe2b3d15bd47e0eef367d2890efbe5f626c6e8ae2d6857697b4a925ddc2f33c6b848bcfc7fef3617babfa16854c80412d3e9d54bc570c8eb758957d4bab6f8b2a46349f5e26708f1b4d54edcd701042780751bb555b82d726ce94700014c3d2baca5c96c6fd2620c88f310165a2cdd04ab8f7bf708c7ab2fce6c68b5e1befe351471fb0468a076586a0f19fca8570147d2b82ab2098ddf4983ee1a1622812d1c7f1eb23d7717ed76efa7c9b12967e3874804ca050479425485aa46cf54e4322872ab5ec40081de687c8dbd1b05e3d0eb8ec9c5e45d35e1378ffce2366271e919f25d16ff8389e810c2ae4f6f6aa3fde3d4bfa859c3d665da2bf0fbb497ba4ce10ce7698d0a4f2d8d80f7369a03ecd7ffa441d040e472b4ebf6fd407e84119a91d9bc1de8293d4729bcb439abab97ad6e0dc3940f7f00899d401f366298b20de82ee22a07d51db1bd4f40ab231cf0b67ef5496ce3fdc3a96a17bb0516ddee1305e52c84ddaeb22f1cb4f91cdd0901db7e6ed18ead0f4a47376d501e6b9fbab2c59829135362e90de6436e502a9dac4e72d5f7b9152e23b81f2390db49e0fd90ba913460d95cb4c54d1aa8472800bcb936633cb149723b787c33ac495f40a45820ba119ee44eacd418cb79152a59050ab5aff75cd9a008ee76092f57738a805f28ed547c05a9f583bd43a1d757b7aeaea57da286c50d89f3b202762ce831fbace0d52094a972e9669630f0fb784bd032f1b1f4ebcd42531aa0517fde034f72df328a08be7acd52189c4406474f7db61caa14aaf400016d4113cf5fe69986c4a5ad000dd2da3eaca29d10bb3bd279ee8958a6737d60e12b7eed5a5b12c14f116170163fb9b9027be7147669ffa57b91b612103edf3a75c9d8aa6537780135a14d15775477b977bfc17cebef9042114870a678108d0d674a902ea13ee04a8fca0014cbce3150345e8594ca9bf1247f01634172ada6cf4792f5d580bffbdbc975a59b3dc1cb9ea2be7fab9ad6688a1c86922c2365eda38a4366293c62367cd5b8f42bb7e4fa9e158380e06976567b8137816799b82c95df75bb2c2a517040f10409a5fe846d759df63b3469e79fc747bda43081853ba85ffc2f80af7eba645191bf21e8c4c83dbe4bd87deed4539bcfc1b14a1b1887d9cf940a95bb43f6b35982e506022aa40058d546a4ac3559f52cd83f0057bbe816692fc7e1774459626bf5eb6da451b4946995b3dcfbdd7e91813c945030f40ca68603097a70f59791150458b7c392d8b7e84a246aa06115360aed4339577012cf917db7993f1ab70ebe3f0e2f93e2a298d324e1a11efd8debe36e80ca80fbb4f85bebf318c626a98ff861adb1b5d3becb55d1084420aabb6bc067c65d907c5787fcf86f109e1628a455edfe6436c7aa7a5e342642da2504e77b85ac7ff9a3e468c3557e24711262777909b2627213fb715cdb5fc6bdee479125fde4a37e64bc00f343619df18596c7a0de2a5384ff435e4d10c60e2fdf0483cb7bdd2288e8565f0495ba4befcc7ddf203fda31b4ac2900879a7624daa9d6d966b550bb9e648f0e650fe405a2058efa1afc78a359ab70ecec1671ab4b0ff3080a3ecd363671601f7304c28c9947ee8f684517712b3f3843bc63c47a2d61998b630325dabc0fa4f9ebfab90fecf0bcbbdc4870599069c9ad99196d79d84efb0a49b6cabe7289e6c5b24878c4269516f6457b8435d9b5aa13ae79f656b78f13eba26135eff08efaea7e14a4c4e078049946b92fc27a0c128045a46cbe78d1e08b97d43d8c2ee5b94ad49411f2eb4fe468d1262a9ccd0e673d5e42027e2959977610a51daccb5793bb447978099909a3669352f5efb28cab77156a419184fba25537c97e0f064895f0472f2b5ef165088224bd128147afce25259079c898273b9b033df3400c96e069940c00b5045395878604d97d1b670dd4a985bfeb3caadeb69affa7c2627068f8cb05df6be759ad468626b4b14035041b8cd542e7a145ab01059788b7dfd31488b927b70c507d96fcbf23403d9430bb29d20e8ae7f3fbd4d2e5d69f9b0ad23e2c758ac0f59c937d68c111c7add242d6b86b6147d741167c6a99fb6f87d4381d6c8eacba29420a919b3fdc8162502a9d741134250e1d778a57be8f85cb3eb8c18657c1b03086390b07f7a5fa3956686fcd4e0c1637d0737367692ff843c4f4deee829c0ad8a4a390a763c71faf3df2b76318b8e6709c3e05c4bbc39fc9dbc621f927f417f20b7d86555dd66b202e1934f7ff65a56289c19d566c0c332fc645f7db9ac78f50c56a963bfe3aa508c5769ae5fc7706de445aa28ea7084fd5501eefb0558f6976680d9a6b8c4c320afdeb0fc764978ef49d52cf05fc9ab9e8819333e57978f9aefa32fb106932f112c1c10c8d56d5c277c67dfbf79f758e36fd0a4c8ee2990e95e9d7ddde828edb630eeeff5f9742690bd1e2f6d509c636273ef002e476567e7d1cfb0e30442889a9516aa0c3b3773972b48efdc2a94705c2966a8377c10e10013dc74af62a79120c3f5646f9e6384ee5db075ebe72fb9c862427c4c795cbcea5458ce02d969cc332b971a2b299043f98bfcc9122e4c23223c5cd67577b30c943a5bbfdeec860f735d5a44c80fb06984602dd175eb0d947a7bf245d2b9d893a4dd4e9a0b94d4ac8821630f334811f9ef9cb69618e66971fe6c0f8493524cc2009953ba87156b675837e7f49951867d434d0ac3346298b92d4edc7f9b49e02e80049867f0010c31e5ca1dc91ebdae78bddf9f520d5f24e0c3b315bff06c0776f17d4bef828f3a08e285e55afe47ab8c6426f44b01641b487258c19bb66b65ac27cf8983769f0c68defded19044541d8c1d193de36ffb28caa937b1486ea9f6c840e7a52934a080c5c0a1a2a6a5b0c1878d80b2c69b69791ea6efdb76b248bbe0746fc3ccad65ef55c7d84a05893861340dd2140941556eeb388b6cae0402be812fe9d41a216688ac2d6b3f7ef9e6b6e969e4cc5429fdc7d6e9db4b79300f61f966838407aadc1716c4d0560e76f9a0db00a48a64f53a64ba0acae9a16d71a61367b0a1b16e41cf5cd7624fceaee31174a44423bbfb322e26bef2806b68a01c8bbc64ea9aef96f1e41bb8e89d7a47d14aac2b0e241a5f5918f9029cffdd3e53a23cd12f00c015bb419221a32effabec0bc2ff55db32f0599e3b9d64bfc2bd76f7c40ebe9503b59ccbd026955e1fb899deaadb5bf3d368f3a50dddb3571eca7c2046b514a97b840661a1aefa9a1ccc782a8076f51804ac1691c9506c13583a9b48dfd13fd2cf6c1ea63d96348c9b5d951c952d2f4568ac96a7cc76280f8704a84d54cd08430490bcb360113b4d7f7000201a2b1ad07615825806cda740f2b4132fffd0da1188fc0c8abd81200978cbb7766a43530515af8ade475b12cdf302db82e12c3cdfc6eb50a6c516b9d0a0649d5676016b45ffb6ddcfc0c4f94902163df322cac81f3a4cc9087af9a7872538bcf1436ccf7a94a0dcab6277fe1f21104c94d2e372e5ec9ac4d74c1fb2078e2c60b4965bb52b4bc3d598531710a5e0e80aae09df4853fe120e2c16b999f1b58a1cd527601dcef2dc7de24a7f5d48305e8f5632cf6a266445e5662f3bfb37efb9753712d46a8f91d8245fe2b28d55faeb7590b694e9e0937b7bc541bc0d1c18e08c9aaed7d2780bdd7ea453170c9912ea1f321ee412061538d4e3d283a2d95735c8325d48fffbb721096d815e4d52db17399fcf57bb1b32a4dee723f52537e071b76ecb63c56299a358ccbeb623b2a9845946bb2aba27e6509fc9c9cf91aa50fa661d95b85d1cdc647301ebe96ffd3a4d02eaa4fdefb9f0994549161b2707510159badf301854bea40a3f40ca877fae1b00841211607f3509cf151828a9d99ae2109a7a43d0be05baa684951f0a09399b56eb1961be0cae350c5c7e611975e27a27da220b297efd77ccac840768c3cc9fe8cac58fe26e909fd25cbc91eb92a990d74b28ba841f2c6c7140dd488f5ee0884263c7baa992c57a9616b7ab21e5ca2ff4d9fed46034f7d2800f25cf84c8debda1ac794065f90daf5b160eba80a5a9275277830c0dbd091f6055da891563c8bf25bdcbf0cddf3b775b5398a9609f121d9fc96c7af5ad317c6c65aa4e65989422a42c2281d85139e28c9b8e3266fec364982fe0f0b339ba1c59515ab0df4c7ff6e78d26eed3435b0629ba61eb295f50ef4331c455b5109719a6595077946d482b14c8f563104460e8e1c301260644ec22a39d75a308a839879033bf46540beaeef95b5d78112fb7b77fd9519401b63d160607e63b8546dee99268c2519916c73dec4380dbf53bc3690270988ebc9b4b3332910989a7f2ea1107118329e711a93aed9d793b939150502345b578e2998996ae999b940c2c20901655edce96982f9f41a2b5e868b8d84f6c579a65b74ba2c86c7180198bf60b356d753289a71266f45b71c08d08917d66025559db9eab7d0ba2e262998252852b907921189e4b568d0599dfe53d680681755a754ce78b6221e5e1ec86ae57be174bdbc8ba4ba4cf8001307f95c6120e14ffa5d4c9982d7b6799142c580e4f01c6f5539f3e51333b47d8bc34795ac2032ebf7f2704cd96209ed480336f4b63920c6aac42e8d415f6f1dea8839fd8d76959f75283ea86f55f2e187b544c567ba91be2f19b81e8e9d83291932d7117915eb0f6aca3cf0b7db326718f02b336bdb2d57f0f0b40bdf353c5a61e87322586902921881a29764140977b2b5334acfb768393dca8db83edc1b5deaad3b09042d2096e614dea4bd6da02866553b97d1d401193fe495ef8673e20d043e3cdf1621cbc33e0ef33677c8a0fd51870da160375d64f7719ffc322948afbc18771ba2cea07cee121becf348a7b80c818a66ebbd2647b86ddb759662357b97cd4769cf557d5481254aca21b6c7f45bcc5c03076045702480d727fbe3c45c89408df753e67ab5d5c3bcf2eda805c6273156603418dc654ea8cd220f4e4647e6e8c1c1ad6ef0f7e02727f960da2c0e6ee218558d01f6e440d7f5373caacd4b20d8add9efa1bf8673970fa4fc078a843090c0c00b03e66351ef98eb8a0647433084c882e9c4c293475420ed45f3ae7702590833d30d219662b2665ad6f73fecc5a820ea6398811a30a8d9e420697bd8d35c8b640fc2cef9e2381b9d79e267af3bd00935a9a0cc5265ac5605c583e956c082b50fae4cc484ff19733bcc37fb009c7394ff7811ac0f36a52d9d2e90c5c7ea968a36132f154d0d3a2e42c8c348112c02045d11bf4bd8b9259e0dfd8128bdc0a9448670bf1f44c1cdff71b1ac121494eddde16502a7289382fc420151dbcef8c01201515d767cdbf03d5461144f4850a0836999df53a24cceaa12d864d7a8193bc24a48c09c24ba43f6ddc63c38dad19091c5288f02dec5c031bad7d1b7d99c42dec387f7accdce85fcc7f0c0c955808be13560d6af5a80ac3a118be64ded7401dfaed78853bc6fe95a0e0ab4a8af13a359cac462fc820363dec9c899130a469e7bc793f435da24bb0bf54480458fc9f496b4bdb9d88847cdbf0b0a035626ad122217cb042dac0e634adb2a3af4245cb19a921dd234dee5afc5b4b357121df07f69bc0b12ebd288c61e5041848d10f6100c2d52dde487fa9031c0f841d38f3cf09abb4199a1601bf5c5f62c3f9e06b10a8ccbee8de06693c201a4876e937c6cff38d24ba698c281460ca63e7a7324551ca7b291df44500fd52eefca9277979cb2ab53182d0457ec0bf90eeece3d0da10942fe7cbb67a0b9feff4a55d40b681525d4a48fd55606aab831fac59385e1ec08bd2785d667daae86540b25507d9e21f121f779de5439b08c9bfb16e18806d0c1b70eb4198c25635c46a424ebc9cddb91e87b036108bc611e664dd2d404092ddea300f3643196e58cf81e0d11cbf3a58d8a53fc6507f51b19b4c26c681b3085d97b40ace38100758b230e20e5bfaf01cc923433aa8a22b6ffd90edd9c11a00b7f76a31baad6a712b308e250ca4dcc19fe1223c85d8f1b014b4948f645d462671e03a057cda4eb7ce43c80ac082dba2beaad5e9caa523f66f1fbc31d80749257620b9e506a494115a9bf83d8cf1986427c3654f4e846415fc508180faaa8af1a37d755dde066cecb78439255d60e40810554922153f5bf1ab80aa6b426f0f2ada4d9f622ef8e55394fee93ff45f7718df8f81b5589fb4c1b3cf99e5d6ca40acc122a2c33e92b383a27877c62c8ee04daa8404573c1ae65072e54114821559bdfa76c2f7c8fc20f0fe7616ebfa158c5c0e8142fd6a185dea5ee4aac95eb85ee76c825c1df42c1821a8c44f9bc7c08514d45c0f7aa9a591dbe5faa98ab39454992f3c85153f8541965e2f00e9d6dfe491423db2b197658ff0d4a6fc6e760cf140a211701a4b7dd09d43aea5cafbc92fad4f56f1ceff2412d6adf821e05358d4a601086547ed2c1639e6124f6f4f9d8ffdbe6c6f135f984e9ba44006a58ca0cafa3ee1d5bb5534151254f218f3e8fa234be2d2372b1e9af4658dd70b1c01d74fa0e14d1a9f298b988a7075d368ce983cbd7dec6f1c3f0e404ec4228eee0923125c2d14dfcb0d926ad2b9ff98fb47afb2177b8e1c3f117e80a2b3ccb5ed55f5eb7e1e4841ae48c59aee5a47643aedb44dff6568f31c71c5185d61e8f1df1c01413a18c9eba3a21701361420462f984ec9cca89c0ab758518a791d2d9e6912cfeca43e4da93fec2797b0bc1724cb12b5d83173018a6f32367ee1465aa3caefc7680cd558e392010a01e87f4147d4075d42806f614618be0c152e8e89e911341acd4b29bfcbc5d2e78e2ac430d6ca2a34ece84703a9497d4b9afb3478516aeee1735c70d39c182fd6a53054df959fa261628d7352fecb3f8dddf12743be84088e5083ee152875cb2ba515e79b510e7393efa9c34d4957184ef2e5842a9f6d8a04180e3e6842982e4f8c07500eede60a210b1a76f772ea0c6e7b97e860039a9aa1783e01846474ad3f678eb11bd8e1cf64acb0f60015a49f7a870389b423050a2919bf9806ab3db09a1f87c26d5c7cc0422fc033d590fcde2058c83e8631a12875123a112d2ece7ea55c351a41f8b2bd740e0789f68ea09999e4b20b4395e9df49d201f28898e902311cd905c45b84062824d1b319ac306e476857b8bc969b3152521eaab79b73fff421b176a657f4d8478fc62d33f3a883b3a16a7c95bf2411975af65b2f82221d0a75934109c34f78fc3901a4ac4315f46d2881d58562da31f17c2f96757a98b0ac9d0372b71ddb38194f2bafcb99cb19a3eda6762094f93b2438f1575751c08939a9f3daf9c0283aa05058308bb6073671d65d7a1124ea1085c59aa83e20feea8c4c0b205a7f1af0fb7846c32655e42f71fbd616e17f2ea54e5a9371574bd14c54bf8090028a87d0fbf1f5b02f5c63ced0ea5e310b0e68d37dc043c0cb456dfaec123664b61fa2f85a9f7c1fe9601cf53c0903ef07e5858c8b4560e6712e878a4319fc33a8cb22821a5b73cfc6fe1c4ab1adf256b18ea97c2272abf3d20e4bc58bdb5ce5524a5392194be368de644ae9440a9526f74ff111d57622642251090e3fbf2fd57dc9773e99de61831121c45a9019b4874286dfaf27a1a327c5e7b1aa6959a73cd3818b61fdad46002699a29b5700d36c950b64eda98233d6fcf5832a0cb1dfadd4e2c97e54c8bac72ee72df886e4ffa9b8873451948d266817e6665011de0621e1903fe0c29043d354338944ff4651d009be563fd837029316d5cf327bb0622c665bf5041c1639598bbb4fe3f490be8862b031a19418874c550ee4a79d4397d6e4f5c874c009afae4bb1303a0ccb0dc677e21533e11564053aac7fcd87799163b10b5f7f090afdd64477000d256b3ce015203e45d77df75e5684d8b40d4813d57a8574e54caf9c116cfc139c0bc9cbe7aeea42c6f6d5132a21c3545edf42ccb2af27db3c02e94c519381d4077372ffe4c453518c4208f8a76ac385b74d51062015897a5c25817d6f101d3de246d2302f319604e000818bfd2e20e7d2848f55b608c7f788bc2352180967d807782bf0fe18a5c7fa7ff778c11251f36b6f83d10dcdba6a72c9a7cc3674c5a25a59b44ed1544c467ad2b61f164e79a915ee9bebe963f74e8067133d5e841039ab9bc76403b63ff8133b99fa5fcc1657ece2a4a60ca6b26ffbc3f677b114e76747695b275327731acdf4b535f546ab5f59386757af1c7804493c545ce3e4bba1481b9103725c84cccf77eae7a012418e0bc5b89468d69eaa70e8d0b32b3910380f806d64534dea894c751cacd5117f1b1d3553fa04db3b8272fd3d09af9e70a90676294f4448cf1f86cbf142aafff5cbf62f6f2ccc25df5ea2e59029e613815be3253a6222c266b3a914a01e61eaadc3ee84b47711afbf6e18685ffade77fcb9787a7ae7feaaf644b84986e17abbbab2e4467c8bf1e2bcf9c5ee3e1d5bc4cc8bdd9b88dfd949ea705a6b123dcfcadcb51cc9e704f533b49c914ff24502b491e646531038dc7bf48be46f56fe499e13644fce612b83de82ce82e0195e1ec086413d8288249a808b6cbf1ecaab841a32170feef5ef97ab9d860a45098f668d25f9f7b30475b87f540016862581ddb4db5ee12335e5af6034dd70df969b3008c2a44db6c3d75bfe71e0fc7a5f1e1d28ba77611a13b93143beb67453dda3142ce1754e0c4974c3d1c3f78f78337dd6c726f9996c2725f26b0029b17608234ab994286b89c3688db1fe853e37e00cd026e3fba09da0cfb564f1d14287c7155573d545c6d508ae90d7d6ce567fae940666bc3d49b95c6afbcaf353cb41bf0ec92486f98b5f52ebc753c5143d7f600e58f06da0ef0a56fd1bcf738ad7101c33866dd35a2e80fd0c5a3d3e473214be927a1aa299ed09df2acaab3cf3983b0340bcca58972f201757ba10c54453f530d9f87d3f57d736f0f05550eb3a27c7fab76d518a7bafb9824a09253999a7922012ff9d1569479b906cf4ab86356918be149fc3505db5a3d450e43083ce2099fb24aca1c2544401eedf8bd93e41ab704a3ce22edce69470bd31726a5bd2163d018aca2f38eb7ef1884863ea4ee086be3331e9a96ddd978c2808e183780f38fece67938e957bbad3c49674e911451a2bed1b794ca21d610c52227ef3576d51aa59d284822108c7253a1ef5f072db3a14ee62b1ae68f1611a3774fc0f82938d2a8119e3bdf26ed7a1c0935d5e5286a120243f1fc59d79b41e11dab665631d36778217560ff529f61b014fe808c2b8f2628fc8cfeba1fda4e1fa398391e662621549bf8c5e890215a4ac1517e872d14a452ef7167689a80768e08787d7bbc558d710db63230805f0382b7dbfdba963af23a663e96ab643858f29be7906bdfadddb8d5f6f85563af45677b49ba5b6ae7b2b82c1975f32a59c4f28188cc71d205cf612fdaf1c51a58eaeb1da9597c70728cd1ccf17d9957aa737ae42585458aead56c350a251b908dfc15a72cd13d43aff32b86afe033a3483abf0eb357de275359cd861df58ac962a292c5e9ac4d896c664465aa919dfe9162ab5461e2675530a970a272fe56613d9601aca3aa2744a47bae827a259b4d5395b45f1446a1f90887eba2aa7abcbb7e1e4e40f49207e620823457695e26989324420705f4800adc450fc24a1fe85b32862dc8e79cb844af9adb65aed94ce0cd9471416ed32540b2f9a34ffaafd4fe15fbb754f3f20c1055b6ce018337ad112715ed07c7f3c88f3a356b72a134415809219b2e7744a7e958d8589178c539545c682896a6a4e11259018cd9f4038fdd98e3db01f70e6433b2bf3600fafcc0b891aea172457d5b2923c3ff920d66e980103b8c798df2f542baa54d7bea38db8f34c88857aee9bc39239f6e56c1db84b66be93d6fa5bf35e39ef5e776f1d53d204b51fc2bfbabe8f1d0eb4452546b15863d405ec8620434974023b7d283c91fd1ed935495572ef3f7445837fa1db2d5282825c45f0154e71e466feea7508af7e2f01a6ac6329075a26c7e1020e7144c83866f201c7214799574ec222113c3292affa8603c2be82ff9ab54a4d6e961a20d10ebef668d703c5d89a63247ac046618aecdf5aebd3d17bc4cedc30374441bd009bc82764972115252cf70b5f02447f579e551a9ef6bd2bf564668af65db6885205837fbd328f08fbfdad6f9c0d5b131daffe94f77e820dbac732767139806adbd9d211437f480e566d9cdd6ba5c9eb166b21aee51e434f84fa8ffce38a0b0e39fe3c23317d5783b150a88fec8ed9464e5b493e38ec88a48edc54c2948c3a9abf4b04eb5dc3466426e4a17aa4c9105320e43ce8dfcb4c2044f0b1ef570888304c04346f90a1ed594feda43e150ad79030881d7fbe96fba47bc5de00d34ff8423929a80f30633ce15453226d309c6440b1a9e3316fd29da16ed07575c27a374d0d87642bd0eb1edd9077574fbb2e30df1886a98765b69ed23edc22f93867848eae283b50dddaa900cc335b41e0202ee8e235abf5720b884685aa99597b80b4eee070066d5ab7c0c7a2bca2ab4c8b85639a73a6523453605c980acb3363e27e4f1565dc8f5357d98716b6182afefddd1cbc996595fe7857bc1304a6b109f60694622bf7d31ddfdfcc053de230d40f58dfbcebc4896112a0a98cd79c004454d430e0b88bf71942be5cc9cbf1df6677fb557a88ff21697fd18444144dd7fc90be60b1b6ae7d4511cb87f0c73191c115a06b2803aff3aab510994847ce525e66a76a4ffd5dc6a38aa2b81d65def602bb15aafb891cf8a3bbfbde4e1b6294d714e719176013b6218ad17f59bb66224c11fed1d3ea0de617368aca8ac81198729accc9fa53aed37dac23ebeeb8a99398c1beb4439cc2a10fa475213bfd2e25660ff1be81fd5f23260fac5d967698864331923c4427cfe083698a64dfb850fc5118f18df4d2626b71b7baf18a58b4f03ecf65a061135982a8bf9f02a59d1fc27c9003662d1400edec640b474a0d5a55cf976b923906c1e7b72b1fcddf67f707d473605487904ad0ea85f075531f1fba77a9ea733ae291bbdec3199325e8aa65335e54a08cf240f178c84cb9cd7b3b88314ede5523307380d16c0aca6b0183c7e0c1ea7a5972312a371a4c11f3c1a3023f7e0c7290da861334ea636c6ee96e6d270e7541e2b9e59e5f9e88e8d9a847c0ad66a3d2af61b77ddd8d6639ec8e3ce37c6d5cc823729a00801c3bc7c7c2d86624b0a8f74daaeb38b26ec052114d41bd7adc435e318ec93aa62713e6383a641a6afbe3c4bd218d0524a2ef3205576a580b1f8f31cc64792c61751d8bf84cecc0a2d2efc053f458c0f1626621b8eb70fdfe68cf0bc4f531a07ebbf1d66fd1abdb41a59c63e9618346f1f26e1f4783cf1c721fe0e590940aa2471a2ff1e1762ebf8b69c389a7d09a144a7020e5821a7787f47bfc26ece348194e7dc6dfdb9e2f3bf14a926b2232a7f0456e3e6c92b43a8584f02c20934eadd0ada9f3efb27ea1bf5b3383935cd098ce71f3101d0a9b0d3d946ec49e0d60c888a8ae8948b5bf9aa1fc10e8cd4f6ae1593fbbcfbce77403b13c7a076e0cd80e10213900afeccede637355c43921cffef3bb8f2f4a11ff01639ef095ae2d45adf997470027c04a970745d242e554d4a3a0bbc697910ca3cbcc521a67d786c73f0afc05b5989a151167d609e5ec0db8363e6b292f97c93b0b13a66c6d709ff5d129dd7d7c80f7953e6751f1404bdcae416c3b1f1443733018a409a219bd912b34dd2089225f989a938873fb5d5bb9a9afd15dd09d3154cd7f05029c158a0982947a03ddc5dc53aa8d16dec55a53d5fc84b9e20706cde21b03a7fcb094dd33535a162980a1607489d5ddef1810df877ec32c0e1900c40d831e7ff30481c7b7d99a28d7ab9a6e0140da06909f15f762c3a6346b72e73ee28cedc72ef4f68046f7919fe652d3b6792a8e55ec746a7333321ce11f4e65e2b1c82825f47f891a0f263b6c5b7c26b07725371886eb77da7681bc11d24d07ba0833b71a4e3393a09b90478e529942ddf642e4d716aad673aee03991d6579455e8627cbf3e25a86eb3ee00ea9f0fc0965517430e7c24cbc797b96355b6f88bb2708b850c50316e518b787c9a4aa81d031abbff04e61b54e763605dc27d389bcbebc14dd2ab1938a80daaebf585947a92e81b25392c698cef4d282b17d8905e734d34ec180525deed1e0d40c1d7221306a13be09e5364e43d51652b838f3c20e2e5a225a1442c8f25d97ff72b52605053bdfbefc17b941d5a171e3208b6f085b9fa05383e5d65e72b28e0b35ec41f75aa84ad6b807a671bec135dc1c6830330635ec951dbfd6a78e252e34f35cb3c9aad2e4a4b09b1d948f03052ce4564356fe395b863657bc703ad8320895d298864d290c56b201e8d2e90e5ee69b78dd88297be4640b0f62780ff57cee90be7425b62f4c85dcb940f394bac9776cb1ccad4ac025a344ecdd6f4c1b752400acd4c1d6aa718d4176e450ebb9af7dd76c25e8d96f8815238477483a7d02d27c1692ebdbc04f436c2392d1b71b646ea550ffc1334c7d965b4433cd3311dff734177e2d5762520dceb0fc07174aa51691702a712227381d553bccac2f4813054f0aa109d876ca32cbcdfe910aee4e928afed49105e080c2ca127c197a89b7ed76c0b71d803c4ab5a946aa996fe609b1c55b7b2377f8830154ec807f54d322d9828945bb0aebe82b73557dec4848482a0f9f3d0009b8977bbe92c7ea3011fbfed53dba98dfd265fb2633bec18a431164ac53486f46e9744341dc41aa300f890ca68aa4af322610fb2aa198e4f49344094fe040ddb9d2b098f8c78c7d99068fae2a3837c48e43f9a7bfed8875d6f0ffe09e2d6e9461318046c979600f5f27b67ecfe1d0e3aeed36b09eb69b78bc9bc861194082e58c68c8879b777a026fb636e72c7d8fc91a233d0dc7c31b794e0f78910eb3beabf15f53d09c40f57bb8230144a2027af22200f72c614a0c63864da423302371a86f59011ffc31cf4a1223dc4f6309426af62fb6cf5235d33b2b872900e2648d3433e3cfb0580910114807669f0319c5c63ac50c055a8e1dea55d6ad49ce33fa49a372320439ad7a8db42e9997f7f44d5a1e2dcf150cc9605f39a7617dcaac2d8a4627cfe96eef4ce29c0083f4226280c1bc1a800f5f27772e14696b3d944ba983ac9dbd419d16016ee55d24c54975c930f07474069840253367ddbaf846458a9f962aef8c2d89a571d6fc357d2835c6d6ba88f3ad633ab2a6ee486d161780a6b08c5de33951b89db8e03f9172fed218aabb759832057ab4a96963918d24d3416301833a1667016b1358e596a5996fee0989f8cd669de8df7f69ba2bbc6ff41017ba50755080356a5d10241fa9fc99ce084f76ce0fff54c6748595b139fba79d188f1b3cedf16959279d85dff194fc421255d182ada25554b25dcbbbaa56ae3efc75f3109efcbd81fac7c15fd697327210aee2c9bd85736cd776b05e8a323d7da0c1e566c9bc0565fa409914f821f42377f41caccd394921ad584499da64c459f60c8cf1054632726204085a44cd923ad12797fdf88dd97ed713a1de959419be1ae6595527a13c9d7044b984c6602e5611df33acd229acbb28e9f9e6f1e9d65d1e616f71b0498cc2088929656274d0fe52c98ba0b868effb7480c5176c8f6b39f1047e7d42b749fb34e072503f6537f86edbd7cce2ed3c03dcc2aa8afe39b7b74a8a193a346bfc7a995bc8dfc2cfaf8c47b8ca1fe8af2e7602d8ece4655b570b4e88cc1c0538e8956fcfccf073a656c9542e5935af46e96bfb2d249e8224e579da63184bb81a173c071995c7180182dc15fbb92c5ba596e561a1e3110ba46d5788e627fc41abbc0c71902e8e1619486c90c52b7fa9b571be9ef2411354e038ee45a361dab6679a4ce28b84951a08c801f47a0b8a56e4efb3beb00ca2da365c8b56eade3bb524fc19a008e0ccf09ad3a7b70a53208d830a5b39359aa0ab9bd5607cab551fb4b356b3623f0d0e01ecb80db88147a6da9af27e6158b8ab27eb18a709f9d697e420e5eb65fb269389f600d0177037c15c7f17a3c01c3fdb31a17e4b7c51fdfef23347f27f219eed0b4accb4da09a79c62036d945c3f6a25e76cab118525b691bb358bc168fd21e046bf250b02a7fe0ebf6721a8bdc285aed4186ff0f17a9fc6abe2cc2b192b7137db04dc19691297b1e97a762e237a7699b4686eac79c3592b78223e7ba575d1f1757fdac7fc5a89b47dc2bab1419f920ac6e511e8020c15d47158849659ea22284eeaaa9a7238412c15eb1d91c4e250c227e8bcd55dd812f10017576884e5564399b797a8cb16a13be88f6ec17370d62d5c2660a647ebbc7a4880da9655aa7040648e5de806752b25b2dd5d97dd8a7f97e580d0a91e9c194dfdd54df620d929c1fe56b0dd7976369e6f330b991b38ae1b8f4548004079d4cd622d6ba97f84b9119736d7d7d1e86ba7389ecb03e1851cac00493ad0ee887b9f8c5a4f5a0ea3764ddda5a598ffa6c27fbeab759f24a70cc1e2f39b27ca22c2c57b562ca86919ea25913d45601f2cd4adefcf83b6d5d6550544adb977a99549ac193cdc65e960257044a75354a8d9f35a8a4d86a85d25e629d7e70cd513383fe03d9cf66384f450fa5c0a9b88458ce4eff5ff2781c82cd4d046252afffae2d83120decd6c4461bc026009d9433a42c2b0b1a995e3db9a021573b37630eef5b1d5b6191ffd7852280cc5b20fa31a0cd2efbd497bab413f1dd6b8551886957fe5983a791123177c7e50c48145e8d60d7d85ac9bddc5444f5cbeb2220e6a96a814542ab33d28b17faf569f69e7e6beae0b027c1b3fe3eb869a591d356944a48c39aca1cbb2f54c8225f5bdf1df5fc2ae52c987d9d20b79b069720f4a6bb51d611c1500e78386ad195d970a44d9808d05025d57f86c76ac77185722010961ec534df7dec30e4a443040736ab584823875bb62e22db85ad12f415b6fd6ac2c0695a4dca0680de7188f520d0accc99409bae83c0227aa652980d25397510ea9942b382d13792c3bd47060d9dc378a95a5bc52197724e2489688eb98d81dda0d833034e8a0401bdcbc6f193c25dc319e7a6921f6a7d2f19b67d81ad881d60125a9666c6dfab9c6abe83118b18731d29a8b97798c7bcf1c422bbbad93a61dbda7092d9313688a6c4172fd6a06c82cdc56b68bd5630dd20fccff28e025d0ef7f5e1364abdc6bfb74d77cfdd476ab58cd5c4ac0f9fef6cfa9af1edd29a1d5f2493ce8b4b691f548de202431298498003a798e162a38107ce03fed870ef050324a9d401a94a8e821871649d1657fd169cc811cbd91a948f5f159923172e76b531566977d8512041c373ef45baec81d886725427d63191dda7ba98d0499a64b37084f4b2f607e87f81e4bd4256a7c8f32c8a0d6ee1f29acda10a81d60f495253bed82ca13cdb2b5132578a6028c45b8cee03c84b2ac77a01ceb380491bd2caa047b7de3de62ad822d4ac430748ee73cb6d8f9adb6170defad860985720766087d8d883f09b86e26c22cd5f7ca726d7bf17359e81fce4ada96b055ff7f7d04a7b67e01c5265b33a93248be16e7a99bfc93e5817df3b14da3014cf2f13544551fe8a9b84a1ea3457c9d6a5866ba3e468841a1d1ac3d604d55c53a3e9828c237acb6a31fb5c2acea33cf02a20bfacc8b02c68ac82afd0418a980b1b39c0066e170efd74e29c42329ca23c9745c9f6bd29a3aae757f966b0724e236cce18be031cf80a676f78ab2df2c102459f59ddb42b891ee905f860c9b5f9e58fff0c973c37b5a7a1864106afb7805bfc639de85782fe730633f1b957a25cf180e547c3c865f06adc5f0da7b431872a537ca1cbff1ab00094797209082cec60f77e15a49e900692ce6d3e1a2c8e4afc0617093f8ff403a789a40dcf19dd1d58f7488d99d9cedd7062f501511d03dd9b5817d33f7bf98971ef8a8c424c8ba9b0924769eccfd225e96352c381d29b2368ba6eb74d6d192ea99948cf2686acc92a70ef395a13281cd5dc75c1baaf24e125cca35bd98c3715409555ea1e6365a988a7ba1dd8f12fed9fe72626ab1a47242338cf0c337ea60b58c479f90da146b35d3b80ac5157ddf7e849f320360c4e9b07d90ef14ee7cafd2ef34b6685f80e0937c292f266e3ecd4927dd62a8c8fb5170ba7e669bc3edaedb81fd9ff37de2ae6ee9f888292987f0bc4574278d2fc8a903cbf7d222332481f0fe67c42c67237d954476cdfa547881642c391520fcefe37933d9f0951db89a0b50aa93e104b958f33cfb2f13b8d4b59c42ddefb0433c7202e3ca2754428e7822d7bf8338ed6186f6746054e034ec66958549e60b75c436d6da93bcd98581a98725459bff8194dbe5b6f950119ad3569a494b2bd1ead8b9555ef2ff29ddd8ed91de76eed8ce6614461faaf814492490a5916a77d08d2050801f30d0af614144f9176e635fa174bfa7d62c028a5df43e7a959badf22048c9ff2634a8f51762953b89c0a0ec249c57c0f1d1dd0955457d551d167fbce7087745a4f6e971335c1bb4f4a56c2813eafb0057c1075ebf12c3021c5e230e64795e592702e72eb7e0e5515bf74e7f2da4f49216d92f97893fb308a629fc9e5f64650433bfa07cac4236465ef730ddece9c5a3e25f3d434b9e4f00847260b950b1a1ad52363cd55647faf919ee1a3657f537e73e0b6a54aeda4bdfb95a16cb6c4266bb71e7bb33b3c771d0375b8014a9eee22027f151d1fb2bae8d1464d1f0c02bea0ba74bdc9cd360ca7402dde8df25ef5ed0a2c2ccfd40f1181198835af6cf8263678e7ce2df27183033f7f826171d4b6ed80fe50385be4834ed014c28f2bc241eee0b1d05d170007e12b6bf419618bb6a019dc7224f3266722e981d013a1c79078d7f4093ecdbc00cbbec1215f1b32c45429d9ef974f038ebff853979b18b92391fea72c13b4fcacdc58a631235f29f5b3b1f68f21c1cf63ed3136d4be8a4f29cf73ca7b68200951dc4971324ded2965a0069b27035ea448fe9c911ca962ef8f88b082b978609f5c7b1c3fd8f10ecc663495ef822ea5647c27d16bc4671f27032cf56a86bd9a9112d4959f70a5d16e4ba3297ab633bf6355b1d29ed2f20f7046f075c1674b8d8eec8448731611dc4c096dbeb85ebddc1a1f369b12f04d6deaabfebb4d5af9abc00d42ff5f7601ca656b816d8673253154550e64128d1e2f8de5a16d064b6ce327cae734d45bb7c38b853ad61df5effcc32343e1b96515cf13312f471b1f3a72f226bbb298986ee9f6b24f949cbdc87fda0ad077ebf454faf2e21470f741c0811bd77fc92007d29c466a0157a7ab86b11fce00fd5c83f08b838d0dc0917e7231528c3903f27bc706f5bb0b037b4e05dbcaff4c1acab48f16743b3a0b777dd18d769f173b40c086d49420987a06794efb1e6b74cafac38a57dd011d73e8ccebeb4d3f570c86b235f9bdc03bdb8555b14556aa3ebd46f8e8945dc5a22adbd35cc65675f6a81e105538d9a0d25069f78fa49f52897c459fc63364f32ada3345bb52a4b1e6dc412d76f0833bdbf13f3de82c01a715128db068c999991d07a417cc29ac23369f2a4a481394f26b8060dddded55c078138161933d8e4474e82ebbfd1f0b03dadb6a08f54ce87fa32fb3850d4c4341afcb75042776b60efb04289b289ccdd57c2a2d1d5c5e423ac62872cc0f1ef21c4412b409b9186c1b42d40deeabe52e6ffb6d568eb04ae95bb31c9b712b6cd65f9111befe5ee19d1329824276139b3aa2e31a651c7a08e703ebbfca7a460c78ced2e1f9e2a3e925cc9de9a9c2d0fbc64f8ada6e9090cda1332eac110a7341e26ab39e1783ae4bae238cc8c527cade2e3ed4350751fd1025b87ff49f90c860079dafbc6c5cac1437756e5279174ac16534ec17302b0406725ba73b98501f9f350aff4d6ecafb93134944a355cf929b2ea39867872a50dc0318f042da7a5f637e06dc008fbe72a0005ae1a7fa00de513c67034ac62780f116f2ca44208298d56331f128b673bd8a3d1a958f8be56167f4b844247ee64dcfbdb59b6e126cfc7b7c4a96c54ec565cc8ce749da03a84dd73e24bd95212277b15dd629df6d04e4e110fee9840771054866967946da7cf50bfd872a2d1bc9c898441eeede045b447f15a3f4dd60f0a0820350a9b8ebbd148cb8264dc27b3c07d2dab76241d13983502e778b94a26348d389c34d40e24f775929b59590d0c783b563e025566ac55545fe5f633e88e581f938b70005fa67771556c57300775d63d111f29f5f210797f4cfcd4db386a918b63f4a31b4661f849db9c80893526760181f7f2ce93e47261670583ce36677fb116d36426bb92df7b1ca022619b8a4f189e6d9e41e803720f126676c8f121dcc8b189d7eaf539d24c1cb4f01d42fd129db4babb9dfb6899e96e57b524ef64bdfefac4e5abdac7684cf1ced6ee0d475b10dd7aca8f7596cfa4c6c86f7924c46870eb98725a7647194a29ead1012cebee0c4954cc031549c98eda3ad0bf053476bccba1b1204d17a3f0f9c639c0519178bd37573c76c60f57db64aaaf4a8e5ca417b98481f5d8273898683fe4721f8e3f3bbae393154dc4b4a3e416f23279e142d43c8bae96ee67adb814fc45e79dfbc118f6c67fcba559621c68e381a7f53223e06a070a3b3f2b8ac96e19636f58df083645c20c7be8ec13cd49db688e350c8253852fe7c6e5d72197938796bbbdf997bc3c581db46361254bc98531d50cb237c4ce9e2a41128ece2e5c162f3816d7bb0f3d2b9c5d13338050e05f98e11768c1574e528b71b7d0528f23de74131b560ea96091cbad47dd802bb29c48ca66787811901dbcd95c7585e8c9d37e938355e7eb11ec16be86c4ec5a6e84a11315043ad2c4e359e51a8f5e6f8ffa54534903ca5db985af128b1a99faa2d5ab4f0d0728e91d3c7678abf69b11c7654b03c882cd86f84652c941a181c432129ecace47d44067ac40451dfd12ffcbac0043131fc6052405e5df3d9502087ce34250e102dac513858a3e681e2c63303878d9fe1b92fbd6ec8f31146369e4aba0be2fdc411d72cdc642e8eb6a9a055401f65db62bb1d6cc16f1bafdc58d638b4b423d99370f05ed161e4fdb66429fcfb880c4c56f1116cb6999228f6e20b50d3bf8c69d4e543ab3aacb0785a67d187da9d23be067fd72e3d5a10394fb6c9d55fafec35bb8edbc9e1efd30c94f3de9dcd6855e52cc8ebe39468a3d1145bf9373663ba65da9d62556273cd02c314bc9dfb88bc267fc6e8d2e9a38a120477813fafe90b76b357626516ab9f07ff6c37d32f6598ce4579d90018f0f314d46501debde8a0ba536c314393f081c47073be8ad0bec7cc433524fab3d77eb3b09b35e24b4f12262745ff99f73d1869d1af04066939bdfd381e3e333cbac6231b09ab760388a81f5b97fff0ef047ab4b2dc72a68fb20c39e6222ddf233185c28b232c4d0c195d78aec6b2f3fe1820db32df4516f676b1bbd24c255019cccc17864d04ad1243077138dc2cbaf8e8365538d134bd04bcfaceddb574c6c6a2eefef6a071c86a9c19a9c0f070b92d626a44704ed066196c00cf6466e1b958be20c6cf3409058c029a23db353a0c5bd222ed8c261eef5b730e47abe2c46141ddf43548c19fa2b6df66c6ff6276e0865476f8d29a694b8d5237bcbd6246b4676b42a9ee8b2984ab789f6a09295a184d8534af6be8c71c984597abccfe7119758a1a2a1aa35082338b8d8f1e93d272c29abdc8a511695727ba445734612294df91f08b040f453d43ed2b0cf828d973b34133d6b0ccdeadfbd2f963d9ad39fc2080547f6764d345bb4734c905b33230d8eb0146fe5258d837b68b902b43302154f05bd6d72953fdd1b436079f66128f4cf232c10b2b77965e26fc2586fb0f2dcb58f497581efa915397e37a3279cd1e08c06d0a0475806556662ad0553bbf41da15c67cc1fa329cf2ec6ca93ee7a1bdf3fef60bdc77033a3f37cc3d9377b290360688f5534fe8a5dc372edf55d2e1ed10fed480f8ad8da5dcbc236404cf46e17ce0145984dc63c995cbd6da90a255d45861dc0f0ef343a432d5ad99ec6ec08fa4cdb2d0612e450f93a42d5661acdc73c402e7560d60b1546bfeba7778e78d741e1204536330ea76a31a59c4086cf5f1aacdb904b1807757b6d751cf8b0185cf6e9f3c98b9e87540022328f9b504f9b741cd1969bfdb1c79341b88980909c8f7bd50eb2e20a45aaa387dede30b5efe49e9ee2e8ac2dba59cd2ddec18699ed407c87d1c762c413c5a22126d99f67c3d3e17d32affe3123c2f65e29ff14033d7a19f9e3dbab5d945cebdb98125a39de8d71730155a6ae932a16a130cea3b231244750a21d0f931dd67ddc2f5dfc5e2adff4d93554edd97b399b3834ad33cd448153065fa3818e126dfa5b49867eea9c383690f2916b6ad21d274e59cd4309bbba36687afb76dc9a900b02294442237ea584739d842171237ec73768f291593c8a347d6d84dd9669b06393b38029c57425f3f3d0eedc574c085dfc104c250e1d6118401d80e02a105d970d7a52f2fb231c2c150b552be5d173ab6d2f5e0a2b0e2dd8e693b925e618f3a759ac896a3d4fe0489e6892c3861a998de0084eb4ae4781e996137deb3bd375baf6934b5b4e7a461dd9e4135704a77d906af57483dad7d8d53664ff6e6b8badede9a8da23510e05954602463d03d457dac571c068c1949db4e13c297415ba90027bfc07edab99b6eebc2811709021f41b61f0a10a96c8b15b0b80e316913f6875b3f1859d2e0ba1d89403092afc716298b0af52a7e48b79c1831622c2f7b23c9f5d52ac27b92cc345e473c5c81d5b73c8aadf9f3f38c7100cbf87a9cd4ca48096b11603ce3d740416a5f46f7543cd05c586eae8542bec7fd7b1d0bcaacc31563eb7829d4b8c51506a6ed78a7f1edd8267a18a5334b6eee6705e35fe13a96ad957ddbe957ac3da273880b2485eb3470592c9b707c9d8e6e8784d893664afdd7f84e8b205553963a6084ff2ded698415fa3fc09079cb8763fe2a4e8a2dd639c15dd934983f680607669cabcdc647b6d65b2898775b0584bcb784f5a2e21c8e6cd636310f71b502c0ce47d2c42f0878ad8d7949d1cc4347bba6e0d4bd0c35296286acc9d6686f7868e1821f4a5e94f74a049c782de978676f922a88d5a827f0ed2fa6a22e0a7f1db40f7482adce3058c131d0a512e302066cfda2515a7a9f59ad7977926491da387fd48c6b3ef01963801e6b7903e5f7637fdd8e42c49195dce5a6175f70981d2ae191e5566553d20f5aeb726adb711f6162d0c9fb65de595aef0f462fbe8206c590c9e61e500c7541dc9f1abb15bb8c6039979f0665d290fdbf82c33dd5ddabdc37fae3536eb7da6367b48b789e729fd59c6e79a31da2ff0a534e2e5035a96db4b626c850a88b63ce2ef35efed6ed96a99eef291008a7d946673de1e7ae2db6ebd2087501d7b11a849836a9e1ce5643420bd7a1f93be7bdcb63f24e3675bbd01b83240d5b650c4f08b786b43cdaa95a05002ac9fbe6d1adf51eeda733c29c0d4dc7fba49bda5fb44be291f514ee04f2502e73b9d98d2fc1036603004295af3cdf4b9abd98dd174e9f332890715a6815780487b13461cf6116d05bee6fc7eb48236c9a661a3e20d9dab8fb91b3461a8be658423f2be26f0fbde9cab93c4baeb9ab550cdcaaea05a1d1a6a029636cc14353b7c7ca862dbbd3297c2f6729f7af78bc9d6d6984c0a2e63dea0eb6eab124f5b257a422b03eca5bf7137e69eb95f5cf26bd30daf9336f31da9d592418aa34acda1cadbb7164a16190f9f036493a2dcc463994c972b684e03b78f029420185a4af3b051d6be1ffdd0cbea5836c63e36b4ed7d</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">您好, 这里需要密码.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">有东西被加密了, 请输入密码查看.</summary>
    
    
    
    <category term="isp" scheme="https://blog.17lai.site/categories/isp/"/>
    
    
    <category term="isp" scheme="https://blog.17lai.site/tags/isp/"/>
    
    <category term="awb" scheme="https://blog.17lai.site/tags/awb/"/>
    
    <category term="mywork" scheme="https://blog.17lai.site/tags/mywork/"/>
    
  </entry>
  
  <entry>
    <title>emoji表情符号</title>
    <link href="https://blog.17lai.site/posts/80938cfe/"/>
    <id>https://blog.17lai.site/posts/80938cfe/</id>
    <published>2022-03-23T10:18:58.000Z</published>
    <updated>2022-03-24T05:23:22.969Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>emoji表情符号是非常流行的表情符号，几乎没有地方都会支持。这里列举出常用的emoji表情不好，方便大家使用与查阅。</p></blockquote><span id="more"></span><h2 id="常用符号">常用符号</h2><pre class="line-numbers language-none"><code class="language-none">❤❥웃유♋☮✌☏☢☠✔☑♚▲♪✈✞÷↑↓◆◇⊙■□△▽¿─│♥❣♂♀☿Ⓐ✍✉☣☤✘☒♛▼♫⌘☪≈←→◈◎☉★☆⊿※¡━┃♡ღ ツ☼☁❅♒✎©®™Σ✪✯☭➳ 卐 √↖↗●◐Θ◤◥︻〖〗┄┆℃℉°✿ϟ☃☂✄¢€£∞✫★½✡×↙↘○◑⊕◣◢︼【】┅┇☽☾✚〓▂▃▄▅▆▇█▉▊▋▌▍▎▏↔↕☽☾ の•▸◂▴▾┈┊①②③④⑤⑥⑦⑧⑨⑩ⅠⅡⅢⅣⅤⅥⅦⅧⅨⅩ ㍿ ▓♨♛❖♓☪✙┉┋☹☺☻ت ヅツッシ Üϡﭢ™℠℗©®♥❤❥❣❦❧♡۵웃유ღ♋♂♀☿☼☀☁☂☄☾☽❄☃☈⊙☉℃℉❅✺ϟ☇♤♧♡♢♠♣♥♦☜☞☝✍☚☛☟✌✽✾✿❁❃❋❀⚘☑✓✔√☐☒✗✘ ㄨ ✕✖✖⋆✢✣✤✥❋✦✧✩✰✪✫✬✭✮✯❂✡★✱✲✳✴✵✶✷✸✹✺✻✼❄❅❆❇❈❉❊†☨✞✝☥☦☓☩☯☧☬☸✡♁✙♆。，、＇：∶；?‘’“”〝〞ˆˇ﹕︰﹔﹖﹑•¨….¸;！´？！～—ˉ ｜‖＂〃｀@﹫¡¿﹏﹋﹌︴々﹟#﹩$﹠&amp;﹪%*﹡﹢﹦﹤‐￣ ¯―﹨ˆ˜﹍﹎+=&lt;＿*-\ˇ~﹉﹊（）〈〉‹›﹛﹜『』〖〗［］《》〔〕{}「」【】︵︷︿︹︽*﹁﹃︻︶︸﹀︺︾ˉ﹂﹄︼☩☨☦✞✛✜✝✙✠✚†‡◉○◌◍◎●◐◑◒◓◔◕◖◗❂☢⊗⊙◘◙◍⅟½⅓⅕⅙⅛⅔⅖⅚⅜¾⅗⅝⅞⅘≂≃≄≅≆≇≈≉≊≋≌≍≎≏≐≑≒≓≔≕≖≗≘≙≚≛≜≝≞≟≠≡≢≣≤≥≦≧≨≩⊰⊱⋛⋚∫∬∭∮∯∰∱∲∳%℅‰‱㊣㊎㊍㊌㊋㊏㊐㊊㊚㊛㊤㊥㊦㊧㊨㊒㊞㊑㊒㊓㊔㊕㊖㊗㊘㊜㊝㊟㊠㊡㊢㊩㊪㊫㊬㊭㊮㊯㊰㊙ ㉿ 囍 ♔♕♖♗♘♙♚♛♜♝♞♟ℂℍℕℙℚℝℤℬℰℯℱℊℋℎℐℒℓℳℴ℘ℛℭ℮ℌℑℜℨ♪♫♩♬♭♮♯°øⒶ☮✌☪✡☭✯ 卐 ✐✎✏✑✒✍✉✁✂✃✄✆✉☎☏➟➡➢➣➤➥➦➧➨➚➘➙➛➜➝➞➸♐➲➳⏎➴➵➶➷➸➹➺➻➼➽←↑→↓↔↕↖↗↘↙↚↛↜↝↞↟↠↡↢↣↤↥↦↧↨➫➬➩➪➭➮➯➱↩↪↫↬↭↮↯↰↱↲↳↴↵↶↷↸↹↺↻↼↽↾↿⇀⇁⇂⇃⇄⇅⇆⇇⇈⇉⇊⇋⇌⇍⇎⇏⇐⇑⇒⇓⇔⇕⇖⇗⇘⇙⇚⇛⇜⇝⇞⇟⇠⇡⇢⇣⇤⇥⇦⇧⇨⇩⇪➀➁➂➃➄➅➆➇➈➉➊➋➌➍➎➏➐➑➒➓㊀㊁㊂㊃㊄㊅㊆㊇㊈㊉ⒶⒷⒸⒹⒺⒻⒼⒽⒾⒿⓀⓁⓂⓃⓄⓅⓆⓇⓈⓉⓊⓋⓌⓍⓎⓏⓐⓑⓒⓓⓔⓕⓖⓗⓘⓙⓚⓛⓜⓝⓞⓟⓠⓡⓢⓣⓤⓥⓦⓧⓨⓩ⒜⒝⒞⒟⒠⒡⒢⒣⒤⒥⒦⒧⒨⒩⒪⒫⒬⒭⒮⒯⒰⒱⒲⒳⒴⒵ⅠⅡⅢⅣⅤⅥⅦⅧⅨⅩⅪⅫⅬⅭⅮⅯⅰⅱⅲⅳⅴⅵⅶⅷⅸⅹⅺⅻⅼⅽⅾⅿ┌┍┎┏┐┑┒┓└┕┖┗┘┙┚┛├┝┞┟┠┡┢┣┤┥┦┧┨┩┪┫┬┭┮┯┰┱┲┳┴┵┶┷┸┹┺┻┼┽┾┿╀╁╂╃╄╅╆╇╈╉╊╋╌╍╎╏═║╒╓╔╕╖╗╘╙╚╛╜╝╞╟╠╡╢╣╤╥╦╧╨╩╪╫╬◤◥◄►▶◀◣◢▲▼◥▸◂▴▾△▽▷◁⊿▻◅▵▿▹◃❏❐❑❒▀▁▂▃▄▅▆▇▉▊▋█▌▍▎▏▐░▒▓▔▕■□▢▣▤▥▦▧▨▩▪▫▬▭▮▯ ㋀㋁㋂㋃㋄㋅㋆㋇㋈㋉㋊㋋㏠㏡㏢㏣㏤㏥㏦㏧㏨㏩㏪㏫㏬㏭㏮㏯㏰㏱㏲㏳㏴㏵㏶㏷㏸㏹㏺㏻㏼㏽㏾㍙㍚㍛㍜㍝㍞㍟㍠㍡㍢㍣㍤㍥㍦㍧㍨㍩㍪㍫㍬㍭㍮㍯㍰㍘☰☲☱☴☵☶☳☷☯<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="特殊符号">特殊符号</h2><pre class="line-numbers language-none"><code class="language-none">♠♣♧♡♥❤❥❣♂♀✲☀☼☾☽◐◑☺☻☎☏✿❀№↑↓←→√×÷★℃℉°◆◇⊙■□△▽¿½☯✡ ㍿卍卐 ♂♀✚〓㎡♪♫♩♬㊚㊛囍㊒㊖ Φ♀♂‖KaTeX parse error: Expected ‘EOF’, got ‘&amp;’ at position 3: @*&amp;̲#※卍卐 Ψ♫♬♭♩♪♯♮⌒¶∮…<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="编号序号">编号序号</h2><pre class="line-numbers language-none"><code class="language-none">①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮⑯⑰⑱⑲⑳⓪❶❷❸❹❺❻❼❽❾❿⓫⓬⓭⓮⓯⓰⓱⓲⓳⓴㊀㊁㊂㊃㊄㊅㊆㊇㊈㊉㈠㈡㈢㈣㈤㈥㈦㈧㈨㈩⑴⑵⑶⑷⑸⑹⑺⑻⑼⑽⑾⑿⒀⒁⒂⒃⒄⒅⒆⒇⒈⒉⒊⒋⒌⒍⒎⒏⒐⒑⒒⒓⒔⒕⒖⒗⒘⒙⒚⒛ⅠⅡⅢⅣⅤⅥⅦⅧⅨⅩⅪⅫⅰⅱⅲⅳⅴⅵⅶⅷⅸⅹⒶⒷⒸⒹⒺⒻⒼⒽⒾⒿⓀⓁⓂⓃⓄⓅⓆⓇⓈⓉⓊⓋⓌⓍⓎⓏⓐⓑⓒⓓⓔⓕⓖⓗⓘⓙⓚⓛⓜⓝⓞⓟⓠⓡⓢⓣⓤⓥⓦⓧⓨⓩ⒜⒝⒞⒟⒠⒡⒢⒣⒤⒥⒦⒧⒨⒩⒪⒫⒬⒭⒮⒯⒰⒱⒲⒳⒴⒵<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="数学符号">数学符号</h2><pre class="line-numbers language-none"><code class="language-none">﹢﹣×÷±/=≌∽≦≧≒ ﹤﹥ ≈≡≠=≤≥&lt;&gt;≮≯∷∶∫∮∝∞∧∨∑∏∪∩∈∵∴⊥∥∠⌒⊙√∟⊿㏒㏑%‰⅟½⅓⅕⅙⅛⅔⅖⅚⅜¾⅗⅝⅞⅘≂≃≄≅≆≇≈≉≊≋≌≍≎≏≐≑≒≓≔≕≖≗≘≙≚≛≜≝≞≟≠≡≢≣≤≥≦≧≨≩⊰⊱⋛⋚∫∬∭∮∯∰∱∲∳%℅‰‱øØπ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="爱心符号">爱心符号</h2><pre class="line-numbers language-none"><code class="language-none">♥❣ღ♠♡♤❤❥<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="标点符号">标点符号</h2><pre class="line-numbers language-none"><code class="language-none">。，、＇：∶；?‘’“”〝〞ˆˇ﹕︰﹔﹖﹑•¨….¸;！´？！～—ˉ ｜‖＂〃｀@﹫¡¿﹏﹋﹌︴々﹟#﹩$﹠&amp;﹪%*﹡﹢﹦﹤‐￣ ¯―﹨ˆ˜﹍﹎+=&lt;＿*-\ˇ~﹉﹊（）〈〉‹›﹛﹜『』〖〗［］《》〔〕{}「」【】︵︷︿︹︽*﹁﹃︻︶︸﹀︺︾ˉ﹂﹄︼❝❞<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="单位符号">单位符号</h2><pre class="line-numbers language-none"><code class="language-none">°′″＄￥〒￠￡％＠℃℉ ﹩﹪‰﹫㎡㏕㎜㎝㎞㏎m³㎎㎏㏄º○¤%$º¹²³<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="货币符号">货币符号</h2><pre class="line-numbers language-none"><code class="language-none">€£Ұ₴$₰¢₤¥₳₲₪₵ 元 ₣₱฿¤₡₮₭₩ރ 円 ₢₥₫₦zł﷼₠₧₯₨Kčर₹ƒ₸ ￠<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="箭头符号（含推导-转换符号）">箭头符号（含推导&amp;转换符号）</h2><pre class="line-numbers language-none"><code class="language-none">↑↓←→↖↗↘↙↔↕➻➼➽➸➳➺➻➴➵➶➷➹▶►▷◁◀◄«»➩➪➫➬➭➮➯➱⏎➲➾➔➘➙➚➛➜➝➞➟➠➡➢➣➤➥➦➧➨↚↛↜↝↞↟↠↠↡↢↣↤↤↥↦↧↨⇄⇅⇆⇇⇈⇉⇊⇋⇌⇍⇎⇏⇐⇑⇒⇓⇔⇖⇗⇘⇙⇜↩↪↫↬↭↮↯↰↱↲↳↴↵↶↷↸↹☇☈↼↽↾↿⇀⇁⇂⇃⇞⇟⇠⇡⇢⇣⇤⇥⇦⇧⇨⇩⇪↺↻⇚⇛♐<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="符号图案">符号图案</h2><pre class="line-numbers language-none"><code class="language-none">✐✎✏✑✒✍✉✁✂✃✄✆✉☎☏☑✓✔√☐☒✗✘ ㄨ ✕✖✖☢☠☣✈★☆✡ 囍㍿ ☯☰☲☱☴☵☶☳☷☜☞☝✍☚☛☟✌♤♧♡♢♠♣♥♦☀☁☂❄☃♨웃유❖☽☾☪✿♂♀✪✯☭➳ 卍卐 √×■◆●○◐◑✙☺☻❀⚘♔♕♖♗♘♙♚♛♜♝♞♟♧♡♂♀♠♣♥❤☜☞☎☏⊙◎☺☻☼▧▨♨◐◑↔↕▪▒◊◦▣▤▥▦▩◘◈◇♬♪♩♭♪ の ★☆→ あぃ￡ Ю〓§♤♥▶¤✲❈✿✲❈➹☀☂☁【】┱┲❣✚✪✣✤✥✦❉❥❦❧❃❂❁❀✄☪☣☢☠☭ღ▶▷◀◁☀☁☂☃☄★☆☇☈⊙☊☋☌☍ⓛⓞⓥⓔ╬『』∴☀♫♬♩♭♪☆∷﹌の ★◎▶☺☻►◄▧▨♨◐◑↔↕↘▀▄█▌◦☼♪ の ☆→♧ ぃ￡ ❤▒▬♦◊◦♠♣▣۰•❤•۰►◄▧▨♨◐◑↔↕▪▫☼♦⊙●○①⊕◎Θ⊙¤ ㊣ ★☆♀◆◇◣◢◥▲▼△▽⊿◤◥✐✌✍✡✓✔✕✖♂♀♥♡☜☞☎☏⊙◎☺☻►◄▧▨♨◐◑↔↕♥♡▪▫☼♦▀▄█▌▐░▒▬♦◊◘◙◦☼♠♣▣▤▥▦▩◘◙◈♫♬♪♩♭♪✄☪☣☢☠♯♩♪♫♬♭♮☎☏☪♈ºº₪¤큐«»™♂✿♥ 　 ◕‿-｡　｡◕‿◕｡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="希腊字母">希腊字母</h2><pre class="line-numbers language-none"><code class="language-none">ΑΒΓΔΕΖΗΘΙΚΛΜΝΞΟΠΡΣΤΥΦΧΨΩαβγδεζνξοπρσηθικλμτυφχψω<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="俄语字母">俄语字母</h2><pre class="line-numbers language-none"><code class="language-none">АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯабвгдеёжзийклмнопрстуфхцчшщъыьэюя<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="汉语拼音">汉语拼音</h2><pre class="line-numbers language-none"><code class="language-none">āáǎàōóǒòēéěèīíǐìūúǔùǖǘǚǜüêɑńňɡ ㄅㄆㄇㄈㄉㄊㄋㄌㄍㄎㄏㄐㄑㄒㄓㄔㄕㄖㄗㄘㄙㄚㄛㄜㄝㄞㄟㄠㄡㄢㄣㄤㄥㄦㄧㄨㄩ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="中文字符">中文字符</h2><pre class="line-numbers language-none"><code class="language-none">零壹贰叁肆伍陆柒捌玖拾佰仟万亿吉太拍艾分厘毫微卍卐卄巜弍弎弐朤氺曱甴囍兀々〆のぁ〡〢〣〤〥〦〧〨〩㊎㊍㊌㊋㊏㊚㊛㊐㊊㊣㊤㊥㊦㊧㊨㊒㊫㊑㊓㊔㊕㊖㊗㊘㊜㊝㊞㊟㊠㊡㊢㊩㊪㊬㊭㊮㊯㊰㊀㊁㊂㊃㊄㊅㊆㊇㊈㊉<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="日文符号">日文符号</h2><pre class="line-numbers language-none"><code class="language-none">ぁあぃいぅうぇえぉおかがきぎくぐけげこごさざしじすずせぜそぞただちぢっつづてでとどなにぬねのはばぱひびぴふぶぷへべぺほぼぽまみむめもゃやゅゆょよらりるれろゎわゐゑをんゔゕゖァアィイゥウェエォオカガキギクグケゲコゴサザシジスズセゼソゾタダチヂッツヅテデトドナニヌネノハバパヒビピフブプヘベペホボポマミムメモャヤュユョヨラリルレロヮワヰヱヲンヴヵヶヷヸヹヺ・ーヽヾヿ゠ㇰㇱㇲㇳㇴㇵㇶㇷㇸㇹㇺㇻㇼㇽㇾㇿ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="制表符号">制表符号</h2><pre class="line-numbers language-none"><code class="language-none">─ ━│┃╌╍╎╏┄ ┅┆┇┈ ┉┊┋┌┍┎┏┐┑┒┓└ ┕┖┗ ┘┙┚┛├┝┞┟┠┡┢┣ ┤┥┦┧┨┩┪┫┬ ┭ ┮ ┯ ┰ ┱ ┲ ┳┴ ┵ ┶ ┷ ┸ ┹ ┺ ┻┼ ┽ ┾ ┿ ╀ ╁ ╂ ╃ ╄ ╅ ╆ ╇ ╈ ╉ ╊ ╋ ╪ ╫ ╬═║╒╓╔ ╕╖╗╘╙╚ ╛╜╝╞╟╠ ╡╢╣╤ ╥ ╦ ╧ ╨ ╩ ╳╔ ╗╝╚ ╬ ═ ╓ ╩ ┠ ┨┯ ┷┏ ┓┗ ┛┳ ⊥ ﹃ ﹄┌ ╮ ╭ ╯╰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="皇冠符号">皇冠符号</h2><pre class="line-numbers language-none"><code class="language-none">♚ 　 ♛ 　 ♝ 　 ♞ 　 ♜ 　 ♟ 　 ♔ 　 ♕ 　 ♗ 　 ♘ 　 ♖ 　 ♟<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="彩色表情符号">彩色表情符号</h2><pre class="line-numbers language-none"><code class="language-none">🌹🍀🍎💰📱🌙🍁🍂🍃🌷💎🔪🔫🏀⚽⚡👄👍🔥<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="常用-emoji-符号">常用 emoji 符号</h2><pre class="line-numbers language-none"><code class="language-none">😀😁😂😃😄😅😆😉😊😋😎😍😘😗😙😚☺😇😐😑😶😏😣😥😮😯😪😫😴😌😛😜😝😒😓😔😕😲😷😖😞😟😤😢😭😦😧😨😬😰😱😳😵😡😠😈👿👹👺💀👻👽👦👧👨👩👴👵👶👱👮👲👳👷👸💂🎅👰👼💆💇🙍🙎🙅🙆💁🙋🙇🙌🙏👤👥🚶🏃👯💃👫👬👭💏💑👪💪👈👉☝👆👇✌✋👌👍👎✊👊👋👏👐✍👣👀👂👃👅👄💋👓👔👕👖👗👘👙👚👛👜👝🎒💼👞👟👠👡👢👑👒🎩🎓💄💅💍🌂🙈🙉🙊🐵🐒🐶🐕🐩🐺🐱😺😸😹😻😼😽🙀😿😾🐈🐯🐅🐆🐴🐎🐮🐂🐃🐄🐷🐖🐗🐽🐏🐑🐐🐪🐫🐘🐭🐁🐀🐹🐰🐇🐻🐨🐼🐾🐔🐓🐣🐤🐥🐦🐧🐸🐊🐢🐍🐲🐉🐳🐋🐬🐟🐠🐡🐙🐚🐌🐛🐜🐝🐞🦋💐🌸💮🌹🌺🌻🌼🌷🌱🌲🌳🌴🌵🌾🌿🍀🍁🍂🍃🌍🌎🌏🌐🌑🌒🌓🌔🌕🌖🌗🌘🌙🌚🌛🌜☀🌝🌞⭐🌟🌠☁⛅☔⚡❄🔥💧🌊💩🍇🍈🍉🍊🍋🍌🍍🍎🍏🍐🍑🍒🍓🍅🍆🌽🍄🌰🍞🍖🍗🍔🍟🍕🍳🍲🍱🍘🍙🍚🍛🍜🍝🍠🍢🍣🍤🍥🍡🍦🍧🍨🍩🍪🎂🍰🍫🍬🍭🍮🍯🍼☕🍵🍶🍷🍸🍹🍺🍻🍴🎪🎭🎨🎰🚣🛀🎫🏆⚽⚾🏀🏈🏉🎾🎱🎳⛳🎣🎽🎿🏂🏄🏇🏊🚴🚵🎯🎮🎲🎷🎸🎺🎻🎬👾🌋🗻🏠🏡🏢🏣🏤🏥🏦🏨🏩🏪🏫🏬🏭🏯🏰💒🗼🗽⛪⛲🌁🌃🌆🌇🌉🌌🎠🎡🎢🚂🚃🚄🚅🚆🚇🚈🚉🚊🚝🚞🚋🚌🚍🚎🚏🚐🚑🚒🚓🚔🚕🚖🚗🚘🚚🚛🚜🚲⛽🚨🚥🚦🚧⚓⛵🚤🚢✈💺🚁🚟🚠🚡🚀🎑🗿🛂🛃🛄🛅💌💎🔪💈🚪🚽🚿🛁⌛⏳⌚⏰🎈🎉🎊🎎🎏🎐🎀🎁📯📻📱📲☎📞📟📠🔋🔌💻💽💾💿📀🎥📺📷📹📼🔍🔎🔬🔭📡💡🔦🏮📔📕📖📗📘📙📚📓📃📜📄📰📑🔖💰💴💵💶💷💸💳✉📧📨📩📤📥📦📫📪📬📭📮✏✒📝📁📂📅📆📇📈📉📊📋📌📍📎📏📐✂🔒🔓🔏🔐🔑🔨🔫🔧🔩🔗💉💊🚬🔮🚩🎌💦💨💣☠♠♥♦♣🀄🎴🔇🔈🔉🔊📢📣💤💢💬💭♨🌀🔔🔕✡✝🔯📛🔰🔱⭕✅☑✔✖❌❎➕➖➗➰➿〽✳✴❇‼⁉❓❔❕❗©®™🎦🔅🔆💯🔠🔡🔢🔣🔤🅰🆎🅱🆑🆒🆓ℹ🆔Ⓜ🆕🆖🅾🆗🅿🆘🆙🆚🈁🈂🈷🈶🈯 🉐 🈹🈚🈲 🉑 🈸🈴🈳 ㊗㊙ 🈺🈵▪▫◻◼◽◾⬛⬜🔶🔷🔸🔹🔺🔻💠🔲🔳⚪⚫🔴🔵♈♉♊♋♌♍♎♏♐♑♒♓⛎💘❤💓💔💕💖💗💙💚💛💜💝💞💟❣🌿🚧💒☎📟💽⬆↗➡↘⬇↙⬅↖↕↔↩↪⤴⤵🔃🔄🔙🔚🔛🔜🔝🔀🔁🔂▶⏩◀⏪🔼⏫🔽⏬📱📶📳📴♻🏧🚮🚰♿🚹🚺🚻🚼🚾⚠🚸⛔🚫🚳🚭🚯🚱🚷🔞<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;emoji表情符号是非常流行的表情符号，几乎没有地方都会支持。这里列举出常用的emoji表情不好，方便大家使用与查阅。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="web" scheme="https://blog.17lai.site/categories/web/"/>
    
    
    <category term="web" scheme="https://blog.17lai.site/tags/web/"/>
    
    <category term="emoji" scheme="https://blog.17lai.site/tags/emoji/"/>
    
  </entry>
  
  <entry>
    <title>winrar去广告和破解</title>
    <link href="https://blog.17lai.site/posts/3b296307/"/>
    <id>https://blog.17lai.site/posts/3b296307/</id>
    <published>2022-03-19T12:00:47.000Z</published>
    <updated>2022-03-19T12:57:22.197Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>WinRAR 是一款不错的解压缩软件，但还是收费软件，广告不少，今天就总结了一下网上的各路教程。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/hexo@latest/medias_webp/cover/winrar.webp" alt=""></p><h2 id="crack-winrar">crack winrar</h2><p>首先通过特殊方式获取软件许可：<br>新建一个文本文档</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1920220319200929.png" alt="img"></p><p>在这个文本文档里输入内容：</p><pre class="line-numbers language-key" data-language="key"><code class="language-key">RAR registration data``Federal Agency ``for` `Education``1000000 PC usage license``UID=b621cca9a84bc5deffbf``6412612250ffbf533df6db2dfe8ccc3aae5362c06d54762105357d``5e3b1489e751c76bf6e0640001014be50a52303fed29664b074145``7e567d04159ad8defc3fb6edf32831fd1966f72c21c0c53c02fbbb``2f91cfca671d9c482b11b8ac3281cb21378e85606494da349941fa``e9ee328f12dc73e90b6356b921fbfb8522d6562a6a4b97e8ef6c9f``fb866be1e3826b5aa126a4d2bfe9336ad63003fc0e71c307fc2c60``64416495d4c55a0cc82d402110498da970812063934815d81470829275<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0320211103230820.png" alt="img"></p><p>然后将文件名改为：rarreg.key</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0320211103231031.png" alt="img"></p><p>再将这个文件导入WinRAR的安装文件夹<br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0320211103231545.png" alt="img"><br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0320211103231839.png" alt="img"><br>这时点开关于WinRAR，已经获取许可。<br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0320211103231800.png" alt="img"></p><h2 id="去除广告">去除广告</h2><p>接下来使用Resource Hacker软件打开<strong>winrar</strong>.exe<br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0320211103231916.png" alt="img"><br>进入字串表，找到“80”，删除“1267”和“1277”行<br>点击绿色三角形按钮，编译。<br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0320211103231939.png" alt="img"><br>然后：文件→另存为，进行保存。<br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0320211103232002.png" alt="img"><br>然后对源文件：winrar.exe进行替换,注意，要关闭winrar软件<br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0320211103232039.png" alt="img"></p><p>至此，已经完成破解和去广告了。</p><p>参考来源 52pojie</p><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="tools" scheme="https://blog.17lai.site/categories/tools/"/>
    
    
    <category term="tools" scheme="https://blog.17lai.site/tags/tools/"/>
    
    <category term="winrar" scheme="https://blog.17lai.site/tags/winrar/"/>
    
    <category term="crack" scheme="https://blog.17lai.site/tags/crack/"/>
    
  </entry>
  
  <entry>
    <title>使用 Shell 脚本实现一个简单 Docker</title>
    <link href="https://blog.17lai.site/posts/90e60aac/"/>
    <id>https://blog.17lai.site/posts/90e60aac/</id>
    <published>2022-03-18T06:33:17.000Z</published>
    <updated>2022-03-19T12:58:38.436Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>《使用 Shell 脚本实现 Docker》旨在通过一系列的实验使用户对docker的底层技术，如Namespace、CGroups、rootfs、联合加载等有一个感性的认识。在此过程中，我们还将通过Shell脚本一步一步地实现一个简易的docker，以期使读者在使用docker的过程中知其然知其所以然。</p></blockquote><p>我们的实验环境为Ubuntu 18.04 64bit，简易docker工程的名字为docker.sh，该工程仓库地址如下：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">https://github.com/pandengyang/docker.sh.githttps://github.com/appotry/docker.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>《使用 Shell 脚本实现 Docker》目录如下：</p><pre class="line-numbers language-none"><code class="language-none">1. Namespace1.1. Namespace简介1.2. uts namespace1.2.1. uts namespace简介1.2.2. docker.sh1.3. mount namespace1.3.1. /etc/mtab、/proc/self/mounts1.3.2. /proc/self/mountinfo1.3.3. bind mount1.3.4. mount namespace简介1.3.5. docker.sh1.4. pid namespace1.4.1. unshare的--fork选项1.4.2. pid namespace简介1.4.3. pid嵌套1.4.4. docker.sh2. CGroups2.1. CGroups简介2.2. 限制内存2.2.1. 用CGroups限制内存2.2.2. docker.sh3. 切换根文件系统3.1. 根文件系统3.2. pivot_root3.3. docker.sh4. 联合加载4.1. 联合加载简介4.2. AUFS4.3. docker.sh5. 卷5.1. 卷简介5.2. docker.sh6. 后记<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="1-Namespace">1.Namespace</h2><h3 id="1-1-Namespace简介">1.1.Namespace简介</h3><p>传统上，在Linux中，许多资源是全局管理的。例如，系统中的所有进程按照惯例是通过PID标识的，这意味着内核必须管理一个全局的PID列表。而且，所有调用者通过uname系统调用返回的系统相关信息都是相同的。用户id的管理方式类似，即各个用户是通过一个全局唯一的UID标识。</p><p>Namespace是Linux用来隔离上述全局资源的一种方式。把一个或多个进程加入到同一个namespace中后，这些进程只会看到该namespace中的资源。namespace是后来加入到Linux中的，为了兼容之前的全局资源管理方式，Linux为每一种资源准备了一个全局的namespace。Linux中的每一个进程都默认加入了这些全局namespace。</p><p>Linux中的每个进程都有一个/proc/[pid]/ns/目录，里面包含了该进程所属的namespace信息。我们查看一下当前Shell的/proc/[pid]/ns目录，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">sudo</span> <span class="token function">ls</span> -l /proc/<span class="token variable">$$</span>/nstotal <span class="token number">0</span>lrwxrwxrwx <span class="token number">1</span> phl phl <span class="token number">0</span> Jan <span class="token number">22</span> 08:43 cgroup -<span class="token operator">&gt;</span> cgroup:<span class="token punctuation">[</span><span class="token number">4026531835</span><span class="token punctuation">]</span>lrwxrwxrwx <span class="token number">1</span> phl phl <span class="token number">0</span> Jan <span class="token number">22</span> 08:43 ipc -<span class="token operator">&gt;</span> ipc:<span class="token punctuation">[</span><span class="token number">4026531839</span><span class="token punctuation">]</span>lrwxrwxrwx <span class="token number">1</span> phl phl <span class="token number">0</span> Jan <span class="token number">22</span> 08:43 mnt -<span class="token operator">&gt;</span> mnt:<span class="token punctuation">[</span><span class="token number">4026531840</span><span class="token punctuation">]</span>lrwxrwxrwx <span class="token number">1</span> phl phl <span class="token number">0</span> Jan <span class="token number">22</span> 08:43 net -<span class="token operator">&gt;</span> net:<span class="token punctuation">[</span><span class="token number">4026531993</span><span class="token punctuation">]</span>lrwxrwxrwx <span class="token number">1</span> phl phl <span class="token number">0</span> Jan <span class="token number">22</span> 08:43 pid -<span class="token operator">&gt;</span> pid:<span class="token punctuation">[</span><span class="token number">4026531836</span><span class="token punctuation">]</span>lrwxrwxrwx <span class="token number">1</span> phl phl <span class="token number">0</span> Jan <span class="token number">22</span> 08:43 pid_for_children -<span class="token operator">&gt;</span> pid:<span class="token punctuation">[</span><span class="token number">4026531836</span><span class="token punctuation">]</span>lrwxrwxrwx <span class="token number">1</span> phl phl <span class="token number">0</span> Jan <span class="token number">22</span> 08:43 user -<span class="token operator">&gt;</span> user:<span class="token punctuation">[</span><span class="token number">4026531837</span><span class="token punctuation">]</span>lrwxrwxrwx <span class="token number">1</span> phl phl <span class="token number">0</span> Jan <span class="token number">22</span> 08:43 uts -<span class="token operator">&gt;</span> uts:<span class="token punctuation">[</span><span class="token number">4026531838</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>该目录下有很多符号链接，每个符号链接代表一个该进程所属的namespace。用readlink读取这些符号链接可以查看进程所属的namespace id。我们读一下当前Shell所属的uts namespace id，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">sudo</span> readlink /proc/<span class="token variable">$$</span>/ns/utsuts:<span class="token punctuation">[</span><span class="token number">4026531838</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>后文中我们将介绍uts namespace、mount namespace、pid namespace的用法。</p><h3 id="1-2-uts-namespace">1.2.uts namespace</h3><h4 id="1-2-1-uts-namespace简介">1.2.1.uts namespace简介</h4><p>uts namespace用于隔离系统的主机名等信息，我们将通过实验学习其用法。在实验过程中，我们采用如下的步骤：</p><ol><li>查看全局uts namespace信息</li><li>新建一个uts namespace，查看其信息并作出修改</li><li>查看全局uts namespace，查看其是否被新建的uts namespace影响到</li></ol><p>对于其他namespace，我们也采取类似的步骤进行实验学习。</p><p>首先，我们查看一下全局的hostname及uts namespace id。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">hostname</span>kernelnewbiesphl@kernelnewbies:~$ <span class="token function">sudo</span> readlink /proc/<span class="token variable">$$</span>/ns/utsuts:<span class="token punctuation">[</span><span class="token number">4026531838</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后，我们创建一个新的uts namespace，并查看其namespce id。</p><p>在继续之前，需要介绍一个namespace工具unshare。利用unshare我们可以新建一个的namespace，并在新namespace中执行一条命令。unshare执行时需要root权限。unshare的使用方法如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">unshare <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>program <span class="token punctuation">[</span>arguments<span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>执行unshare时，我们可以指定要新建的namespace的类型以及要执行的命令。unshare提供了一系列选项，当指定某个选项时可新建指定的namespace。namespace类型选项如下：</p><ul><li>--uts创建新的uts namespace</li><li>--mount创建新的mount namespace</li><li>--pid创建新的pid namespace</li><li>--user创建新的user namespace</li></ul><p>介绍完unshare之后，我们继续之前的实验。我们用unshare创建一个新的uts namespace，并在新的uts namespace中执行/bin/bash命令，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">sudo</span> unshare --uts /bin/bashroot@kernelnewbies:~<span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>我们用unshare创建了一个新的uts namespace。在新的uts namespace中查看其hostname和namespace id，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kernelnewbies:~$ <span class="token function">hostname</span>kernelnewbiesroot@kernelnewbies:~<span class="token comment"># readlink /proc/$$/ns/uts</span>uts:<span class="token punctuation">[</span><span class="token number">4026532177</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，新uts namespace的id与全局uts namespace的id不一致。这说明/bin/bash已运行在一个新的uts namespace中了。</p><p>我们将新uts namespace的hostname改为dreamland，并强制更新Shell提示符。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kernelnewbies:~<span class="token comment"># hostname dreamland</span>root@kernelnewbies:~<span class="token comment"># hostname</span>dreamlandroot@kernelnewbies:~<span class="token comment"># exec /bin/bash</span>root@dreamland:~<span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，新uts namespace的hostname的确是被修改了，exec /bin/bash用于强制更新Shell的提示符。</p><p>我们重新打开一个Shell窗口，该Shell位于全局uts namespace中。在新的Shell窗口中查看全局uts namespace id及hostname，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">hostname</span>kernelnewbiesphl@kernelnewbies:~$ <span class="token function">sudo</span> readlink /proc/<span class="token variable">$$</span>/ns/utsuts:<span class="token punctuation">[</span><span class="token number">4026531838</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，我们在新uts namespace中所作的修改并未影响到全局的uts namespace。</p><p>父进程创建子进程时只有提供创建新namespace的标志，才可创建新的namespace，并使子进程处于新的namespace中。默认情况下，子进程与父进程处于相同的namespace中。我们在新的uts namespace中创建一个子进程，然后查看该子进程的uts namespace id，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">sudo</span> unshare --uts /bin/bashroot@kernelnewbies:~<span class="token comment"># readlink /proc/$$/ns/uts</span>uts:<span class="token punctuation">[</span><span class="token number">4026532305</span><span class="token punctuation">]</span>root@kernelnewbies:~<span class="token comment"># bash</span>root@kernelnewbies:~<span class="token comment"># readlink /proc/$$/ns/uts</span>uts:<span class="token punctuation">[</span><span class="token number">4026532305</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，子进程所属uts namespace的id与其父进程相同。其他namespae与uts namespace类似，子进程与父进程同属一个namespace。</p><h4 id="1-2-2-docker-sh">1.2.2.docker.sh</h4><p>有了以上关于uts namespace的介绍，我们就可以将uts namespace加入到docker.sh中了。docker.sh工程分为两个脚本：docker.sh和container.sh。</p><p>docker.sh用于收集用户输入、调用unshare创建namespace并执行container.sh脚本，docker.sh脚本如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token function-name function">usage</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[31mIMPORTANT: Run As Root<span class="token entity" title="\033">\033</span>[0m"</span>        <span class="token builtin class-name">echo</span> <span class="token string">""</span>        <span class="token builtin class-name">echo</span> <span class="token string">"Usage:    docker.sh [OPTIONS]"</span>        <span class="token builtin class-name">echo</span> <span class="token string">""</span>        <span class="token builtin class-name">echo</span> <span class="token string">"A docker written by shell"</span>        <span class="token builtin class-name">echo</span> <span class="token string">""</span>        <span class="token builtin class-name">echo</span> <span class="token string">"Options:"</span>        <span class="token builtin class-name">echo</span> <span class="token string">"          -c string       docker command"</span>        <span class="token builtin class-name">echo</span> <span class="token string">"                          (<span class="token entity" title="\&quot;">\"</span>run<span class="token entity" title="\&quot;">\"</span>)"</span>        <span class="token builtin class-name">echo</span> <span class="token string">"          -m              memory"</span>        <span class="token builtin class-name">echo</span> <span class="token string">"                          (<span class="token entity" title="\&quot;">\"</span>100M, 200M, 300M...<span class="token entity" title="\&quot;">\"</span>)"</span>        <span class="token builtin class-name">echo</span> <span class="token string">"          -C string       container name"</span>        <span class="token builtin class-name">echo</span> <span class="token string">"          -I string       image name"</span>        <span class="token builtin class-name">echo</span> <span class="token string">"          -V string       volume"</span>        <span class="token builtin class-name">echo</span> <span class="token string">"          -P string       program to run in container"</span>        <span class="token builtin class-name">return</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">whoami</span><span class="token variable">)</span></span>"</span> <span class="token operator">!=</span> root<span class="token keyword">then</span>        usage        <span class="token builtin class-name">exit</span> -1<span class="token keyword">fi</span><span class="token keyword">while</span> <span class="token builtin class-name">getopts</span> c:m:C:I:V:P: option<span class="token keyword">do</span>        <span class="token keyword">case</span> <span class="token string">"<span class="token variable">$option</span>"</span>        <span class="token keyword">in</span>                c<span class="token punctuation">)</span> <span class="token assign-left variable">cmd</span><span class="token operator">=</span><span class="token variable">$OPTARG</span><span class="token punctuation">;</span><span class="token punctuation">;</span>                m<span class="token punctuation">)</span> <span class="token assign-left variable">memory</span><span class="token operator">=</span><span class="token variable">$OPTARG</span><span class="token punctuation">;</span><span class="token punctuation">;</span>                C<span class="token punctuation">)</span> <span class="token assign-left variable">container</span><span class="token operator">=</span><span class="token variable">$OPTARG</span><span class="token punctuation">;</span><span class="token punctuation">;</span>                I<span class="token punctuation">)</span> <span class="token assign-left variable">image</span><span class="token operator">=</span><span class="token variable">$OPTARG</span><span class="token punctuation">;</span><span class="token punctuation">;</span>                V<span class="token punctuation">)</span> <span class="token assign-left variable">volume</span><span class="token operator">=</span><span class="token variable">$OPTARG</span><span class="token punctuation">;</span><span class="token punctuation">;</span>                P<span class="token punctuation">)</span> <span class="token assign-left variable">program</span><span class="token operator">=</span><span class="token variable">$OPTARG</span><span class="token punctuation">;</span><span class="token punctuation">;</span>                <span class="token punctuation">\</span>?<span class="token punctuation">)</span> usage                    <span class="token builtin class-name">exit</span> -2<span class="token punctuation">;</span><span class="token punctuation">;</span>        <span class="token keyword">esac</span><span class="token keyword">done</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">cmd</span><span class="token operator">=</span><span class="token variable">$cmd</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">memory</span><span class="token operator">=</span><span class="token variable">$memory</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">container</span><span class="token operator">=</span><span class="token variable">$container</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">image</span><span class="token operator">=</span><span class="token variable">$image</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">volume</span><span class="token operator">=</span><span class="token variable">$volume</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">program</span><span class="token operator">=</span><span class="token variable">$program</span>unshare --uts ./container.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>脚本最开始为usage函数，该函数为docker.sh的使用说明。当用户以非预期的方式使用docker.sh时，该函数会被调用。该函数输出如下信息：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">IMPORTANT: Run As RootUsage:  docker.sh <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span>A <span class="token function">docker</span> written by shellOptions:                -c string       <span class="token function">docker</span> <span class="token builtin class-name">command</span>                                <span class="token punctuation">(</span><span class="token string">"run"</span><span class="token punctuation">)</span>                -m              memory                                <span class="token punctuation">(</span><span class="token string">"100M, 200M, 300M..."</span><span class="token punctuation">)</span>                -C string       container name                -I string       image name                -V string       volume                -P string       program to run <span class="token keyword">in</span> container<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从usage函数的输出我们可以看到，执行docker.sh时需要root权限且需要正确地传递参数。</p><p>docker.sh首先对当前用户进行检测，如果用户不为root，则打印使用说明并退出脚本；如果用户为root，则继续执行。检测用户的脚本如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">whoami</span><span class="token variable">)</span></span>"</span> <span class="token operator">!=</span> root<span class="token keyword">then</span>        usage        <span class="token builtin class-name">exit</span> -1<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后，docker.sh使用getopts从命令行提取参数，然后赋值给合适的变量。从命令行提取参数的脚本如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">while</span> <span class="token builtin class-name">getopts</span> c:m:C:I:V:P: option<span class="token keyword">do</span>        <span class="token keyword">case</span> <span class="token string">"<span class="token variable">$option</span>"</span>        <span class="token keyword">in</span>                c<span class="token punctuation">)</span> <span class="token assign-left variable">cmd</span><span class="token operator">=</span><span class="token variable">$OPTARG</span><span class="token punctuation">;</span><span class="token punctuation">;</span>                m<span class="token punctuation">)</span> <span class="token assign-left variable">memory</span><span class="token operator">=</span><span class="token variable">$OPTARG</span><span class="token punctuation">;</span><span class="token punctuation">;</span>                C<span class="token punctuation">)</span> <span class="token assign-left variable">container</span><span class="token operator">=</span><span class="token variable">$OPTARG</span><span class="token punctuation">;</span><span class="token punctuation">;</span>                I<span class="token punctuation">)</span> <span class="token assign-left variable">image</span><span class="token operator">=</span><span class="token variable">$OPTARG</span><span class="token punctuation">;</span><span class="token punctuation">;</span>                V<span class="token punctuation">)</span> <span class="token assign-left variable">volume</span><span class="token operator">=</span><span class="token variable">$OPTARG</span><span class="token punctuation">;</span><span class="token punctuation">;</span>                P<span class="token punctuation">)</span> <span class="token assign-left variable">program</span><span class="token operator">=</span><span class="token variable">$OPTARG</span><span class="token punctuation">;</span><span class="token punctuation">;</span>                <span class="token punctuation">\</span>?<span class="token punctuation">)</span> usage                    <span class="token builtin class-name">exit</span> -2<span class="token punctuation">;</span><span class="token punctuation">;</span>        <span class="token keyword">esac</span><span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果用户的输入不正确，则打印使用说明并退出脚本；如果用户输入正确，则解析命令行参数并赋值给合适的变量。</p><p>为了简化，用户在运行docker.sh时需提供完整的参数列表，示例如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> ./docker.sh -c run -m 100M -C dreamland -I ubuntu1604 -V data1 -P /bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当然，如果当前用户就是root，就不需要sudo了。下表列出了各个参数的含义及示例：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1820220318143125.png" alt="使用 Shell 脚本实现 Docker"></p><p>docker.sh将命令行参数赋值给变量后，需要将这些变量导出，以传递给container.sh。导出变量的脚本如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">cmd</span><span class="token operator">=</span><span class="token variable">$cmd</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">memory</span><span class="token operator">=</span><span class="token variable">$memory</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">container</span><span class="token operator">=</span><span class="token variable">$container</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">image</span><span class="token operator">=</span><span class="token variable">$image</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">volume</span><span class="token operator">=</span><span class="token variable">$volume</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">program</span><span class="token operator">=</span><span class="token variable">$program</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里说明一下为什么要将docker.sh工程拆分为docker.sh和container.sh两个脚本。因为调用unshare创建新的namespace时，会执行一个命令，该命令在新的namespace中运行。该命令一旦结束，unshare也就结束了，unshare创建的新namespace也就不存在了。</p><p>docker.sh不会并发地执行unshare命令与unshare之后的脚本，因此，只有unshare结束了，后续脚本才可继续运行。但是当unshare结束了，准备执行后续脚本时，新的namespae已经不存在了。因此一些加入cgroups、切换根文件系统等工作必须在unshare执行的命令中进行，所以我们采用在unshare中执行container.sh脚本的方式完成后续的工作。</p><p>最后，docker.sh调用unshare创建新的uts namespace，并执行container.sh脚本。调用unshare的脚本如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">unshare --uts ./container.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>container.sh将容器的hostname修改为通过-C传递的容器的名字，然后执行通过-P传递的程序。container.sh脚本如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token function">hostname</span> <span class="token variable">$container</span><span class="token builtin class-name">exec</span> <span class="token variable">$program</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>现在，我们运行docker.sh，并查看其hostname。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/docker.sh$ <span class="token function">sudo</span> ./docker.sh -c run -m 100M -C dreamland -I ubuntu1604 -V data1 -P /bin/bashroot@dreamland:~/docker.sh<span class="token comment"># hostname</span>dreamland<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，容器的hostname已经改变为我们传递的容器名字dreamland了。</p><h3 id="1-3-mount-namespace">1.3.mount namespace</h3><h4 id="1-3-1-etc-mtab、-proc-self-mounts">1.3.1./etc/mtab、/proc/self/mounts</h4><p>早期的Linux使用/etc/mtab文件来记录当前的挂载点信息。每次mount/umount文件系统时会更新/etc/mtab文件中的信息。</p><p>后来，linux引入了mount namespace，每个进程都有一份自己的挂载点信息。当然，处于同一个mount namespace里面的进程，其挂载点信息是相同的。进程的挂载点信息通过/proc/[pid]/mounts文件导出给用户。</p><p>为了兼容以前的/etc/mtab，/etc/mtab变成了指向/proc/self/mounts的符号链接。通过readlink查看/etc/mtab指向的文件，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ readlink /etc/mtab<span class="token punctuation">..</span>/proc/self/mounts<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>通过读取/proc/self/mounts文件，可以查看当前的挂载点信息，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">cat</span> /proc/self/mountssysfs /sys sysfs rw,nosuid,nodev,noexec,relatime <span class="token number">0</span> <span class="token number">0</span>proc /proc proc rw,nosuid,nodev,noexec,relatime <span class="token number">0</span> <span class="token number">0</span>/dev/sda1 / ext4 rw,relatime,errors<span class="token operator">=</span>remount-ro <span class="token number">0</span> <span class="token number">0</span>securityfs /sys/kernel/security securityfs rw,nosuid,nodev,noexec,relatime <span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由于该文件中内容太多，我们省略了一部分，只保留了一些比较重要的挂载点信息。每行的信息分为六个字段，各字段的含义及示例如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1820220318143143.png" alt="使用 Shell 脚本实现 Docker"></p><p>由于该文件有点过时，被后文介绍的/proc/self/mountinfo替换掉，所以不做过多介绍。</p><h4 id="1-3-2-proc-self-mountinfo">1.3.2./proc/self/mountinfo</h4><p>/proc/self/mountinfo包含了进程mount namespace中的挂载点信息。 它提供了旧的/proc/[pid]/mounts文件中缺少的各种信息（传播状态，挂载点id，父挂载点id等），并解决了/proc/[pid]/mounts文件的一些其他缺陷。我们查看进程挂载点信息时应优先使用该文件。</p><p>该文件中每一行代表一个挂载点信息，每个挂载点信息分为11个字段。挂载点信息的示例如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1820220318143124.png" alt="使用 Shell 脚本实现 Docker"></p><p>各字段的含义及示例如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1820220318143118.png" alt="使用 Shell 脚本实现 Docker"></p><p>我们主要关注可选字段中的传播状态选项。首先，我们看一下关于mount namespace的问题。问题如下：</p><p>当创建mount namespace时，新mount namespace会拷贝一份老mount namespace里面的挂载点信息。例如，全局mount namespace中有一个/a挂载点，新建的mount namespace中也会有一个/a挂载点。那么我们在新mount namespace中的/a下创建或删除一个挂载点，全局mount namespace中的/a会同步创建或删除该挂载点吗？或者在全局mount namespace中的/a下创建或删除一个挂载点，新mount namespace中的/a会同步创建或删除该挂载点吗？</p><p>mountinfo文件中可选字段的传播状态就是控制在一个挂载点下进行创建/删除挂载点操作时是否会传播到其他挂载点的选项。传播状态有四种可取值，常见的有如下两种：</p><ul><li>shared 表示创建/删除挂载点的操作会传播到其他挂载点</li><li>private 表示创建/删除挂载点的操作不会传播到其他挂载点</li></ul><p>由于在容器技术中要保证主机与容器的挂载点信息互不影响，因此要求容器中的挂载点的传播状态为private。</p><h4 id="1-3-3-bind-mount">1.3.3.bind mount</h4><p>bind mount可以将一个目录（源目录）挂载到另一个目录（目的目录），在目的目录里面的读写操作将直接作用于源目录。</p><p>下面我们通过实验了解一下bind mount的功能，首先，我们准备一下实验所需要的的目录及文件。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">mkdir</span> <span class="token builtin class-name">bind</span>phl@kernelnewbies:~$ <span class="token builtin class-name">cd</span> bind/phl@kernelnewbies:~/bind$ <span class="token function">mkdir</span> aphl@kernelnewbies:~/bind$ <span class="token function">mkdir</span> bphl@kernelnewbies:~/bind$ <span class="token builtin class-name">echo</span> hello, a <span class="token operator">&gt;</span> a/a.txtphl@kernelnewbies:~/bind$ <span class="token builtin class-name">echo</span> hello, b <span class="token operator">&gt;</span> b/b.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后，我们将a目录bind mount到b目录并查看b目录下的内容。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/bind$ <span class="token function">sudo</span> <span class="token function">mount</span> --bind a bphl@kernelnewbies:~/bind$ tree bb└── a.txt<span class="token number">0</span> directories, <span class="token number">1</span> <span class="token function">file</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，b目录下原先的内容被隐藏，取而代之的是a目录下的内容。</p><p>然后，我们修改b目录下的内容，修改完毕后，从b目录上卸载掉a目录。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/bind$ <span class="token builtin class-name">echo</span> hello, a from b <span class="token operator">&gt;</span> b/a.txtphl@kernelnewbies:~/bind$ <span class="token function">sudo</span> <span class="token function">umount</span> b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>我们读取一下a目录中a.txt，看看其内容是否被改变。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/bind$ <span class="token function">cat</span> a/a.txthello, a from b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>从结果我们可以看到，a目录中的内容确实被当a被bind mount到b时对b目录的操作所修改了。</p><p>bind mount在容器技术中有很重要的用途，后文会有涉及。</p><h4 id="1-3-4-mount-namespace简介">1.3.4.mount namespace简介</h4><p>mount namespace用来隔离文件系统的挂载点信息, 使得不同的mount namespace拥有自己独立的挂载点信息。不同的namespace之间不会相互影响，其在unshare中的选项为--mount。</p><p>当用unshare创建新的mount namespace时，新创建的namespace将拷贝一份老namespace里的挂载点信息，但从这之后，他们就没有关系了。这是unshare将新 namespace 里面的所有挂载点的传播状态设置为private实现的。通过mount和umount增加和删除各自mount namespace里面的挂载点都不会相互影响。</p><p>下面我们将演示mount namespace的用法。首先，我们准备需要的目录和文件，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">mkdir</span> -p hds/hd1 hds/hd2 <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> hdsphl@kernelnewbies:~/hds$ <span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">bs</span><span class="token operator">=</span>1M <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">of</span><span class="token operator">=</span>hd1.img <span class="token operator">&amp;&amp;</span> mkfs.ext2 hd1.imgphl@kernelnewbies:~/hds$ <span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">bs</span><span class="token operator">=</span>1M <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">of</span><span class="token operator">=</span>hd2.img <span class="token operator">&amp;&amp;</span> mkfs.ext2 hd2.imgphl@kernelnewbies:~$ tree <span class="token builtin class-name">.</span><span class="token builtin class-name">.</span>├── hd1├── hd1.img├── hd2└── hd2.img<span class="token number">2</span> directories, <span class="token number">2</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后，我们在全局的mount namespace中挂载hd1.img到hd1目录，然后查看该mount namespace中的挂载点信息与mount namespace id。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/hds$ <span class="token function">sudo</span> <span class="token function">mount</span> hd1.img hd1phl@kernelnewbies:~/hds$ <span class="token function">cat</span> /proc/self/mountinfo <span class="token operator">|</span> <span class="token function">grep</span> hd<span class="token number">556</span> <span class="token number">27</span> <span class="token number">7</span>:18 / /home/phl/hds/hd1 rw,relatime shared:372 - ext2 /dev/loop18 rwphl@kernelnewbies:~/hds$ <span class="token function">sudo</span> readlink /proc/<span class="token variable">$$</span>/ns/mntmnt:<span class="token punctuation">[</span><span class="token number">4026531840</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后，执行unshare命令创建一个新的mount namespace并查看该mount namespace id和挂载点信息。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/hds$ <span class="token function">sudo</span> unshare --uts --mount /bin/bashroot@kernelnewbies:~/hds<span class="token comment"># cat /proc/self/mountinfo | grep hd</span><span class="token number">739</span> <span class="token number">570</span> <span class="token number">7</span>:18 / /home/phl/hds/hd1 rw,relatime - ext2 /dev/loop18 rwroot@kernelnewbies:~/hds<span class="token comment"># readlink /proc/$$/ns/mnt</span>mnt:<span class="token punctuation">[</span><span class="token number">4026532180</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，新mount namespace中的挂载点信息与全局mountnamespace中的挂载点信息基本一致，一些挂载选项（如传播状态）变化了。新的mount namespace id与全局mount namespace id是不一样的。</p><p>然后，我们在新的mount namespace中挂载hd2.img到hd2目录，并查看挂载点信息。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kernelnewbies:~/hds<span class="token comment"># mount hd2.img hd2</span>root@kernelnewbies:~/hds<span class="token comment"># cat /proc/self/mountinfo | grep hd</span><span class="token number">739</span> <span class="token number">570</span> <span class="token number">7</span>:18 / /home/phl/hds/hd1 rw,relatime - ext2 /dev/loop18 rw<span class="token number">740</span> <span class="token number">570</span> <span class="token number">7</span>:19 / /home/phl/hds/hd2 rw,relatime - ext2 /dev/loop19 rw<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，新mount namespace中有hd1和hd2这两个挂载点。现在启动一个新的Shell窗口，查看全局mount namespace中的挂载点信息。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/hds$ <span class="token function">cat</span> /proc/self/mountinfo <span class="token operator">|</span> <span class="token function">grep</span> hd<span class="token number">556</span> <span class="token number">27</span> <span class="token number">7</span>:18 / /home/phl/hds/hd1 rw,relatime shared:372 - ext2 /dev/loop18 rw<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>从结果我们可以看到，全局mount namespace中的挂载点信息只有hd1，而没有hd2。这说明在新mount namespace中进行挂载/卸载操作不会影响其他mount namespace中的挂载点信息。</p><p>mount namespace只隔离挂载点信息，并不隔离挂载点下面的文件信息。对于多个mount namespace都能看到的挂载点，如果在一个namespace中修改了挂载点下面的文件，其他namespace也能感知到。下面，我们在新建的mount namespace中创建一个文件，命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kernelnewbies:~/hds<span class="token comment"># echo hello from new mount namespace &gt; hd1/hello.txt</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在新启动的Shell中，查看hd1目录并读取hd1/hello.txt文件。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/hds$ tree hd1hd1├── hello.txt└── lost+found <span class="token punctuation">[</span>error opening dir<span class="token punctuation">]</span><span class="token number">1</span> directory, <span class="token number">1</span> <span class="token function">file</span>phl@kernelnewbies:~/hds$ <span class="token function">cat</span> hd1/hello.txthello from new <span class="token function">mount</span> namespace<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，在全局mount namespace中，我们可以读取到在新建的mount namespace中创建的文件。</p><h4 id="1-3-5-docker-sh">1.3.5.docker.sh</h4><p>有了以上关于mount namespace的知识，我们就可以将mount namespace加入到docker.sh中了。mount namespace将放在docker.sh中，带下划线的行是我们为实现mount namespace而修改的代码。修改后的docker.sh脚本如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">..</span>.unshare --uts --mount ./container.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>从上述代码我们可以看到，我们仅仅是在调用unshare时加入--mount选项，就可为docker.sh引入了mount namespace功能。</p><h3 id="1-4-pid-namespace">1.4.pid namespace</h3><h4 id="1-4-1-unshare的-fork选项">1.4.1.unshare的--fork选项</h4><p>unshare有一个选项--fork，当执行unshare时，如果没有这个选项，unshare会直接exec新命令，也就是说unshare变成了新命令。如果带有--fork选项，unshare会fork一个子进程，该子进程exec新命令，unshare是该子进程的父进程。我们分别不带--fork和带--fork来执行unshare，然后查看进程之间的关系。</p><p>首先，我们不带--fork选项执行unshare，并查看当前Shell的进程id。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">sudo</span> unshare --uts /bin/bashroot@kernelnewbies:~/hds<span class="token comment"># echo $$</span><span class="token number">11699</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>此时unshare会创建一个新的uts namespace，然后exec /bin/bash。我们启动一个新Shell，然后使用pstree查看进程间关系，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/hds$ pstree -p <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">11699</span>sudo<span class="token punctuation">(</span><span class="token number">11698</span><span class="token punctuation">)</span>---bash<span class="token punctuation">(</span><span class="token number">11699</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>从结果我们可以看到，sudo fork出一个子进程，该子进程执行unshare。unshare创建了新uts namespace后，exec了/bin/bash，也就是说unshare变成了/bin/bash。</p><p>然后，我们带--fork选项执行unshare，并查看当前Shell的进程id。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/hds$ <span class="token function">sudo</span> unshare --uts --fork /bin/bashroot@kernelnewbies:~/hds<span class="token comment"># echo $$</span><span class="token number">11866</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>此时unshare会创建一个新的uts namespace，然后fork出一个子进程，该子进程exec /bin/bash。我们启动一个新Shell，然后使用pstree查看进程间关系，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/hds$ pstree -p <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">11866</span>sudo<span class="token punctuation">(</span><span class="token number">11864</span><span class="token punctuation">)</span>---unshare<span class="token punctuation">(</span><span class="token number">11865</span><span class="token punctuation">)</span>---bash<span class="token punctuation">(</span><span class="token number">11866</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>从结果我们可以看到，sudo fork出一个子进程，该子进程执行命令unshare。unshare创建了新uts namespace后，fork出一个子进程，该子进程exec /bin/bash，也就是说unshare变成了新的/bin/bash进程的父进程。</p><h4 id="1-4-2-pid-namespace简介">1.4.2.pid namespace简介</h4><p>pid namespace用来隔离进程pid空间，使得不同pid namespace里的进程 pid可以重复且相互之间不影响。进程所属的pid namespace在创建的时候就确定了，无法更改，因此需要--fork选项来创建一个新进程，然后将该新进程加入新建的pid namespace中。pid namespace在unshare中的选项为--pid。</p><p>unshare在创建pid namespace时需同时提供--pid与--fork选项。unshare本身会加入全局的pid namespace，其fork出的子进程会加入新建的pid namespace。</p><p>首先，我们查看全局pid namespace id，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">sudo</span> readlink /proc/<span class="token variable">$$</span>/ns/pidpid:<span class="token punctuation">[</span><span class="token number">4026531836</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>然后，执行unshare命令创建一个新的pid namespace并查看该pid namespace id。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">sudo</span> unshare --mount --pid --fork /bin/bashroot@kernelnewbies:~<span class="token comment"># readlink /proc/$$/ns/pid</span>pid:<span class="token punctuation">[</span><span class="token number">4026531836</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，新创建的进程也处于全局pid namespace中，而不是新的pid namespace。</p><p>出现这种情形是因为当前的/proc文件系统是老的。我们查看一下$$的值，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kernelnewbies:~<span class="token comment"># echo $$</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>从结果我们可以看到，$$的值为1，但是/proc文件系统却是老的，因此我们查看的实际是init进程所属的pid namespace，当然是全局pid namespace了。</p><p>重新挂载/proc文件系统，这也是unshare执行时带--mount选项的原因，只有这样，重新挂载/proc文件系统时，不会搞乱整个系统。再次查看新进程所属的pid namespace，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kernelnewbies:~<span class="token comment"># mount -t proc proc /proc</span>root@kernelnewbies:~<span class="token comment"># readlink /proc/$$/ns/pid</span>pid:<span class="token punctuation">[</span><span class="token number">4026532182</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，新进程的pid namespace与全局pid namespace的id不同。</p><p>接下来，我们再来查看一下新pid namespace中的进程信息。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kernelnewbies:~<span class="token comment"># ps -ef</span><span class="token environment constant">UID</span>        PID  <span class="token environment constant">PPID</span>  C STIME TTY          TIME CMDroot         <span class="token number">1</span>     <span class="token number">0</span>  <span class="token number">0</span> <span class="token number">19</span>:03 pts/1    00:00:00 /bin/bashroot        <span class="token number">10</span>     <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">19</span>:03 pts/1    00:00:00 <span class="token function">ps</span> -e<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，当前pid namespace中只有2个进程，看不到全局pid namespace里面的其他进程。我们通过unshare执行的进程pid为1，也就是说该进程成了新pid namespace中的init进程。</p><h4 id="1-4-3-pid嵌套">1.4.3.pid嵌套</h4><p>pid namespace可以嵌套，也就是说有父子关系，在当前pid namespace里面创建的所有新的pid namespace都是当前pid namespace的子pid namespace。</p><p>首先，我们创建3个嵌套的pid namespace，并查看每个pid namespace id。--mount-proc选项用于自动挂载/proc文件系统，省去了手动挂载/proc文件系统的操作。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">sudo</span> readlink /proc/<span class="token variable">$$</span>/ns/pidpid:<span class="token punctuation">[</span><span class="token number">4026531836</span><span class="token punctuation">]</span>phl@kernelnewbies:~$ <span class="token function">sudo</span> unshare --uts --mount --pid --mount-proc --fork /bin/bashroot@kernelnewbies:~<span class="token comment"># readlink /proc/$$/ns/pid</span>pid:<span class="token punctuation">[</span><span class="token number">4026532182</span><span class="token punctuation">]</span>root@kernelnewbies:~<span class="token comment"># unshare --uts --mount --pid --mount-proc --fork /bin/bash</span>root@kernelnewbies:~<span class="token comment"># readlink /proc/$$/ns/pid</span>pid:<span class="token punctuation">[</span><span class="token number">4026532185</span><span class="token punctuation">]</span>root@kernelnewbies:~<span class="token comment"># unshare --uts --mount --pid --mount-proc --fork /bin/bash</span>root@kernelnewbies:~<span class="token comment"># readlink /proc/$$/ns/pid</span>pid:<span class="token punctuation">[</span><span class="token number">4026532188</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后，我们启动一个新Shell，然后使用pstree查看进程间关系。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ pstree -lp <span class="token operator">|</span> <span class="token function">grep</span> unsharesudo<span class="token punctuation">(</span><span class="token number">12547</span><span class="token punctuation">)</span>---unshare<span class="token punctuation">(</span><span class="token number">12548</span><span class="token punctuation">)</span>---bash<span class="token punctuation">(</span><span class="token number">12549</span><span class="token punctuation">)</span>---unshare<span class="token punctuation">(</span><span class="token number">12579</span><span class="token punctuation">)</span>---bash<span class="token punctuation">(</span><span class="token number">12580</span><span class="token punctuation">)</span>---unshare<span class="token punctuation">(</span><span class="token number">12593</span><span class="token punctuation">)</span>---bash<span class="token punctuation">(</span><span class="token number">12594</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>使用cat /proc/[pid]/status | grep NSpid可查看某进程在当前pid namespace及子孙pid namespace中的pid。我们在全局pid namespace中查看上述各进程在各pid namespace中的pid，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">cat</span> /proc/12594/status <span class="token operator">|</span> <span class="token function">grep</span> NSpidNSpid: <span class="token number">12594</span> <span class="token number">21</span> <span class="token number">11</span> <span class="token number">1</span>phl@kernelnewbies:~$ <span class="token function">cat</span> /proc/12593/status <span class="token operator">|</span> <span class="token function">grep</span> NSpidNSpid: <span class="token number">12593</span> <span class="token number">20</span> <span class="token number">10</span>phl@kernelnewbies:~$ <span class="token function">cat</span> /proc/12580/status <span class="token operator">|</span> <span class="token function">grep</span> NSpidNSpid: <span class="token number">12580</span> <span class="token number">11</span> <span class="token number">1</span>phl@kernelnewbies:~$ <span class="token function">cat</span> /proc/12579/status <span class="token operator">|</span> <span class="token function">grep</span> NSpidNSpid: <span class="token number">12579</span> <span class="token number">10</span>phl@kernelnewbies:~$ <span class="token function">cat</span> /proc/12549/status <span class="token operator">|</span> <span class="token function">grep</span> NSpidNSpid: <span class="token number">12549</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>下面我们将以上进程在各pid namespace中的pid，整理成表格。表格信息如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1820220318143156.png" alt="使用 Shell 脚本实现 Docker"></p><p>我们以最后一行为例进行介绍，最后一行有4个pid，这4个pid其实是同一个进程。这个进程在4个pid namespace中都可以被看到，且其在4个pid namespace中的pid各不相同。</p><h4 id="1-4-4-docker-sh">1.4.4.docker.sh</h4><p>有了以上关于pid namespace的知识，我们就可以将pid namespae加入到docker.sh中了。pid namespace将放在docker.sh中，带下划线的行是我们为实现pid namespace而修改的代码。修改后的docker.sh脚本如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">..</span>.unshare --uts --mount --pid --fork ./container.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>从上述代码我们可以看到，我们仅仅是在调用unshare时加入--pid和--fork选项，就可为docker.sh引入了pid namespace功能。</p><p>然后，我们需要重新挂载/proc文件系统。重新挂载/proc文件系统的功能将放在container.sh中，带下划线的行是我们为重新挂载/proc文件系统而新添的代码。修改后的container.sh脚本如下如下所示：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">hostname</span> <span class="token variable">$container</span><span class="token function">mount</span> -t proc proc /proc<span class="token builtin class-name">exec</span> <span class="token variable">$program</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>现在，我们运行docker.sh，并查看当前的进程信息。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/docker.sh$ <span class="token function">sudo</span> ./docker.sh -c run -m 100M -C dreamland -I ubuntu1604 -V data1 -P /bin/bashroot@dreamland:~/docker.sh<span class="token comment"># ps -ef</span><span class="token environment constant">UID</span>        PID  <span class="token environment constant">PPID</span>  C STIME TTY          TIME CMDroot         <span class="token number">1</span>     <span class="token number">0</span>  <span class="token number">0</span> <span class="token number">17</span>:31 pts/1    00:00:00 /bin/bashroot        <span class="token number">16</span>     <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">17</span>:31 pts/1    00:00:00 <span class="token function">ps</span> -ef<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从结果我们可看出，当前进程只有两个，不再有主机上的其他进程。</p><h2 id="2-CGroups">2.CGroups</h2><h3 id="2-1-CGroups简介">2.1.CGroups简介</h3><p>CGroups是一种将进程分组，并以组为单位对进程实施资源限制的技术。每个组都包含以下几类信息：</p><ul><li>进程列表</li><li>资源A限制</li><li>资源B限制</li><li>资源C限制</li><li>...</li></ul><p>我们将以常见的CPU资源及内存资源为例进行介绍。以下的信息将使进程号为1001、1002、2008、3306的四个进程总共只能使用一个CPU核心；总共最多使用25%的CPU资源；总共最多使用100M内存，这样的一个分组被称为cgroup。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1820220318143103.png" alt="使用 Shell 脚本实现 Docker"></p><p>上面的介绍只是说明了要将何种资源限制施加于哪些进程，并未说明资源限制是如何施加到进程上。具体施加资源限制的过程需要subsystem来帮忙。subsystem读取cgroup中的资源限制和进程列表，然后将这些资源限制施加到这些进程上。常见的subsystem包括如下几种：</p><ul><li>cpu</li><li>memory</li><li>pids</li><li>devices</li><li>blkio</li><li>net_cls</li></ul><p>每个subsystem只读取与其相关的资源限制，然后施加到进程上。例如：memory子系统只读取内存限制，而cpu子系统只读取cpu限制。</p><p>cgroup被组织成树，如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1820220318143057.png" alt="使用 Shell 脚本实现 Docker"></p><p>采用树状结构可以方便地实现资源限制继承，一个cgroup中的资源限制将作用于该cgroup及其子孙cgroup中的进程。例如：图中13001、10339、2999受到A、B、C、D四个cgroup中的资源限制。这样的一个树状结构被称为hierarchy。</p><p>hierarchy中包含了系统中所有的进程，它们分布于各个cgroup中。在hierarchy中，一个进程必须属于且只属于一个cgroup，这样才能保证对进程施加的资源限制不会遗漏也不会冲突。</p><p>要想让一个subsystem读取hierarchy中各cgroup的资源限制，并施加于其中的进程需要将subsystem和hierarchy关联起来。subsystem与hierarchy的关系如下：</p><ul><li>系统中可以有多个hierarchy</li><li>一个hierarchy可以关联0个或多个subsystem，当关联0个subsystem时，该hierarchy只是对进程进行分类</li><li>一个subsystem最多关联到一个hierarchy，因为每个hierarchy都包含系统中所有的进程，若一个subsystem关联到了多个hierarchy，对同一进程将有多种资源限制，这是不对的</li></ul><p>系统使用CGroups通常有两种形式：一种是创建一个hierarchy，将所有的subsystem关联到其上，在这个hierarchy上配置各种资源限制；另一种是为每一个subsystem创建一个hierarchy，并将该subsystem关联到其上，每个hierarchy只对一种资源进行限制。后一种比较清晰，得到了更普遍的采用。</p><p>CGroups不像大多数的技术那样提供API或命令之类的用户接口，而是提供给用户一个虚拟文件系统，该虚拟文件系统类型为cgroup。一个挂载后的cgroup文件系统就是一个hierarchy，文件系统中的一个目录就是一个cgroup，目录中的文件代表了进程列表或者资源限制信息。文件系统是树状结构，其各个目录之间的父子关系就代表了cgroup之间的继承关系。挂载cgroup虚拟文件系统后，通过在该文件系统上创建目录、写进程列表文件、写资源限制文件就可以操作CGroups。</p><p>下面，我们通过实验学习一下CGroups的用法。首先，我们挂载一个cgroup虚拟文件系统，该文件系统不与任何subsystem关联，仅仅是将进程进行分类。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">mkdir</span> -p cg/test<span class="token comment"># -o none,name=test 表示该cgroup文件系统不与任何子系统关联</span><span class="token comment"># 该文件系统用name=test来标识</span>phl@kernelnewbies:~$ <span class="token function">sudo</span> <span class="token function">mount</span> -t cgroup -o none,name<span class="token operator">=</span>test <span class="token builtin class-name">test</span> cg/testphl@kernelnewbies:~$ tree cg/testcg/test├── cgroup.clone_children├── cgroup.procs├── cgroup.sane_behavior├── notify_on_release├── release_agent└── tasks<span class="token number">0</span> directories, <span class="token number">6</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>挂载cgroup文件系统后，该cgroup文件系统的根目录下会生成许多文件，该根目录被称为root cgroup。cgroup.procs里面存放的是当前cgroup中的所有进程id，由于该hierarchy中只有一个cgroup，所以这个文件包含了系统中所有的进程id。其他的文件与cgroups基本功能关系不大，暂时可以忽略。</p><p>在cgroup文件系统中，创建一个目录就会创建一个cgroup。下面我们将会演示如何创建下面这样的hierarchy：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1820220318143054.png" alt="使用 Shell 脚本实现 Docker"></p><p>命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">sudo</span> <span class="token function">mkdir</span> -p cg/test/test1/test11phl@kernelnewbies:~$ <span class="token function">sudo</span> <span class="token function">mkdir</span> -p cg/test/test2/test22phl@kernelnewbies:~$ tree cg/testcg/test├── cgroup.clone_children├── cgroup.procs├── cgroup.sane_behavior├── notify_on_release├── release_agent├── tasks├── test1│   ├── cgroup.clone_children│   ├── cgroup.procs│   ├── notify_on_release│   ├── tasks│   └── test11│       ├── cgroup.clone_children│       ├── cgroup.procs│       ├── notify_on_release│       └── tasks└── test2    ├── cgroup.clone_children    ├── cgroup.procs    ├── notify_on_release    ├── tasks    └── test22        ├── cgroup.clone_children        ├── cgroup.procs        ├── notify_on_release        └── tasks<span class="token number">4</span> directories, <span class="token number">22</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，我们创建了相应的目录后，这些目录下自动出现了包含cgroup信息的目录及文件。</p><p>删除cgroup时只需删除该cgroup所在的目录即可。下面我们将删除test11 cgroup，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">sudo</span> <span class="token function">rmdir</span> cg/test/test1/test11phl@kernelnewbies:~$ tree cg/testcg/test├── cgroup.clone_children├── cgroup.procs├── cgroup.sane_behavior├── notify_on_release├── release_agent├── tasks├── test1│   ├── cgroup.clone_children│   ├── cgroup.procs│   ├── notify_on_release│   └── tasks└── test2    ├── cgroup.clone_children    ├── cgroup.procs    ├── notify_on_release    ├── tasks    └── test22        ├── cgroup.clone_children        ├── cgroup.procs        ├── notify_on_release        └── tasks<span class="token number">3</span> directories, <span class="token number">18</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>每个cgroup下面都有一个cgroup.procs文件，该文件里面包含当前cgroup里面的所有进程id。只要将某个进程的id写入该文件，即可将该进程加入到该cgroup中。下面，我们将当前的bash加入到test22 cgroup中，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token builtin class-name">echo</span> <span class="token variable">$$</span><span class="token number">3894</span>phl@kernelnewbies:~$ <span class="token function">sudo</span> <span class="token function">sh</span> -c <span class="token string">"echo 3894 &gt; cg/test/test2/test22/cgroup.procs"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>/proc/[pid]/cgroup包含了某个进程所在的cgroup信息。下面，我们查看一下当前bash进程所在的cgroup信息，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">cat</span> /proc/3894/cgroup<span class="token number">13</span>:name<span class="token operator">=</span>test:/test2/test22<span class="token number">12</span>:freezer:/<span class="token number">11</span>:perf_event:/<span class="token number">10</span>:blkio:/user.slice<span class="token number">9</span>:devices:/user.slice<span class="token number">8</span>:hugetlb:/<span class="token number">7</span>:cpu,cpuacct:/user.slice<span class="token number">6</span>:net_cls,net_prio:/<span class="token number">5</span>:memory:/user.slice<span class="token number">4</span>:rdma:/<span class="token number">3</span>:pids:/user.slice/user-1001.slice/session-4.scope<span class="token number">2</span>:cpuset:/<span class="token number">1</span>:name<span class="token operator">=</span>systemd:/user.slice/user-1001.slice/session-4.scope<span class="token number">0</span>::/user.slice/user-1001.slice/session-4.scope<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，当前bash进程加入了多个cgroup，其中带下划线的行为我们刚刚加入的cgroup。</p><p>要想将hierarchy与子系统关联起来，需要在-o选项中指定子系统名称。下面演示了如何将memory子系统与新挂载的cgroup文件系统关联起来。代码如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">sudo</span> <span class="token function">mkdir</span> cg/memoryphl@kernelnewbies:~$ <span class="token function">sudo</span> <span class="token function">mount</span> -t cgroup -o memory memcg cg/memory<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>由于很多发行版的操作系统已经为我们配置好了这些cgroup文件系统，我们应当直接使用这些已经挂在好的文件系统，不需要自己去挂载。</p><p>另外，当创建子进程时，子进程会自动加入父进程所在的cgroup。</p><h3 id="2-2-限制内存">2.2.限制内存</h3><h4 id="2-2-1-用CGroups限制内存">2.2.1.用CGroups限制内存</h4><p>下面我们将介绍演示CGroups如何限制进程使用的内存资源，我们以内存为例进行讲解。</p><p>Ubuntu18.04已经为我们挂载了一个关联memory子系统的cgroup虚拟文件系统。我们用mount命令查看一下该系统挂载到了何处，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">mount</span> <span class="token operator">|</span> <span class="token function">grep</span> cgrouptmpfs on /sys/fs/cgroup <span class="token builtin class-name">type</span> tmpfs <span class="token punctuation">(</span>ro,nosuid,nodev,noexec,mode<span class="token operator">=</span><span class="token number">755</span><span class="token punctuation">)</span>cgroup on /sys/fs/cgroup/unified <span class="token builtin class-name">type</span> cgroup2 <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,nsdelegate<span class="token punctuation">)</span>cgroup on /sys/fs/cgroup/systemd <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,xattr,name<span class="token operator">=</span>systemd<span class="token punctuation">)</span>cgroup on /sys/fs/cgroup/cpuset <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,cpuset<span class="token punctuation">)</span>cgroup on /sys/fs/cgroup/pids <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,pids<span class="token punctuation">)</span>cgroup on /sys/fs/cgroup/rdma <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,rdma<span class="token punctuation">)</span>cgroup on /sys/fs/cgroup/memory <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,memory<span class="token punctuation">)</span>cgroup on /sys/fs/cgroup/net_cls,net_prio <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,net_cls,net_prio<span class="token punctuation">)</span>cgroup on /sys/fs/cgroup/cpu,cpuacct <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,cpu,cpuacct<span class="token punctuation">)</span>cgroup on /sys/fs/cgroup/hugetlb <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,hugetlb<span class="token punctuation">)</span>cgroup on /sys/fs/cgroup/devices <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,devices<span class="token punctuation">)</span>cgroup on /sys/fs/cgroup/blkio <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,blkio<span class="token punctuation">)</span>cgroup on /sys/fs/cgroup/perf_event <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,perf_event<span class="token punctuation">)</span>cgroup on /sys/fs/cgroup/freezer <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,freezer<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>该系统挂载到了/sys/fs/cgroup/memory目录下。我们在该hierarchy中创建一个test cgroup并查看该cgroup的目录结构，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">sudo</span> <span class="token function">mkdir</span> /sys/fs/cgroup/memory/testphl@kernelnewbies:~$ tree /sys/fs/cgroup/memory/test/sys/fs/cgroup/memory/test├── cgroup.clone_children├── cgroup.event_control├── cgroup.procs├── memory.failcnt├── memory.force_empty├── memory.kmem.failcnt├── memory.kmem.limit_in_bytes├── memory.kmem.max_usage_in_bytes├── memory.kmem.slabinfo├── memory.kmem.tcp.failcnt├── memory.kmem.tcp.limit_in_bytes├── memory.kmem.tcp.max_usage_in_bytes├── memory.kmem.tcp.usage_in_bytes├── memory.kmem.usage_in_bytes├── memory.limit_in_bytes├── memory.max_usage_in_bytes├── memory.move_charge_at_immigrate├── memory.numa_stat├── memory.oom_control├── memory.pressure_level├── memory.soft_limit_in_bytes├── memory.stat├── memory.swappiness├── memory.usage_in_bytes├── memory.use_hierarchy├── notify_on_release└── tasks<span class="token number">0</span> directories, <span class="token number">27</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，新建的test cgroup中有许多文件，这些文件中存放着资源限制信息。其中memory.limit_in_bytes里面存放的是该cgroup中的进程能够使用的内存额度。</p><p>下面，我们将当前bash加入到test cgroup中并查看当前bash所属的cgroup信息。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token builtin class-name">echo</span> <span class="token variable">$$</span><span class="token number">2984</span>phl@kernelnewbies:~$ <span class="token function">sudo</span> <span class="token function">sh</span> -c <span class="token string">"echo 2984 &gt; /sys/fs/cgroup/memory/test/cgroup.procs"</span>phl@kernelnewbies:~$ <span class="token function">cat</span> /proc/2984/cgroup<span class="token number">12</span>:devices:/user.slice<span class="token number">11</span>:hugetlb:/<span class="token number">10</span>:memory:/test<span class="token number">9</span>:rdma:/<span class="token number">8</span>:perf_event:/<span class="token number">7</span>:blkio:/user.slice<span class="token number">6</span>:cpu,cpuacct:/user.slice<span class="token number">5</span>:pids:/user.slice/user-1001.slice/session-4.scope<span class="token number">4</span>:freezer:/<span class="token number">3</span>:cpuset:/<span class="token number">2</span>:net_cls,net_prio:/<span class="token number">1</span>:name<span class="token operator">=</span>systemd:/user.slice/user-1001.slice/session-4.scope<span class="token number">0</span>::/user.slice/user-1001.slice/session-4.scope<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，当前bash所属的memory cgroup变为了/test，该目录为一个相对于root cgroup的相对路径。</p><p>然后，将100M写入test cgroup中的memory.limit_in_bytes文件中，命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">sudo</span> <span class="token function">sh</span> -c <span class="token string">"echo 100M &gt; /sys/fs/cgroup/memory/test/memory.limit_in_bytes"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>我们在当前bash中启动一个占用300M进程的stress进程，该stress进程是bash的子进程，其与bash进程都在test cgroup中。命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ stress --vm <span class="token number">1</span> --vm-bytes 300M --vm-keep<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>启动一个新的Shell窗口，执行top命令查看stress进程占用的内存。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">PID <span class="token environment constant">USER</span>      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND<span class="token number">14216</span> root      <span class="token number">20</span>   <span class="token number">0</span>  <span class="token number">315440</span> <span class="token number">101224</span>    <span class="token number">264</span> D <span class="token number">27.7</span>  <span class="token number">2.5</span>   <span class="token number">0</span>:02.66 stress<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>从结果我们可以看到，stress进程占用了2.5%的内存。我的电脑的内存为4G，4G * 2.5% = 100M，stress进程确实受到了cgroup中设置的内存额度的限制。</p><h4 id="2-2-2-docker-sh">2.2.2.docker.sh</h4><p>下有了以上关于CGroups的知识，我们就可以将限制内存的功能加入到docker.sh中了。限制内存的功能将放在container.sh中，带下划线的行是我们为实现限制内存而新添的代码。修改后的container.sh脚本如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">hostname</span> <span class="token variable">$container</span><span class="token function">mkdir</span> -p /sys/fs/cgroup/memory/<span class="token variable">$container</span><span class="token builtin class-name">echo</span> <span class="token variable">$$</span> <span class="token operator">&gt;</span> /sys/fs/cgroup/memory/<span class="token variable">$container</span>/cgroup.procs<span class="token builtin class-name">echo</span> <span class="token variable">$memory</span> <span class="token operator">&gt;</span> /sys/fs/cgroup/memory/<span class="token variable">$container</span>/memory.limit_in_bytes<span class="token function">mount</span> -t proc proc /proc<span class="token builtin class-name">exec</span> <span class="token variable">$program</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先，我们根据容器的名字创建cgroup，命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> -p /sys/fs/cgroup/memory/<span class="token variable">$container</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后，我们将当前bash加入到我们创建的cgroup中，命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token variable">$$</span> <span class="token operator">&gt;</span> /sys/fs/cgroup/memory/<span class="token variable">$container</span>/cgroup.procs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>最后，我们将内存限制写入新cgroup的memory.limit_in_bytes文件中，命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token variable">$memory</span> <span class="token operator">&gt;</span> /sys/fs/cgroup/memory/<span class="token variable">$container</span>/memory.limit_in_bytes<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>现在，我们运行docker.sh，并启动一个占用300M进程的stress进程。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/docker.sh$ <span class="token function">sudo</span> ./docker.sh -c run -m 100M -C dreamland -I ubuntu1604 -V data1 -P /bin/bashroot@dreamland:~/docker.sh<span class="token comment"># stress --vm 1 --vm-bytes 300M --vm-keep</span>stress: info: <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> dispatching hogs: <span class="token number">0</span> cpu, <span class="token number">0</span> io, <span class="token number">1</span> vm, <span class="token number">0</span> hdd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>启动一个新的Shell窗口，执行top命令查看stress进程占用的内存。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">PID <span class="token environment constant">USER</span>      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND<span class="token number">14216</span> root      <span class="token number">20</span>   <span class="token number">0</span>  <span class="token number">315440</span> <span class="token number">101224</span>    <span class="token number">264</span> D <span class="token number">27.7</span>  <span class="token number">2.5</span>   <span class="token number">0</span>:02.66 stress<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>从结果我们可以看到，容器内的stress进程只使用了100M的内存。</p><h2 id="3-切换根文件系统">3.切换根文件系统</h2><h3 id="3-1-根文件系统">3.1.根文件系统</h3><p>在容器技术中，根文件系统可为容器进程提供一个与主机不一致的文件系统环境。举个例子，主机为Ubuntu 18.04，创建的容器采用Ubuntu 16.04的根文件系统，那么容器运行时所用的软件及其依赖库、配置文件等都是Ubuntu 16.04的。尽管该容器使用的内核是仍旧是Ubuntu 18.04的，但应用软件的表现却与Ubuntu 16.04一致，从虚拟化的角度来说该容器就是一个Ubuntu 16.04系统。</p><p>debootstrap是Ubuntu下的一个工具，用来构建根文件系统。生成的目录符合Linux文件系统标准，即包含了/boot、/etc、/bin、/usr等目录。debootstrap的安装命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">debootstrap</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>下面我们通过debootstrap构建Ubuntu 16.04的根文件系统。为了清晰，我们在images目录下生成根文件系统。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/docker.sh$ <span class="token function">mkdir</span> imagesphl@kernelnewbies:~/docker.sh$ <span class="token builtin class-name">cd</span> imagesphl@kernelnewbies:~/docker.sh/images$ <span class="token function">sudo</span> <span class="token function">debootstrap</span> --arch amd64 xenial ./ubuntu1604<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>制作根文件系统需要从服务器下载很多文件，很耗时，请耐心等待。当文件系统制作好后，可以使用tree命令查看生成的根文件系统。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/docker.sh/images$ tree -L <span class="token number">1</span> ubuntu1604/ubuntu1604/├── bin├── boot├── dev├── etc├── home├── lib├── lib64├── media├── mnt├── old_root├── opt├── proc├── root├── run├── sbin├── srv├── sys├── tmp├── usr└── var<span class="token number">20</span> directories, <span class="token number">0</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个根文件系统与Linux系统目录很相近，我们后续的实验将使用该根文件系统。</p><h3 id="3-2-pivot-root">3.2.pivot_root</h3><p>pivot_root命令用于切换根文件系统，其使用方式如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pivot_root new_root put_old<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>pivot_root将当前进程的根文件系统移至put_old目录并使new_root目录成为新的根文件系统。</p><p>下面我们将通过实验学习pivot_root的使用方法。为了简单，我们在一个新的mount namespace下进行实验。首先，我们创建一个新的mount namespace，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/docker.sh/images$ <span class="token function">sudo</span> unshare --mount /bin/bashroot@kernelnewbies:~/docker.sh/images<span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>在我们的实验中，我们的根文件系统将挂载在ubuntu1604目录，而老的根文件系统将被移动到ubuntu1604/old_root目录下。我们先创建old_root目录，命令如下：</p><p>root@kernelnewbies:~/docker.sh/images# mkdir -p ubuntu1604/old_root/</p><p>由于pivot_root命令要求老的根目录和新的根目录不能在同一个挂载点下，因此我们通过bind mount将ubuntu1604目录变成一个挂载点。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kernelnewbies:~/docker.sh/images<span class="token comment"># mount --bind ubuntu1604 ubuntu1604</span>root@kernelnewbies:~/docker.sh/images<span class="token comment"># cat /proc/self/mountinfo | grep ubuntu1604</span><span class="token number">624</span> <span class="token number">382</span> <span class="token number">8</span>:1 /home/phl/docker.sh/images/ubuntu1604 /home/phl/docker.sh/images/ubuntu1604 rw,relatime - ext4 /dev/sda1 rw,errors<span class="token operator">=</span>remount-ro<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>准备好切换根文件系统所需要的条件后，我们调用pivot_root切换根文件系统。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kernelnewbies:~/docker.sh/images<span class="token comment"># cd ubuntu1604/</span>root@kernelnewbies:~/docker.sh/images/ubuntu1604<span class="token comment"># pivot_root . old_root/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>此时，已完成根文件系统的切换，/proc文件系统也被挪到了<br>/home/phl/docker.sh/images/ubuntu1604/old_root/proc，也就是说当前没有/proc文件系统，因此，我们无法查看挂载点信息，自然也无法执行一些依赖于/proc文件系统的操作。我们需要重新挂载/proc文件系统。命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kernelnewbies:~/docker.sh/images/ubuntu1604<span class="token comment"># mount -t proc proc /proc</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>重新挂载/proc文件系统后，我们就可以查看当前的挂载点信息了。通过读取/proc/self/mountinfo文件来查看系统的挂载点信息。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kernelnewbies:~/docker.sh/images/ubuntu1604<span class="token comment"># cat /proc/self/mountinfo</span><span class="token number">382</span> <span class="token number">624</span> <span class="token number">8</span>:1 / /old_root rw,relatime - ext4 /dev/sda1 rw,errors<span class="token operator">=</span>remount-ro<span class="token punctuation">..</span>.<span class="token number">624</span> <span class="token number">381</span> <span class="token number">8</span>:1 /home/phl/docker.sh/images/ubuntu1604 / rw,relatime - ext4 /dev/sda1 rw,errors<span class="token operator">=</span>remount-ro<span class="token number">625</span> <span class="token number">624</span> <span class="token number">0</span>:5 / /proc rw,relatime - proc proc rw<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此时的挂载点很多，为了方便查看，此处只保留了一些主要的挂载点信息。这些挂载点信息包括/、/proc、/old_root。/old_root为老的根文件系统，我们需要将其卸载。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kernelnewbies:~/docker.sh/images/ubuntu1604<span class="token comment"># umount -l /old_root/</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>卸载掉老的根文件系统后，我们再查看系统的挂载点信息。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kernelnewbies:~/docker.sh/images/ubuntu1604<span class="token comment"># cat /proc/self/mountinfo</span><span class="token number">624</span> <span class="token number">381</span> <span class="token number">8</span>:1 /home/phl/docker.sh/images/ubuntu1604 / rw,relatime - ext4 /dev/sda1 rw,errors<span class="token operator">=</span>remount-ro<span class="token number">625</span> <span class="token number">624</span> <span class="token number">0</span>:5 / /proc rw,relatime - proc proc rw<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>此时，挂载点信息中只有/、/proc，不再有主机的挂载点信息。</p><h3 id="3-3-docker-sh">3.3.docker.sh</h3><p>有了以上关于切换根文件系统的知识，我们就可以将切换根文件系统的功能加入到docker.sh中了。切换根文件系统的功能将放在container.sh中，带下划线的行是我们为实现切换根文件系统而新添的代码。修改后的container.sh脚本如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token function">hostname</span> <span class="token variable">$container</span><span class="token function">mkdir</span> -p /sys/fs/cgroup/memory/<span class="token variable">$container</span><span class="token builtin class-name">echo</span> <span class="token variable">$$</span> <span class="token operator">&gt;</span> /sys/fs/cgroup/memory/<span class="token variable">$container</span>/cgroup.procs<span class="token builtin class-name">echo</span> <span class="token variable">$memory</span> <span class="token operator">&gt;</span> /sys/fs/cgroup/memory/<span class="token variable">$container</span>/memory.limit_in_bytes<span class="token function">mkdir</span> -p images/<span class="token variable">$image</span>/old_root<span class="token function">mount</span> --bind images/<span class="token variable">$image</span> images/<span class="token variable">$image</span><span class="token builtin class-name">cd</span> images/<span class="token variable">$image</span>pivot_root <span class="token builtin class-name">.</span> ./old_root<span class="token function">mount</span> -t proc proc /proc<span class="token function">umount</span> -l /old_root<span class="token builtin class-name">exec</span> <span class="token variable">$program</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先，我们在新的根文件系统目录中创建挂载老的根文件系统的目录。命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> -p images/<span class="token variable">$image</span>/old_root<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后，我们将新根文件系统目录bind mount成一个挂载点。命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mount</span> --bind images/<span class="token variable">$image</span> images/<span class="token variable">$image</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后，我们切换根文件系统。命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> images/<span class="token variable">$image</span>pivot_root <span class="token builtin class-name">.</span> ./old_root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>最后，我们重新挂载/proc文件系统，然后卸载掉老的根文件系统。命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mount</span> -t proc proc /proc<span class="token function">umount</span> -l /old_root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>现在，我们运行docker.sh，并查看当前的发行版信息。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/docker.sh$ <span class="token function">sudo</span> ./docker.sh -c run -m 100M -C dreamland -I ubuntu1604 -V data1 -P /bin/bashroot@dreamland:/<span class="token comment"># cat /etc/issue</span>Ubuntu <span class="token number">16.04</span> LTS <span class="token punctuation">\</span>n <span class="token punctuation">\</span>l<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看出，读出的发行版信息是Ubuntu 16.04 LTS \n \l，而非主机的Ubuntu 18.04.3 LTS \n \l。这说明当前使用的根文件系统确实是ubuntu16.04目录下的根文件系统，而非主机的根文件系统。</p><p>我们再查看一下当前的挂载点信息，看看是否只有/与/proc。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@dreamland:/<span class="token comment"># cat /proc/self/mountinfo</span><span class="token number">625</span> <span class="token number">381</span> <span class="token number">8</span>:1 /home/phl/docker.sh/images/ubuntu1604 / rw,relatime - ext4 /dev/sda1 rw,errors<span class="token operator">=</span>remount-ro<span class="token number">626</span> <span class="token number">625</span> <span class="token number">0</span>:52 / /proc rw,relatime - proc proc rw<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>从结果我们可看出，当前挂载点信息中只有/、/proc，不再有主机的挂载点信息。</p><p>通过根文件系统，我们实现了在容器中虚拟出与主机不一样的操作系统的功能。</p><h2 id="4-联合加载">4.联合加载</h2><h3 id="4-1-联合加载简介">4.1.联合加载简介</h3><p>联合加载指的是一次同时加载多个文件系统，但是在外面看起来只能看到 一个文件系统。联合加载会将各层文件系统叠加到一起，这样最终的文件系统会 包含所有底层的文件和目录。</p><p>联合加载的多个文件系统中有一个是可读写文件系统，称为读写层，其他文件系统是只读的，称为只读层。当联合加载的文件系统发生变化时，这些变化都应用到这个读写层。比如，如果想修改一个文件，这个文件首先会从只读层复制到读写层。原只读层中的文件依然存在，但是被读写层中的该文件副本所隐藏。我们以后读写该文件时，都是读写的该文件在读写层中的副本。这种机制被称为 写时复制。</p><p>我们之前实现的docker.sh，有一个很大的缺陷。那就是，如果使用相同的根文件系统同时启动多个容器的实例，那么，这些容器实例使用的根文件系统位于同一个目录。我们在不同的容器实例对根文件系统所作的修改，这些容器彼此之间都可以看到，甚至一个容器可以覆覆盖另一个容器所作的修改。同时，容器实例退出时，对根文件系统所作的修改也直接作用于其所使用的根文件系统。当我们使用该根文件系统再次启动容器实例时，新启动的容器实例也可以看到以前的这些修改。例如，我们用ubuntu1604根文件系统启动两个容器实例，命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/docker.sh$ <span class="token function">sudo</span> ./docker.sh -c run -m 100M -C dreamland -I ubuntu1604 -V data1 -P /bin/bashphl@kernelnewbies:~/docker.sh$ <span class="token function">sudo</span> ./docker.sh -c run -m 100M -C dreamland2 -I ubuntu1604 -V data1 -P /bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这两个容器实例对根文件系统做的修改彼此都可以看到。容器实例退出时，这些修改也被保存了下来，当用ubuntu1604根文件系统启动新的容器实例时，新实例也可看到以前实例所做的修改。</p><p>如果容器使用的根文件系统是一个联合加载的文件系统，原先的根文件系统作为一个只读层，再添加一个读写层，那么，在容器内所作的修改都将只作用于读写层。为了区分，我们以后称ubuntu1604目录下的根文件系统为镜像。而我们可以为每一个容器实例指定一个唯一的读写层目录，这样的话，多个容器实例就可以使用同一个镜像，容器内所作的修改不会影响彼此，也不会影响到以后启动的容器实例。例如：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/docker.sh$ <span class="token function">sudo</span> ./docker.sh -c run -m 100M -C dreamland -I ubuntu1604 -V data1 -P /bin/bashphl@kernelnewbies:~/docker.sh$ <span class="token function">sudo</span> ./docker.sh -c run -m 100M -C dreamland2 -I ubuntu1604 -V data1 -P /bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>我们使用ubuntu1604镜像启动了两个容器示例，并在容器实例里进行读写操作。这两个容器实例的读写层目录是不一样的，在容器实例中所作的修改只作用于各自的读写层，彼此之间不会影响，当然更不会影响到后续启动的容器实例。</p><h3 id="4-2-AUFS">4.2. AUFS</h3><p>AUFS是一个实现了联合加载功能的文件系统。我们将采用AUFS实现docker.sh中的联合加载功能。</p><p>下面，我们将通过实验演示一下AUFS文件系统的用法。首先，我们准备需要用到的目录及文件。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~$ <span class="token function">mkdir</span> aufsphl@kernelnewbies:~$ <span class="token builtin class-name">cd</span> aufs/phl@kernelnewbies:~/aufs$ <span class="token function">mkdir</span> rw r1 r2 unionphl@kernelnewbies:~/aufs$ <span class="token builtin class-name">echo</span> hello r1 <span class="token operator">&gt;</span> r1/hellor1.txtphl@kernelnewbies:~/aufs$ <span class="token builtin class-name">echo</span> hello r2 <span class="token operator">&gt;</span> r2/hellor2.txtphl@kernelnewbies:~/aufs$ <span class="token builtin class-name">echo</span> hello rw <span class="token operator">&gt;</span> rw/hellorw.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>下表列出了各个目录的作用。列表如下：</p><ul><li>rw为aufs文件系统的读写层目录</li><li>r1为aufs文件系统的只读层目录</li><li>r2为aufs文件系统的只读层目录</li><li>union为挂载点，联合加载的aufs文件系统挂载于此目录</li></ul><p>下面我们将rw、r1、r2联合加载到union目录。命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/aufs$ <span class="token function">sudo</span> <span class="token function">mount</span> -t aufs -o <span class="token assign-left variable">dirs</span><span class="token operator">=</span>rw:r1:r2 none union<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>-t aufs表示要挂载的文件系统类型为AUFS</li><li>-o dirs=rw:r1:r2表示要将哪些目录加载到afus文件系统中，多个目录之间以:分隔。目录列表中的第一个目录表示读写层目录</li><li>union表示aufs文件系统要挂载的目录</li></ul><p>挂载好AUFS文件系统后，我们进入该文件系统，查看其内容。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/aufs$ <span class="token builtin class-name">cd</span> union/phl@kernelnewbies:~/aufs/union$ <span class="token function">ls</span>hellor1.txt hellor2.txt hellorw.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>从输出结果来看，rw、r1、r2目录下的内容全部出现在了AUFS文件系统中，该文件系统由rw、r1、r2目录叠加而成。</p><p>然后，我们修改这些文件，看看原始的rw、r1、r2目录下的文件是否更改。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/aufs/union$ <span class="token builtin class-name">echo</span> hello to r1 from union <span class="token operator">&gt;</span> hellor1.txtphl@kernelnewbies:~/aufs/union$ <span class="token builtin class-name">echo</span> hello to r2 from union <span class="token operator">&gt;</span> hellor2.txtphl@kernelnewbies:~/aufs/union$ <span class="token builtin class-name">echo</span> hello to rw from union <span class="token operator">&gt;</span> hellorw.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>我们返回到aufs目录，直接查看aufs目录下的内容。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/aufs$ tree <span class="token builtin class-name">.</span><span class="token builtin class-name">.</span>├── r1│   └── hellor1.txt├── r2│   └── hellor2.txt├── rw│   ├── hellor1.txt│   ├── hellor2.txt│   └── hellorw.txt└── union    ├── hellor1.txt    ├── hellor2.txt    └── hellorw.txt<span class="token number">4</span> directories, <span class="token number">8</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从输出结果我们可以看到，我们修改的hellor1.txt和hellor2.txt文件分别被拷贝了一份放在读写层目录rw中。我们查看一下这些文件的内容，命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/aufs$ <span class="token function">cat</span> r1/hellor1.txthello r1phl@kernelnewbies:~/aufs$ <span class="token function">cat</span> r2/hellor2.txthello r2phl@kernelnewbies:~/aufs$ <span class="token function">cat</span> rw/hellor1.txthello to r1 from unionphl@kernelnewbies:~/aufs$ <span class="token function">cat</span> rw/hellor2.txthello to r2 from unionphl@kernelnewbies:~/aufs$ <span class="token function">cat</span> rw/hellorw.txthello to rw from union<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从输出结果我们看到，用户修改只读层r1、r2中的文件时，这些文件被复制到了读写层，我们修改的是读写层的副本，原只读层中的文件没有变化。用户修改读写层rw中的文件时，修改直接作用于这些文件本身。</p><h3 id="4-3-docker-sh">4.3.docker.sh</h3><p>在继续之前，我们需要将上一章在ubuntu1604根文件系统中创建的old_root目录删除掉，以保证该根文件系统跟刚制作好时一样。命令及结果如下：</p><p>phl@kernelnewbies:~/docker.sh$ sudo rm -rf images/ubuntu1604/old_root</p><p>有了以上关于联合加载的介绍，我们就可以将联合加载功能加入到docker.sh中了。联合加载功能将放在container.sh脚本中，带下划线的行是我们为实现联合加载功能而新添的代码。修改后的container.sh如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token function">hostname</span> <span class="token variable">$container</span><span class="token function">mkdir</span> -p /sys/fs/cgroup/memory/<span class="token variable">$container</span><span class="token builtin class-name">echo</span> <span class="token variable">$$</span> <span class="token operator">&gt;</span> /sys/fs/cgroup/memory/<span class="token variable">$container</span>/cgroup.procs<span class="token builtin class-name">echo</span> <span class="token variable">$memory</span> <span class="token operator">&gt;</span> /sys/fs/cgroup/memory/<span class="token variable">$container</span>/memory.limit_in_bytes<span class="token function">mkdir</span> -p <span class="token variable">$container</span>/rwlayer<span class="token function">mount</span> -t aufs -o <span class="token assign-left variable">dirs</span><span class="token operator">=</span><span class="token variable">$container</span>/rwlayer:./images/<span class="token variable">$image</span> none <span class="token variable">$container</span><span class="token function">mkdir</span> -p <span class="token variable">$container</span>/old_root<span class="token builtin class-name">cd</span> <span class="token variable">$container</span>pivot_root <span class="token builtin class-name">.</span> ./old_root<span class="token function">mount</span> -t proc proc /proc<span class="token function">umount</span> -l /old_root<span class="token builtin class-name">exec</span> <span class="token variable">$program</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先，我们根据容器的名字创建联合加载需要的读写层目录及文件系统挂载目录。命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> -p <span class="token variable">$container</span>/rwlayer<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>假如我们传递的容器的名字为dreamland，将创建以下目录：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/docker.sh$ tree dreamland/dreamland/└── rwlayer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>其中dreamland/rwlayer目录为创建的AUFS文件系统的读写层，dreamland目录为AUFS文件系统的挂载点。</p><p>然后我们将镜像目录、读写层目录联合加载到挂载点目录。命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mount</span> -t aufs -o <span class="token assign-left variable">dirs</span><span class="token operator">=</span><span class="token variable">$container</span>/rwlayer:./images/<span class="token variable">$image</span> none <span class="token variable">$container</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>假如容器名字为dreamland，使用的镜像为ubuntu1604根文件系统，dreamland/rwlayer、images/ubuntu1604将被联合加载的dreamland目录。其中，dreamland/rwlayer为AUFS文件系统的读写层，images/ubuntu1604为AUFS文件系统的只读层。</p><p>之前我们将老的根文件系统挪到了rootfs/old_root，rootfs代表一个具体的镜像目录。创建old_root目录时直接修改了该镜像。下面我们将老的根文件系统的挂载点目录放在AUFS文件系统中，并将老的根文件系统挪到此处。命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> -p <span class="token variable">$container</span>/old_root<span class="token builtin class-name">cd</span> <span class="token variable">$container</span>pivot_root <span class="token builtin class-name">.</span> ./old_root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>此时，$container目录本身就是一个挂载点，挂载了AUFS文件系统。因此下面的代码就被移除了：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mount</span> --bind images/<span class="token variable">$image</span> images/<span class="token variable">$image</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>现在，我们运行docker.sh，并在/root下创建一个文件。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/docker.sh$ <span class="token function">sudo</span> ./docker.sh -c run -m 100M -C dreamland -I ubuntu1604 -V data1 -P /bin/bashroot@dreamland:/<span class="token comment"># cd /root</span>root@dreamland:/root<span class="token comment"># ls</span>root@dreamland:/root<span class="token comment"># cat /etc/issue &gt; hello.txt</span>root@dreamland:/root<span class="token comment"># cat hello.txt</span>Ubuntu <span class="token number">16.04</span> LTS <span class="token punctuation">\</span>n <span class="token punctuation">\</span>l<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>启动一个新的Shell窗口，查看一下该容器使用的AUFS文件系统。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/docker.sh$ <span class="token function">sudo</span> tree dreamland/dreamland/└── rwlayer    ├── old_root    └── root        └── hello.txt<span class="token number">2</span> directories, <span class="token number">1</span> <span class="token function">file</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，我们新建的文件及创建的老根文件系统的挂载点目录都出现在了读写层。我们再查看一下新创建的文件。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/docker.sh$ <span class="token function">sudo</span> <span class="token function">cat</span> dreamland/rwlayer/root/hello.txtUbuntu <span class="token number">16.04</span> LTS <span class="token punctuation">\</span>n <span class="token punctuation">\</span>l<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>文件内容是Ubuntu 16.04的发行版信息。</p><p>通过联合加载，我们实现了在容器中的读写不会影响使用的镜像。这样使用ubuntu1604镜像创建多个容器时，彼此之间就不会相互影响了。</p><h2 id="5-卷">5.卷</h2><h3 id="5-1-卷简介">5.1.卷简介</h3><p>卷是容器内的一个目录，这个目录可以绕过联合文件系统，提供数据共享（容器所使用的的联合文件系统不应该被主机或其他容器访问）与数据持久化的功能。</p><p>举个例子，假如容器有个目录为/data的卷，我们向这个卷写入的内容不会出现在联合文件系统的读写层，而是直接出现在这个目录里。主机与其他容器也可以访问该目录，从而达到数据共享与数据持久化的目的。</p><p>卷位于联合文件系统中，通常来说写入该目录的内容会被写入容器的读写层中，那么怎样才能是写入卷的目录直接出现在该目录中，而不是容器读写层呢？其实方法很简单，只要我们将该目录变成一个挂载点就行，变成挂载点后，这个目录中的内容就不属于联合文件系统了，写入该目录的内容自然会保存在挂载到该挂载点的设备中。</p><h3 id="5-2-docker-sh">5.2 docker.sh</h3><p>有了以上关于卷的介绍，我们就可以将卷功能加入到docker.sh中了。卷功能将放在container.sh脚本中，带下划线的行是我们为实现卷功能而新添的代码。修改后的container.sh脚本如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token function">hostname</span> <span class="token variable">$container</span><span class="token function">mkdir</span> -p /sys/fs/cgroup/memory/<span class="token variable">$container</span><span class="token builtin class-name">echo</span> <span class="token variable">$$</span> <span class="token operator">&gt;</span> /sys/fs/cgroup/memory/<span class="token variable">$container</span>/cgroup.procs<span class="token builtin class-name">echo</span> <span class="token variable">$memory</span> <span class="token operator">&gt;</span> /sys/fs/cgroup/memory/<span class="token variable">$container</span>/memory.limit_in_bytes<span class="token function">mkdir</span> -p <span class="token variable">$container</span>/rwlayer<span class="token function">mount</span> -t aufs -o <span class="token assign-left variable">dirs</span><span class="token operator">=</span><span class="token variable">$container</span>/rwlayer:./images/<span class="token variable">$image</span> none <span class="token variable">$container</span><span class="token function">mkdir</span> -p <span class="token variable">$volume</span><span class="token function">mkdir</span> -p <span class="token variable">$container</span>/<span class="token variable">$volume</span><span class="token function">mount</span> --bind <span class="token variable">$volume</span> <span class="token variable">$container</span>/<span class="token variable">$volume</span><span class="token function">mkdir</span> -p <span class="token variable">$container</span>/old_root<span class="token builtin class-name">cd</span> <span class="token variable">$container</span>pivot_root <span class="token builtin class-name">.</span> ./old_root<span class="token function">mount</span> -t proc proc /proc<span class="token function">umount</span> -l /old_root<span class="token builtin class-name">exec</span> <span class="token variable">$program</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先，我们根据卷的名字创建主机卷目录，我们在容器内部对卷的修改，都将作用于此目录。命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> -p <span class="token variable">$volume</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后，我们在容器内部创建同名卷目录，该目录本身会出现在容器的读写层中，因为该目录是在AUFS文件系统中创建的。因为<img src="https://math.now.sh?inline=container%E7%9B%AE%E5%BD%95%E4%B8%BA%E5%AE%B9%E5%99%A8%E7%9A%84%E6%A0%B9%E7%9B%AE%E5%BD%95%EF%BC%8C%E6%89%80%E4%BB%A5%E5%AE%B9%E5%99%A8%E5%86%85%E9%83%A8%E5%8D%B7%E7%9B%AE%E5%BD%95%E7%9A%84%E8%B7%AF%E5%BE%84%E4%B8%BA%2F" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;">volume。命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> -p <span class="token variable">$container</span>/<span class="token variable">$volume</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>将主机上的卷目录bind mount到容器内部的卷目录上，这样容器内部对卷目录的修改，都将作用于主机卷目录。命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mount</span> --bind <span class="token variable">$volume</span> <span class="token variable">$container</span>/<span class="token variable">$volume</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>现在，我们运行docker.sh，并在卷目录（/data1）中创建一个文件。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/docker.sh$ <span class="token function">sudo</span> ./docker.sh -c run -m 100M -C dreamland -I ubuntu1604 -V data1 -P /bin/bashroot@dreamland:/<span class="token comment"># cd /data1</span>root@dreamland:/data1<span class="token comment"># echo "hello to data1 volume from ubuntu16.04" &gt;&gt; hello.txt</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>启动一个新的Shell窗口，查看一下该容器使用的AUFS文件系统中的内容。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/docker.sh$ <span class="token function">sudo</span> tree dreamland/dreamland/└── rwlayer    ├── data1    ├── old_root    └── root        └── hello.txt<span class="token number">4</span> directories, <span class="token number">1</span> <span class="token function">file</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，我们使用的卷目录被创建在了容器的读写层，但是我们在卷目录中新建的文件却没有出现在读写层中。</p><p>我们再来查看一下主机卷目录的内容。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/docker.sh$ <span class="token function">sudo</span> tree data1/data1/└── hello.txt<span class="token number">0</span> directories, <span class="token number">1</span> <span class="token function">file</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从结果我们可以看到，在容器内部对卷目录的修改直接作用在了主机上的卷目录。我们再来查看一下主机卷目录下hello.txt中的内容。命令及结果如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">phl@kernelnewbies:~/docker.sh$ <span class="token function">sudo</span> <span class="token function">cat</span> data1/hello.txthello to data1 volume from ubuntu16.04<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>从结果我们可以看到，该文件的内容与我们在容器内部写入hello.txt的内容一致。</p><p>通过卷目录，我们实现了容器之间数据共享与数据持久化的功能。</p><h2 id="6-后记">6.后记</h2><p>至此，我们通过一系列的实验对docker的底层技术有了一个感性的认识。我们在使用docker时，也能够对其是如何运作的有了一个大致的了解。当然，这对于掌握docker技术来说还远远不够，有很多知识我们没有涉及，例如user namespace、容器安全、其他的CGroups、虚拟网络等。</p><p>编辑整理 <a target="_blank" rel="noopener" href="https://www.toutiao.com/i6890898988879315468/?tt_from=weixin&amp;utm_campaign=client_share&amp;wxshare_count=1&amp;timestamp=1647576105&amp;app=news_article&amp;utm_source=weixin&amp;utm_medium=toutiao_android&amp;use_new_style=1&amp;req_id=202203181201440101511900790A2CBE46&amp;share_token=b2d9351e-4cb1-4a25-ae82-f70543ce2a3b&amp;group_id=6890898988879315468">ScratchLab</a></p><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="docker" scheme="https://blog.17lai.site/categories/docker/"/>
    
    
    <category term="linux" scheme="https://blog.17lai.site/tags/linux/"/>
    
    <category term="docker" scheme="https://blog.17lai.site/tags/docker/"/>
    
    <category term="shell" scheme="https://blog.17lai.site/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>node 项目从构建到使用 jenkins + docker + nginx + mysql + redis 自动化部署</title>
    <link href="https://blog.17lai.site/posts/68d3867d/"/>
    <id>https://blog.17lai.site/posts/68d3867d/</id>
    <published>2022-03-16T10:04:02.000Z</published>
    <updated>2022-03-17T00:45:31.318Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1>概述</h1><p>这都2019年末了，你还不会 docker吗？ 你 low 爆了，我们作为一枚前端，不能说是要精通使用 docker 完成各种事情，但我觉得必须要学会使用 docker 干下面几件事：</p><ol><li>部署前端应用</li><li>部署nginx</li><li>使用docker-compose部署</li><li>在容器之间建立联系</li></ol><p>Docker 可理解为跑在宿主机上的非常精简、小巧、高度浓缩的虚拟机。 它可以将容器里的进程安稳的在宿主机上运行，之前我也有写过一些关于docker的文章，在这我就不做过多的介绍了，如有需要请自行查看我之前的文章即可，接下来我们通过项目来了解并使用 docker</p><h1>Egg.js ？</h1><p>在这里我使用 <code>egg.js</code> 来为大家实操一下项目的部署流程。有人会问 <code>egg.js</code> 是什么？ 我只能回答这是一款专业级的 <code>node</code> 框架。作为一个有梦想的前端，我们有必要去学习一种后端语言，而作为前端 <code>node</code> 的学习成本相对来说比较低的。 <code>egg.js</code> 这个框架在 node 现有框架中也是比较优秀的，如有需要，大家可以自行学习，我们今天的学习主要还是项目的部署流程，在这我就不给大家做过多的介绍。如有需要，请查阅 <a href="https://link.juejin.cn?target=https%3A%2F%2Feggjs.org%2Fzh-cn%2Fintro%2Findex.html" title="https://eggjs.org/zh-cn/intro/index.html">官方文档</a></p><h1>开始前的准备</h1><blockquote><p>docker 与 docker-compose 的安装我就不给大家介绍了。在之前的文章中是有的，也比较详细，作为一位开发人员，我认为这点事情难不倒大家</p></blockquote><h2 id="初始化项目">初始化项目</h2><pre class="line-numbers language-none"><code class="language-none">$ mkdir egg-example &amp;&amp; cd egg-example$ npm init egg --type=simple$ npm i复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="创建需要的文件">创建需要的文件</h2><p>我们需要在项目根目录创建我们所需要的文件</p><pre class="line-numbers language-none"><code class="language-none">$ touch Dockerfile$ touch docker-compose.yml$ setup.sh复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="目录结构-2">目录结构</h2><pre class="line-numbers language-none"><code class="language-none">egg-project├── package.json├── setup.sh (新建)├── Dockerfile (新建)├── docker-compose.yml (新建)├── app|   ├── router.js│   ├── controller│   |   └── home.js│   ├── service (可选)│   |   └── user.js│   ├── middleware (可选)│   |   └── response_time.js│   ├── schedule (可选)│   |   └── my_task.js...复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="常用指令">常用指令</h2><p>在开始之前我们要学习下常用的一些指令，看下方：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110127.webp" alt=""></p><h1>了解流程</h1><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110133.webp" alt=""></p><h1>安装 jenkins</h1><p>在安装jenkins我选择了使用docker-compose<br>docker-compose 是一个用来把 docker 自动化的东西<br>有了 docker-compose 你可以把所有繁复的 docker 操作全都一条命令，自动化的完成。</p><h2 id="首先我们需要在服务器上创建一个目录机构-具体结构个人自行创建">首先我们需要在服务器上创建一个目录机构 (具体结构个人自行创建)</h2><pre class="line-numbers language-none"><code class="language-none">/home/jenkins     - docker-compose.yml     - jenkins-home复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="接下来我们来编写-docker-compose-yml-安装jenkins">接下来我们来编写 docker-compose.yml 安装jenkins</h2><pre class="line-numbers language-none"><code class="language-none">version: '3'                                    # 指定 docker-compose.yml 文件的写法格式services:                                       # 多个容器集合  docker_jenkins:     user: root                                  # 为了避免一些权限问题 在这我使用了root    restart: always                             # 重启方式    image: jenkins/jenkins:lts                  # 指定服务所使用的镜像 在这里我选择了 LTS (长期支持)    container_name: jenkins                     # 容器名称    ports:                                      # 对外暴露的端口定义      - '8080:8080'      - '50000:50000'    volumes:                                    # 卷挂载路径      - /home/jenkins/jenkins_home/:/var/jenkins_home   # 这是我们一开始创建的目录挂载到容器内的jenkins_home目录      - /var/run/docker.sock:/var/run/docker.sock      - /usr/bin/docker:/usr/bin/docker                 # 这是为了我们可以在容器内使用docker命令      - /usr/local/bin/docker-compose:/usr/local/bin/docker-compose     # 同样的这是为了使用docker-compose命令复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们需要进入到 jenkins 目录下执行：</p><pre class="line-numbers language-none"><code class="language-none">$ docker-compose up -d复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="配置-2">配置</h2><p>不出意外你现在可以打开你的服务器地址 <a href="https://link.juejin.cn?target=http%3A%2F%2Fxxxxxxx" title="http://xxxxxxx">http://xxxxxxx</a>:端口号 就能看到这个界面：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110139.webp" alt=""></p><p>打开你所创建的jenkins目录进入到jenkins-home<br>/home/jenkins/jenkins-home</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110148.webp" alt=""></p><p>进入 secrets 目录</p><pre class="line-numbers language-none"><code class="language-none">$ cat initialAdminPassword复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110209.webp" alt=""></p><p>然后把里面的文本复制出来填到管理员密码中</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110327.webp" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110215.webp" alt=""></p><p>接下来需要安装两个插件</p><pre class="line-numbers language-none"><code class="language-none">NodeJS PluginPublish Over SSH复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110334.webp" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110221.webp" alt=""></p><p>然后我们滑到最下方</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110228.webp" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110341.webp" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110347.webp" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110235.webp" alt=""></p><h1>开始我们的操作</h1><h2 id="Dockerfile">Dockerfile</h2><p>我们在开始阶段的时候学过一些常用指令，大家应该一眼就可以看得懂这些命令。 加油！！</p><pre class="line-numbers language-none"><code class="language-none">FROM node:10.0-alpine             # 镜像版本# 设置时区RUN apk --update add tzdata \    &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \    &amp;&amp; echo "Asia/Shanghai" &gt; /etc/timezone \    &amp;&amp; apk del tzdata# 创建app目录RUN mkdir -p /usr/src/node-app/egg-santak# 设置工作目录WORKDIR /usr/src/node-app/egg-santak# 拷贝package.json文件到工作目录# !!重要：package.json需要单独添加。# Docker在构建镜像的时候，是一层一层构建的，仅当这一层有变化时，重新构建对应的层。# 如果package.json和源代码一起添加到镜像，则每次修改源码都需要重新安装npm模块，这样木有必要。# 所以，正确的顺序是: 添加package.json；安装npm模块；添加源代码。COPY package.json /usr/src/node-app/egg-santak/package.json# 安装npm依赖(使用淘宝的镜像源)# 如果使用的境外服务器，无需使用淘宝的镜像源，即改为`RUN npm i`。RUN npm i --registry=https://registry.npm.taobao.org# 拷贝所有源代码到工作目录COPY . /usr/src/node-app/egg-santak# 暴露容器端口EXPOSE 7001# 启动node应用CMD npm start复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="在服务器中创建我们所需要挂载的数据卷">在服务器中创建我们所需要挂载的数据卷</h2><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110241.webp" alt=""></p><pre class="line-numbers language-none"><code class="language-none"># nginx$ mkdir -p nginx/conf.d nginx/logs# mysql$ mkdir mysql# redis$ mkdir redis复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后进入 <code>nginx/conf.d</code> 文件夹中 创建一个后缀为 <code>conf</code> 的文件</p><pre class="line-numbers language-none"><code class="language-none">$ cd nginx/conf.d$ touch default.conf$ vim default.conf复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>写入以下内容：</p><pre class="line-numbers language-none"><code class="language-none">server {  listen 80;  listen [::]:80;  server_tokens off;  root /var/www/html;  index index.html index.htm;  # 修改为自己的域名  server_name api.lovelp.xin;  # 访问 / 路径时执行反向代理  location / {    # 这里 nodejs 是 node 容器名    proxy_pass http://nodejs:7001;    proxy_set_header X-Real-IP $remote_addr;    proxy_set_header Host $host;    # 后端的Web服务器可以通过 X-Forwarded-For 获取用户真实 IP    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;    # 允许客户端请求的最大单文件字节数    client_max_body_size 15M;    # 缓冲区代理缓冲用户端请求的最大字节数    client_body_buffer_size 128k;  }}复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="docker-compose-yml">docker-compose.yml</h2><pre class="line-numbers language-none"><code class="language-none">version: '3'services:  santak_redis:    image: redis:3                  # 指定服务镜像    container_name: santak_redis    # 容器名称    restart: always                 # 重启方式    hostname: redis    command: redis-server /usr/local/etc/redis/redis.conf --requirepass 123456  --appendonly yes    volumes:                        # 挂载数据卷      - /root/redis/redis.conf:/usr/local/etc/redis/redis.conf    ports:                          # 映射端口      - "6379:6379"         networks:                       # 加入指定网络      - app-network  santak_nginx:    image: nginx:stable-alpine      # 指定服务镜像    container_name: santak_nginx    # 容器名称    restart: always                 # 重启方式    ports:                          # 映射端口      - "80:80"    volumes:                        # 挂载数据卷      - /etc/localtime:/etc/localtime      - /root/nginx/conf.d:/etc/nginx/conf.d      - /root/nginx/logs:/var/log/nginx    depends_on:                     # 启动顺序      - nodejs    networks:                       # 加入指定网络      - app-network  santak_mysql:    image: mysql:5.7    container_name: santak_mysql    restart: always    ports:                          # 映射端口      - "3306:3306"    environment:      - MYSQL_ROOT_PASSWORD=root      - MYSQL_USER=lovelp           # 创建lovelp用户      - MYSQL_PASSWORD=mm123321     # 设置lovelp用户的密码      - MYSQL_DATABASE=santak       # 创建初始数据库      - TZ=Asia/Shanghai            # 设置时区    volumes:                        # 挂载数据卷      - /root/mysql:/var/lib/mysql  # 为了数据持久化    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci    networks:                       # 加入指定网络      - app-network   nodejs:    build:                          # 这里指的是我们刚刚撸的 Dockerfile 文件      context: .                          dockerfile: Dockerfile    image: nodejs                   # 镜像名称    container_name: nodejs          # 容器名称    restart: always                 # 重启方式    depends_on:                     # 启动顺序      - santak_redis      - santak_mysql    links:                          # 容器连接      - santak_redis:santak_redis      - santak_mysql:santak_mysql    networks:                       # 加入指定网络      - app-networkvolumes:  certbot-etc:  certbot-var:networks:  # 实现通信  app-network:    driver: bridge复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="在项目中的使用">在项目中的使用</h2><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110359.webp" alt=""></p><h2 id="setup-sh">setup.sh</h2><pre class="line-numbers language-none"><code class="language-none">#!/usr/bin/env bash#image_version=`date +%Y%m%d%H%M`;# 关闭容器docker-compose stop || true;# 删除容器docker-compose down || true;# 构建镜像docker-compose build;# 启动并后台运行docker-compose up -d;# 查看日志docker logs nodejs;# 对空间进行自动清理docker system prune -a -f复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1>jenkins 创建项目</h1><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110247.webp" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110248.webp" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110254.webp" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110409.webp" alt=""></p><p>最后我们就可以愉快的 <code>Build Now</code> 了</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1120220311110415.webp" alt=""></p><p>在这里我选择的是手动构建。其实jenkins有很多可配置项，比如自动化构建啥的，兴趣使然，大家自行摸索，谢谢大家</p><h2 id="整理转载">整理转载:</h2><ul><li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904006184091662">掘金</a></li></ul><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="web" scheme="https://blog.17lai.site/categories/web/"/>
    
    
    <category term="web" scheme="https://blog.17lai.site/tags/web/"/>
    
    <category term="docker" scheme="https://blog.17lai.site/tags/docker/"/>
    
    <category term="CI/CD" scheme="https://blog.17lai.site/tags/CI-CD/"/>
    
    <category term="node" scheme="https://blog.17lai.site/tags/node/"/>
    
    <category term="jenkins" scheme="https://blog.17lai.site/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>音乐推荐-曾经我也想过一了百了</title>
    <link href="https://blog.17lai.site/posts/8b7d3a9a/"/>
    <id>https://blog.17lai.site/posts/8b7d3a9a/</id>
    <published>2022-03-14T15:37:19.000Z</published>
    <updated>2022-03-16T10:52:12.650Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="现场MV-2">现场MV</h2><style>.bbplayer{width: 100%; max-width: 850px; margin: auto}</style><div class="bbplayer"><iframe class="bbplayer" id="mmedia-GKmAWZRHdiKLOfnk" src="https://player.bilibili.com/player.html?bvid=BV1b64y1d7pw&amp;page=1&amp;high_quality=1&amp;danmaku=true" allowfullscreen="allowfullscreen" scrolling="no" border="0" frameborder="0" framespacing="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts allow-popups"></iframe></div><script> document.getElementById("mmedia-GKmAWZRHdiKLOfnk").style.height=document.getElementById("mmedia-GKmAWZRHdiKLOfnk").scrollWidth*0.76+"px";    window.onresize = function(){      document.getElementById("mmedia-GKmAWZRHdiKLOfnk").style.height=document.getElementById("mmedia-GKmAWZRHdiKLOfnk").scrollWidth*0.76+"px";    }; </script><h2 id="背景介绍">背景介绍</h2><p>《曾经我也想过一了百了》是日本歌手中岛美嘉演唱的歌曲，由秋田弘填词和谱曲、出羽良彰编曲，于2013年8月28日发行，收录在中岛美嘉个人专辑《TOUGH 为爱勇敢》中。该歌曲勾勒出向死而生、努力活着的人，让人感到温暖和希望，让因为压力迷茫无助而有轻生想法的人，开始积极拥抱生活。 《曾经我也想过一了百了》由日本摇滚乐队amazarashi的主唱秋田弘创作，创作理念为“为了描写浓烈的希望，必须先描写深层的黑暗”。2010年，迎来出道十周年的中岛美嘉宣布自己因耳咽管开放症暂停一切音乐活动。在疾病的影响下，歌唱对她而言变得无比艰难。2011年，她携单曲《Dear》复出，但复出后始终经历着状态的起伏和媒体的质疑。 中岛美嘉起先向amazarashi提出合作请求，希望乐队能为自己创作一首节奏明快的歌曲，但随后秋田弘向她播放了乐队一首未发行的样本歌曲，并认为该曲很适合由她来演唱。收到该曲时，中岛美嘉起先感到十分惊讶，但听到最后泪流不止，感到自己的心变得柔和，便立即要求演唱该曲。录制过程中，中岛美嘉将自己的心声融入到了该曲中，希望能将力量传达给低迷苦闷的听众。</p><pre class="line-numbers language-lrc" data-language="lrc"><code class="language-lrc">[00:00.10]僕が死のうと思ったのは (曾经我也想过一了百了) - 中島美嘉 (なかしま みか)[00:00.20]词：秋田ひろむ[00:00.30]曲：秋田ひろむ[00:00.40]编曲：出羽良彰[00:27.95]僕が死のうと思ったのは[00:33.83]ウミネコが桟橋で鳴いたから[00:39.20]波の随意に浮かんで消える[00:45.33]過去も啄ばんで飛んでいけ[00:50.70]僕が死のうと思ったのは[00:56.52]誕生日に杏の花が咲いたから[01:02.22]その木漏れ日でうたた寝したら[01:08.09]虫の死骸と土になれるかな[01:14.09]薄荷飴 漁港の灯台[01:17.05]錆びたアーチ橋 捨てた自転車[01:19.74]木造の駅のストーブの前で[01:22.74]どこにも旅立てない心[01:25.61]今日はまるで昨日みたいだ[01:28.30]明日を変えるなら今日を変えなきゃ[01:31.56]分かってる 分かってる けれど[01:39.71]僕が死のうと思ったのは[01:44.89]心が空っぽになったから[01:50.71]満たされないと泣いているのは[01:56.39]きっと満たされたいと願うから[02:25.49]僕が死のうと思ったのは[02:30.69]靴紐が解けたから[02:36.57]結びなおすのは苦手なんだよ[02:42.25]人との繋がりもまた然り[02:47.90]僕が死のうと思ったのは[02:53.65]少年が僕を見つめていたから[02:59.30]ベッドの上で土下座してるよ[03:05.12]あの日の僕にごめんなさいと[03:11.43]パソコンの薄明かり[03:14.05]上階の部屋の生活音[03:16.80]インターフォンのチャイムの音[03:19.80]耳を塞ぐ鳥かごの少年[03:22.87]見えない敵と戦ってる[03:25.43]六畳一間のドンキホーテ[03:28.30]ゴールはどうせ醜いものさ[03:36.74]僕が死のうと思ったのは[03:42.05]冷たい人と言われたから[03:47.94]愛されたいと泣いているのは[03:53.63]人の温もりを知ってしまったから[04:22.79]僕が死のうと思ったのは[04:27.91]あなたが綺麗に笑うから[04:33.49]死ぬことばかり考えてしまうのは[04:39.62]きっと生きる事に真面目すぎるから[04:45.43]僕が死のうと思ったのは[04:50.70]まだあなたに出会ってなかったから[04:56.51]あなたのような人が生まれた[05:02.09]世界を少し好きになったよ[05:07.96]あなたのような人が生きてる[05:13.65]世界に少し期待するよ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="中文翻唱">中文翻唱</h2>        <div id="aplayer-bpnmVhya" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;"></div>  <script>  var options = {"narrow":false,"autoplay":false,"showlrc":3,"mode":"random","mutex":true,"theme":"#e6d0b2","preload":"metadata","listmaxheight":"513px","music":[{"title":"曾经我也想过一了百了","author":"一么","url":"https://cdn.17lai.site/media/music/僕が死のうと思ったのは/曾经我也想过一了百了-一么.mp3","pic":"https://cdn.17lai.site/media/music/僕が死のうと思ったのは/僕が死のうと思ったのは.jpg","lrc":"https://cdn.17lai.site/media/music/僕が死のうと思ったのは/曾经我也想过一了百了-一么.lrc"},{"title":"僕が死のうと思ったのは","author":"中岛美嘉","url":"https://cdn.17lai.site/media/music/僕が死のうと思ったのは/01%20僕が死のうと思ったのは.mp3","pic":"https://cdn.17lai.site/media/music/僕が死のうと思ったのは/僕が死のうと思ったのは.jpg","lrc":"https://cdn.17lai.site/media/music/僕が死のうと思ったのは/01%20僕が死のうと思ったのは.lrc"}]};  options.element = document.getElementById("aplayer-bpnmVhya");  var ap = new APlayer(options);    window.aplayers || (window.aplayers = []);  window.aplayers.push(ap);  </script><pre class="line-numbers language-none"><code class="language-none">[00:02.09]作曲 : 秋田 ひろむ[00:02.64]曾经我也想过一了百了[00:03.21]原唱：中岛美嘉[00:04.46] [00:29.85]曾经我 也想过 一了百了[00:34.79]因为看见蜷缩的猫[00:37.40]在码头望着远方[00:40.40]海浪拍打在岸上[00:43.44]一阵又一阵侵踏[00:46.22]希望那些过往都消失[00:49.38]不再回望[00:52.43]曾经我 也想过[00:54.82]一了百了[00:57.46]是因为生日的那天[01:00.10]杏花 又开放[01:03.75]阳光灿烂树荫下[01:06.41]落花已沉睡安详[01:09.84]是否我也 能化作尘土[01:12.16]不再流浪[01:15.76]仍放抽屉里过期的糖[01:18.28]迷路的单车被留在回家路上[01:21.27]还有海边抛弃的避风港[01:23.88]全都提醒 我和他们一样[01:26.75]昨天和今天的画面不断浮现[01:29.74]明天 渴望能不能有[01:31.54]新的改变[01:32.90]不能沮丧 我知道啊[01:35.55]可是啊[01:40.88]曾经我 也想过 一了百了[01:46.24]身边一切都像在问我[01:49.19]过得好不好[01:52.28]泪不能停止的流[01:55.05]流进心底的荒漠[01:58.28]这颗心中的模样[02:00.17]早空如一具躯壳[02:26.84]曾经我 也想过 一了百了[02:32.71]因为我的存在[02:34.23]总让别人失望[02:37.98]不曾拥有就不怕[02:40.80]关于人与人的伤[02:44.18]这么简单的道理[02:45.96]我也只会搞砸[02:49.80]曾经我 也想过 一了百了[02:55.49]是因为墙上[02:56.52]那张骄傲的自画像[03:00.96]无力反驳地跪下[03:03.66]只说的出一句话[03:06.99]生而为人的我[03:08.61]真的对不起呀[03:12.75]房间里闪烁着荧幕微光[03:15.56]伴随着屋外夜色的声音嘈杂[03:18.43]电话那头传来窒息的话[03:21.28]刺痛在笼中[03:22.44]备受折磨的时间啊[03:24.25]黑暗中我装备[03:25.58]唐吉轲德的毅力[03:26.89]对抗看不见的敌人[03:28.38]摧毁我的决心[03:29.85]不要害怕我知道啊可是啊[03:38.04]曾经我也想过一了百了[03:44.29]为何人们都说我无可救药[03:49.69]不强求能明白我[03:52.60]不奢望时间倒流[03:55.70]因为很久很久以前我曾爱过[04:00.86]曾经我 也想过 一了百了[04:06.89]是因为我该那样[04:08.43]灿烂那样美好[04:12.49]一味消极着过去[04:14.95]离去的念头缠绕[04:17.29]闭上眼能感受到[04:20.04]更好的明天来到[04:24.35]茫茫人海中的你[04:27.01]泪光中微笑的你[04:30.26]在我耳边温柔唱起这首歌曲<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>PS: 数据丢失了一回，折腾了很长时间才重新补回来。</p><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="music" scheme="https://blog.17lai.site/categories/music/"/>
    
    
    <category term="music" scheme="https://blog.17lai.site/tags/music/"/>
    
    <category term="中岛美嘉" scheme="https://blog.17lai.site/tags/%E4%B8%AD%E5%B2%9B%E7%BE%8E%E5%98%89/"/>
    
  </entry>
  
  <entry>
    <title>私人在线音乐服务器搭建与使用介绍</title>
    <link href="https://blog.17lai.site/posts/2b9325d0/"/>
    <id>https://blog.17lai.site/posts/2b9325d0/</id>
    <published>2021-11-07T01:25:00.000Z</published>
    <updated>2022-03-16T12:29:02.095Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p><strong>多种音乐播放实现方式</strong></p><ol><li>页面内插入音乐列表。Aplayer实现</li><li>单独页面音乐列表。Aplayer实现</li><li>音乐Docker。在线云音乐</li></ol><blockquote><ul><li>原作者DMCA原因不再维护，如果你想自己部署，需要修改原作者docker内部代码。</li></ul></blockquote><ol><li>音乐Docker <a target="_blank" rel="noopener" href="https://github.com/linuxserver/docker-mstream">Mstream docker</a>。</li><li>音乐Docker <a target="_blank" rel="noopener" href="https://hub.docker.com/r/apnar/logitech-media-server">Logitech Media Server</a>。<a target="_blank" rel="noopener" href="https://github.com/Logitech/slimserver">Github</a></li></ol><blockquote><ul><li>多用户音乐分享、播放，在线，分类等功能。</li></ul></blockquote></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0720211107003631.jpg" alt="img"></p><h2 id="Aplayer-在线音乐">Aplayer 在线音乐</h2><blockquote><p>博文页面内插入音乐列表</p></blockquote><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><div id="mmedia-KwOgacsoYkVLEvJG"></div><script> var KwOgacsoYkVLEvJG_options = JSON.parse('{\"lrcType\":3,\"volume\":0.66,\"audio\":[{\"name\":\"Hotel California\",\"artist\":\"Camille and Kennerly\",\"url\":\"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.mp3\",\"lrc\":\"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.lrc\",\"cover\":\"https://cdn.17lai.site/media/music/Hotel%20California/Hotel%20California.webp\"}]}'); KwOgacsoYkVLEvJG_options.container = document.getElementById("mmedia-KwOgacsoYkVLEvJG"); const ap_KwOgacsoYkVLEvJG = new APlayer(KwOgacsoYkVLEvJG_options); </script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><div id="mmedia-eBVsvRnKcIFYzXru"></div><script> var eBVsvRnKcIFYzXru_options = JSON.parse('{\"lrcType\":3,\"volume\":0.8,\"autoplay\":false,\"audio\":[{\"name\":\"Hotel California\",\"artist\":\"Camille and Kennerly\",\"url\":\"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.mp3\",\"cover\":\"https://cdn.17lai.site/media/music/Hotel%20California/Hotel%20California.webp\",\"lrc\":\"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.lrc\",\"theme\":\"#ebd0c2\"},{\"name\":\"Sold Out\",\"artist\":\"Diamonds\",\"url\":\"https://cdn.17lai.site/media/music/Diamonds/05%20Sold%20Out.flac\",\"cover\":\"https://cdn.17lai.site/media/music/Diamonds/Diamonds.jpg\",\"theme\":\"#ebd0c2\"},{\"name\":\"The Final Bell\",\"artist\":\"Rocky_ Original Motion Picture Score\",\"url\":\"https://cdn.17lai.site/media/music/Rocky_%20Original%20Motion%20Picture%20Score/12%20Bill%20Conti%20-%20The%20Final%20Bell.mp3\",\"cover\":\"https://cdn.17lai.site/media/music/Rocky_%20Original%20Motion%20Picture%20Score/Rocky_%20Original%20Motion%20Picture%20Score.jpg\",\"theme\":\"#ebd0c2\"},{\"name\":\" Croatian Rhapsody\",\"artist\":\"The Piano Player\",\"url\":\"https://cdn.17lai.site/media/music/The%20Piano%20Player/11%20Croatian%20Rhapsody.mp3\",\"cover\":\"https://cdn.17lai.site/media/music/The%20Piano%20Player/The%20Piano%20Player.jpg\",\"theme\":\"#ebd0c2\"}]}'); eBVsvRnKcIFYzXru_options.container = document.getElementById("mmedia-eBVsvRnKcIFYzXru"); const ap_eBVsvRnKcIFYzXru = new APlayer(eBVsvRnKcIFYzXru_options); </script><h2 id="单独Aplayer音乐页面">单独Aplayer音乐页面</h2><blockquote><p><strong>直接戳这里 -&gt;</strong> <a href="https://blog.17lai.site/musics/">Musics</a></p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0720211107002935.jpg" alt="img"></p><h2 id="在线云音乐">在线云音乐</h2><p>私人云音乐</p><div class="admonition note"><p class="admonition-title">研究学习使用</p><p>不对外公开发布，研究学习用。</p></div><p>用户名密码base64编码</p><pre class="line-numbers language-base64" data-language="base64"><code class="language-base64">55So5oi35ZCN5a+G56CB6YO95pivMTdsYWk=<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>base64解密: <a target="_blank" rel="noopener" href="http://encode.chahuo.com/">在线加密解密</a></p><p><a target="_blank" rel="noopener" href="https://musicplayer.17lai.site/"><strong>入口</strong></a></p><blockquote><ul><li>公开在线云音乐服务网页版。</li><li>可以与网易云音乐UID同步！</li><li><a target="_blank" rel="noopener" href="https://hub.docker.com/r/oldiy/music-player-docker">DockerHub</a></li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/0920211009174442.png" alt="在线云音乐入口"></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1220211012022352.png" alt="播放界面"></p><p>与网易云同步</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/0920211009174557.png" alt=""></p><p>网易云UID在登陆 https://music.163.com/ 后 点击右上角图标的我的主页 https://music.163.com/#/user/home?id=617xxxxx0</p><p>home?id= 后面的数字就是你的UID。登录后，可以同步个人列表！</p><h2 id="私人音乐服务器">私人音乐服务器</h2><p><a target="_blank" rel="noopener" href="https://music.17lai.site/"><strong>入口</strong></a></p><blockquote><ul><li>所有音乐作者，专辑，演唱者元数据刮削。</li><li>rclone挂载webdav网盘存储音乐文件。</li><li>cloudflare parterner加速。</li><li>私人使用，不对外公开。</li></ul></blockquote><h2 id="在线音乐播放">在线音乐播放</h2><blockquote><ul><li>SelfHost 支持。Docker 部署！</li><li>Github: <a target="_blank" rel="noopener" href="https://github.com/linuxserver/docker-mstream">Mstream docker</a>。</li><li>浏览器界面支持。</li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/0620211006015739.png" alt="私人音乐服务"></p><h3 id="支持DJ模式">支持DJ模式</h3><blockquote><ul><li>在音乐库中随机选择音乐播放。</li><li>选择症患者救星。</li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/0620211006020713.png" alt="DJ模式"></p><h3 id="Android支持">Android支持</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/0620211006020403.png" alt="Android支持"></p><h3 id="其它特性">其它特性</h3><blockquote><ul><li>转码支持</li><li>遥控器支持</li><li>播放列表</li><li>等等</li></ul></blockquote><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="music" scheme="https://blog.17lai.site/categories/music/"/>
    
    
    <category term="docker" scheme="https://blog.17lai.site/tags/docker/"/>
    
    <category term="music" scheme="https://blog.17lai.site/tags/music/"/>
    
    <category term="mstream" scheme="https://blog.17lai.site/tags/mstream/"/>
    
    <category term="selfhost" scheme="https://blog.17lai.site/tags/selfhost/"/>
    
  </entry>
  
  <entry>
    <title>自己动手制作电子书的最佳方式（支持PDF、ePub、mobi等格式）</title>
    <link href="https://blog.17lai.site/posts/d6bad1e5/"/>
    <id>https://blog.17lai.site/posts/d6bad1e5/</id>
    <published>2021-11-02T01:25:00.000Z</published>
    <updated>2022-03-16T10:52:12.514Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="前言-3">前言</h2><p>对于经常阅读的人来说，制作本地电子书，算是刚需了。网上的很多教程都不太好用，所以我特地整理出一个详细的教程。亲测有效，一劳永逸。</p><p>当你意外发现某个宝藏公众号时，想要集中阅读上面的每一篇文章，恨不得一口气看完，你会怎么做呢？你可能会把它添加到“微信读书”App 的书架上：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223600.jpeg" alt="img"></p><p>但上面这种曲线救国的方式并非最佳，仍然不尽人意，存在不少问题。</p><p>我知道，现在有很多的第三方服务，可以将任意公众号的文章制作成电子书，我试过很多次，但都是付费的。一听说要钱，你又不干了：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223603.jpeg" alt="img"></p><p>再列举一种场景：当你在 GitHub 上发现一个很全面很丰富的项目文档时，仿佛发现了新大陆。可 GitHub 网站的服务器在国外，国内的访问速度实在感人，你想要把它下载到本地查看，会怎么做呢？你估计会选择<code>git clone</code>或者直接选择“Download ZIP”，然后用 Typora 或者 VS Code 软件打开这个项目文档，在本地查看：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223605.jpeg" alt="img"></p><p>总之，你能想到的方式，我都想到了，而且都尝试过。</p><p>现在的需求就是，如果你经常阅读网上的资料，肯定会有这样一个需求：<strong>怎么把这些几百页、甚至几千页的内容整理成 PDF、ePub、mobi等格式的电子书呢</strong>？</p><p>要么花钱请别人做，要么自己做。</p><p>今天这篇文章，就是来告诉你”<strong>自己动手制作 PDF、ePub、mobi 等格式电子书</strong>“的最佳方式。如果你是码农出身，下面讲的这些步骤，根本难不倒你。如果你不是码农出身，也没关系，只要你有一台电脑，跟着我讲的教程研究下去，肯定能搞定。</p><p>问题的关键不在于难不难、会不会，而是在于你是不是<strong>爱折腾</strong>。</p><h2 id="工具篇">工具篇</h2><h3 id="bloodstar-gitbook-builder"><a target="_blank" rel="noopener" href="https://hub.docker.com/r/bloodstar/gitbook-builder">bloodstar/gitbook-builder</a></h3><blockquote><p>Gitbook Docker 集成开发环境。支持CJK，附带常用工具。使用它，下面一些列环境配置都可以省略了。开箱即用。</p></blockquote><h3 id="Usage">Usage</h3><p>Read the official <a target="_blank" rel="noopener" href="https://toolchain.gitbook.com/">GitBook Toolchain Documentation</a> documentation <a target="_blank" rel="noopener" href="https://github.com/GitbookIO/gitbook#how-to-use-it">GitbookIO/gitbook</a> first.</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># init</span><span class="token function">docker</span> run --rm -v <span class="token string">"<span class="token environment constant">$PWD</span>:/gitbook"</span> -p <span class="token number">4000</span>:4000 bloodstar/gitbook-builder gitbook init<span class="token comment"># serve</span><span class="token function">docker</span> run --rm -v <span class="token string">"<span class="token environment constant">$PWD</span>:/gitbook"</span> -p <span class="token number">4000</span>:4000 bloodstar/gitbook-builder gitbook serve<span class="token comment"># build</span><span class="token function">docker</span> run --rm -v <span class="token string">"<span class="token environment constant">$PWD</span>:/gitbook"</span> -p <span class="token number">4000</span>:4000 bloodstar/gitbook-builder gitbook build<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>For short, you can use alias for the long command line text. Place the alias statement in your <code>.bashrc</code> or <code>.zshrc</code>.</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">alias</span> <span class="token assign-left variable">gitbook</span><span class="token operator">=</span><span class="token string">'docker run --rm -v "$PWD":/gitbook -p 4000:4000 bloodstar/gitbook-builder gitbook'</span><span class="token comment"># init</span>gitbook init<span class="token comment"># serve</span>gitbook serve<span class="token comment"># build</span>gitbook build<span class="token comment"># pdf output</span>gitbook pdf <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Integrate-with-Gitlab-CI">Integrate with Gitlab CI</h3><p>This docker image is originally designed for generating ebook with <a target="_blank" rel="noopener" href="https://about.gitlab.com/gitlab-ci/">Gitlab CI</a>. You could configure your Gitlab CI as following:</p><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">before_script</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> env  <span class="token punctuation">-</span> export LC_ALL=zh_TW.UTF<span class="token punctuation">-</span><span class="token number">8</span><span class="token key atrule">stages</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> build<span class="token key atrule">ebook</span><span class="token punctuation">:</span>  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build  <span class="token key atrule">script</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> gitbook pdf  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>    <span class="token key atrule">paths</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> book.pdf  <span class="token key atrule">only</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> master  <span class="token key atrule">tags</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> gitbook  <span class="token key atrule">image</span><span class="token punctuation">:</span> bloodstar/gitbook<span class="token punctuation">-</span>builder<span class="token punctuation">:</span>latest  <span class="token key atrule">allow_failure</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="制作电子书的具体步骤">制作电子书的具体步骤</h2><h3 id="整体流程">整体流程</h3><p>先说一下整体步骤：</p><p>（1）安装 gitbook 工具。</p><p>（2）安装 calibre 软件，配置 <code>ebook-convert</code>工具。</p><p>（3）将<code>md</code>格式的多个文件素材导出为电子书（支持 PDF、ePub、mobi 等格式）。</p><p>（4）高级进阶：配置电子书的目录、封面、页眉页脚等。</p><p>整理流程如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223611.jpeg" alt="img"></p><p>接下来我们看看详细的完整步骤。</p><h3 id="步骤-1：通过-npm-安装-gitbook-cli">步骤 1：通过 npm 安装 gitbook-cli</h3><p>安装命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> -g gitbook-cli<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>安装成功之后，再执行<code>gitbook -V</code>命令确认是否安装成功：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gitbook -VCLI version: <span class="token number">2.3</span>.2GitBook version: <span class="token number">3.2</span>.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>备注：如果你不知道 <code>npm</code> 是什么，可以自行查阅<strong>如何安装 Node.js 和 npm 环境</strong>。</p><h3 id="步骤-2：安装-ebook-convert（针对-Windows-用户）">步骤 2：安装 ebook-convert（针对 Windows 用户）</h3><p>ebook-convert 是能够自由转化格式的一个命令行工具，已经包含在 calibre 软件里面了。</p><p>（1）安装 <code>calibre</code> 软件。calibre 的官网如下：（我们可以去官网下载安装）</p><blockquote><p>https://calibre-ebook.com/</p></blockquote><p>（2）在终端输入如下命令，验证 <code>ebook-convert</code> 是否能正常使用：</p><p>如果输入上面的命令后提示错误，说明你还需要将 calibre 的安装目录添加到系统的环境变量中。</p><h3 id="步骤-2：安装-ebook-convert（针对-Mac-用户）">步骤 2：安装 ebook-convert（针对 Mac 用户）</h3><p>ebook-convert 是能够自由转化格式的一个命令行工具，已经包含在 calibre 软件里面了。</p><p>（1）安装 <code>calibre</code> 软件。calibre 的官网如下：（我们可以去官网下载安装）</p><blockquote><p>https://calibre-ebook.com/</p></blockquote><p>（2）配置 <code>ebook-convert</code>。针对 Mac 系统，需要执行如下命令，把 <code>ebook-convert</code> 软链接到 <code>bin</code> 目录：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">ln</span> -s /Applications/calibre.app/Contents/MacOS/ebook-convert /usr/bin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>执行上面的命令后，如果出现<code>Operation not permitted</code>异常，说明系统权限限制，此时需要<strong>配置环境变量</strong>。</p><p>（3）环境变量配置：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> ~/.bash_profile<span class="token comment"># 将下面这两行配置，添加到 .bash_profile 文件中</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">EBOOK_PATH</span><span class="token operator">=</span>/Applications/calibre.app/Contents/MacOS<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$EBOOK_PATH</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>备注：可以自行研究下，在命令行环境，如何通过 vim 编辑文件。</p><p>然后刷新一下刚刚的配置：</p><p>验证<code>ebook-convert</code>是否能正常使用：</p><h3 id="步骤-3：配置电子书的目录">步骤 3：配置电子书的目录</h3><p>本地新建一个空的文件夹，作为我们的电子书项目。文件夹的名字随便起，但建议用英文命名。</p><p>（1）项目初始化。</p><p>在当前项目下，执行如下命令，进行初始化：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gitbook init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>此时，项目下会自动生成如下两个文件：（<strong>非常重要，必不可少</strong>）</p><ul><li><code>README.md</code>：书籍的简介放在这个文件里。</li><li><code>SUMMARY.md</code>：书籍的<strong>目录结构</strong>在这里配置。</li></ul><p>这两个文件创建后，内容为空白，可使用 Markdown 语言自定义内容。</p><p>（2）配置电子书的目录。</p><p>我们先把本地的 markdown 文件（也就是我们的<strong>电子书素材</strong>）放到项目中，然后在<code>SUMMARY.md</code>文件中配置电子书的目录。</p><p>比如说， 我的项目中有下面这些文件：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223644.jpeg" alt="img"></p><p>那么，我在<code>SUMMARY.md</code>文件中就要这样配置：</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 目录</span><span class="token list punctuation">*</span> <span class="token url">[<span class="token content">README</span>](<span class="token url">./README.md</span>)</span><span class="token list punctuation">*</span> <span class="token url">[<span class="token content">00-前端工具</span>](<span class="token url">00-前端工具/0-README.md</span>)</span>  <span class="token list punctuation">*</span> [01-VS Code的使用](00-前端工具/01-VS Code的使用.md)  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">02-Git的使用</span>](<span class="token url">00-前端工具/02-Git的使用.md</span>)</span><span class="token list punctuation">*</span> <span class="token url">[<span class="token content">01-HTML</span>](<span class="token url">01-HTML/0-README.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">01-认识Web和Web标准</span>](<span class="token url">01-HTML/01-认识Web和Web标准.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">02-浏览器的介绍</span>](<span class="token url">01-HTML/02-浏览器的介绍.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">03-初识HTML</span>](<span class="token url">01-HTML/03-初识HTML.md</span>)</span><span class="token list punctuation">*</span> <span class="token url">[<span class="token content">02-CSS基础</span>](<span class="token url">02-CSS基础/0-README.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">01-CSS属性：字体属性和文本属性</span>](<span class="token url">02-CSS基础/01-CSS属性：字体属性和文本属性.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">02-CSS属性：背景属性</span>](<span class="token url">02-CSS基础/02-CSS属性：背景属性.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">03-CSS样式表和选择器</span>](<span class="token url">02-CSS基础/03-CSS样式表和选择器.md</span>)</span><span class="token list punctuation">*</span> <span class="token url">[<span class="token content">03-JavaScript基础</span>](<span class="token url">03-JavaScript基础/0-README.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">00-编程语言</span>](<span class="token url">03-JavaScript基础/00-编程语言.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">01-JS简介</span>](<span class="token url">03-JavaScript基础/01-JS简介.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">02-变量</span>](<span class="token url">03-JavaScript基础/02-变量.md</span>)</span>  <span class="token list punctuation">*</span> <span class="token url">[<span class="token content">03-变量的数据类型：基本数据类型和引用数据类型</span>](<span class="token url">03-JavaScript基础/03-变量的数据类型：基本数据类型和引用数据类型.md</span>)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>制作成的目录，将会是下面这种效果：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223613.jpeg" alt="img"></p><h3 id="步骤-4：导出电子书">步骤 4：导出电子书</h3><p>（1）本地预览电子书：</p><p>执行上方命令后，工具会对项目里的 Markdown 格式的文件进行转换，默认转换为 html 格式，最后提示 <code>Serving book on http://localhost:4000</code>。</p><p>我们打开浏览器输入<code>http://localhost:4000</code>，预览一下电子书的效果：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223620.jpeg" alt="img"></p><p>（2）制作并导出电子书。<strong>接下来就是见证奇迹的时刻</strong>。</p><p>生成 PDF 格式的电子书：（PDF 是最常见的文档格式）</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gitbook pdf ./ ./mybook.pdf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>生成 epub 格式的电子书：（epub 是最常见、最通用的电子书格式）</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gitbook epub ./ ./mybook.epub<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>生成 mobi 格式的电子书：（mobi 格式可以在 kindle 中打开）</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gitbook mobi ./ ./mybook.mobi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>上面这三种格式的电子书生成之后，项目里会看到这三个新增的文件：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223652.jpeg" alt="img"></p><p>我们把电子书打开，验收一下成果。</p><p>打开 pdf 电子书看看效果：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223700.jpeg" alt="img"></p><p>打开 epub 电子书看看效果：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223622.jpeg" alt="img"></p><p>怎么样，自制电子书就这样做好了，是不是很有成就感？</p><blockquote><p>更详细参考教程： <a target="_blank" rel="noopener" href="https://blog.17lai.fun/posts/7fe86002/">GitBook+GitLab撰写发布技术文档-Part1:GitBook篇</a></p></blockquote><h2 id="制作电子书的高级配置">制作电子书的高级配置</h2><p>电子书做好之后，我猜你肯定想进一步做<strong>个性化配置</strong>，比如：怎么加封面？怎么修改页眉页脚？还有其他的一些配置。</p><p>我们来看看亲手制作的电子书，有哪些常见的高级配置。</p><h3 id="制作书籍封面">制作书籍封面</h3><p>为了让书籍显示得更加优雅，我们可以指定一个自定义的封面。操作如下：</p><p>在项目的根目录下准备好 <code>cover.jpg</code> （大封面）和 <code>cover_small.jpg</code> （小封面）这两种封面图片。注意，图片的文件名和后缀名必须严格按照这句话来。</p><p>GitBook 的官方文档建议： <code>cover.jpg</code> （大封面）的尺寸为 1800x2360 像素，<code>cover_small.jpg</code>（小封面）的尺寸为 200x262 像素。图片的制作，建议遵循如下规范：</p><ul><li>没有边框</li><li>清晰可见的书本标题</li><li>任何重要的文字在小封面中应该清晰可见</li></ul><h3 id="book-json-：电子书的各种配置">book.json ：电子书的各种配置</h3><p>我们可以在项目的根目录下新建一个文件<code>book.json</code>（注意，文件名是<code>book</code>，后缀名是<code>json</code>），这个<code>book.json</code>就是电子书的配置文件，可以在里面填一些常见的配置。</p><p>关于 book.json 的配置项有很多，我们可以在网上搜索“GitBook book.json”找到。这里大致列举一些。</p><p>1、<strong>常规配置</strong>如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0220211102223624.jpeg" alt="img"></p><p>配置 book.json 的示例如下：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"前端入门和进阶图文教程"</span><span class="token punctuation">,</span>    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"前端入门到进阶图文教程，超详细的Web前端学习笔记。从零开始学前端，做一名精致优雅的前端工程师。公众号「千古壹号」作者。"</span><span class="token punctuation">,</span>    <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"千古壹号"</span><span class="token punctuation">,</span>    <span class="token property">"language"</span><span class="token operator">:</span> <span class="token string">"zh-hans"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook"</span><span class="token operator">:</span> <span class="token string">"3.2.3"</span><span class="token punctuation">,</span>    <span class="token property">"root"</span><span class="token operator">:</span> <span class="token string">"."</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>备注：上面的<code>root</code>根目录为当前目录，使用默认的就好，此项可以删掉，这里仅做演示。</p><p>2、<strong>pdf</strong> 的配置如下：（使用 <code>book.json</code> 中的一组选项来定制 PDF 输出）</p><p>| 配置项 | 描述 | | ----------------- | ------------------------------------------------------------ | | pdf.pageNumbers | 将页码添加到每个页面的底部（默认为 true） | | pdf.fontSize | 基本字体大小（默认是 12） | | pdf.fontFamily | 基本字体样式（默认是 Arial） | | pdf.paperSize | 页面尺寸，选项有： a0、a1、 a2、 a3、a4、a5、a6、b0、b1、b2、b3、b4、b5、b6、legal、letter （默认值是 a4） | | pdf.margin.top | 上边距（默认值是 56） | | pdf.margin.bottom | 下边距（默认值是 56） | | pdf.margin.left | 左边距（默认值是 62） | | pdf.margin.right | 右边距（默认值是 62） |</p><p>定制 PDF 文档输出格式的示例代码如下：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"pdf"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"pageNumbers"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"fontSize"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>        <span class="token property">"paperSize"</span><span class="token operator">:</span> <span class="token string">"a4"</span><span class="token punctuation">,</span>        <span class="token property">"margin"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"top"</span><span class="token operator">:</span> <span class="token number">36</span><span class="token punctuation">,</span>            <span class="token property">"bottom"</span><span class="token operator">:</span> <span class="token number">36</span><span class="token punctuation">,</span>            <span class="token property">"left"</span><span class="token operator">:</span> <span class="token number">62</span><span class="token punctuation">,</span>            <span class="token property">"right"</span><span class="token operator">:</span> <span class="token number">62</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>备注：如果你不需要对输出的 pdf 做任何特定的配置，则不需要添加上面的内容，让 pdf 的输出格式保持默认就好。</p><p>3、<strong>plugins</strong> 插件：</p><p>插件及其配置在 <code>book.json</code> 中指定，让电子书的配置能力更加强大。</p><p>通过插件，我们可以做很多事情，比如：修改页眉页脚、自动生成并显示图片的标题等。</p><p>另外，针对<strong>在线版</strong>的GitBook电子书，也有很多插件，这里列举几个：</p><ul><li>自带的search插件不支持中文搜索，使用起来非常不方便，还好<code>search-pro</code>插件横空出世，让搜索功能焕发出新的生机。插件地址：https://github.com/gitbook-plugins/gitbook-plugin-search-pro</li><li>默认侧边栏宽度是不能够调节的，如果想通过拖拽的方式自由调节侧边栏宽度，可以使用插件<code>splitter</code>。插件地址：https://github.com/yoshidax/gitbook-plugin-splitter</li><li>donate插件支持定义和显示支付宝和微信打赏。插件地址：<a target="_blank" rel="noopener" href="https://github.com/willin/gitbook-plugin-donate">http://github.com/willin/gitbook-plugin-donate</a></li></ul><p>关于插件的具体配置，感兴趣的同学可以自行研究下。</p><h3 id="自动生成目录（重要）">自动生成目录（重要）</h3><p>如果你的电子书素材里有很多 markdown 文件，那么，如何将多个 markdown 文件的文件名，在<code>SUMMARY.md</code>里快速生成对应的目录？</p><p>难道要一个一个地手动 copy 吗？这不可能。</p><p>说白了，这个需求就是：<strong>如何自动生成电子书的目录</strong>？改变世界的程序员用「脚本」就能搞定，一键执行。</p><p>网上有很多好用的脚本，我给你推荐一个亲测好用的脚本：</p><blockquote><p>GitBook 自动生成目录的脚本：https://github.com/fushenghua/gitbook-plugin-summary</p></blockquote><p>操作方法很简单，把上面这个链接中的项目下载下来，进入到这个项目的目录，执行 <code>$ python gitbook-plugin-summary.py dirPath</code> 即可自动生成电子书的目录，亲测有效。备注：这里的<code>dirPath</code>指的是你的电子书目录的绝对路径。</p><p>对了，在执行上面这个脚本之前，记得先安装 <code>Python</code> 环境。</p><h2 id="电子书用什么软件打开">电子书用什么软件打开</h2><h3 id="用什么软件打开-PDF">用什么软件打开 PDF</h3><p>Windows 平台：可以用「福昕阅读器」或者「Acrobat Reader DC」。「福昕阅读器」既有 Windows 平台，也有 Mac 平台。</p><p>Mac 平台：可以用自带的「预览」打开。</p><p>其实，不管你用的是 Windows 电脑还是 Mac 电脑，你都可以用 Chrome 浏览器打开 PDF。</p><p>iPhone 或 iPad平台：可以用自带的「iBooks」打开，或者用「WPS Office」打开。也可以用第三方软件「GoodReader」，不过需要 40 人民币。</p><p>Android 手机：可以用「WPS Office」等第三方办公软件打开。</p><h3 id="用什么软件阅读-ePub-电子书">用什么软件阅读 ePub 电子书</h3><p>Windows 平台：可以用「calibre」软件阅读 epub 电子书。</p><p>Mac &amp; iPhone &amp; iPad 平台：用自带的「iBooks」阅读即可。iBooks 可以非常方便地对电子书进行标注和搜索，无疑是体验最好的 ePub 电子书阅读软件。</p><p>Android 手机：可以用「多看阅读」App 来阅读 epub 格式电子书。</p><h3 id="用什么方式阅读-mobi-电子书">用什么方式阅读 mobi 电子书</h3><p>kindle 电子书有两种常见的电子书格式：「mobi」格式和「azw3」格式。</p><ul><li>针对 mobi 格式的电子书，你既可以通过邮件的形式将其发送到 kindle 阅读器（可以自行网上查一下相关教程），也可以将其拷贝到 kindle 阅读器（是连接 usb 进行拷贝）。</li><li>针对 azw3 格式的电子书，就只能通过拷贝的形式（是连接 usb 拷贝）传输到 kindle 阅读器。</li></ul><h3 id="小结">小结</h3><p>我在 2017 年 1 月写过一篇电子书科普的文章，快三年过去了，如今回过头来看，那篇文章一点也不过时，不妨看看：《<a href="https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/-FsT_GQtBQ0-q_ndO5X6sQ">电子书有哪些常见格式？以及该怎样阅读它</a>》</p><h2 id="最后一段-2">最后一段</h2><p>如果你一时半会儿找不到可用的素材来制作电子书，可以拿我的项目练练手。项目地址：</p><blockquote><p>https://github.com/qianguyihao/web</p></blockquote><p>不瞒你说，这篇文章，我在一年多以前就写好了初稿并放在了 GitHub 上，当时专门折腾过一次。</p><p>最近几天，我突然又有了制作电子书的需求。一年多过去了，我还以为有啥新的方法可以试试，然而我在网上找了一圈，好用的方法还是没变。所以，我今天整理一下发出来，希望让更多人看到。</p><p>其他的各种自制电子书的方法我都试过了，都不太好使，唯独 <strong>GitBook + calibre</strong> 是最佳选择，信我没错！</p><h2 id="参考链接-2">参考链接</h2><ul><li>GITBOOK 使用：https://kuang.netlify.app/blog/gitbook.htmlbook.html</li><li>GitBook 制作 Kindle 电子书详细教程：https://github.com/fushenghua/gitbook-plugin-summary/blob/master/gitbook-guide.md</li><li>gitbook-plugin-summary 工具（自动生成目录）：https://github.com/fushenghua/gitbook-plugin-summary</li><li>gitbook-plugin-atoc（自动生成目录的插件）：https://github.com/willin/gitbook-plugin-atoc</li><li>自动生成目录：https://github.com/mofhu/GitBook-auto-summary</li><li>使用 Gitbook 打造你的电子书：https://juejin.im/post/6844903793033740302</li><li>书籍《了不起的 Markdown》的第 8 章：自由地写作——GitBook</li><li>gitbook 的 book.json 配置示例：https://blog.ujwd.cn/archives/349</li><li>关于更加详细的 book.json 文件配置：https://zhousiwei.gitee.io/mybook/notes/gitbook_config.html</li><li>GitBook 简明使用教程：https://www.phpjieshuo.com/archives/153/</li><li>gitbook 入门教程之导出电子书：https://juejin.im/post/5caa0fb46fb9a05e5a2e53b3</li><li>GitBook 插件整理 - book.json 配置：https://www.cnblogs.com/mingyue5826/p/10307051.html</li><li>如何把 Markdown 文件批量转换为 PDF（不好用）：https://sspai.com/post/47110</li><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/245763905">自己动手制作电子书的最佳方式</a></li></ul><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="gitbook" scheme="https://blog.17lai.site/categories/gitbook/"/>
    
    
    <category term="docker" scheme="https://blog.17lai.site/tags/docker/"/>
    
    <category term="gitbook" scheme="https://blog.17lai.site/tags/gitbook/"/>
    
    <category term="git" scheme="https://blog.17lai.site/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>CI/CD与Git Flow与GitLab</title>
    <link href="https://blog.17lai.site/posts/1879721e/"/>
    <id>https://blog.17lai.site/posts/1879721e/</id>
    <published>2021-11-01T11:25:00.000Z</published>
    <updated>2022-03-16T10:52:12.343Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>CI/CD + Git Flow + GitLab 的整体工作流程记录。主要介绍一下 GitLab CI 相关功能，并通过 GitLab CI 实现自动化构建项目。项目中所用的示例项目已经上传到了 <a target="_blank" rel="noopener" href="https://github.com/mritd/GitLabCI-TestProject">GitHub</a></p></blockquote><h3 id="一、Git-Flow-简介">一、Git Flow 简介</h3><p>Git Flow 定义了一个围绕项目开发发布的严格 git 分支模型，用于管理多人协作的大型项目中实现高效的协作开发；Git Flow 分支模型最早起源于 <a target="_blank" rel="noopener" href="http://nvie.com/about/">Vincent Driessen</a> 的 <a target="_blank" rel="noopener" href="http://nvie.com/posts/a-successful-git-branching-model/">A successful Git branching model</a> 文章；随着时间发展，Git Flow 大致分为三种:</p><ul><li>Git Flow: 最原始的 Git Flow 分支模型</li><li>Github Flow: Git Flow 的简化版，专门配合持续发布</li><li>GitLab Flow: Git Flow 与 Github Flow 的结合版</li></ul><p>关于三种 Git Flow 区别详情可参考 <a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2015/12/git-workflow.html">Git 工作流程</a></p><h3 id="二、-Git-Flow-流程">二、 Git Flow 流程</h3><p>Github Flow 和 GitLab Flow 对于持续发布支持比较好，但是原始版本的 Git Flow 对于传统的按照版本发布更加友好一些，所以以下主要说明以下 Git Flow 的工作流程；Git Flow 主要分支模型如下</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220215.jpg" alt="git flow"></p><p>在整个分支模型中 <strong>存在两个长期分支: develop 和 master</strong>，其中 develop 分支为开发分支，master 为生产分支；<strong>master 代码始终保持随时可以部署到线上的状态；develop 分支用于合并最新提交的功能性代码</strong>；具体的分支定义如下</p><ul><li>master: 生产代码，始终保持可以直接部署生产的状态</li><li>develop: 开发分支，每次合并最新功能代码到此分支</li><li>feature: 新功能分支，所有新开发的功能将采用 <code>feature/xxxx</code> 形式命名分支</li><li>hotfixes: 紧急修复补丁分支，当新功能部署到了线上出现了严重 bug 需要紧急修复时，则创建 <code>hotfixes/xxxx</code> 形式命名的分支</li><li>release: 稳定版分支，当完成大版本变动后，应该创建 <code>release/xxxx</code> 分支</li></ul><p>在整个分支模型中，develop 分支为最上游分支，会不断有新的 feature 合并入 develop 分支，当功能开发达到完成所有版本需求时，则从 develop 分支创建 release 分支，release 后如没有发现其他问题，最终 release 会被合并到 master 分支以完成线上部署</p><h3 id="三、Git-Flow-工具">三、Git Flow 工具</h3><p>针对于 Git Flow，其手动操作 git 命令可能过于繁琐，所以后来有了 git-flow 工具；git-flow 是一个 git 扩展集，按 Vincent Driessen 的分支模型提供高层次的库操作；使用 git-flow 工具可以以更加简单的命令完成对 Vincent Driessen 分支模型的实践；<br>git-flow 安装以及使用具体请参考 <a target="_blank" rel="noopener" href="https://danielkummer.github.io/git-flow-cheatsheet/index.zh_CN.html">git-flow 备忘清单</a>，该文章详细描述了 git-flow 工具的使用方式</p><p>还有另一个工具是 <a target="_blank" rel="noopener" href="https://github.com/tj/git-extras">git-extras</a>，该工具没有 git-flow 那么简单化，不过其提供更加强大的命令支持</p><h3 id="四、Git-Commit-Message">四、Git Commit Message</h3><p>在整个 Git Flow 中，commit message 也是必不可少的一部分；一个良好且统一的 commit message 有助于代码审计以及 review 等；目前使用最广泛的写法是 <a target="_blank" rel="noopener" href="https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit#heading=h.greljkmo14y0">Angular 社区规范</a>，该规范大中 commit message 格式大致如下:</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>(<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>): <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>subject</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BLANK</span> <span class="token attr-name">LINE</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BLANK</span> <span class="token attr-name">LINE</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">&gt;</span></span>Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>总体格式大致分为 3 部分，首行主要 3 个组成部分:</p><ul><li>type: 本次提交类型</li><li>scope: 本次提交影响范围，一般标明影响版本号或者具体的范围如 <code>$browser, $compile, $rootScope, ngHref, ngClick, ngView, etc...</code></li><li>subject: 本次提交简短说明</li></ul><p>关于 type 提交类型，有如下几种值:</p><ul><li>feat：新功能(feature)</li><li>fix：修补 bug</li><li>docs：文档(documentation)</li><li>style： 格式(不影响代码运行的变动)</li><li>refactor：重构(即不是新增功能，也不是修改 bug 的代码变动)</li><li>test：增加测试</li><li>chore：构建过程或辅助工具的变动</li></ul><p>中间的 body 部分是对本次提交的详细描述信息，底部的 footer 部分一般分为两种情况:</p><ul><li>不兼容变动: 如果出现不兼容变动，则以 <code>BREAKING CHANGE:</code> 开头，后面跟上不兼容变动的具体描述和解决办法</li><li>关闭 issue: 如果该 commit 针对某个 issue，并且可以将其关闭，则可以在其中指定关闭的 issue，如 <code>Close #9527,#9528</code></li></ul><p>不过 footer 部分也有特殊情况，如回滚某次提交，则以 <code>revert:</code> 开头，后面紧跟 commit 信息和具体描述；还有时某些 commit 只是解决了 某个 issue 的一部分问题，这是可以使用 <code>refs ISSUE</code> 的方式来引用该 issue</p><h3 id="五、Git-Commit-Message-工具">五、Git Commit Message 工具</h3><p>针对 Git 的 commit message 目前已经有了成熟的生成工具，比较有名的为 <a target="_blank" rel="noopener" href="https://github.com/commitizen/cz-cli">commitizen-cli</a> 工具，其采用 node.js 编写，执行 <code>git cz</code> 命令能够自动生成符合 Angular 社区规范的 commit message；不过由于其使用 node.js 编写，所以安装前需要安装 node.js，因此可能不适合其他非 node.js 的项目使用；这里推荐一个基于 shell 编写的 <a target="_blank" rel="noopener" href="https://cimhealth.github.io/git-toolkit">Git-toolkit</a>，安装此工具后执行 <code>git ci</code> 命令进行提交将会产生交互式生成 Angular git commit message 格式的提交说明，截图如下:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220233.jpg" alt="git ci"></p><h3 id="六、GitLab-整合">六、GitLab 整合</h3><p>以上 Git Flow 所有操作介绍的都是在本地操作，而正常我们在工作中都是基于 GitLab 搭建私有 Git 仓库来进行协同开发的，以下简述以下 Git Flow 配合 GitLab 的流程</p><h4 id="6-1、开发-features">6.1、开发 features</h4><p>当开发一个新功能时流程如下:</p><ul><li>本地 <code>git flow feature start xxxx</code> 开启一个 feature 新分支</li><li><code>git flow feature publish xxxx</code> 将此分支推送到远端以便他人获取</li><li>完成开发后 GitLab 上向 <code>develop</code> 分支发起合并请求</li><li>CI sonar 等质量检测工具扫描，其他用户 review 代码</li><li>确认无误后 <code>master</code> 权限用户合并其到 <code>develop</code> 分支</li><li>部署到测试环境以便测试组测试</li><li>如果测试不通过，则继续基于此分支开发，直到该功能开发完成</li></ul><h4 id="6-2、创建-release">6.2、创建 release</h4><p>当一定量的 feature 开发完成并合并到 develop 后，如所有 feature 都测试通过并满足版本需求，则可以创建 release 版本分支；release 分支流程如下</p><ul><li>本地 <code>git flow release start xxxx</code> 开启 release 分支</li><li><code>git flow release publish xxxx</code> 将其推送到远端以便他人获取</li><li>继续进行完整性测试，出现问题继续修复，直到 release 完全稳定</li><li>从 release 分支向 master、develop 分支分别发起合并请求</li><li>master 合并后创建对应的 release 标签，并部署生产环境</li><li>develop 合并 release 的后期修改</li></ul><h4 id="6-3、紧急修复">6.3、紧急修复</h4><p>当 master 某个 tag 部署到生产环境后，也可能出现不符合预期的问题出现；此时应该基于 master 创建 hotfix 分支进行修复，流程如下</p><ul><li>本地 <code>git flow hotfix start xxxx</code> 创建紧急修复分支</li><li>修改代码后将其推送到远端，并像 master、develop 分支发起合并</li><li>develop 合并紧急修复补丁，如果必要最好再做一下测试</li><li>master 合并紧急修复补丁，创建紧急修复 tag，并部署生产环境</li></ul><h3 id="七、环境准备">七、环境准备</h3><p>首先需要有一台 GitLab 服务器，然后需要有个项目；这里示例项目以 Spring Boot 项目为例，然后最好有一台专门用来 Build 的机器，实际生产中如果 Build 任务不频繁可适当用一些业务机器进行 Build；本文示例所有组件将采用 Docker 启动， GitLab HA 等不在本文阐述范围内</p><ul><li>Docker Version : 1.13.1</li><li>GitLab Version : 10.1.4-ce.0</li><li>GitLab Runner Version : 10.1.0</li><li>GitLab IP : 172.16.0.37</li><li>GitLab Runner IP : 172.16.0.36</li></ul><h3 id="八、GitLab-CI-简介">八、GitLab CI 简介</h3><p>GitLab CI 是 GitLab 默认集成的 CI 功能，GitLab CI 通过在项目内 <code>.gitlab-ci.yaml</code> 配置文件读取 CI 任务并进行相应处理；GitLab CI 通过其称为 GitLab Runner 的 Agent 端进行 build 操作；Runner 本身可以使用多种方式安装，比如使用 Docker 镜像启动等；Runner 在进行 build 操作时也可以选择多种 build 环境提供者；比如直接在 Runner 所在宿主机 build、通过新创建虚拟机(vmware、virtualbox)进行 build等；同时 Runner 支持 Docker 作为 build 提供者，即每次 build 新启动容器进行 build；GitLab CI 其大致架构如下</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220236.png" alt="GitLab"></p><h3 id="九、搭建-GitLab-服务器">九、搭建 GitLab 服务器</h3><h4 id="9-1、GitLab-搭建">9.1、GitLab 搭建</h4><p>GitLab 搭建这里直接使用 docker compose 启动，compose 配置如下</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">gitlab</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">'gitlab/gitlab-ce:10.1.4-ce.0'</span>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> gitlab    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> <span class="token string">'git.mritd.me'</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">GITLAB_OMNIBUS_CONFIG</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">        external_url 'http://git.mritd.me'        # Add any other gitlab.rb configuration here, each on its own line</span>    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">'80:80'</span>      <span class="token punctuation">-</span> <span class="token string">'443:443'</span>      <span class="token punctuation">-</span> <span class="token string">'8022:22'</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">'./data/gitlab/config:/etc/gitlab'</span>      <span class="token punctuation">-</span> <span class="token string">'./data/gitlab/logs:/var/log/gitlab'</span>      <span class="token punctuation">-</span> './data/gitlab/data<span class="token punctuation">:</span>/var/opt/gitlab'Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>直接启动后，首次登陆需要设置初始密码如下，默认用户为 <code>root</code></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220240.png" alt="gitkab init"></p><p>登陆成功后创建一个用户(该用户最好给予 Admin 权限，以后操作以该用户为例)，并且创建一个测试 Group 和 Project，如下所示</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220427.png" alt="Create User"></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220432.png" alt="Test Project"></p><h4 id="9-2、增加示例项目">9.2、增加示例项目</h4><p>这里示例项目采用 Java 的 SpringBoot 项目，并采用 Gradle 构建，其他语言原理一样；<strong>如果不熟悉 Java 的没必要死磕此步配置，任意语言(最好 Java)整一个能用的 Web 项目就行，并不强求一定 Java 并且使用 Gradle 构建，以下只是一个样例项目</strong>；SpringBoot 可以采用 <a target="_blank" rel="noopener" href="https://start.spring.io/">Spring Initializr</a> 直接生成(依赖要加入 WEB)，如下所示</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220246.png" alt="Spring Initializr"></p><p>将项目导入 IDEA，然后创建一个 index 示例页面，主要修改如下</p><ul><li>build.gradle</li></ul><pre class="line-numbers language-jade" data-language="jade"><code class="language-jade">buildscript {    ext {        springBootVersion = '1.5.8.RELEASE'    }    repositories {        mavenCentral()    }    dependencies {        classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")    }}apply plugin: 'java'apply plugin: 'eclipse'apply plugin: 'idea'apply plugin: 'org.springframework.boot'group = 'me.mritd'version = '0.0.1-SNAPSHOT'sourceCompatibility = 1.8repositories {    mavenCentral()}dependencies {    compile('org.springframework.boot:spring-boot-starter')    compile('org.springframework.boot:spring-boot-starter-web')    compile('org.springframework.boot:spring-boot-starter-thymeleaf')    testCompile('org.springframework.boot:spring-boot-starter-test')}Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>新建一个 HomeController</li></ul><pre class="line-numbers language-jade" data-language="jade"><code class="language-jade">package me.mritd.TestProject;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping;/******************************************************************************* * Copyright (c) 2005-2017 Mritd, Inc. * TestProject * me.mritd.TestProject * Created by mritd on 2017/11/24 下午12:23. * Description:  *******************************************************************************/@Controllerpublic class HomeController {    @RequestMapping("/")    public String home(){        return "index";    }}Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>templates 下新建 index.html</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Test...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后项目整体结构如下</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220249.png" alt="TestProject"></p><p>执行 <code>assemble</code> Task 打包出可执行 jar 包，并运行 <code>java -jar TestProject-0.0.1-SNAPSHOT.jar</code> 测试下能启动访问页面即可</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220251.png" alt="TestProject assemble"></p><p>最后将项目提交到 GitLab 后如下</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220304.png" alt="init Project"></p><h3 id="十、GitLab-CI-配置">十、GitLab CI 配置</h3><blockquote><p>针对这一章节创建基础镜像以及项目镜像，这里仅以 Java 项目为例；其他语言原理相通，按照其他语言对应的运行环境修改即可</p></blockquote><h4 id="10-1、增加-Runner">10.1、增加 Runner</h4><p>GitLab CI 在进行构建时会将任务下发给 Runner，让 Runner 去执行；所以先要添加一个 Runner，Runner 这里采用 Docker Compose 启动，build 方式也使用 Docker 方式 Build；compose 文件如下</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">gitlab-runner</span><span class="token punctuation">:</span>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> gitlab<span class="token punctuation">-</span>runner    <span class="token key atrule">image</span><span class="token punctuation">:</span> gitlab/gitlab<span class="token punctuation">-</span>runner<span class="token punctuation">:</span>alpine<span class="token punctuation">-</span>v10.1.0    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">"host"</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> /var/run/docker.sock<span class="token punctuation">:</span>/var/run/docker.sock      <span class="token punctuation">-</span> ./config.toml<span class="token punctuation">:</span>/etc/gitlab<span class="token punctuation">-</span>runner/config.toml    <span class="token key atrule">extra_hosts</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> "git.mritd.me<span class="token punctuation">:</span>172.16.0.37"Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>在启动前，我们需要先 touch 一下这个 config.toml 配置文件</strong>；该文件是 Runner 的运行配置，此后 Runner 所有配置都会写入这个文件(不 touch 出来 docker-compose 发现不存在会挂载一个目录进去，导致 Runner 启动失败)；启动 docker-compose 后，<strong>需要进入容器执行注册，让 Runner 主动去连接 GitLab 服务器</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 生成 Runner 配置文件</span><span class="token function">touch</span> config.toml<span class="token comment"># 启动 Runner</span><span class="token function">docker-compose</span> up -d<span class="token comment"># 激活 Runner</span><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it gitlab-runner gitlab-runner registerCopy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在执行上一条激活命令后，会按照提示让你输入一些信息；<strong>首先输入 GitLab 地址，然后是 Runner Token，Runner Token 可以从 GitLab 设置中查看</strong>，如下所示</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220624.png" alt="Runner Token"></p><p>整体注册流程如下</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220312.png" alt="Runner registry"></p><p>注册完成后，在 GitLab Runner 设置中就可以看到刚刚注册的 Runner，如下所示</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220628.png" alt="Runner List"></p><p><strong>Runner 注册成功后会将配置写入到 config.toml 配置文件；由于两个测试宿主机都没有配置内网 DNS，所以为了保证 runner 在使用 docker build 时能正确的找到 GitLab 仓库地址，还需要增加一个 docker 的 host 映射( <code>extra_hosts</code> )；同时为了能调用 宿主机 Docker 和持久化 build 的一些缓存还挂载了一些文件和目录；完整的 配置如下(配置文件可以做一些更高级的配置，具体参考 <a target="_blank" rel="noopener" href="https://docs.gitlab.com/runner/configuration/advanced-configuration.html">官方文档</a> )</strong></p><ul><li>config.toml</li></ul><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token key property">concurrent</span> <span class="token punctuation">=</span> <span class="token number">1</span><span class="token key property">check_interval</span> <span class="token punctuation">=</span> <span class="token number">0</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">runners</span><span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"Test Runner"</span>  <span class="token key property">url</span> <span class="token punctuation">=</span> <span class="token string">"http://git.mritd.me"</span>  <span class="token key property">token</span> <span class="token punctuation">=</span> <span class="token string">"c279ec1ac08aec98c7141c7cf2d474"</span>  <span class="token key property">executor</span> <span class="token punctuation">=</span> <span class="token string">"docker"</span>  <span class="token key property">builds_dir</span> <span class="token punctuation">=</span> <span class="token string">"/gitlab/runner-builds"</span>  <span class="token key property">cache_dir</span> <span class="token punctuation">=</span> <span class="token string">"/gitlab/runner-cache"</span>  <span class="token punctuation">[</span><span class="token table class-name">runners.docker</span><span class="token punctuation">]</span>    <span class="token key property">tls_verify</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>    <span class="token key property">image</span> <span class="token punctuation">=</span> <span class="token string">"debian"</span>    <span class="token key property">privileged</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>    <span class="token key property">disable_cache</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>    <span class="token key property">shm_size</span> <span class="token punctuation">=</span> <span class="token number">0</span>    <span class="token key property">volumes</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"/data/gitlab-runner:/gitlab"</span><span class="token punctuation">,</span><span class="token string">"/var/run/docker.sock:/var/run/docker.sock"</span><span class="token punctuation">,</span><span class="token string">"/data/maven_repo:/data/repo"</span><span class="token punctuation">,</span><span class="token string">"/data/maven_repo:/data/maven"</span><span class="token punctuation">,</span><span class="token string">"/data/gradle:/data/gradle"</span><span class="token punctuation">,</span><span class="token string">"/data/sonar_cache:/root/.sonar"</span><span class="token punctuation">,</span><span class="token string">"/data/androidsdk:/usr/local/android"</span><span class="token punctuation">,</span><span class="token string">"/data/node_modules:/data/node_modules"</span><span class="token punctuation">]</span>    <span class="token key property">extra_hosts</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"git.mritd.me:172.16.0.37"</span><span class="token punctuation">]</span>  <span class="token punctuation">[</span><span class="token table class-name">runners.cache</span><span class="token punctuation">]</span>Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>注意，这里声明的 Volumes 会在每个运行的容器中都生效；也就是说 build 时新开启的每个容器都会被挂载这些目录</strong>；修改完成后重启 runner 容器即可，由于 runner 中没啥可保存的东西，所以可以直接 <code>docker-compose down &amp;&amp; docker-compose up -d</code> 重启</p><h4 id="10-2、创建基础镜像">10.2、创建基础镜像</h4><p>由于示例项目是一个 Java 项目，而且是采用 Spring Boot 的，所以该项目想要运行起来只需要一个 java 环境即可，中间件已经被打包到了 jar 包中；以下是一个作为基础运行环境的 openjdk 镜像的 Dockerfile</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">FROM alpine:edge LABEL maintainer="mritd &lt;mritd1234@gmail.com&gt;"ENV JAVA_HOME /usr/lib/jvm/java-1.8-openjdkENV PATH $PATH:/usr/lib/jvm/java-1.8-openjdk/jre/bin:/usr/lib/jvm/java-1.8-openjdk/binRUN apk add --update bash curl tar wget ca-certificates unzip \        openjdk8 font-adobe-100dpi ttf-dejavu fontconfig \    &amp;&amp; rm -rf /var/cache/apk/* \CMD ["bash"]Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>这个 openjdk Dockerfile 升级到了 8.151 版本，并且集成了一些字体相关的软件，以解决在 Java 中某些验证码库无法运行问题，详见 <a target="_blank" rel="noopener" href="https://mritd.me/2017/09/27/alpine-3.6-openjdk-8-bug/">Alpine 3.6 OpenJDK 8 Bug</a></strong>；使用这个 Dockerfile，在当前目录执行 <code>docker build -t mritd/openjdk:8 .</code> build 一个 openjdk8 的基础镜像，然后将其推送到私服，或者 Docker Hub 即可</p><h4 id="10-3、创建项目镜像">10.3、创建项目镜像</h4><p>有了基本的 openjdk 的 docker 镜像后，针对于项目每次 build 都应该生成一个包含发布物的 docker 镜像，所以对于项目来说还需要一个项目本身的 Dockerfile；<strong>项目的 Dockerfile 有两种使用方式；一种是动态生成 Dockerfile，然后每次使用新生成的 Dockerfile 去 build；还有一种是写一个通用的 Dockerfile，build 时利用 ARG 参数传入变量</strong>；这里采用第二种方式，以下为一个可以反复使用的 Dockerfile</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">FROM mritd/openjdk:8-144-01MAINTAINER mritd &lt;mritd1234@gmail.com&gt;ARG PROJECT_BUILD_FINALNAMEENV TZ 'Asia/Shanghai'ENV PROJECT_BUILD_FINALNAME ${PROJECT_BUILD_FINALNAME}COPY build/libs/${PROJECT_BUILD_FINALNAME}.jar /${PROJECT_BUILD_FINALNAME}.jarCMD ["bash","-c","java -jar /${PROJECT_BUILD_FINALNAME}.jar"]Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>该 Dockerfile 通过声明一个 <code>PROJECT_BUILD_FINALNAME</code> 变量来表示项目的发布物名称；然后将其复制到根目录下，最终利用 java 执行这个 jar 包；所以每次 build 之前只要能拿到项目发布物的名称即可</strong></p><h4 id="10-4、Gradle-修改">10.4、Gradle 修改</h4><p>上面已经创建了一个标准的通用型 Dockerfile，每次 build 镜像只要传入 <code>PROJECT_BUILD_FINALNAME</code> 这个最终发布物名称即可；对于发布物名称来说，最好不要固定死；当然不论是 Java 还是其他语言的项目我们都能将最终发布物变成一个固定名字，最不济可以写脚本重命名一下；但是不建议那么干，最好保留版本号信息，以便于异常情况下进入容器能够分辨；对于当前 Java 项目来说，想要拿到 <code>PROJECT_BUILD_FINALNAME</code> 很简单，我们只需要略微修改一下 Gradle 的 build 脚本，让其每次打包 jar 包时将项目的名称及版本号导出到文件中即可；同时这里也加入了镜像版本号的处理，Gradle 脚本修改如下</p><ul><li>build.gradle 最后面增加如下</li></ul><pre class="line-numbers language-jade" data-language="jade"><code class="language-jade">bootRepackage {    mainClass = 'me.mritd.TestProject.TestProjectApplication'    executable = true    doLast {        File envFile = new File("build/tmp/PROJECT_ENV")        println("Create ${archivesBaseName} ENV File ===&gt; " + envFile.createNewFile())        println("Export ${archivesBaseName} Build Version ===&gt; ${version}")        envFile.write("export PROJECT_BUILD_FINALNAME=${archivesBaseName}-${version}\n")        println("Generate Docker image tag...")        envFile.append("export BUILD_DATE=`date +%Y%m%d%H%M%S`\n")        envFile.append("export IMAGE_NAME=mritd/test:`echo \${CI_BUILD_REF_NAME} | tr '/' '-'`-`echo \${CI_COMMIT_SHA} | cut -c1-8`-\${BUILD_DATE}\n")        envFile.append("export LATEST_IMAGE_NAME=mritd/test:latest\n")    }}Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>这一步操作实际上是修改了 <code>bootRepackage</code> 这个 Task(不了解 Gradle 或者不是 Java 项目的请忽略)，在其结束后创建了一个叫 <code>PROJECT_ENV</code> 的文件，里面实际上就是写入了一些 bash 环境变量声明，以方便后面 source 一下这个文件拿到一些变量，然后用户 build 镜像使用</strong>，<code>PROJECT_ENV</code> 最终生成如下</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">PROJECT_BUILD_FINALNAME</span><span class="token operator">=</span>TestProject-0.0.1-SNAPSHOT<span class="token builtin class-name">export</span> <span class="token assign-left variable">BUILD_DATE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">`</span></span><span class="token builtin class-name">export</span> <span class="token assign-left variable">IMAGE_NAME</span><span class="token operator">=</span>mritd/test:<span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $<span class="token punctuation">{</span>CI_BUILD_REF_NAME<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">'/'</span> <span class="token string">'-'</span><span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $<span class="token punctuation">{</span>CI_COMMIT_SHA<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token function">cut</span> -c1-8<span class="token variable">`</span></span>-<span class="token variable">${BUILD_DATE}</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">LATEST_IMAGE_NAME</span><span class="token operator">=</span>mritd/test:latestCopy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220738.png" alt="PROJECT_ENV"></p><h4 id="10-5、创建-CI-配置文件">10.5、创建 CI 配置文件</h4><p>一切准备就绪以后，就可以编写 CI 脚本了；GitLab 依靠读取项目根目录下的 <code>.gitlab-ci.yml</code> 文件来执行相应的 CI 操作；以下为测试项目的 <code>.gitlab-ci.yml</code> 配置</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 调试开启</span><span class="token comment">#before_script:</span><span class="token comment">#  - pwd</span><span class="token comment">#  - env</span><span class="token key atrule">cache</span><span class="token punctuation">:</span>  <span class="token key atrule">key</span><span class="token punctuation">:</span> $CI_PROJECT_NAME/$CI_COMMIT_REF_NAME<span class="token punctuation">-</span>$CI_COMMIT_SHA  <span class="token key atrule">paths</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> build<span class="token key atrule">stages</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> build  <span class="token punctuation">-</span> deploy<span class="token key atrule">auto-build</span><span class="token punctuation">:</span>  <span class="token key atrule">image</span><span class="token punctuation">:</span> mritd/build<span class="token punctuation">:</span>2.1.1  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build  <span class="token key atrule">script</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> gradle <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>daemon clean assemble  <span class="token key atrule">tags</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> test<span class="token key atrule">deploy</span><span class="token punctuation">:</span>  <span class="token key atrule">image</span><span class="token punctuation">:</span> mritd/docker<span class="token punctuation">-</span>kubectl<span class="token punctuation">:</span>v1.7.4  <span class="token key atrule">stage</span><span class="token punctuation">:</span> deploy  <span class="token key atrule">script</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> source build/tmp/PROJECT_ENV    <span class="token punctuation">-</span> echo "Build Docker Image ==<span class="token punctuation">&gt;</span> $<span class="token punctuation">{</span>IMAGE_NAME<span class="token punctuation">}</span>"    <span class="token punctuation">-</span> docker build <span class="token punctuation">-</span>t $<span class="token punctuation">{</span>IMAGE_NAME<span class="token punctuation">}</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>build<span class="token punctuation">-</span>arg PROJECT_BUILD_FINALNAME=$<span class="token punctuation">{</span>PROJECT_BUILD_FINALNAME<span class="token punctuation">}</span> .<span class="token comment">#    - docker push ${IMAGE_NAME}</span>    <span class="token punctuation">-</span> docker tag $<span class="token punctuation">{</span>IMAGE_NAME<span class="token punctuation">}</span> $<span class="token punctuation">{</span>LATEST_IMAGE_NAME<span class="token punctuation">}</span><span class="token comment">#    - docker push ${LATEST_IMAGE_NAME}</span><span class="token comment">#    - docker rmi ${IMAGE_NAME} ${LATEST_IMAGE_NAME}</span><span class="token comment">#    - kubectl --kubeconfig ${KUBE_CONFIG} set image deployment/test test=$IMAGE_NAME</span>  <span class="token key atrule">tags</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> test  <span class="token key atrule">only</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> master    <span class="token punctuation">-</span> develop    <span class="token punctuation">-</span> /^chore.<span class="token important">*$/Copy</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>关于 CI 配置的一些简要说明如下</strong></li></ul><h5 id="stages">stages</h5><p>stages 字段定义了整个 CI 一共有哪些阶段流程，以上的 CI 配置中，定义了该项目的 CI 总共分为 <code>build</code>、<code>deploy</code> 两个阶段；GitLab CI 会根据其顺序执行对应阶段下的所有任务；<strong>在正常生产环境流程可以定义很多个，比如可以有 <code>test</code>、<code>publish</code>，甚至可能有代码扫描的 <code>sonar</code> 阶段等；这些阶段没有任何限制，完全是自定义的</strong>，上面的阶段定义好后在 CI 中表现如下图</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220327.png" alt="stages"></p><h5 id="task">task</h5><p>task 隶属于 stages 之下；也就是说一个阶段可以有多个任务，任务执行顺序默认不指定会并发执行；对于上面的 CI 配置来说 <code>auto-build</code> 和 <code>deploy</code> 都是 task，他们通过 <code>stage: xxxx</code> 这个标签来指定他们隶属于哪个 stage；当 Runner 使用 Docker 作为 build 提供者时，我们可以在 task 的 <code>image</code> 标签下声明该 task 要使用哪个镜像运行，不指定则默认为 Runner 注册时的镜像(这里是 debian)；<strong>同时 task 还有一个 <code>tags</code> 的标签，该标签指明了这个任务将可以在哪些 Runner 上运行；这个标签可以从 Runner 页面看到，实际上就是 Runner 注册时输入的哪个 tag；对于某些特殊的项目，比如 IOS 项目，则必须在特定机器上执行，所以此时指定 tags 标签很有用</strong>，当 task 运行后如下图所示</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101221014.png" alt="Task"></p><p>除此之外 task 还能指定 <code>only</code> 标签用于限定那些分支才能触发这个 task，如果分支名字不满足则不会触发；<strong>默认情况下，这些 task 都是自动执行的，如果感觉某些任务太过危险，则可以通过增加 <code>when: manual</code> 改为手动执行；注意: 手动执行被 GitLab 认为是高权限的写操作，所以只有项目管理员才能手动运行一个 task，直白的说就是管理员才能点击</strong>；手动执行如下图所示</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220759.png" alt="manual task"></p><h5 id="cache">cache</h5><p>cache 这个参数用于定义全局那些文件将被 cache；<strong>在 GitLab CI 中，跨 stage 是不能保存东西的；也就是说在第一步 build 的操作生成的 jar 包，到第二部打包 docker image 时就会被删除；GitLab 会保证每个 stage 中任务在执行时都将工作目录(Docker 容器 中)还原到跟 GitLab 代码仓库中一模一样，多余文件及变更都会被删除</strong>；正常情况下，第一步 build 生成 jar 包应当立即推送到 nexus 私服；但是这里测试没有搭建，所以只能放到本地；但是放到本地下一个 task 就会删除它，所以利用 <code>cache</code> 这个参数将 <code>build</code> 目录 cache 住，保证其跨 stage 也能存在</p><p><strong>关于 <code>.gitlab-ci.yml</code> 具体配置更完整的请参考 <a target="_blank" rel="noopener" href="https://docs.gitlab.com/ee/ci/yaml/">官方文档</a></strong></p><h3 id="十一、其他相关">十一、其他相关</h3><h4 id="11-1、GitLab-内置环境变量">11.1、GitLab 内置环境变量</h4><p>上面已经基本搞定了一个项目的 CI，但是有些变量可能并未说清楚；比如在创建的 <code>PROJECT_ENV</code> 文件中引用了 <code>${CI_COMMIT_SHA}</code> 变量；这种变量其实是 GitLab CI 的内置隐藏变量，这些变量在每次 CI 调用 Runner 运行某个任务时都会传递到对应的 Runner 的执行环境中；<strong>也就是说这些变量在每次的任务容器 SHELL 环境中都会存在，可以直接引用</strong>，具体的完整环境变量列表可以从 <a target="_blank" rel="noopener" href="https://docs.gitlab.com/ee/ci/variables/">官方文档</a> 中获取；如果想知道环境变量具体的值，实际上可以通过在任务执行前用 <code>env</code> 指令打印出来，如下所示</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220338.png" alt="env"></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220800.png" alt="env task"></p><h4 id="11-2、GitLab-自定义环境变量">11.2、GitLab 自定义环境变量</h4><p>在某些情况下，我们希望 CI 能自动的发布或者修改一些东西；比如将 jar 包上传到 nexus、将 docker 镜像 push 到私服；这些动作往往需要一个高权限或者说有可写入对应仓库权限的账户来支持，但是这些账户又不想写到项目的 CI 配置里；因为这样很不安全，谁都能看到；此时我们可以将这些敏感变量写入到 GitLab 自定义环境变量中，GitLab 会像对待内置变量一样将其传送到 Runner 端，以供我们使用；GitLab 中自定义的环境变量可以有两种，一种是项目级别的，只能够在当前项目使用，如下</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220803.png" alt="project env"></p><p>另一种是组级别的，可以在整个组内的所有项目中使用，如下</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220805.png" alt="group env"></p><p>这两种变量添加后都可以在 CI 的脚本中直接引用</p><h4 id="11-3、Kubernetes-集成">11.3、Kubernetes 集成</h4><p>对于 Kubernetes 集成实际上有两种方案，一种是对接 Kubernetes 的 api，纯代码实现；另一种取巧的方案是调用 kubectl 工具，用 kubectl 工具来实现滚动升级；这里采用后一种取巧的方式，将 kubectl 二进制文件封装到镜像中，然后在 deploy 阶段使用这个镜像直接部署就可以</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101220345.png" alt="kubectl"></p><p>其中 <code>mritd/docker-kubectl:v1.7.4</code> 这个镜像的 Dockerfile 如下</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">FROM docker:dind LABEL maintainer="mritd &lt;mritd1234@gmail.com&gt;"ARG TZ="Asia/Shanghai"ENV TZ ${TZ}ENV KUBE_VERSION v1.8.0RUN apk upgrade --update \    &amp;&amp; apk add bash tzdata wget ca-certificates \    &amp;&amp; wget https://storage.googleapis.com/kubernetes-release/release/${KUBE_VERSION}/bin/linux/amd64/kubectl -O /usr/local/bin/kubectl \    &amp;&amp; chmod +x /usr/local/bin/kubectl \    &amp;&amp; ln -sf /usr/share/zoneinfo/${TZ} /etc/localtime \    &amp;&amp; echo ${TZ} &gt; /etc/timezone \    &amp;&amp; rm -rf /var/cache/apk/*CMD ["/bin/bash"]Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里面的 <code>${KUBE_CONFIG}</code> 是一个自定义的环境变量，对于测试环境我将配置文件直接挂载入了容器中，然后 <code>${KUBE_CONFIG}</code> 只是指定了一个配置文件位置，实际生产环境中可以选择将配置文件变成自定义环境变量使用</p><h4 id="11-4、GitLab-CI-总结">11.4、GitLab CI 总结</h4><p>关于 GitLab CI 上面已经讲了很多，但是并不全面，也不算太细致；因为这东西说起来实际太多了，现在目测已经 1W 多字了；以下总结一下 GitLab CI 的总体思想，当思路清晰了以后，我想后面的只是查查文档自己试一试就行了</p><ul><li><strong>CS 架构</strong></li></ul><p>GitLab 作为 Server 端，控制 Runner 端执行一系列的 CI 任务；代码 clone 等无需关心，GitLab 会自动处理好一切；Runner 每次都会启动新的容器执行 CI 任务</p><ul><li><strong>容器即环境</strong></li></ul><p>在 Runner 使用 Docker build 的前提下；<strong>所有依赖切换、环境切换应当由切换不同镜像实现，即 build 那就使用 build 的镜像，deploy 就用带有 deploy 功能的镜像；通过不同镜像容器实现完整的环境隔离</strong></p><ul><li><strong>CI即脚本</strong></li></ul><p>不同的 CI 任务实际上就是在使用不同镜像的容器中执行 SHELL 命令，自动化 CI 就是执行预先写好的一些小脚本</p><ul><li><strong>敏感信息走环境变量</strong></li></ul><p>一切重要的敏感信息，如账户密码等，不要写到 CI 配置中，直接放到 GitLab 的环境变量中；GitLab 会保证将其推送到远端 Runner 的 SHELL 变量中</p><p>转载整理From：</p><ul><li><a target="_blank" rel="noopener" href="https://mritd.com/2017/09/05/git-flow-note/">git-flow-note</a></li><li><a target="_blank" rel="noopener" href="https://mritd.com/2017/11/28/ci-cd-gitlab-ci/">ci-cd-gitlab-ci</a></li></ul><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Gitlab" scheme="https://blog.17lai.site/categories/Gitlab/"/>
    
    
    <category term="Gitlab" scheme="https://blog.17lai.site/tags/Gitlab/"/>
    
    <category term="Git" scheme="https://blog.17lai.site/tags/Git/"/>
    
    <category term="CI/CD" scheme="https://blog.17lai.site/tags/CI-CD/"/>
    
  </entry>
  
  <entry>
    <title>Earthly 一个更加强大的镜像构建工具</title>
    <link href="https://blog.17lai.site/posts/593cc323/"/>
    <id>https://blog.17lai.site/posts/593cc323/</id>
    <published>2021-10-31T23:25:00.000Z</published>
    <updated>2022-03-16T10:52:12.416Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、Earthly-介绍">一、Earthly 介绍</h2><blockquote><p>开局一张图，功能全靠吹。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210057.png" alt="img"></p><p>Earthly 是一个更加高级的 Docker 镜像构建工具，Earthly 通过自己定义的 Earthfile 来代替传统的 Dockerfile 完成镜像构建；Earthfile 就如同 Earthly 官方所描述:</p><pre class="line-numbers language-none"><code class="language-none">**Makefile + Dockerfile = Earthfile**<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在使用 Earthly 进行构建镜像时目前强依赖于 buildkit，Earthly 通过 buildkit 支持了一些 Dockerfile 的扩展语法，同时将 Dockerfile 与 Makefile 整合，使得多平台构建和代码化 Dockerfile 变得更加简单；使用 Earthly 可以更加方便的完成 Dockerfile 的代码复用以及更加友好的 CI 自动集成。</p><h2 id="二、快速开始">二、快速开始</h2><h3 id="2-1、安装依赖">2.1、安装依赖</h3><p>Earthly 目前依赖于 Docker 和 Git，所以安装 Earthly 前请确保机器已经安装了 Docker 和 Git。</p><h3 id="2-2、安装-Earthly">2.2、安装 Earthly</h3><p>Earthly 采用 Go 编写，所以主要就一个二进制文件，Linux 下安装可以直接参考官方的安装脚本:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> /bin/sh -c <span class="token string">'wget https://github.com/earthly/earthly/releases/latest/download/earthly-linux-amd64 -O /usr/local/bin/earthly &amp;&amp; chmod +x /usr/local/bin/earthly &amp;&amp; /usr/local/bin/earthly bootstrap --with-autocomplete'</span>Copy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>安装完成后 Earthly 将会启动一个 buildkitd 容器: <code>earthly-buildkitd</code>。</p><h3 id="2-3、语法高亮">2.3、语法高亮</h3><p>目前 Earthly 官方支持 VS Code、VIM 以及 Sublime Text 三种编辑器的语法高亮，具体如何安装请参考 <a target="_blank" rel="noopener" href="https://earthly.dev/get-earthly">官方文档</a>。</p><h3 id="2-4、基本使用">2.4、基本使用</h3><p>本示例源于官方 Basic 教程，以下示例以编译 Go 项目为样例:</p><p>首先创建一个任意名称的目录，目录中存在项目源码文件以及一个 <code>Earthfile</code> 文件；</p><p><strong>main.go</strong></p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token string">"fmt"</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">}</span>Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Earthfile</strong></p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">FROM golang:1.17-alpineWORKDIR /go-examplebuild:    COPY main.go .    RUN go build -o build/go-example main.go    SAVE ARTIFACT build/go-example /go-example AS LOCAL build/go-exampledocker:    COPY +build/go-example .    ENTRYPOINT ["/go-example/go-example"]    SAVE IMAGE go-example:latestCopy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>有了 <code>Earthfile</code> 以后我们就可以使用 <code>Earthly</code> 将其打包为镜像；</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 目录结构</span>~/t/earthlytest ❯❯❯ tree<span class="token builtin class-name">.</span>├── Earthfile└── main.go<span class="token number">0</span> directories, <span class="token number">2</span> files<span class="token comment"># 通过 earthly 进行构建</span>~/t/earthlytest ❯❯❯ earthly +dockerCopy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210338.png" alt="img"></p><p>构建完成后我们就可以直接从 docker 的 images 列表中查看刚刚构建的镜像，并运行:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101212129.png" alt="img"></p><h2 id="三、进阶使用">三、进阶使用</h2><h3 id="3-1、多阶段构建">3.1、多阶段构建</h3><p>Earthfile 中包含类似 Makefile 一样的 <code>target</code>，不同的 <code>target</code> 之间还可以通过特定语法进行引用，每个 <code>target</code> 都可以被单独执行，执行过程中 earthly 会自动解析这些依赖关系。</p><p>这种多阶段构建时语法很弹性，我们可以在每个阶段运行独立的命令以及使用不同的基础镜像；从快速开始中可以看到，我们始终使用了一个基础镜像(<code>golang:1.17-alpine</code>)，对于 Go 这种编译后自带运行时不依赖其语言 SDK 的应用，我们事实上可以将 “发布物” 仅放在简单的运行时系统镜像内，从而减少最终镜像体积:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210338-2.png" alt="img"></p><p>由于使用了多个 target，所以我们可以单独的运行 <code>build</code> 这个 target 来验证我们的编译流程，<strong>这种多 target 的设计方便我们构建应用时对编译、打包步骤的细化拆分，同时也方便我们进行单独的验证。</strong> 例如我们单独执行 <code>build</code> 这个 target 来验证我们的编译流程是否正确:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210338-3.png" alt="img"></p><p>在其他阶段验证完成后，我们可以直接运行最终的 target，earthly 会自动识别到这种依赖关系从而自动运行其依赖的 target:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210338-4.png" alt="img"></p><h3 id="3-2、扩展指令">3.2、扩展指令</h3><h4 id="3-2-1、SAVE">3.2.1、SAVE</h4><p>SAVE 指令是 Earthly 自己的一个扩展指令，实际上分为 <code>SAVE ARTIFACT</code> 和 <code>SAVE IMAGE</code>；其中 <code>SAVE ARTIFACT</code> 指令格式如下:</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">SAVE ARTIFACT [--keep-ts] [--keep-own] [--if-exists] [--force] &lt;src&gt; [&lt;artifact-dest-path&gt;] [AS LOCAL &lt;local-path&gt;]Copy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>SAVE ARTIFACT</code> 指令用于将文件或目录从 build 运行时环境保存到 target 的 artifact 环境；当保存到 artifact 环境后，可以通过 <code>COPY</code> 等命令在其他位置进行引用，类似于 Dockerfile 的 <code>COPY --from...</code> 语法；不同的是 <code>SAVE ARTIFACT</code> 支持 <code>AS LOCAL &lt;local-path&gt;</code> 附加参数，一但指定此参数后，earthly 会同时将文件或目录在宿主机复制一份，一般用于调试等目的。<code>SAVE ARTIFACT</code> 命令在上面的样例中已经展示了，在运行完 <code>earthly +build</code> 命令后实际上会在本地看到被 SAVE 出来的 ARTIFACT:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210338-5.png" alt="img"></p><p>而另一个 <code>SAVE IMAGE</code> 指令则主要用于将当前的 build 环境 SAVE 为一个 IMAGE，<strong>如果指定了 <code>--push</code> 选项，同时在执行 <code>earthly +target</code> 命令时也加入 <code>--push</code> 选项，该镜像将会自动被推送到目标 Registry 上。</strong><code>SAVE IMAGE</code> 指令格式如下:</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">SAVE IMAGE [--cache-from=&lt;cache-image&gt;] [--push] &lt;image-name&gt;...Copy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210338-6.png" alt="img"></p><h4 id="3-2-2、GIT-CLONE">3.2.2、GIT CLONE</h4><p><code>GIT CLONE</code> 指令用于将指定 git 仓库 clone 到 build 环境中；与 <code>RUN git clone...</code> 命令不同的是，<strong><code>GIT CLONE</code> 通过宿主机的 git 命令运行，它不依赖于容器内的 git 命令，同时还可以直接为 earthly 配置 git 认证，从而避免将这些安全信息泄漏到 build 环境中；</strong> 关于如何配置 earthly 的 git 认证请参考 <a target="_blank" rel="noopener" href="https://docs.earthly.dev/docs/guides/auth">官方文档</a>；下面是 <code>GIT CLONE</code> 指令的样例</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101213746.png" alt="img"></p><h4 id="3-2-3、COPY">3.2.3、COPY</h4><p><code>COPY</code> 指令与标准的 Dockerfile COPY 指令类似，除了支持 Dockerfile 标准的 COPY 功能以外，<strong>earthly 中的 <code>COPY</code> 指令可以引用其他 target 环节产生的 artifact，在引用时会自动声明依赖关系；即当在 <code>B</code> target 中存在 <code>COPY +A/xxxxx /path/to/copy</code> 类似的指令时，如果只单纯的执行 <code>earthly +B</code>，那么 earthly 根据依赖分析会得出在 COPY 之前需要执行 target A。</strong><code>COPY</code> 指令的语法格式如下:</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile"># 与 Dockerfile 相同的使用方式，从上下文复制COPY [options...] &lt;src&gt;... &lt;dest&gt;# 扩展支持的从 target 复制方式COPY [options...] &lt;src-artifact&gt;... &lt;dest&gt;Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-2-4、RUN">3.2.4、RUN</h4><p><code>RUN</code> 指令在标准使用上与 Dockerfile 里保持一致，除此之外增加了更多的扩展选项，其指令格式如下:</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile"># shell 方式运行(/bin/sh -c)RUN [--push] [--entrypoint] [--privileged] [--secret &lt;env-var&gt;=&lt;secret-ref&gt;] [--ssh] [--mount &lt;mount-spec&gt;] [--] &lt;command&gt;# exec 方式运行RUN [[&lt;flags&gt;...], "&lt;executable&gt;", "&lt;arg1&gt;", "&lt;arg2&gt;", ...]Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中 <code>--privileged</code> 选项允许运行的命令使用 <code>privileged capabilities</code>，但是需要 earthly 在运行 target 时增加 <code>--allow-privileged</code> 选项；<code>--interactive / --interactive-keep</code> 选项用于交互式执行一些命令，在完成交互后 build 继续进行，<strong>在交互过程中进行的操作都会被持久化到 镜像中:</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210338-8.png" alt="img"></p><p>限于篇幅原因，其他的具体指令请查阅官方文档 <a target="_blank" rel="noopener" href="https://docs.earthly.dev/docs/earthfile">Earthfile reference</a>。</p><h3 id="3-3、UDCS">3.3、UDCS</h3><p>UDCs 全称 “User-defined commands”，即用户定义指令；通过 UDCs 我们可以将 Earthfile 中特定的命令剥离出来，从而实现更加通用和统一的代码复用；下面是一个定义 UDCs 指令的样例:</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile"># 定义一个 Command# ⚠️ 注意: 语法必须满足以下规则# 1、名称全大写# 2、名称下划线分割# 3、首个命令必须为 COMMAND(后面没有冒号)MY_COPY:    COMMAND    ARG src    ARG dest=./    ARG recursive=false    RUN cp $(if $recursive =  "true"; then printf -- -r; fi) "$src" "$dest"# target 中引用build:    FROM alpine:3.13    WORKDIR /udc-example    RUN echo "hello" &gt;./foo    # 通过 DO 关键字引用 UDCs    DO +MY_COPY --src=./foo --dest=./bar    RUN cat ./bar # prints "hello"Copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>UDCs 不光可以定义在一个 Earthfile 中，UDCs 可以跨文件、跨目录引用:</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101212525.png" alt="img"></p><p>有了 UDCs 以后，我们可以通过这种方式将对基础镜像的版本统一控制、对特殊镜像的通用处理等操作全部抽象出来，然后每个 Earthfile 根据需要进行引用；关于 UDCs 的使用样例可以参考我的 <a target="_blank" rel="noopener" href="https://github.com/mritd/autobuild">autobuild</a> 项目，其中的 <a target="_blank" rel="noopener" href="https://github.com/mritd/autobuild/tree/main/earthfiles/udcs">udcs</a> 目录定义了大量的通用 UDCs，这些 UDCs 被其他目标镜的 Earthfile 批量引用。</p><h3 id="3-4、多平台构建">3.4、多平台构建</h3><p>在以前使用 Dockerfile 的时候，我们需要自己配置然后开启 buildkit 来实现多平台构建；在配置过程中可能会很繁琐，现在使用 earthly 可以默认帮我们实现多平台的交叉编译，我们需要做的仅仅是在 Earthfile 中声明需要支持哪些平台而已:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210338-10.png" alt="img"></p><p>以上 Earthfile 在执行 <code>earthly --push +all</code> 构建时，将会自动构建四个平台的镜像，并保持单个 tag，同时由于使用了 <code>--push</code> 选项还会自动推送到 Docker Hub 上:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/11/0120211101210338-11.png" alt="img"></p><h2 id="四、总结">四、总结</h2><p>Earthly 弥补了 Dockerfile 的很多不足，解决了很多痛点问题；但同样可能需要一些学习成本，但是如果已经熟悉了 Dockerfile 其实学习成本不高；所以目前还是比较推荐将 Dockerfile 切换为 Earthfile 进行统一和版本化管理的。本文由于篇幅所限(懒)很多地方没有讲，比如共享缓存等，所以关于 Earthly 更多的详细使用等最好还是仔细阅读一下<a target="_blank" rel="noopener" href="https://docs.earthly.dev/docs/guides">官方文档</a>。</p><blockquote><p>整理转载：<a target="_blank" rel="noopener" href="https://mritd.com/2021/10/27/the-best-image-build-tool-earthly/">the-best-image-build-tool-earthly</a></p></blockquote><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Docker" scheme="https://blog.17lai.site/categories/Docker/"/>
    
    
    <category term="Docker" scheme="https://blog.17lai.site/tags/Docker/"/>
    
    <category term="Earthly" scheme="https://blog.17lai.site/tags/Earthly/"/>
    
  </entry>
  
  <entry>
    <title>Hexo Markdown以及各种插件功能测试</title>
    <link href="https://blog.17lai.site/posts/cf0f47fd/"/>
    <id>https://blog.17lai.site/posts/cf0f47fd/</id>
    <published>2021-10-20T01:25:00.000Z</published>
    <updated>2022-03-21T15:24:25.969Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="Markdown-插件">Markdown 插件</h2><ul><li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-abbr">markdown-it-abbr</a></li><li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-container">markdown-it-container</a></li><li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-deflist">markdown-it-deflist</a></li><li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-emoji">markdown-it-emoji</a></li><li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-footnote">markdown-it-footnote</a></li><li><a target="_blank" rel="noopener" href="https://github.com/tatsy/markdown-it-imsize">markdown-it-imsize</a></li><li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-ins">markdown-it-ins</a></li><li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-mark">markdown-it-mark</a></li><li><a target="_blank" rel="noopener" href="https://github.com/rlidwka/markdown-it-regexp">markdown-it-regexp</a></li><li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-sub">markdown-it-sub</a></li><li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-sup">markdown-it-sup</a></li><li><a target="_blank" rel="noopener" href="https://github.com/linsir/markdown-it-task-checkbox">markdown-it-task-checkbox</a></li></ul><h3 id="常用标记">常用标记</h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token list punctuation">-</span> 29^th^ =&gt; <span class="token code-snippet code keyword">`29&lt;sup&gt;th&lt;/sup&gt;`</span><span class="token list punctuation">-</span> H<span class="token strike"><span class="token punctuation">~</span><span class="token content">2</span><span class="token punctuation">~</span></span>0 =&gt; <span class="token code-snippet code keyword">`H&lt;sub&gt;2&lt;/sub&gt;O`</span><span class="token list punctuation">-</span> ==marked== =&gt; <span class="token code-snippet code keyword">`&lt;mark&gt;inserted&lt;/mark&gt;`</span><span class="token list punctuation">-</span> ++inserted++ =&gt; <span class="token code-snippet code keyword">`&lt;ins&gt;inserted&lt;/ins&gt;`</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>29<sup>th</sup> =&gt; <code>29&lt;sup&gt;th&lt;/sup&gt;</code></li><li>H<sub>2</sub>0 =&gt; <code>H&lt;sub&gt;2&lt;/sub&gt;O</code></li><li><mark>marked</mark> =&gt; <code>&lt;mark&gt;inserted&lt;/mark&gt;</code></li><li><ins>inserted</ins> =&gt; <code>&lt;ins&gt;inserted&lt;/ins&gt;</code></li></ul><h3 id="markdown-it-task-checkbox"><a target="_blank" rel="noopener" href="https://github.com/linsir/markdown-it-task-checkbox">markdown-it-task-checkbox</a></h3><blockquote><p>和主题某些css冲突，停用</p></blockquote><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token list punctuation">-</span> [x] item 1    <span class="token list punctuation">-</span> [x] item 1-1    <span class="token list punctuation">-</span> [ ] item 1-2    <span class="token list punctuation">-</span> [ ] item 1-3    <span class="token list punctuation">-</span> [ ] item 1-4<span class="token list punctuation">-</span> [ ] item 2    <span class="token list punctuation">-</span> [ ] item 2-1    <span class="token list punctuation">-</span> [ ] item 2-2    <span class="token list punctuation">-</span> [ ] item 2-3    <span class="token list punctuation">-</span> [ ] item 2-4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>[x] item 1<ul><li>[x] item 1-1</li><li>[ ] item 1-2</li><li>[ ] item 1-3</li><li>[ ] item 1-4</li></ul></li><li>[ ] item 2<ul><li>[ ] item 2-1</li><li>[ ] item 2-2</li><li>[ ] item 2-3</li><li>[ ] item 2-4</li></ul></li></ul><h3 id="markdown-it-multimd-table"><a target="_blank" rel="noopener" href="https://github.com/RedBug312/markdown-it-multimd-table">markdown-it-multimd-table</a></h3><blockquote><p>目前仅支持多列合并</p></blockquote><pre class="line-numbers language-none"><code class="language-none">| 标题1        | 标题2        || ------------ | ------------ || 合并第一行                ||| 第二行第一列 | 第二行第二列 |<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th style="text-align:left">标题1</th><th style="text-align:left">标题2</th></tr></thead><tbody><tr><td style="text-align:left">合并第一行</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">第二行第一列</td><td style="text-align:left">第二行第二列</td></tr></tbody></table><p>colspan <code>&gt;</code> or <code>empty cell</code>:</p><table><thead><tr><th style="text-align:left">a</th><th style="text-align:left">b</th></tr></thead><tbody><tr><td style="text-align:left">&gt;</td><td style="text-align:left">1</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left"></td></tr></tbody></table><p>rowspan ‘^’</p><table><thead><tr><th style="text-align:left">a</th><th style="text-align:left">b</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left">2</td></tr><tr><td style="text-align:left">^^</td><td style="text-align:left">4</td></tr></tbody></table><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token table"><span class="token table-header-row"><span class="token punctuation">|</span><span class="token table-header important">   Markdown   </span><span class="token punctuation">|</span><span class="token table-header important"> Rendered HTML </span><span class="token punctuation">|</span></span><span class="token table-line"><span class="token punctuation">|</span><span class="token punctuation">--------------</span><span class="token punctuation">|</span><span class="token punctuation">---------------</span><span class="token punctuation">|</span></span><span class="token table-data-rows"></span></span>|    <span class="token italic"><span class="token punctuation">*</span><span class="token content">Italic</span><span class="token punctuation">*</span></span>  | <span class="token italic"><span class="token punctuation">*</span><span class="token content">Italic</span><span class="token punctuation">*</span></span>      | \|              |               ||    - Item 1  | - Item 1      | \|    - Item 2  | - Item 2      ||    ```python | ```python       \|    .1 + .2   | .1 + .2         \|    ```       | ```           |<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th style="text-align:left">Markdown</th><th style="text-align:left">Rendered <abbr title="Hyper Text Markup Language">HTML</abbr></th><th></th></tr></thead><tbody><tr><td style="text-align:left"><em>Italic</em></td><td style="text-align:left"><em>Italic</em></td><td>\</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"></td><td></td></tr><tr><td style="text-align:left">- Item 1</td><td style="text-align:left">- Item 1</td><td>\</td></tr><tr><td style="text-align:left">- Item 2</td><td style="text-align:left">- Item 2</td><td></td></tr><tr><td style="text-align:left">```python</td><td style="text-align:left">```python \</td><td></td></tr><tr><td style="text-align:left">.1 + .2</td><td style="text-align:left">.1 + .2 \</td><td></td></tr><tr><td style="text-align:left">```</td><td style="text-align:left">```</td><td></td></tr></tbody></table><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token table"><span class="token table-header-row"><span class="token punctuation">|</span><span class="token table-header important"> Task           </span><span class="token punctuation">|</span><span class="token table-header important"> Time required </span><span class="token punctuation">|</span><span class="token table-header important"> Assigned to   </span><span class="token punctuation">|</span><span class="token table-header important"> Current Status </span><span class="token punctuation">|</span><span class="token table-header important"> Finished </span><span class="token punctuation">|</span><span class="token table-header important"> </span></span><span class="token table-line"><span class="token punctuation">|</span><span class="token punctuation">----------------</span><span class="token punctuation">|</span><span class="token punctuation">---------------</span><span class="token punctuation">|</span><span class="token punctuation">---------------</span><span class="token punctuation">|</span><span class="token punctuation">----------------</span><span class="token punctuation">|</span><span class="token punctuation">-----------</span><span class="token punctuation">|</span></span><span class="token table-data-rows"><span class="token punctuation">|</span><span class="token table-data"> Calendar Cache </span><span class="token punctuation">|</span><span class="token table-data"> &gt; 5 hours  </span><span class="token punctuation">|</span><span class="token table-data"> @georgehrke </span><span class="token punctuation">|</span><span class="token table-data"> in progress </span><span class="token punctuation">|</span><span class="token table-data"> <span class="token list punctuation">-</span> [x] ok?</span><span class="token punctuation">|</span><span class="token table-data"> Object Cache   </span><span class="token punctuation">|</span><span class="token table-data"> &gt; 5 hours  </span><span class="token punctuation">|</span><span class="token table-data"> @georgehrke </span><span class="token punctuation">|</span><span class="token table-data"> in progress </span><span class="token punctuation">|</span><span class="token table-data"> [x] item1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>[ ] item2</span><span class="token punctuation">|</span><span class="token table-data"> Object Cache   </span><span class="token punctuation">|</span><span class="token table-data"> &gt; 5 hours  </span><span class="token punctuation">|</span><span class="token table-data"> @georgehrke </span><span class="token punctuation">|</span><span class="token table-data"> in progress </span><span class="token punctuation">|</span><span class="token table-data"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>- [x] item1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>- [ ] item2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">|</span><span class="token table-data"> Object Cache   </span><span class="token punctuation">|</span><span class="token table-data"> &gt; 5 hours  </span><span class="token punctuation">|</span><span class="token table-data"> @georgehrke </span><span class="token punctuation">|</span><span class="token table-data"> in progress </span><span class="token punctuation">|</span><span class="token table-data"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>[x] item1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>[ ] item2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span></span></span></span><span class="token list punctuation">-</span> [x] works<span class="token list punctuation">-</span> [x] works too<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th style="text-align:left">Task</th><th style="text-align:left">Time required</th><th style="text-align:left">Assigned to</th><th style="text-align:left">Current Status</th><th style="text-align:left">Finished</th></tr></thead><tbody><tr><td style="text-align:left">Calendar Cache</td><td style="text-align:left">&gt; 5 hours</td><td style="text-align:left">@georgehrke</td><td style="text-align:left">in progress</td><td style="text-align:left">- [x] ok?</td></tr><tr><td style="text-align:left">Object Cache</td><td style="text-align:left">&gt; 5 hours</td><td style="text-align:left">@georgehrke</td><td style="text-align:left">in progress</td><td style="text-align:left">[x] item1 [ ] item2</td></tr><tr><td style="text-align:left">Object Cache</td><td style="text-align:left">&gt; 5 hours</td><td style="text-align:left">@georgehrke</td><td style="text-align:left">in progress</td><td style="text-align:left">- [x] item1- [ ] item2</td></tr><tr><td style="text-align:left">Object Cache</td><td style="text-align:left">&gt; 5 hours</td><td style="text-align:left">@georgehrke</td><td style="text-align:left">in progress</td><td style="text-align:left">[x] item1[ ] item2</td></tr></tbody></table><ul><li>[x] works</li><li>[x] works too</li></ul><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token table"><span class="token table-header-row"><span class="token table-header important">Function </span><span class="token punctuation">|</span><span class="token table-header important"> MySQL / MariaDB </span><span class="token punctuation">|</span><span class="token table-header important"> PostgreSQL </span><span class="token punctuation">|</span><span class="token table-header important"> SQLite</span></span><span class="token table-line"><span class="token punctuation">:------------</span> <span class="token punctuation">|</span> <span class="token punctuation">:-------------</span><span class="token punctuation">|</span> <span class="token punctuation">:-------------</span><span class="token punctuation">|</span> <span class="token punctuation">:-------------</span></span><span class="token table-data-rows"><span class="token table-data">substr </span><span class="token punctuation">|</span><span class="token table-data"> :heavy_check_mark: </span><span class="token punctuation">|</span><span class="token table-data">  :white_check_mark: </span><span class="token punctuation">|</span><span class="token table-data"> :heavy_check_mark:</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><table><thead><tr><th style="text-align:left">Function</th><th style="text-align:left">MySQL / MariaDB</th><th style="text-align:left">PostgreSQL</th><th style="text-align:left">SQLite</th></tr></thead><tbody><tr><td style="text-align:left">substr</td><td style="text-align:left">✔️</td><td style="text-align:left">✅</td><td style="text-align:left">✔️</td></tr></tbody></table><h3 id="emoji"><a target="_blank" rel="noopener" href="https://www.webfx.com/tools/emoji-cheat-sheet/">emoji</a></h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">:smile::smirk::sunny:<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>😄😏☀️</p><h3 id="markdown-it-abbr"><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-abbr">markdown-it-abbr</a></h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token italic"><span class="token punctuation">*</span><span class="token content">[HTML]: Hyper Text Markup Language</span><span class="token punctuation">*</span></span><span class="token url-reference url"><span class="token punctuation">[</span><span class="token variable">W3C</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  World</span> Wide Web ConsortiumThe HTML specificationis maintained by the W3C.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>The <abbr title="Hyper Text Markup Language">HTML</abbr> specification<br>is maintained by the <abbr title="World Wide Web Consortium">W3C</abbr>.</p><h3 id="markdown-it-container"><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it-container">markdown-it-container</a></h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">::: warning<span class="token italic"><span class="token punctuation">*</span><span class="token content">here be dragons</span><span class="token punctuation">*</span></span>:::<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><em>here be dragons</em></p><h3 id="footnote">footnote</h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">Here is a footnote reference,[^1] and another.[^longnote]<span class="token url-reference url"><span class="token punctuation">[</span><span class="token variable">^1</span><span class="token punctuation">]</span><span class="token punctuation">:</span> Here</span> is the footnote.<span class="token url-reference url"><span class="token punctuation">[</span><span class="token variable">^longnote</span><span class="token punctuation">]</span><span class="token punctuation">:</span> Here's</span> one with multiple blocks.<span class="token code keyword">    Subsequent paragraphs are indented to show that they</span>belong to the previous footnote.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Here is a footnote reference,<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> and another.<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup></p><p>belong to the previous footnote.</p><h3 id="markdown-it-imsize"><a target="_blank" rel="noopener" href="https://github.com/tatsy/markdown-it-imsize">markdown-it-imsize</a></h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url"><span class="token operator">!</span>[<span class="token content">test</span>](<span class="token url">https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1220211012022352.png</span>)</span>![test](https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1220211012022352.png =100x200)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1220211012022352.png" alt="test"><br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1220211012022352.png" alt="test" width="100" height="200"></p><h2 id="公式测试">公式测试</h2><blockquote><p>采用**<a target="_blank" rel="noopener" href="https://github.com/MakerGYT/markdown-it-latex2img">markdown-it-latex2img</a>**</p></blockquote><p><a target="_blank" rel="noopener" href="https://makergyt.github.io/markdown-it-latex2img/">Demo</a></p><h3 id="1-数学公式">1 数学公式</h3><h4 id="1-1-内联公式">1.1 内联公式</h4><p><strong>开头的<code>$</code>必须在其右边紧跟一个非空格字符，而结尾的<code>$</code>必须在其左边紧接一个非空格字符，并且不能紧跟一个数字。</strong></p><ul><li>勾股定理: <img src="https://math.now.sh?inline=a%5E2%2Bb%5E2%3Dc%5E2" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></li><li>等差数列求和公式: <img src="https://math.now.sh?inline=S_%7Bn%7D%3Dn%20a_%7B1%7D%2B%5Cfrac%7Bn%28n-1%29%7D%7B2%7D%20d%2C%20n%20%5Cin%20N%5E%7B*%7D" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></li><li>牛顿-莱布尼茨公式: <img src="https://math.now.sh?inline=%5Cint_%7Ba%7D%5E%7Bb%7D%20f%28x%29%20d%20x%3DF(b)-F(a)%3D%5Cleft.F(x)%5Cright%7C_%7Ba%7D%20%5E%7Bb%7D" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></li><li>二项分布: <img src="https://math.now.sh?inline=P_%7Bn%7D%28k%29%3DC_%7Bn%7D%5E%7Bk%7D%20p%5E%7Bk%7D%20q%5E%7Bn-k%7D%20%5Cquad%20k%3D0%2C1%2C2%20%5Cldots%20%5Cldots%2C%20n" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></li></ul><h4 id="1-2-块公式">1.2 块公式</h4><p>正态分布<img src="https://math.now.sh?inline=X%20%5Csim%20N%28%5Cmu%2C%5Csigma%5E2%29" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;">:</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=f%28x%29%20%3D%20%5Cfrac%7B1%7D%7B%5Csqrt%7B2%5Cpi%7D%5Csigma%7De%5E%7B-%5Cfrac%7B(x-%5Cmu)%5E2%7D%7B2%5Csigma%5E2%7D%7D%0A"></p><p>斐波那契数列<img src="https://math.now.sh?inline=A_n%3DA_%7Bn-1%7D%2BA_%7Bn-2%7D" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;">,前后两项的比值逐渐收敛到黄金分割比例</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=%5Clim_%7Bn%5Cto%20%5Cinfty%7D%5Cfrac%7BA_%7Bn-1%7D%7D%7BA_n%7D%3D%5Cfrac%7B%5Csqrt%7B5%7D-1%7D%7B2%7D.%0A"></p><p>因式分解</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=%5Cbegin%7Bsplit%7D%28x%E2%88%921%29(x%E2%88%923)%26%3Dx%5E2%E2%88%924x%2B3%20%5C%5C%20%0A%26%3Dx%5E2%E2%88%924x%2B4%E2%88%921%20%5C%5C%20%0A%26%3D(x%E2%88%922)%5E2%E2%88%921%0A%5Cend%7Bsplit%7D%0A"></p><p>狄利克雷函数</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=D%28x%29%3D%0A%5Cbegin%7Bcases%7D%0A1%2C%26%20x%20%5Cin%20Q%20%5C%5C%0A0%2C%26%20x%20%5Cnotin%20Q%0A%5Cend%7Bcases%7D%0A"></p><p>高斯公式</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=%5Ciiint_%7B%5COmega%7D%5Cleft%28%5Cfrac%7B%5Cpartial%20P%7D%7B%5Cpartial%20x%7D%2B%5Cfrac%7B%5Cpartial%20Q%7D%7B%5Cpartial%20y%7D%2B%5Cfrac%7B%5Cpartial%20R%7D%7B%5Cpartial%20z%7D%5Cright%29%20d%20v%3D%5Ciint_%7B%5CSigma%7D%20P%20d%20y%20d%20z%2BQ%20d%20z%20d%20x%2BR%20d%20x%20d%20y%0A"></p><p>范德蒙行列式</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=D_%7Bn-1%7D%3D%5Cleft%7C%5Cbegin%7Barray%7D%7Bcccc%7D%0A1%20%26%201%20%26%20%5Cdots%20%26%201%20%5C%5C%0Ax_%7B2%7D%20%26%20x_%7B3%7D%20%26%20%5Cdots%20%26%20x_%7Bn%7D%20%5C%5C%0A%5Cvdots%20%26%20%5Cvdots%20%26%20%26%20%5Cvdots%20%5C%5C%0Ax_%7B2%7D%5E%7Bn-2%7D%20%26%20x_%7B3%7D%5E%7Bn-2%7D%20%26%20%5Cdots%20%26%20x_%7Bn%7D%5E%7Bn-2%7D%0A%5Cend%7Barray%7D%5Cright%7C%3D%5Cprod_%7B2%20%5Cleq%20j%3Ci%20%5Cleq%20n%7D%5Cleft%28x_%7Bi%7D-x_%7Bj%7D%5Cright%29"></p><p>线性方程组</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=%5Cleft%5C%7B%5Cbegin%7Baligned%7D%0Aa_%7B11%7D%20x_%7B1%7D%2Ba_%7B12%7D%20x_%7B2%7D%2B%5Ccdots%2Ba_%7B1%20n%7D%20x_%7Bn%7D%20%26%3Db_%7B1%7D%20%5C%5C%0Aa_%7B21%7D%20x_%7B1%7D%2Ba_%7B22%7D%20x_%7B2%7D%2B%5Ccdots%2Ba_%7B2%20n%7D%20x_%7Bn%7D%20%26%3Db_%7B2%7D%20%5C%5C%0A%5Ccdots%20%5Ccdots%20%5Ccdots%20%5C%5C%0Aa_%7Bm%201%7D%20x_%7B1%7D%2Ba_%7Bm%202%7D%20x_%7B2%7D%2B%5Ccdots%2Ba_%7Bm%20n%7D%20x_%7Bn%7D%20%26%3Db_%7Bm%7D%0A%5Cend%7Baligned%7D%5Cright."></p><h3 id="2-物理公式">2 物理公式</h3><ul><li>牛顿第一定律: <img src="https://math.now.sh?inline=%5Csum%20%5Cvec%7BF%7D_%7Bi%7D%3D%5Cfrac%7B%5Cmathrm%7Bd%7D%20%5Cvec%7Bv%7D%7D%7B%5Cmathrm%7Bd%7D%20t%7D%3D0" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></li><li>牛顿第二定律: <img src="https://math.now.sh?inline=%5Cvec%7BF%7D%3D%5Cfrac%7B%5Cmathrm%7Bd%7D%20m%7D%7B%5Cmathrm%7Bd%7D%20t%7D%20%5Cvec%7Bv%7D%2Bm%20%5Cfrac%7B%5Cmathrm%7Bd%7D%20%5Cvec%7Bv%7D%7D%7B%5Cmathrm%7Bd%7D%20t%7D%3D%5Cfrac%7B%5Cmathrm%7Bd%7D%20m%7D%7B%5Cmathrm%7Bd%7D%20t%7D%20%5Cvec%7Bv%7D%2Bm%20%5Cvec%7Ba%7D%3D%5Cfrac%7B%5Cmathrm%7Bd%7D%20m%7D%7B%5Cmathrm%7Bd%7D%20t%7D%20%5Cvec%7Bv%7D%2Bm%20%5Cfrac%7B%5Cmathrm%7Bd%7D%5E%7B2%7D%20%5Cvec%7Br%7D%7D%7B%5Cmathrm%7Bd%7D%20t%5E%7B2%7D%7D" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></li><li>牛顿第三定律: <img src="https://math.now.sh?inline=%5Coverrightarrow%7BF_%7B12%7D%7D%3D-%5Coverrightarrow%7BF_%7B21%7D%7D" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></li><li>质能守恒: <img src="https://math.now.sh?inline=E%3Dmc%5E2" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></li></ul><p>万有引力定律: <img src="https://math.now.sh?inline=F%3D%5Cfrac%7BG%20M%20m%7D%7Br%5E%7B2%7D%7D" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=G%20%5Cfrac%7Bm%20M%7D%7B%28r%2Bh%29%5E%7B2%7D%7D%3Dm%20%5Cfrac%7B%5Cnu%5E%7B2%7D%7D%7B(r%2Bh)%7D%0A"></p><p>基尔霍夫定律</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=%5Cleft%5B%5Cfrac%7B%5Cpartial%5Cleft%28%5CDelta_%7Br%7D%20H_%7Bm%7D%5Cright%29%7D%7B%5Cpartial%20T%7D%5Cright%5D_%7Bp%7D%3D%5Csum_%7BB%7D%20v_%7BB%7D%20C_%7Bp%2C%20m%7D(B)%0A"></p><p>热力学第二定律</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=d%20S%20%5Cgeq%20%5Cfrac%7B%5Cdelta%20Q%7D%7BT%7D%0A"></p><h3 id="3-化学公式">3 化学公式</h3><p>离子反应与沉淀: <img src="https://math.now.sh?inline=%5Cce%7BSO4%5E2-%20%2B%20Ba%5E2%2B%20-%3E%20BaSO4%20v%7D" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></p><p>氮气氢气合成氨</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=%5Cce%7BN2%20%2B%203H2%20%3C%3D%3ET%5B%E9%AB%98%E6%B8%A9%E3%80%81%E5%8A%A0%E5%8E%8B%5D%5B%E5%82%AC%E5%8C%96%E5%89%82%5D%202NH3%7D%0A"></p><p>化学平衡常数:<img src="https://math.now.sh?inline=%5Cmathrm%7BZn%7D%2B2%20%5Cmathrm%7BHCl%7D%28%5Cmathrm%7Baq%7D%29%3D%5Cmathrm%7BH%7D_%7B2%7D%2B%5Cmathrm%7BZnCl%7D_%7B2%7D%20%5Cquad(%5Cmathrm%7Baq%7D)" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=K%5E%7B%5Ctheta%7D%3D%5Cfrac%7B%5Cleft%5Bp%5Cleft%28%5Cmathrm%7BH%7D_%7B2%7D%5Cright%29%20%2F%20p%5E%7B%5Ctheta%7D%5Cright%5D%5Cleft%5Bc%5Cleft(%5Cmathrm%7BZnCl%7D_%7B2%7D%5Cright)%5Cright%5D%7D%7Bc%5E%7B2%7D(%5Cmathrm%7BHC%7D)%7D%0A"></p><h3 id="4-生物公式">4 生物公式</h3><p>光合作用</p><p style="filter: opacity(90%);transform:scale(0.85);text-align:center;"><img src="https://math.now.sh?from=%5Cce%3C!--swig%EF%BF%BC75--%3E%0A"></p><h3 id="5-语法参考">5 语法参考</h3><p><a target="_blank" rel="noopener" href="https://math.meta.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference">MathJax basic tutorial and quick reference</a></p><h4 id="长公式">长公式</h4><p><img src="https://math.now.sh/?from=%5Cdef%20%5Clowercase%20%7B%5Calpha%20%5Cbeta%20%5Cgamma%20%5Cdelta%20%5Cepsilon%20%5Czeta%20%5Ceta%20%5Ctheta%20%5Ciota%20%5Ckappa%20%5Clambda%20%5Cmu%20%5Cnu%20%5Comicron%20%5Cpi%20%5Crho%20%5Csigma%20%5Ctau%20%5Cupsilon%20%5Cphi%20%5Cchi%20%5Cpsi%20%5Comega%7D%0A%5Cdef%20%5Cuppercase%20%7BA%20B%20%5CGamma%20%5CDelta%20E%20Z%20E%20%5CTheta%20I%20K%20%5CLambda%20M%20N%20O%20%5CPi%20R%20%5CSigma%20T%20%5CUpsilon%20%5CPhi%20X%20%5CPsi%20%5COmega%7D%0A%5Cdef%20%5Clong%20%7B%5Cuppercase%20%5CLeftrightarrow%20%5Clowercase%7D%0A" alt="img"></p><p><img src="https://math.now.sh/?inline=%5Ctext%7Blong%20inline%20mathjax%3A%7D%5Cquad%20%5Clong%20%5Cquad%20%5Clong%20%5Cquad%20%5Clong" alt="img"></p><p><img src="https://math.now.sh/?from=%5Ctext%7B%3C-%20long%20displayed%20mathjax%20example%20-%3E%7D%20%5C%5C%0A%5Cbegin%7Bsplit%7D%0A%5Clong%20%5Cquad%20%26%5Clong%20%5C%5C%0A%26%5Clong%20%5Cquad%20%5Clong%0A%5Cend%7Bsplit%7D%0A" alt="img"></p><h4 id="小括号测试">小括号测试</h4><pre class="line-numbers language-none"><code class="language-none">$\alpha\beta$$\alpha_\beta$$\alpha_\beta = \gamma_\delta$(abctest)\(abctest\)\\(abctest\\)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://math.now.sh?inline=%5Calpha%5Cbeta" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></p><p><img src="https://math.now.sh?inline=%5Calpha_%5Cbeta" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></p><p><img src="https://math.now.sh?inline=%5Calpha_%5Cbeta%20%3D%20%5Cgamma_%5Cdelta" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;"></p><p>(abctest)</p><p>(abctest)</p><p>\(abctest\)</p><h4 id="下划线测试">下划线测试</h4><pre class="line-numbers language-none"><code class="language-none">w^{(l)}*{ij} = w^{(l)}*{ij} - \eta\frac{\partial E(W, b)}{\partial w^{(l)}_{ij}}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://math.now.sh/?from=w%5E%7B%28l%29%7D*%7Bij%7D%20%3D%20w%5E%7B(l)%7D*%7Bij%7D%20-%20%5Ceta%5Cfrac%7B%5Cpartial%20E(W%2C%20b)%7D%7B%5Cpartial%20w%5E%7B(l)%7D_%7Bij%7D%7D%0A" alt="img"></p><h2 id="CSS测试">CSS测试</h2><p>文字增加背景色块 <span id="inline-blue">站点配置文件</span>,<br><span id="inline-purple">主题配置文件</span></p><pre class="line-numbers language-none"><code class="language-none">&lt;span id="inline-blue"&gt;站点配置文件&lt;/span&gt;, &lt;span id="inline-purple"&gt;主题配置文件&lt;/span&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="引用边框变色">引用边框变色</h3><p id="div-border-left-red">如果没有安装成功, 那可能就是墙的原因. 建议下载 `Node.js` 直接安装. </p><p id="div-border-top-blue">关于更多基本操作和基础知识, 请查阅 [Hexo](https://hexo.io/zh-cn/) 与 [NexT](http://theme-next.iissnan.com/) 官方文档.</p>  <pre class="line-numbers language-none"><code class="language-none">&lt;p id="div-border-left-red"&gt;如果没有安装成功, 那可能就是墙的原因. 建议下载 `Node.js` 直接安装. &lt;/p&gt;&lt;p id="div-border-top-blue"&gt;关于更多基本操作和基础知识, 请查阅 [Hexo](https://hexo.io/zh-cn/) 与 [NexT](http://theme-next.iissnan.com/) 官方文档.&lt;/p&gt;  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="图形边框效果">图形边框效果</h3><p><a id="download" target="_blank" rel="noopener" href="https://git-scm.com/download/win"><i class="fa fa-download"></i><span> Download Now</span><br></a></p><pre class="line-numbers language-none"><code class="language-none">&lt;a id="download" href="https://git-scm.com/download/win"&gt;&lt;i class="fa fa-download"&gt;&lt;/i&gt;&lt;span&gt; Download Now&lt;/span&gt;&lt;/a&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>更多tips可参考 <a target="_blank" rel="noopener" href="https://yangbingdong.com/2017/build-blog-hexo-advanced">blog</a></p><h3 id="在文档中增加图标">在文档中增加图标</h3><ul><li><i class="fa fa-pencil"></i>支持Markdown<br><i>Hexo 支持 GitHub Flavored Markdown 的所有功能, 甚至可以整合 Octopress 的大多数插件. </i></li><li><i class="fa fa-cloud-upload"></i>一件部署<br><i>只需一条指令即可部署到Github Pages, 或其他网站</i></li><li><i class="fa fa-cog"></i>丰富的插件<br><i>Hexo 拥有强大的插件系统, 安装插件可以让 Hexo 支持 Jade, CoffeeScript. </i></li></ul><pre class="line-numbers language-none"><code class="language-none">- &lt;i class="fa fa-pencil"&gt;&lt;/i&gt;支持Markdown&lt;i&gt;Hexo 支持 GitHub Flavored Markdown 的所有功能, 甚至可以整合 Octopress 的大多数插件. &lt;/i&gt;- &lt;i class="fa fa-cloud-upload"&gt;&lt;/i&gt;一件部署&lt;i&gt;只需一条指令即可部署到Github Pages, 或其他网站&lt;/i&gt;- &lt;i class="fa fa-cog"&gt;&lt;/i&gt;丰富的插件&lt;i&gt;Hexo 拥有强大的插件系统, 安装插件可以让 Hexo 支持 Jade, CoffeeScript. &lt;/i&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><i class="fa fa-github"></i><br><i class="fa fa-github fa-lg"></i><br><i class="fa fa-github fa-2x"></i></p><pre class="line-numbers language-none"><code class="language-none">`&lt;i class="fa fa-github"&gt;&lt;/i&gt;``&lt;i class="fa fa-github fa-lg"&gt;&lt;/i&gt;``&lt;i class="fa fa-github fa-2x"&gt;&lt;/i&gt;`<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="图表绘制">图表绘制</h2><ul><li><p><strong><a target="_blank" rel="noopener" href="https://github.com/JameChou/hexo-tag-mermaid">hexo-tag-mermaid</a></strong></p></li><li><p><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=hOwQoD6fIIIe7W28woagTQ%3D%3D.VHuPUTxtKKrWqD9OwRmRWowEiRhfZtrRRPW0tAHaUnugQA9ofUIFaPqb38gbAsyx"><strong>hexo-tag-plantuml</strong></a></p><blockquote><p>hexo-tag-plantuml is a tag plugin for Hexo. It can work with plantuml to draw uml.</p></blockquote><p>在Hexo中绘制uml图。</p></li><li><p><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=7CVDHj4WMnK6vHwS3JXOAQ%3D%3D.VqG%2BdxXCAb%2FdHLPgRnzrtjEUBUuK1EhF%2Fo7ev0Banu7ADAa3cS1GF4ROLNNWkriO"><strong>hexo-filter-flowchart</strong></a></p><blockquote><p>Generate flowchart diagrams for Hexo.</p></blockquote></li></ul><h2 id="Mermaid">Mermaid</h2><blockquote><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/horsee/category_10772579.html">Markdown mermaid教程</a></p></blockquote><h3 id="mermaid"><a target="_blank" rel="noopener" href="https://github.com/mermaid-js/mermaid">mermaid</a></h3><p><a target="_blank" rel="noopener" href="https://github.com/JameChou/hexo-tag-mermaid">hexo-tag-mermaid</a><a target="_blank" rel="noopener" href="https://github.com/two/hexo-tag-plantuml">hexo-tag-plantuml</a></p><blockquote><p><strong>需要用下面块包裹</strong></p></blockquote><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% mermaid %}[内容]{% endmermaid %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>先来几个演示</p><div class="mermaid">  graph LR source(*.java) --javac--&gt; bytecode(*.class) bytecode --java--&gt; result(程序输出)</div><div class="mermaid">  graph LR type(type) -.-&gt; type type -.-&gt; object(object) type -.-&gt; A(A) type -.-&gt; int(int) A -.-&gt; a((a)) int -.-&gt; i((i)) object --&gt; type object --&gt; A</div><h3 id="flowchart">flowchart</h3><p>[<a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid/#/flowchart">docs</a> - <a target="_blank" rel="noopener" href="https://mermaidjs.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoiZ3JhcGggVERcbiAgICBBW0hhcmRdIC0tPnxUZXh0fCBCKFJvdW5kKVxuICAgIEIgLS0-IEN7RGVjaXNpb259XG4gICAgQyAtLT58T25lfCBEW1Jlc3VsdCAxXVxuICAgIEMgLS0-fFR3b3wgRVtSZXN1bHQgMl0iLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9fQ">live editor</a>]</p><pre class="line-numbers language-none"><code class="language-none">{% mermaid %}graph TD    A[Christmas] --&gt;|Get money| B(Go shopping)    B --&gt; C{Let me think}    C --&gt;|One| D[Laptop]    C --&gt;|Two| E[iPhone]    C --&gt;|Three| F[Car]{% endmermaid %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="mermaid">  graph TD    A[Christmas] --&gt;|Get money| B(Go shopping)    B --&gt; C{Let me think}    C --&gt;|One| D[Laptop]    C --&gt;|Two| E[iPhone]    C --&gt;|Three| F[Car]</div><h3 id="Sequence-diagram">Sequence <strong>diagram</strong></h3><p>[<a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid/#/sequenceDiagram">docs</a> - <a target="_blank" rel="noopener" href="https://mermaidjs.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG5BbGljZS0-PkpvaG46IEhlbGxvIEpvaG4sIGhvdyBhcmUgeW91P1xubG9vcCBIZWFsdGhjaGVja1xuICAgIEpvaG4tPj5Kb2huOiBGaWdodCBhZ2FpbnN0IGh5cG9jaG9uZHJpYVxuZW5kXG5Ob3RlIHJpZ2h0IG9mIEpvaG46IFJhdGlvbmFsIHRob3VnaHRzIVxuSm9obi0tPj5BbGljZTogR3JlYXQhXG5Kb2huLT4-Qm9iOiBIb3cgYWJvdXQgeW91P1xuQm9iLS0-PkpvaG46IEpvbGx5IGdvb2QhIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifX0">live editor</a>]</p><pre class="line-numbers language-none"><code class="language-none">{% mermaid %}sequenceDiagram    loop every day        Alice-&gt;&gt;John: Hello John, how are you?        John--&gt;&gt;Alice: Great!    end{% endmermaid %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="mermaid">  sequenceDiagram    loop every day        Alice-&gt;&gt;John: Hello John, how are you?        John--&gt;&gt;Alice: Great!    end</div><h3 id="Gantt-diagram">Gantt <strong>diagram</strong></h3><p>[<a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid/#/gantt">docs</a> - <a target="_blank" rel="noopener" href="https://mermaidjs.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoiZ2FudHRcbnNlY3Rpb24gU2VjdGlvblxuQ29tcGxldGVkIDpkb25lLCAgICBkZXMxLCAyMDE0LTAxLTA2LDIwMTQtMDEtMDhcbkFjdGl2ZSAgICAgICAgOmFjdGl2ZSwgIGRlczIsIDIwMTQtMDEtMDcsIDNkXG5QYXJhbGxlbCAxICAgOiAgICAgICAgIGRlczMsIGFmdGVyIGRlczEsIDFkXG5QYXJhbGxlbCAyICAgOiAgICAgICAgIGRlczQsIGFmdGVyIGRlczEsIDFkXG5QYXJhbGxlbCAzICAgOiAgICAgICAgIGRlczUsIGFmdGVyIGRlczMsIDFkXG5QYXJhbGxlbCA0ICAgOiAgICAgICAgIGRlczYsIGFmdGVyIGRlczQsIDFkIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifX0">live editor</a>]</p><pre class="line-numbers language-none"><code class="language-none">{% mermaid %}gantt    dateFormat  YYYY-MM-DD    title Adding GANTT diagram functionality to mermaid    section A section    Completed task            :done,    des1, 2014-01-06,2014-01-08    Active task               :active,  des2, 2014-01-09, 3d    Future task               :         des3, after des2, 5d    Future task2               :         des4, after des3, 5d    section Critical tasks    Completed task in the critical line :crit, done, 2014-01-06,24h    Implement parser and jison          :crit, done, after des1, 2d    Create tests for parser             :crit, active, 3d    Future task in critical line        :crit, 5d    Create tests for renderer           :2d    Add to mermaid                      :1d    section Documentation    Describe gantt syntax               :active, a1, after des1, 3d    Add gantt diagram to demo page      :after a1  , 20h    Add another diagram to demo page    :doc1, after a1  , 48h    section Last section    Describe gantt syntax               :after doc1, 3d    Add gantt diagram to demo page      : 20h    Add another diagram to demo page    : 48h{% endmermaid %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="mermaid">  gantt    dateFormat  YYYY-MM-DD    title Adding GANTT diagram functionality to mermaid    section A section    Completed task            :done,    des1, 2014-01-06,2014-01-08    Active task               :active,  des2, 2014-01-09, 3d    Future task               :         des3, after des2, 5d    Future task2               :         des4, after des3, 5d        section Critical tasks    Completed task in the critical line :crit, done, 2014-01-06,24h    Implement parser and jison          :crit, done, after des1, 2d    Create tests for parser             :crit, active, 3d    Future task in critical line        :crit, 5d    Create tests for renderer           :2d    Add to mermaid                      :1d        section Documentation    Describe gantt syntax               :active, a1, after des1, 3d    Add gantt diagram to demo page      :after a1  , 20h    Add another diagram to demo page    :doc1, after a1  , 48h        section Last section    Describe gantt syntax               :after doc1, 3d    Add gantt diagram to demo page      : 20h    Add another diagram to demo page    : 48h</div><h3 id="ER图">ER图</h3><div class="mermaid">  erDiagram    CUSTOMER ||--o{ ORDER : places    CUSTOMER {        string name        string custNumber        string sector    }    ORDER ||--|{ LINE-ITEM : contains    ORDER {        int orderNumber        string deliveryAddress    }    LINE-ITEM {        string productCode        int quantity        float pricePerUnit    }</div><pre class="line-numbers language-none"><code class="language-none">erDiagram    CUSTOMER ||--o{ ORDER : places    CUSTOMER {        string name        string custNumber        string sector    }    ORDER ||--|{ LINE-ITEM : contains    ORDER {        int orderNumber        string deliveryAddress    }    LINE-ITEM {        string productCode        int quantity        float pricePerUnit    }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="class"><strong>class</strong></h3><p>[<a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid/#/classDiagram">docs</a> - <a target="_blank" rel="noopener" href="https://mermaidjs.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoiY2xhc3NEaWFncmFtXG5DbGFzczAxIDx8LS0gQXZlcnlMb25nQ2xhc3MgOiBDb29sXG48PGludGVyZmFjZT4-IENsYXNzMDFcbkNsYXNzMDkgLS0-IEMyIDogV2hlcmUgYW0gaT9cbkNsYXNzMDkgLS0qIEMzXG5DbGFzczA5IC0tfD4gQ2xhc3MwN1xuQ2xhc3MwNyA6IGVxdWFscygpXG5DbGFzczA3IDogT2JqZWN0W10gZWxlbWVudERhdGFcbkNsYXNzMDEgOiBzaXplKClcbkNsYXNzMDEgOiBpbnQgY2hpbXBcbkNsYXNzMDEgOiBpbnQgZ29yaWxsYVxuY2xhc3MgQ2xhc3MxMCB7XG4gID4-c2VydmljZT4-XG4gIGludCBpZFxuICBzaXplKClcbn0iLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9fQ">live editor</a>]</p><pre class="line-numbers language-none"><code class="language-none">classDiagramclass Shape{    &lt;&lt;interface&gt;&gt;    noOfVertices    draw()}class Color{    &lt;&lt;enumeration&gt;&gt;    RED    BLUE    GREEN    WHITE    BLACK}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="mermaid">  classDiagramclass Shape{    &lt;<interface>&gt;    noOfVertices    draw()}class Color{    &lt;<enumeration>&gt;    RED    BLUE    GREEN    WHITE    BLACK}</enumeration></interface></div><h3 id="State"><strong>State</strong></h3><p>[<a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid/#/stateDiagram">docs</a> - <a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic3RhdGVEaWFncmFtLXYyXG4gICAgWypdIC0tPiBTdGlsbFxuICAgIFN0aWxsIC0tPiBbKl1cbiAgICBTdGlsbCAtLT4gTW92aW5nXG4gICAgTW92aW5nIC0tPiBTdGlsbFxuICAgIE1vdmluZyAtLT4gQ3Jhc2hcbiAgICBDcmFzaCAtLT4gWypdIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQiLCJ0aGVtZVZhcmlhYmxlcyI6eyJiYWNrZ3JvdW5kIjoid2hpdGUiLCJwcmltYXJ5Q29sb3IiOiIjRUNFQ0ZGIiwic2Vjb25kYXJ5Q29sb3IiOiIjZmZmZmRlIiwidGVydGlhcnlDb2xvciI6ImhzbCg4MCwgMTAwJSwgOTYuMjc0NTA5ODAzOSUpIiwicHJpbWFyeUJvcmRlckNvbG9yIjoiaHNsKDI0MCwgNjAlLCA4Ni4yNzQ1MDk4MDM5JSkiLCJzZWNvbmRhcnlCb3JkZXJDb2xvciI6ImhzbCg2MCwgNjAlLCA4My41Mjk0MTE3NjQ3JSkiLCJ0ZXJ0aWFyeUJvcmRlckNvbG9yIjoiaHNsKDgwLCA2MCUsIDg2LjI3NDUwOTgwMzklKSIsInByaW1hcnlUZXh0Q29sb3IiOiIjMTMxMzAwIiwic2Vjb25kYXJ5VGV4dENvbG9yIjoiIzAwMDAyMSIsInRlcnRpYXJ5VGV4dENvbG9yIjoicmdiKDkuNTAwMDAwMDAwMSwgOS41MDAwMDAwMDAxLCA5LjUwMDAwMDAwMDEpIiwibGluZUNvbG9yIjoiIzMzMzMzMyIsInRleHRDb2xvciI6IiMzMzMiLCJtYWluQmtnIjoiI0VDRUNGRiIsInNlY29uZEJrZyI6IiNmZmZmZGUiLCJib3JkZXIxIjoiIzkzNzBEQiIsImJvcmRlcjIiOiIjYWFhYTMzIiwiYXJyb3doZWFkQ29sb3IiOiIjMzMzMzMzIiwiZm9udEZhbWlseSI6IlwidHJlYnVjaGV0IG1zXCIsIHZlcmRhbmEsIGFyaWFsIiwiZm9udFNpemUiOiIxNnB4IiwibGFiZWxCYWNrZ3JvdW5kIjoiI2U4ZThlOCIsIm5vZGVCa2ciOiIjRUNFQ0ZGIiwibm9kZUJvcmRlciI6IiM5MzcwREIiLCJjbHVzdGVyQmtnIjoiI2ZmZmZkZSIsImNsdXN0ZXJCb3JkZXIiOiIjYWFhYTMzIiwiZGVmYXVsdExpbmtDb2xvciI6IiMzMzMzMzMiLCJ0aXRsZUNvbG9yIjoiIzMzMyIsImVkZ2VMYWJlbEJhY2tncm91bmQiOiIjZThlOGU4IiwiYWN0b3JCb3JkZXIiOiJoc2woMjU5LjYyNjE2ODIyNDMsIDU5Ljc3NjUzNjMxMjglLCA4Ny45MDE5NjA3ODQzJSkiLCJhY3RvckJrZyI6IiNFQ0VDRkYiLCJhY3RvclRleHRDb2xvciI6ImJsYWNrIiwiYWN0b3JMaW5lQ29sb3IiOiJncmV5Iiwic2lnbmFsQ29sb3IiOiIjMzMzIiwic2lnbmFsVGV4dENvbG9yIjoiIzMzMyIsImxhYmVsQm94QmtnQ29sb3IiOiIjRUNFQ0ZGIiwibGFiZWxCb3hCb3JkZXJDb2xvciI6ImhzbCgyNTkuNjI2MTY4MjI0MywgNTkuNzc2NTM2MzEyOCUsIDg3LjkwMTk2MDc4NDMlKSIsImxhYmVsVGV4dENvbG9yIjoiYmxhY2siLCJsb29wVGV4dENvbG9yIjoiYmxhY2siLCJub3RlQm9yZGVyQ29sb3IiOiIjYWFhYTMzIiwibm90ZUJrZ0NvbG9yIjoiI2ZmZjVhZCIsIm5vdGVUZXh0Q29sb3IiOiJibGFjayIsImFjdGl2YXRpb25Cb3JkZXJDb2xvciI6IiM2NjYiLCJhY3RpdmF0aW9uQmtnQ29sb3IiOiIjZjRmNGY0Iiwic2VxdWVuY2VOdW1iZXJDb2xvciI6IndoaXRlIiwic2VjdGlvbkJrZ0NvbG9yIjoicmdiYSgxMDIsIDEwMiwgMjU1LCAwLjQ5KSIsImFsdFNlY3Rpb25Ca2dDb2xvciI6IndoaXRlIiwic2VjdGlvbkJrZ0NvbG9yMiI6IiNmZmY0MDAiLCJ0YXNrQm9yZGVyQ29sb3IiOiIjNTM0ZmJjIiwidGFza0JrZ0NvbG9yIjoiIzhhOTBkZCIsInRhc2tUZXh0TGlnaHRDb2xvciI6IndoaXRlIiwidGFza1RleHRDb2xvciI6IndoaXRlIiwidGFza1RleHREYXJrQ29sb3IiOiJibGFjayIsInRhc2tUZXh0T3V0c2lkZUNvbG9yIjoiYmxhY2siLCJ0YXNrVGV4dENsaWNrYWJsZUNvbG9yIjoiIzAwMzE2MyIsImFjdGl2ZVRhc2tCb3JkZXJDb2xvciI6IiM1MzRmYmMiLCJhY3RpdmVUYXNrQmtnQ29sb3IiOiIjYmZjN2ZmIiwiZ3JpZENvbG9yIjoibGlnaHRncmV5IiwiZG9uZVRhc2tCa2dDb2xvciI6ImxpZ2h0Z3JleSIsImRvbmVUYXNrQm9yZGVyQ29sb3IiOiJncmV5IiwiY3JpdEJvcmRlckNvbG9yIjoiI2ZmODg4OCIsImNyaXRCa2dDb2xvciI6InJlZCIsInRvZGF5TGluZUNvbG9yIjoicmVkIiwibGFiZWxDb2xvciI6ImJsYWNrIiwiZXJyb3JCa2dDb2xvciI6IiM1NTIyMjIiLCJlcnJvclRleHRDb2xvciI6IiM1NTIyMjIiLCJjbGFzc1RleHQiOiIjMTMxMzAwIiwiZmlsbFR5cGUwIjoiI0VDRUNGRiIsImZpbGxUeXBlMSI6IiNmZmZmZGUiLCJmaWxsVHlwZTIiOiJoc2woMzA0LCAxMDAlLCA5Ni4yNzQ1MDk4MDM5JSkiLCJmaWxsVHlwZTMiOiJoc2woMTI0LCAxMDAlLCA5My41Mjk0MTE3NjQ3JSkiLCJmaWxsVHlwZTQiOiJoc2woMTc2LCAxMDAlLCA5Ni4yNzQ1MDk4MDM5JSkiLCJmaWxsVHlwZTUiOiJoc2woLTQsIDEwMCUsIDkzLjUyOTQxMTc2NDclKSIsImZpbGxUeXBlNiI6ImhzbCg4LCAxMDAlLCA5Ni4yNzQ1MDk4MDM5JSkiLCJmaWxsVHlwZTciOiJoc2woMTg4LCAxMDAlLCA5My41Mjk0MTE3NjQ3JSkifX0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9">live editor</a>]</p><pre class="line-numbers language-none"><code class="language-none">{% mermaid %}stateDiagram-v2    [*] --&gt; Still    Still --&gt; [*]    Still --&gt; Moving    Moving --&gt; Still    Moving --&gt; Crash    Crash --&gt; [*]{% endmermaid %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="mermaid">  stateDiagram-v2    [*] --&gt; Still    Still --&gt; [*]    Still --&gt; Moving    Moving --&gt; Still    Moving --&gt; Crash    Crash --&gt; [*]</div><h3 id="Pie"><strong>Pie</strong></h3><p>[<a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid/#/pie">docs</a> - <a target="_blank" rel="noopener" href="https://mermaidjs.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoicGllXG5cIkRvZ3NcIiA6IDQyLjk2XG5cIkNhdHNcIiA6IDUwLjA1XG5cIlJhdHNcIiA6IDEwLjAxIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifX0">live editor</a>]</p><pre class="line-numbers language-none"><code class="language-none">{% mermaid %}pie"Dogs" : 386"Cats" : 85"Rats" : 15{% endmermaid %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="mermaid">  pie"Dogs" : 386"Cats" : 85"Rats" : 15</div><h3 id="User-Journey"><strong>User Journey</strong></h3><p>[<a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid/#/user-journey">docs</a> - <a target="_blank" rel="noopener" href="https://mermaidjs.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic3RhdGVEaWFncmFtXG4gICAgWypdIC0tPiBTdGlsbFxuICAgIFN0aWxsIC0tPiBbKl1cbiAgICBTdGlsbCAtLT4gTW92aW5nXG4gICAgTW92aW5nIC0tPiBTdGlsbFxuICAgIE1vdmluZyAtLT4gQ3Jhc2hcbiAgICBDcmFzaCAtLT4gWypdIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifX0">live editor</a>]</p><pre class="line-numbers language-none"><code class="language-none">{% mermaid %}  journey    title My working day    section Go to work      Make tea: 5: Me      Go upstairs: 3: Me      Do work: 1: Me, Cat    section Go home      Go downstairs: 5: Me      Sit down: 3: Me{% endmermaid %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="mermaid">  journey title My working day section Go to work   Make tea: 5: Me   Go upstairs: 3: Me   Do work: 1: Me, Cat section Go home   Go downstairs: 5: Me   Sit down: 3: Me</div><h2 id="plant-uml">plant uml</h2><p><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=ZnkRBa%2Fre3TQCl7KNJg2Sg%3D%3D.ZEjsSgGk0F1LOYjRqQLWGcsHdjIHjXJJNCwT20OKlas%3D"><strong>PlantUML</strong> </a>是一个允许你快速编写一下图表的组件 :</p><ul><li><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=WnNQQpbhwLLtOvy0iZznAw%3D%3D.ufDzIrmSHLTJOvU%2B%2BrCbHKX7i%2BXDfiAs43p47%2Brd6CPQPzmoRjTx9Yjer2eCPMIx">Sequence diagram</a>（时序图）</li><li><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=swyHFudu0Dv1kgG36K6uKQ%3D%3D.%2F3OTiCZ42cJb5Qx7sx3T0xkD8UzUl2QpmT5nScfRShRBbDCjvTAYmIjQBdcndh5P">Usecase diagram</a></li><li><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=y2iylEjbyP1BkiOoSD3aBQ%3D%3D.Uk3N50fH52eqKvi5pR9V2dCwZ2t88GyGCkB56t0bi51SDzK3TAm8q%2F%2BknYaMp6gq">Class diagram</a>（类图）</li><li><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=ZPF3Fm60rmWHTd6iqgefYw%3D%3D.hetxaEZitHOTlwF26EQHW1ze%2BqQe28tO5Zan9A6PQD7tELizzdVt2LCwJ7Wqni8N">Activity diagram</a> (here is <a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=G1AlcTWhXkwCzalwXO04Tw%3D%3D.RKEPVfhovignZnpee9bltjlVeAZ25VKK5bSbzmo2G225h2cQ3wEKM8LyC23GxRLL">the legacy syntax)</a></li><li><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=Vxtv5M%2FcCgkpBtyWH8mDCA%3D%3D.xTXdTliRpsnQ8OniXrs1V6YfjTy0nSFbS7l7wqvn0uACpHlTJNL9BlF0xb7vfM4Z">Component diagram</a></li><li><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=asRZoWO7I5UQ3wuP84r8hg%3D%3D.vyIPg7GpNKjSjf7e2IS4KO%2Bg6SnD1DLe9DYb9T1CuW2U41s72PgDFuT0hbkp2BO9">State diagram</a></li><li><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=WMWDuC4PoXS%2BUq8UK%2B6m6Q%3D%3D.UaRzixgD%2B8x%2BRoBPDjArHXZEVWCpjnRwzoBn9HZDWAgyM2iggTjoxPJrpjuH5nZL">Object diagram</a></li><li><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=4QYG%2FOLv5kpCA0Wur4JTBg%3D%3D.Ci3AIvz1ie0I6BCUt8a%2BaklDx8hJvKPujkVdWDGw%2BzDTkfdnBBhY5GhX9mIITaMb">Deployment diagram</a>(BETA)</li><li><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=%2Bi9ecBhjJV%2Fo6bPpIo6zEw%3D%3D.b0HW%2B0h7iKI3LibmVdbEmi77twGMobstSrkBWn2n6AucZmIcrNRI7QEhpDEMrUTR">Timing diagram</a>(BETA)</li></ul><p>Hexo安装hexo-tag-plantuml插件，便能使其绘制的图表在博客上展示，其原理其实使用的是 PlantUML 提供的在线服务, 只是简单地将标签包裹的代码传给服务器, 获取生成的链接, 生成 img标签替换原来的代码区域.</p><blockquote><p><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=Om2tsztpVQpl48NLQP8wPg%3D%3D.lA5QuvRnDCcbundLA81sGH8MG3E6QjnIJQ6%2BgojZWH8%3D">plantUML在线编辑网站</a></p></blockquote><p>可使用HTML标签将其嵌套</p><pre class="line-numbers language-none"><code class="language-none">{% plantuml %}title Relationships - Class Diagramclass Dwelling {  +Int Windows  +void LockTheDoor()}class Apartmentclass Houseclass Communeclass Windowclass DoorDwelling &lt;|-down- Apartment: InheritanceDwelling &lt;|-down- Commune: InheritanceDwelling &lt;|-down- House: InheritanceDwelling "1" *-up- "many" Window: CompositionDwelling "1" *-up- "many" Door: Composition{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="http://www.plantuml.com/plantuml/svg/XP0z2y8m48Rt_8gZanzaS2qkKWSBJY8uXpQqXybTQ5ABgF_TrhQAuCUMbpptt4V0O3Jij541cNo9peE4n2ZlOOsgg9GL8kjZeur1Ak0Y0EOf1JWWvTpuBfuOSzXoTjoNUirSJQRYDXQkdAg2rHI6lE7Qw-6TiBKrZQaNZlrQZH3FhikhRFz8ldGnf5Jg2eEYJ7y01_S_x37E5oXQH32JjPCGMKNdQ9WmxjoEFNP7-q5tAxonTm00"><pre class="line-numbers language-none"><code class="language-none">{% plantuml %}[内容]{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="时序图"><a target="_blank" rel="noopener" href="https://plantuml.com/zh/timing-diagram">时序图</a></h3><pre class="line-numbers language-none"><code class="language-none">{% plantuml %}    Bob-&gt;Alice : hello{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><img src="http://www.plantuml.com/plantuml/svg/SyfFqhLppCbCJbMmKiX8pSd91m00"><pre class="line-numbers language-none"><code class="language-none">Alice -&gt; Bob: Authentication RequestBob --&gt; Alice: Authentication ResponseAlice -&gt; Bob: Another authentication RequestAlice &lt;-- Bob: Another authentication Response<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="http://www.plantuml.com/plantuml/svg/Syp9J4vLqBLJSCfFib9mB2t9ICqhoKnEBCdCprC8IYqiJIqkuGBAAUW2rJY256DHLLoGdrUSoiNbY6fONZvGNP528dP38OfjT7K9g8OO3W00"><h3 id="用例图"><a target="_blank" rel="noopener" href="https://plantuml.com/zh/use-case-diagram">用例图</a></h3><pre class="line-numbers language-none"><code class="language-none">{% plantuml %}User -&gt; (Start)User --&gt; (Use the application) : A small label:Main Admin: ---&gt; (Use the application) : This is\nyet another\nlabel{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="类图"><a target="_blank" rel="noopener" href="https://plantuml.com/zh/class-diagram">类图</a></h3><pre class="line-numbers language-none"><code class="language-none">{% plantuml %}class Object &lt;&lt; general &gt;&gt;Object &lt;|--- ArrayListnote top of Object : In java, every class\nextends this one.note "This is a floating note" as N1note "This note is connected\nto several objects." as N2Object .. N2N2 .. ArrayListclass Foonote left: On last defined class{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="活动图"><a target="_blank" rel="noopener" href="https://plantuml.com/zh/activity-diagram-beta">活动图</a></h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% plantuml %}@startumlstartif (Graphviz 已安装?) then (yes)  :处理所有\n绘制任务;else (no)  :仅处理  <span class="token bold"><span class="token punctuation">__</span><span class="token content">时序图</span><span class="token punctuation">__</span></span> 和 <span class="token bold"><span class="token punctuation">__</span><span class="token content">活动</span><span class="token punctuation">__</span></span> 图;endifstop@enduml{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="http://www.plantuml.com/plantuml/svg/SoWkIImgAStDuG8pkBWoqnGqt8iI2pBACgiKdcxVz7HTvul5hVQQ2YKPgNaA6fMfnPfS2WfMJvUqF9_GzgopuTcSpfYyvxjdFEtOzcJtxgTT2wsvKdEAKnKqylB12f_iReMe1NBYuvzDt_PqL__JsVlYunMUJke1YMm1Qbe1uixU1zIQbvAPnWLqItu1bmEG0tGO0000"><h3 id="组件图"><a target="_blank" rel="noopener" href="https://plantuml.com/zh/component-diagram">组件图</a></h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% plantuml %}@startuml[First component][Another component] as Comp2component Comp3component [Last\ncomponent] as Comp4@enduml{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="http://www.plantuml.com/plantuml/svg/SoWkIImgAStDuUAATiiiAYvHICxFBSZFIyqhYUMATipBByb8BK8IKqWiLd06yeouu69WlZ4IFzediRWa9WzJamaNbqDgNWhGDW00"><h3 id="状态图"><a target="_blank" rel="noopener" href="https://plantuml.com/zh/state-diagram">状态图</a></h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% plantuml %}@startuml[<span class="token italic"><span class="token punctuation">*</span><span class="token content">] --&gt; State1State1 --&gt; [</span><span class="token punctuation">*</span></span>]State1 : this is a stringState1 : this is another stringState1 -&gt; State2State2 --&gt; [*]@enduml{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="http://www.plantuml.com/plantuml/svg/SoWkIImgAStDuUAArefLqDMrKmWkIIn9DUI2K60He0oCQwLGaf5Ph014YGh59KMPUUbOPFBoIp9IYs3oS9EWHXj118pWHdCvfEQb09q00000"><h3 id="对象图"><a target="_blank" rel="noopener" href="https://plantuml.com/zh/object-diagram">对象图</a></h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% plantuml %}@startuml PERTleft to right direction' Horizontal lines: --&gt;, <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>--,</span> <span class="token attr-name">&lt;--</span><span class="token punctuation">&gt;</span></span>' Vertical lines: -&gt;, <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>-,</span> <span class="token attr-name">&lt;-</span><span class="token punctuation">&gt;</span></span>title PERT: Project Namemap Kick.Off {}map task.1 {    Start =&gt; End}map task.2 {    Start =&gt; End}map task.3 {    Start =&gt; End}map task.4 {    Start =&gt; End}map task.5 {    Start =&gt; End}Kick.Off --&gt; task.1 : Label 1Kick.Off --&gt; task.2 : Label 2Kick.Off --&gt; task.3 : Label 3task.1 --&gt; task.4task.2 --&gt; task.4task.3 --&gt; task.4task.4 --&gt; task.5 : Label 4@enduml{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="http://www.plantuml.com/plantuml/svg/XP7DQiCm48Jl-nHpwoKEn3yNqvfS0e64r3IbTyMM4oMo5EJjfQNl7iMaIcWD5gn0yosp8tRUiN3ysMgKYxTtqh9Xi8LJ-mEZLavMhAoX9oojKr_MiD3GoiWkHnGL4pn7KNyLlkL3EbRLGqFFhrKGAzQodv6ZTFReVR4HhIHgnHahLPschqs3R_hf1HRTQJhpJ_YplKR4Iu65gHzvFCAJ4PwEy6oOXx3-rxz1Swp5JchC1cWSQ3n0aq0Jkfa5bjBDuA-I_5FIkv85nvJcqjH-kHS0"><h3 id="部署图"><a target="_blank" rel="noopener" href="https://plantuml.com/zh/deployment-diagram">部署图</a></h3><pre class="line-numbers language-none"><code class="language-none">{% plantuml %}@startumlactor actoragent agentartifact artifactboundary boundarycard cardcloud cloudcomponent componentcontrol controldatabase databaseentity entityfile filefolder folderframe frameinterface  interfacenode nodepackage packagequeue queuestack stackrectangle rectanglestorage storageusecase usecase@enduml{% endplantuml %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="http://www.plantuml.com/plantuml/svg/FP1B4eGm24JtVGgEubKmGSio1WV9mjiFyRTv_Gho8HaEP_Es5N1oDRe8dgKwNKIqbodAz0f6RJMpdVGA4bkc3gIYBRGJIRTTQp_fiwXLDotq938xZtm8lO9OjVX9Ts1QYb079YrPZEx0PBn5enDBTR6OJ8W-HTKir86TqnfFeIVnQzA4BY9UdrQw29FaNEUuxxFeg_MzJw8TalgqJsAGckFp_W00"><h2 id="URL-卡片"><a target="_blank" rel="noopener" href="https://github.com/toastsgithub/hexo-valkyr-url">URL 卡片</a></h2><div class="vkr-url-wrapper"><style>.vkr-url-wrapper {    padding: 10px;    border-radius: 5px;    border: 1px solid;    border-color: #eee #ddd #bbb;    box-shadow: rgba(0,0,0,.14) 0 1px 3px;    margin-bottom: 10px;    display: flex;}.vkr-url-wrapper .desc-wrapper > hr {    margin: 10px 0;    height: 1px;}.vkr-url-wrapper .avatar {    width: 100px;    height: 100px;    border: solid 1px #eee;    box-shadow: none!important;    margin: 0;    margin-right: 10px;}.vkr-url-wrapper h2 {    border: none;    margin: 0;    padding: 0;}.vkr-url-wrapper .desc-wrapper {    flex: 1;}.vkr-url-wrapper .desc-wrapper a {    font-size: 22px;    font-weight: 700;}</style>            <a target="_blank" rel="noopener" href="https://github.com/toastsgithub/valkyr-ssh"><img class="avatar" src="http://images2.dzmtoast.top/post-cover/github-logo_hub2899c31b6ca7aed8d6a218f0e752fe4_46649_1200x1200_fill_box_center_2.png"></a>        <div class="desc-wrapper">        <a target="_blank" rel="noopener" href="https://github.com/toastsgithub/valkyr-ssh">valkyr ssh manager</a>        <hr>        <div class="desc">valkyr-ssh, a simple commandline tool to help you store ssh login address</div>    </div></div><pre class="line-numbers language-none"><code class="language-none">{% valkyrurl[url=https://github.com/toastsgithub/valkyr-ssh][title="valkyr ssh manager"][avatar=http://images2.dzmtoast.top/post-cover/github-logo_hub2899c31b6ca7aed8d6a218f0e752fe4_46649_1200x1200_fill_box_center_2.png][desc="valkyr-ssh, a simple commandline tool to help you store ssh login address"]%}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">{% valkyrurl [url=http://example.com] [otherOpt=value] %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>avatar</code> image that describe your link (optional)</li><li><code>title</code> title</li><li><code>desc</code> description</li><li><code>url</code> destination when you click image url or title</li><li>空格要用引号包裹起来！</li></ul><h2 id="BILIBILI卡片"><a target="_blank" rel="noopener" href="https://github.com/MaxChang3/hexo-bilibili-card">BILIBILI卡片</a></h2><div class="bvideo">    <a href="//www.bilibili.com/video/BV1sr4y1K7Be" target="_blank">        <div class="bvideo-box">            <div class="bvideo-cover">                <div class="cover-default"></div>                <div class="bvideo-cover-layer" style="background-image:url(https://images.weserv.nl/?url=http://i1.hdslb.com/bfs/archive/ee23c0ab56c3e29838f1081a76cf55c5a6199bf0.jpg)">                    <i class="icon-video"></i>                </div>                <span class="duration">52:09:00</span>            </div>            <div class="bvideo-info">                <p class="title">【PKU】高等数学（全60讲)</p>                <p class="card-status">                    <span class="play-num">                        <i class="fa fa-youtube-play"></i>                        <span>26.6万</span></span>                    <span>                        <i class="fa fa-list-alt"></i>                        <span>148</span></span></p>                <div class="partition">                    <label class="card-label">视频</label>                    <label class="up-label"></label>                    <label class="up-name">沉迷学习的PickleFermi</label>                </div>                <div class="actions hide"></div>            </div>        </div>    </a></div><pre class="line-numbers language-none"><code class="language-none">{% bilicard your_video_id %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="hexo-github-card"><strong><a target="_blank" rel="noopener" href="https://github.com/Gisonrg/hexo-github-card">hexo-github-card</a></strong></h2><pre class="line-numbers language-none"><code class="language-none">{% githubCard user:your_user [repo:your_repo] [width:400] [height:200] [theme:default] [client_id:your_client_id] [client_secret:your_client_secret] [align:text-align_position] %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% githubCard user:appotry %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% githubCard user:appotry repo:hexo-github-card %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div style="text-align: center">  <div class="github-card" data-user="appotry" data-repo="" data-height="200" data-width="400" data-theme="default" data-target="" data-client-id="" data-client-secret=""></div></div><script src="/github-card-lib/githubcard.js"></script><div style="text-align: center">  <div class="github-card" data-user="appotry" data-repo="docker-hexo" data-height="200" data-width="400" data-theme="default" data-target="" data-client-id="" data-client-secret=""></div></div><script src="/github-card-lib/githubcard.js"></script><div style="text-align: center">  <div class="github-card" data-user="appotry" data-repo="PTtool" data-height="200" data-width="400" data-theme="default" data-target="" data-client-id="" data-client-secret=""></div></div><script src="/github-card-lib/githubcard.js"></script><h2 id="hexo-douban-card"><a target="_blank" rel="noopener" href="https://github.com/TankNee/hexo-douban-card">hexo-douban-card</a></h2><div class="douban-card-block">    <a class="douban-card" target="_blank" rel="noopener" href="https://movie.douban.com/subject/24745500">        <div class="douban-card-bgimg" style="background-image: url('https://images.weserv.nl/?url=https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2194066391.jpg');"></div>        <div class="douban-card-left">            <div class="douban-card-img" style="background-image: url('https://images.weserv.nl/?url=https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2194066391.jpg');"></div>            <div class="douban-card-status">灯影绰约</div>        </div>        <div class="douban-card-right">            <div class="douban-card-item"><span>电影名: </span><strong>绣春刀(2014)</strong></div>            <div class="douban-card-item"><span>导演: </span><span>路阳</span></div>            <div class="douban-card-item"><span>主演: </span><span>张震/刘诗诗</span></div>            <div class="douban-card-item"><span>上映时间: </span><span>2014-08-07(中国大陆)</span></div>            <div class="douban-card-item"><span>评分: </span><span>7.6</span></div>        </div>    </a></div><style>    .douban-card-block {    display: flex;    justify-content: center;    align-items: center;    width: 100%;    max-height: 400px;}.douban-card {    display: flex;    margin: 30px 10px;    padding: 15px;    border-radius: 15px;    position: relative;    justify-content: center;    align-items: center;    overflow: hidden;    color: antiquewhite;    text-decoration: none;}.douban-card:hover {    text-decoration: none;}.douban-card-bgimg {    position: absolute;    width: 115%;    height: 115%;    filter: blur(15px) brightness(0.6);    background-size: 100%;    background-position: center;    background-repeat: no-repeat;}.douban-card-img {    position: relative;    height: 130px;    width: 80px;    background-size: 100%;    background-position: center;    background-repeat: no-repeat;}.douban-card-left:hover .douban-card-img {    filter: blur(5px) brightness(0.6);    transform: perspective(800px) rotateX(180deg);}.douban-card-left .douban-card-img {    transition: all 500ms ease;}.douban-card-left {    position: relative;    display: flex;    flex-direction: column;    align-items: center;}.douban-card-left .douban-card-status {    height: 130px;    width: 80px;    text-align: center;    font-weight: bold;    position: absolute;    left: 0;    top: 30%;    transform: rotateX(180deg);    backface-visibility: hidden;    transition: all 500ms ease;}.douban-card-left:hover .douban-card-status {    transform: perspective(800px) rotateX(0deg);}.douban-card-right {    position: relative;    display: flex;    flex-direction: column;    margin-left: 12px;    font-size: 16px;    font-family: "Courier New", Courier, monospace;    line-height: 1.3;    color: antiquewhite;}.douban-card-item {    margin-top: 4px;}</style><div class="douban-card-block">    <a class="douban-card" target="_blank" rel="noopener" href="https://book.douban.com/subject/30376420">        <div class="douban-card-bgimg" style="background-image: url('https://images.weserv.nl/?url=https://img1.doubanio.com/view/subject/s/public/s30015279.jpg');">        </div>        <div class="douban-card-left">            <div class="douban-card-img" style="background-image: url('https://images.weserv.nl/?url=https://img1.doubanio.com/view/subject/s/public/s30015279.jpg');">            </div>            <div class="douban-card-status">见字如晤</div>        </div>        <div class="douban-card-right" style="line-height: 1.7;">            <div class="douban-card-item"><span>书名: </span><strong>一个人生活</strong></div>            <div class="douban-card-item"><span>作者: </span><span>[日]谷川俊太郎</span></div>            <div class="douban-card-item"><span>出版年份: </span><span>2019-3</span></div>            <div class="douban-card-item"><span>评分: </span><span>7.1</span></div>        </div>    </a></div><style>    .douban-card-block {    display: flex;    justify-content: center;    align-items: center;    width: 100%;    max-height: 400px;}.douban-card {    display: flex;    margin: 30px 10px;    padding: 15px;    border-radius: 15px;    position: relative;    justify-content: center;    align-items: center;    overflow: hidden;    color: antiquewhite;    text-decoration: none;}.douban-card:hover {    text-decoration: none;}.douban-card-bgimg {    position: absolute;    width: 115%;    height: 115%;    filter: blur(15px) brightness(0.6);    background-size: 100%;    background-position: center;    background-repeat: no-repeat;}.douban-card-img {    position: relative;    height: 130px;    width: 80px;    background-size: 100%;    background-position: center;    background-repeat: no-repeat;}.douban-card-left:hover .douban-card-img {    filter: blur(5px) brightness(0.6);    transform: perspective(800px) rotateX(180deg);}.douban-card-left .douban-card-img {    transition: all 500ms ease;}.douban-card-left {    position: relative;    display: flex;    flex-direction: column;    align-items: center;}.douban-card-left .douban-card-status {    height: 130px;    width: 80px;    text-align: center;    font-weight: bold;    position: absolute;    left: 0;    top: 30%;    transform: rotateX(180deg);    backface-visibility: hidden;    transition: all 500ms ease;}.douban-card-left:hover .douban-card-status {    transform: perspective(800px) rotateX(0deg);}.douban-card-right {    position: relative;    display: flex;    flex-direction: column;    margin-left: 12px;    font-size: 16px;    font-family: "Courier New", Courier, monospace;    line-height: 1.3;    color: antiquewhite;}.douban-card-item {    margin-top: 4px;}</style><div class="douban-card-block"><a class="douban-card" target="_blank" rel="noopener" href="https://music.douban.com/subject/35099703"><div class="douban-card-bgimg" style="background-image: url('https://images.weserv.nl/?url=https://img1.doubanio.com/view/subject/m/public/s33667479.jpg');"></div><div class="douban-card-left"><div class="douban-card-img" style="background-image: url('https://images.weserv.nl/?url=https://img1.doubanio.com/view/subject/m/public/s33667479.jpg');"></div>            <div class="douban-card-status">余音绕梁</div>        </div><div class="douban-card-right"><div class="douban-card-item"><span>音乐名: </span><strong>María</strong></div><div class="douban-card-item"><span>表演者: </span><span>화사/华莎</span></div><div class="douban-card-item"><span>发行时间: </span><span>2020-06-30</span></div><div class="douban-card-item"><span>评分: </span><span>8.3</span></div></div></a></div><style>    .douban-card-block {    display: flex;    justify-content: center;    align-items: center;    width: 100%;    max-height: 400px;}.douban-card {    display: flex;    margin: 30px 10px;    padding: 15px;    border-radius: 15px;    position: relative;    justify-content: center;    align-items: center;    overflow: hidden;    color: antiquewhite;    text-decoration: none;}.douban-card:hover {    text-decoration: none;}.douban-card-bgimg {    position: absolute;    width: 115%;    height: 115%;    filter: blur(15px) brightness(0.6);    background-size: 100%;    background-position: center;    background-repeat: no-repeat;}.douban-card-img {    position: relative;    height: 130px;    width: 80px;    background-size: 100%;    background-position: center;    background-repeat: no-repeat;}.douban-card-left:hover .douban-card-img {    filter: blur(5px) brightness(0.6);    transform: perspective(800px) rotateX(180deg);}.douban-card-left .douban-card-img {    transition: all 500ms ease;}.douban-card-left {    position: relative;    display: flex;    flex-direction: column;    align-items: center;}.douban-card-left .douban-card-status {    height: 130px;    width: 80px;    text-align: center;    font-weight: bold;    position: absolute;    left: 0;    top: 30%;    transform: rotateX(180deg);    backface-visibility: hidden;    transition: all 500ms ease;}.douban-card-left:hover .douban-card-status {    transform: perspective(800px) rotateX(0deg);}.douban-card-right {    position: relative;    display: flex;    flex-direction: column;    margin-left: 12px;    font-size: 16px;    font-family: "Courier New", Courier, monospace;    line-height: 1.3;    color: antiquewhite;}.douban-card-item {    margin-top: 4px;}</style><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% douban movie 24745500 %}{% douban book 30376420 %}{% douban music 35099703 %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="插入音乐和视频">插入音乐和视频</h2><blockquote><ul><li><a target="_blank" rel="noopener" href="https://github.com/MoePlayer/hexo-tag-aplayer">hexo-tag-aplayer</a></li><li><a target="_blank" rel="noopener" href="https://github.com/MoePlayer/hexo-tag-dplayer">hexo-tag-dplayer</a></li><li><a target="_blank" rel="noopener" href="https://github.com/u2sb/hexo-tag-mmedia">hexo-tag-mmedia</a> 推荐使用</li></ul></blockquote><h3 id="插入音乐">插入音乐</h3><blockquote><p><a target="_blank" rel="noopener" href="https://github.com/MoePlayer/hexo-tag-aplayer/blob/master/docs/README-zh_cn.md">官方教程</a></p></blockquote><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% aplayer title author url [picture_url, narrow, autoplay, width:xxx, lrc:xxx] %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>title</code> : 曲目标题</li><li><code>author</code>: 曲目作者</li><li><code>url</code>: 音乐文件 URL 地址</li><li><code>picture_url</code>: (可选) 音乐对应的图片地址</li><li><code>narrow</code>: （可选）播放器袖珍风格</li><li><code>autoplay</code>: (可选) 自动播放，移动端浏览器暂时不支持此能</li><li><code>width:xxx</code>: (可选) 播放器宽度 (默认: 100%)</li><li><code>lrc:xxx</code>: （可选）歌词文件 URL #### <em><strong>单曲附带歌词显示</strong></em></li></ul>        <div id="aplayer-uODWQCXd" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;">            <pre class="aplayer-lrc-content"></pre>        </div>        <script>          var ap = new APlayer({            element: document.getElementById("aplayer-uODWQCXd"),            narrow: false,            autoplay: false,            showlrc: 3,            music: {              title: "Hotel California",              author: "Camille and Kennerly",              url: "https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.mp3",              pic: "https://cdn.17lai.site/media/music/Hotel%20California/Hotel%20California.webp",              lrc: "https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.lrc"            }          });          window.aplayers || (window.aplayers = []);          window.aplayers.push(ap);        </script>#### **音乐播放列表**<pre class="line-numbers language-none"><code class="language-none">{% aplayerlist %}{    "narrow": false,                          // （可选）播放器袖珍风格    "autoplay": true,                         // （可选) 自动播放，移动端浏览器暂时不支持此功能    "mode": "random",                         // （可选）曲目循环类型，有 'random'（随机播放）, 'single' (单曲播放), 'circulation' (循环播放), 'order' (列表播放)， 默认：'circulation'     "showlrc": 3,                             // （可选）歌词显示配置项，可选项有：1,2,3    "mutex": true,                            // （可选）该选项开启时，如果同页面有其他 aplayer 播放，该播放器会暂停    "theme": "#e6d0b2",                      // （可选）播放器风格色彩设置，默认：#b7daff    "preload": "metadata",                    // （可选）音乐文件预载入模式，可选项： 'none' 'metadata' 'auto', 默认: 'auto'    "listmaxheight": "513px",                 // (可选) 该播放列表的最大长度    "music": [        {            "title": "CoCo",            "author": "Jeff Williams",            "url": "caffeine.mp3",            "pic": "caffeine.jpeg",            "lrc": "caffeine.txt"        },        {            "title": "アイロニ",            "author": "鹿乃",            "url": "irony.mp3",            "pic": "irony.jpg"        }    ]}{% endaplayerlist %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>        <div id="aplayer-ZZHpoRpW" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;"></div>  <script>  var options = {"narrow":false,"autoplay":true,"showlrc":3,"mode":"random","mutex":true,"theme":"#e6d0b2","preload":"metadata","listmaxheight":"513px","music":[{"title":"Hotel California","author":"Camille and Kennerly","url":"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.mp3","pic":"https://cdn.17lai.site/media/music/Hotel%20California/Hotel%20California.webp","lrc":"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.lrc"},{"title":"Sold Out","author":"Diamonds","url":"https://cdn.17lai.site/media/music/Diamonds/05%20Sold%20Out.flac","pic":"https://cdn.17lai.site/media/music/Diamonds/Diamonds.jpg"}]};  options.element = document.getElementById("aplayer-ZZHpoRpW");  var ap = new APlayer(options);    window.aplayers || (window.aplayers = []);  window.aplayers.push(ap);  </script><h3 id="插入视频">插入视频</h3><blockquote><p><a target="_blank" rel="noopener" href="http://dplayer.js.org/guide.html">官方教程</a></p></blockquote><pre class="line-numbers language-none"><code class="language-none">{% dplayer key=value ... %}例：{% dplayer "url=http://www.nenu.edu.cn/_upload/article/videos/03/5f/7c999eed42e3aadc413d7f851f0e/0f50b3eb-9285-41d2-ac4d-6cc363651aad_B.mp4"  "autoplay=true" "preload=metadata" "hotkey=true" %} <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>有关的选项列表如下:</p><table><thead><tr><th style="text-align:left">选项</th><th style="text-align:left">默认值</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">url</td><td style="text-align:left"><strong>必须值</strong></td><td style="text-align:left">视频地址</td></tr><tr><td style="text-align:left">loop</td><td style="text-align:left"><code>false</code></td><td style="text-align:left">视频循环播放</td></tr><tr><td style="text-align:left">volume</td><td style="text-align:left"><code>0.7</code></td><td style="text-align:left">播放器音量</td></tr><tr><td style="text-align:left">hotkey</td><td style="text-align:left"><code>true</code></td><td style="text-align:left">开启热键</td></tr><tr><td style="text-align:left">autoplay</td><td style="text-align:left"><code>true</code></td><td style="text-align:left">自动播放，移动端浏览器暂时不支持此功能</td></tr><tr><td style="text-align:left">logo</td><td style="text-align:left"><code>-</code></td><td style="text-align:left">在左上角展示一个 logo，你可以通过 CSS 调整它的大小和位置</td></tr><tr><td style="text-align:left">mutex</td><td style="text-align:left"><code>true</code></td><td style="text-align:left">该选项开启时，如果同页面有其他播放，该播放器会暂停</td></tr><tr><td style="text-align:left">highlight</td><td style="text-align:left"><code>[]</code></td><td style="text-align:left">自定义进度条提示点</td></tr><tr><td style="text-align:left">preload</td><td style="text-align:left"><code>auto</code></td><td style="text-align:left">视频文件预载入模式，可选项： <code>none</code>, <code>metadata</code>, <code>auto</code></td></tr><tr><td style="text-align:left">theme</td><td style="text-align:left"><code>#ad7a86</code></td><td style="text-align:left">播放器风格色彩设置</td></tr></tbody></table><p>注：如果使用腾讯视频、优酷视频等在线视频网站的资源，需要先进行视频地址解析，如<a target="_blank" rel="noopener" href="http://old.flvurl.cn/">点量视频解析</a>，获取到实际的视频地址。</p><p>在使用优酷或者腾讯视频时可以直接复制分享代码到文章中，如：</p><pre class="line-numbers language-none"><code class="language-none">&lt;iframe height=498 width=510 src='https://player.youku.com/embed/XMjk4ODAyMzIyOA==' frameborder=0 'allowfullscreen'&gt;&lt;/iframe&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><strong>dplayer</strong></li></ul><pre class="line-numbers language-none"><code class="language-none">{% dplayer "url=http://www.nenu.edu.cn/_upload/article/videos/03/5f/7c999eed42e3aadc413d7f851f0e/0f50b3eb-9285-41d2-ac4d-6cc363651aad_B.mp4"  "autoplay=false" "preload=metadata" "hotkey=true" %} <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><strong>iframe</strong></li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>498</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>510</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>https://player.youku.com/embed/XMjk4ODAyMzIyOA==<span class="token punctuation">'</span></span> <span class="token attr-name">frameborder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>0</span> <span class="token attr-name">'allowfullscreen'</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="hexo-tag-mmedia使用"><a target="_blank" rel="noopener" href="https://github.com/u2sb/hexo-tag-mmedia">hexo-tag-mmedia</a>使用</h3><blockquote><p><a target="_blank" rel="noopener" href="https://www.u2sb.com/pages/7c33e5/">官方教程</a></p></blockquote><h4 id="audio"><strong>audio</strong></h4><blockquote><p>此部分请熟读 <a target="_blank" rel="noopener" href="https://www.w3.org/TR/2014/REC-html5-20141028/embedded-content-0.html#the-audio-element">Audio 相关介绍</a></p><p>目前主题中不可用</p></blockquote><ul><li>使用 <code>:</code> 或 <code>=</code> 分割。</li><li>所有 <code>&lt;audio&gt;</code> 标签的原生参数均可添加，只要能写进去就可以。</li><li>具体能否实现相关标准，取决于客户端浏览器。</li></ul><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">mmedia</span> <span class="token string"><span class="token punctuation">"</span>audio<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>src:a.mp3<span class="token punctuation">"</span></span> <span class="token delimiter punctuation">%}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">mmedia</span> <span class="token string"><span class="token punctuation">"</span>audio<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>src:https://baidu.com/a.mp3<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>autoplay:true<span class="token punctuation">"</span></span> <span class="token delimiter punctuation">%}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="video">video</h4><blockquote><p>此部分请熟读 <a target="_blank" rel="noopener" href="https://www.w3.org/TR/2014/REC-html5-20141028/embedded-content-0.html#the-video-element">Video 相关介绍</a></p><p>目前主题中不可用</p></blockquote><ul><li>使用 <code>:</code> 或 <code>=</code> 分割。</li><li>所有 <code>&lt;video&gt;</code> 标签的原生参数均可添加，只要能写进去就可以。</li><li>具体能否实现相关标准，取决于客户端浏览器。</li></ul><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">mmedia</span> <span class="token string"><span class="token punctuation">"</span>video<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>src:a.mp4<span class="token punctuation">"</span></span> <span class="token delimiter punctuation">%}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">mmedia</span> <span class="token string"><span class="token punctuation">"</span>video<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>src:https://baidu.com/a.mp4<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>autoplay:true<span class="token punctuation">"</span></span> <span class="token delimiter punctuation">%}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="MetingJS"><strong>MetingJS</strong></h4><blockquote><p>此部分请熟读 <a target="_blank" rel="noopener" href="https://github.com/metowolf/MetingJS#option">MetingJS 文档</a></p></blockquote><table><thead><tr><th style="text-align:left">option</th><th style="text-align:center">default</th><th style="text-align:left">description</th></tr></thead><tbody><tr><td style="text-align:left">id</td><td style="text-align:center"><strong>require</strong></td><td style="text-align:left">song id / playlist id / album id / search keyword</td></tr><tr><td style="text-align:left">server</td><td style="text-align:center"><strong>require</strong></td><td style="text-align:left">music platform: <code>netease</code>, <code>tencent</code>, <code>kugou</code>, <code>xiami</code>, <code>baidu</code></td></tr><tr><td style="text-align:left">type</td><td style="text-align:center"><strong>require</strong></td><td style="text-align:left"><code>song</code>, <code>playlist</code>, <code>album</code>, <code>search</code>, <code>artist</code></td></tr><tr><td style="text-align:left">auto</td><td style="text-align:center">options</td><td style="text-align:left">music link, support: <code>netease</code>, <code>tencent</code>, <code>xiami</code></td></tr><tr><td style="text-align:left">fixed</td><td style="text-align:center"><code>false</code></td><td style="text-align:left">enable fixed mode</td></tr><tr><td style="text-align:left">mini</td><td style="text-align:center"><code>false</code></td><td style="text-align:left">enable mini mode</td></tr><tr><td style="text-align:left">autoplay</td><td style="text-align:center"><code>false</code></td><td style="text-align:left">audio autoplay</td></tr><tr><td style="text-align:left">theme</td><td style="text-align:center"><code>#2980b9</code></td><td style="text-align:left">main color</td></tr><tr><td style="text-align:left">loop</td><td style="text-align:center"><code>all</code></td><td style="text-align:left">player loop play, values: ‘all’, ‘one’, ‘none’</td></tr><tr><td style="text-align:left">order</td><td style="text-align:center"><code>list</code></td><td style="text-align:left">player play order, values: ‘list’, ‘random’</td></tr><tr><td style="text-align:left">preload</td><td style="text-align:center"><code>auto</code></td><td style="text-align:left">values: ‘none’, ‘metadata’, ‘auto’</td></tr><tr><td style="text-align:left">volume</td><td style="text-align:center"><code>0.7</code></td><td style="text-align:left">default volume, notice that player will remember user setting, default volume will not work after user set volume themselves</td></tr><tr><td style="text-align:left">mutex</td><td style="text-align:center"><code>true</code></td><td style="text-align:left">prevent to play multiple player at the same time, pause other players when this player start play</td></tr><tr><td style="text-align:left">lrc-type</td><td style="text-align:center"><code>0</code></td><td style="text-align:left">lyric type</td></tr><tr><td style="text-align:left">list-folded</td><td style="text-align:center"><code>false</code></td><td style="text-align:left">indicate whether list should folded at first</td></tr><tr><td style="text-align:left">list-max-height</td><td style="text-align:center"><code>340px</code></td><td style="text-align:left">list max height</td></tr><tr><td style="text-align:left">storage-name</td><td style="text-align:center"><code>metingjs</code></td><td style="text-align:left">localStorage key that store player setting</td></tr></tbody></table><p>Documentation for APlayer can be found at https://aplayer.js.org/#/home?id=options</p><p><strong>单曲</strong></p><pre class="line-numbers language-none"><code class="language-none">{% mmedia "meting" "auto=https://y.qq.com/n/ryqq/songDetail/0005RQAO3FqG5K" %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js metin="meting" auto="https://y.qq.com/n/ryqq/songDetail/0005RQAO3FqG5K"></meting-js><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">mmedia</span> <span class="token string"><span class="token punctuation">"</span>meting<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>auto=https://y.qq.com/n/yqq/song/001RGrEX3ija5X.html<span class="token punctuation">"</span></span> <span class="token delimiter punctuation">%}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">mmedia</span> <span class="token string"><span class="token punctuation">"</span>meting<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>server=netease<span class="token punctuation">"</span></span><span class="token string"><span class="token punctuation">"</span>type=playlist<span class="token punctuation">"</span></span><span class="token string"><span class="token punctuation">"</span>id=60198<span class="token punctuation">"</span></span> <span class="token delimiter punctuation">%}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>#### **Aplayer**详细参数表：| 参数           | 默认   | 解释                                           || :------------- | :----- | :--------------------------------------------- || name           | -      | audio name                                     || artist         | -      | audio artist                                   || url            | -      | audio url                                      || cover          | -      | audio cover                                    || lrc            | -      | audio lrc                                      || theme          | -      | audio theme                                    || type           | auto   | audio type 可选 ‘auto’, ‘hls’, ‘normal’        || autoplay       | false  | autoplay                                       || loop           | ‘all’  | player loop play, values: ‘all’, ‘one’, ‘none’ || order          | ‘list’ | player play order, values: ‘list’, ‘random’    || volume         | 0.7    | default volume,                                || tlistMaxHeight | -      | list max height                                |不在表格内的参数请使用下面 JSON 类型的参数。mmedia 插件允许在 contents 部分使用 JSON 编写配置，由于允许使用 JSON5，此项配置几乎与 APlayer 完全一致。- **单曲**<pre class="line-numbers language-none"><code class="language-none">{% mmedia "aplayer" "name:Hotel California" "artist:Camille and Kennerly" "url:https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.mp3" "lrc:https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.lrc" "cover:https://cdn.17lai.site/media/music/Hotel%20California/Hotel%20California.webp" "volume:0.66" %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><div id="mmedia-HKotvfAyyPWTmzOA"></div><script> var HKotvfAyyPWTmzOA_options = JSON.parse('{\"lrcType\":3,\"volume\":0.66,\"autoplay\":false,\"audio\":[{\"name\":\"Hotel California\",\"artist\":\"Camille and Kennerly\",\"url\":\"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.mp3\",\"lrc\":\"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.lrc\",\"cover\":\"https://cdn.17lai.site/media/music/Hotel%20California/Hotel%20California.webp\"}]}'); HKotvfAyyPWTmzOA_options.container = document.getElementById("mmedia-HKotvfAyyPWTmzOA"); const ap_HKotvfAyyPWTmzOA = new APlayer(HKotvfAyyPWTmzOA_options); </script>- **列表**<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><div id="mmedia-XxrNbvyGTHBXJTUR"></div><script> var XxrNbvyGTHBXJTUR_options = JSON.parse('{\"lrcType\":3,\"volume\":0.8,\"autoplay\":false,\"audio\":[{\"name\":\"Hotel California\",\"artist\":\"Camille and Kennerly\",\"url\":\"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.mp3\",\"cover\":\"https://cdn.17lai.site/media/music/Hotel%20California/Hotel%20California.webp\",\"lrc\":\"https://cdn.17lai.site/media/music/Hotel%20California/01%20Hotel%20California.lrc\",\"theme\":\"#ebd0c2\"},{\"name\":\"Sold Out\",\"artist\":\"Diamonds\",\"url\":\"https://cdn.17lai.site/media/music/Diamonds/05%20Sold%20Out.flac\",\"cover\":\"https://cdn.17lai.site/media/music/Diamonds/Diamonds.jpg\",\"theme\":\"#ebd0c2\"},{\"name\":\"The Final Bell\",\"artist\":\"Rocky_Original Motion Picture Score\",\"url\":\"https://cdn.17lai.site/media/music/Rocky_%20Original%20Motion%20Picture%20Score/12%20Bill%20Conti%20-%20The%20Final%20Bell.mp3\",\"cover\":\"https://cdn.17lai.site/media/music/Rocky_%20Original%20Motion%20Picture%20Score/Rocky_%20Original%20Motion%20Picture%20Score.jpg\",\"theme\":\"#ebd0c2\"},{\"name\":\" Croatian Rhapsody\",\"artist\":\"The Piano Player\",\"url\":\"https://cdn.17lai.site/media/music/The%20Piano%20Player/11%20Croatian%20Rhapsody.mp3\",\"cover\":\"https://cdn.17lai.site/media/music/The%20Piano%20Player/The%20Piano%20Player.jpg\",\"theme\":\"#ebd0c2\"}]}'); XxrNbvyGTHBXJTUR_options.container = document.getElementById("mmedia-XxrNbvyGTHBXJTUR"); const ap_XxrNbvyGTHBXJTUR = new APlayer(XxrNbvyGTHBXJTUR_options); </script><p><strong>例子</strong></p><pre class="line-numbers language-none"><code class="language-none">{% mmedias "aplayer" "autoplay:false" %}{  "volume": 0.8,  "audio":  [    {      "name": "name1",      "artist": "artist1",      "url": "url1.mp3",      "cover": "cover1.jpg",      "lrc": "lrc1.lrc",      "theme": "#ebd0c2"    },    {      "name": "name2",      "artist": "artist2",      "url": "url2.mp3",      "cover": "cover2.jpg",      "lrc": "lrc2.lrc",      "theme": "#46718b"    }  ]}{% endmmedias %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Dplayer">Dplayer</h4><blockquote><p>此部分请熟读 <a target="_blank" rel="noopener" href="http://dplayer.js.org/">DPlayer 文档</a></p></blockquote><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">mmedia</span> <span class="token string"><span class="token punctuation">"</span>dplayer<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>url:a.mp4<span class="token punctuation">"</span></span> <span class="token delimiter punctuation">%}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">mmedias</span> <span class="token string"><span class="token punctuation">"</span>dplayer<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>flv:<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>url:https://dandoc.u2sb.com/video/%E5%AE%89%E8%A3%85/1-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E8%A3%85.mp4<span class="token punctuation">"</span></span> <span class="token delimiter punctuation">%}</span></span>{  "contextmenu":  [    {      text: "custom1",      link: "https://github.com/DIYgod/DPlayer"    }  ]}<span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">endmmedias</span> <span class="token delimiter punctuation">%}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">{% mmedia "dplayer" "url:https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4" %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><script src="https://cdn.jsdelivr.net/npm/dplayer@1/dist/DPlayer.min.js"></script><div id="mmedia-QRLPBNpfCmdyjAfS"></div><script> var QRLPBNpfCmdyjAfS_options = JSON.parse('{\"video\":{\"url\":\"https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4\"}}'); QRLPBNpfCmdyjAfS_options.container = document.getElementById("mmedia-QRLPBNpfCmdyjAfS"); const dp_QRLPBNpfCmdyjAfS = new DPlayer(QRLPBNpfCmdyjAfS_options); </script><pre class="line-numbers language-none"><code class="language-none">{% mmedias "dplayer" %}{  video:   {    url: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4"  }}{% endmmedias %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>#### 哔哩哔哩详细参数表：| 参数            | 默认                                               | 解释                                                    || :-------------- | :------------------------------------------------- | :------------------------------------------------------ || aid             | -                                                  | aid                                                     || bvid            | -                                                  | bvid，与 aid 同时出现时以 bvid 为准                     || page            | 1                                                  | page                                                    || danmaku         | true                                               | 是否有弹幕 ture or false                                || allowfullscreen | allowfullscreen                                    | 允许全屏， allowfullscreen 或 true 允许，其他选项不允许 || sandbox         | 见 [配置](https://www.u2sb.com/pages/19d343/#配置) | iframe sandbox                                          || width           | 100%                                               | css 属性                                                || max_width       | 850px                                              | css 属性                                                || margin          | auto                                               | css 属性                                                |mmedia 插件允许在 contents 部分使用 JSON 编写配置，使用 JSON5 标准。<style>.bbplayer{width: 100%; max-width: 850px; margin: auto}</style><div class="bbplayer"><iframe class="bbplayer" id="mmedia-wKBvmYazaFHVWtbN" src="https://player.bilibili.com/player.html?bvid=BV1fs411S7u7&amp;page=1&amp;high_quality=1&amp;danmaku=true" allowfullscreen="allowfullscreen" scrolling="no" border="0" frameborder="0" framespacing="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts allow-popups"></iframe></div><script> document.getElementById("mmedia-wKBvmYazaFHVWtbN").style.height=document.getElementById("mmedia-wKBvmYazaFHVWtbN").scrollWidth*0.76+"px";    window.onresize = function(){      document.getElementById("mmedia-wKBvmYazaFHVWtbN").style.height=document.getElementById("mmedia-wKBvmYazaFHVWtbN").scrollWidth*0.76+"px";    }; </script><pre class="line-numbers language-none"><code class="language-none">{% mmedia "bilibili" "bvid:BV1fs411S7u7" %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>#### 西瓜视频<pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">mmedia</span> <span class="token string"><span class="token punctuation">"</span>xigua<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>xid=6925997698269053453<span class="token punctuation">"</span></span> <span class="token delimiter punctuation">%}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">mmedia</span> <span class="token string"><span class="token punctuation">"</span>xigua<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>xid:6925997698269053453<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>autoplay:true<span class="token punctuation">"</span></span> <span class="token delimiter punctuation">%}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>详细参数表：| 参数            | 默认                                               | 解释                                                    || :-------------- | :------------------------------------------------- | :------------------------------------------------------ || xid             | -                                                  | 西瓜视频的 ID，就是那一串数字                           || id              | -                                                  | 一般情况下不需要填写                                    || autoplay        | false                                              | autoplay                                                || startTime       | 0                                                  | 开始时间，秒                                            || allowfullscreen | allowfullscreen                                    | 允许全屏， allowfullscreen 或 true 允许，其他选项不允许 || sandbox         | 见 [配置](https://www.u2sb.com/pages/a0c4a7/#配置) | iframe sandbox                                          || width           | 100%                                               | css 属性                                                || max_width       | 850px                                              | css 属性                                                || margin          | auto                                               | css 属性                                                |<style>.xgplayer{width: 100%; max-width: 850px; margin: auto}</style><div class="xgplayer"><iframe class="xgplayer" id="mmedia-kEFlvQgJxoTicUgf" src="https://www.ixigua.com/iframe/6925997698269053453?autoplay=0&amp;startTime=undefined" allowfullscreen="allowfullscreen" scrolling="no" border="0" frameborder="0" framespacing="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts allow-popups"></iframe></div><script> document.getElementById("mmedia-kEFlvQgJxoTicUgf").style.height=document.getElementById("mmedia-kEFlvQgJxoTicUgf").scrollWidth*0.7+"px";    window.onresize = function(){      document.getElementById("mmedia-kEFlvQgJxoTicUgf").style.height=document.getElementById("mmedia-kEFlvQgJxoTicUgf").scrollWidth*0.7+"px";    }; </script><pre class="line-numbers language-none"><code class="language-none">{% mmedia "xigua" "xid=6925997698269053453" %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>#### ArtPlayer&gt; 此部分请熟读 [ArtPlayer 文档](https://artplayer.org/document/#/options)- 使用 `:` 或 `=` 分割。详细参数表：| 参数     | 默认  | 解释           || :------- | :---- | :------------- || url      | -     | url            || title    | -     | title          || poster   | -     | poster         || type     | -     | type           || autoplay | false | video autoplay || loop     | false | video loop     || volume   | 0.7   | default volume || style    | -     | style          |上面有一个比较特殊的参数 flv，这里单独解释一下，这个参数是用于引入其他 js 文件的，目前支持的有： `hls` `dash` `shaka_dash` `flv` `webtorrent` ，上述参数可多个一起使用，如果后面带有 js 地址，将直接使用，否则将使用 `_config.yml` 配置或插件默认配置，如：<pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">mmedia</span> <span class="token string"><span class="token punctuation">"</span>artplayer<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>flv:<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>url:a.flv<span class="token punctuation">"</span></span> <span class="token delimiter punctuation">%}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">mmedias</span> <span class="token string"><span class="token punctuation">"</span>artplayer<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>flv:<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>hls:https://cdn.jsdelivr.net/npm/hls.js/dist/hls.min.js<span class="token punctuation">"</span></span> <span class="token delimiter punctuation">%}</span></span>{  ...}<span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">endmmedias</span> <span class="token delimiter punctuation">%}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">mmedia</span> <span class="token string"><span class="token punctuation">"</span>artplayer<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>url:https://dandoc.u2sb.com/video/%E5%AE%89%E8%A3%85/1-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E8%A3%85.mp4<span class="token punctuation">"</span></span> <span class="token delimiter punctuation">%}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-twig" data-language="twig"><code class="language-twig"><span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">mmedias</span> <span class="token string"><span class="token punctuation">"</span>artplayer<span class="token punctuation">"</span></span> <span class="token string"><span class="token punctuation">"</span>flv:<span class="token punctuation">"</span></span>  <span class="token delimiter punctuation">%}</span></span>{  url: "https://dandoc.u2sb.com/video/%E5%AE%89%E8%A3%85/1-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E8%A3%85.mp4"}<span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">endmmedias</span> <span class="token delimiter punctuation">%}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">{% mmedia "artplayer" "url:https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_2mb.mp4" %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><script src="https://cdn.jsdelivr.net/npm/artplayer@3/dist/artplayer.js"></script><div id="mmedia-ocPKOHkdZtTZVCNm" style="width:100%;height:650px;max-width:1200px;center"></div><script> var ocPKOHkdZtTZVCNm_options = JSON.parse('{\"style\":\"width:100%;height:650px;max-width:1200px;center\",\"autoSize\":true,\"autoMini\":true,\"fullscreen\":true,\"fullscreenWeb\":true,\"url\":\"https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_2mb.mp4\"}'); ocPKOHkdZtTZVCNm_options.container = "#mmedia-ocPKOHkdZtTZVCNm"; const art_ocPKOHkdZtTZVCNm = new Artplayer(ocPKOHkdZtTZVCNm_options); </script><pre class="line-numbers language-none"><code class="language-none">{% mmedias "artplayer" %}{  url: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_2mb.mp4"}{% endmmedias %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="脑图"><a target="_blank" rel="noopener" href="https://github.com/MaxChang3/hexo-markmap">脑图</a></h2><blockquote><p><a target="_blank" rel="noopener" href="https://zhangmaimai.com/2021/02/23/hexo-mindmap-plugin/">原作者记录</a></p></blockquote>    <div class="markmap-container" style="height:250px">      <svg data="{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:1,&quot;p&quot;:{&quot;lines&quot;:[0,1]},&quot;v&quot;:&quot;思维导图？&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[1,2]},&quot;v&quot;:&quot;使用现有的插件或组件？&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[2,3]},&quot;v&quot;:&quot;Mermaid：更偏向流程图&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[3,4]},&quot;v&quot;:&quot;Kityminder&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[4,5]},&quot;v&quot;:&quot;现成hexo插件有些小问题。&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[5,6]},&quot;v&quot;:&quot;二次开发，失败&quot;}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[6,7]},&quot;v&quot;:&quot;找寻相关项目？&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[8,9]},&quot;v&quot;:&quot;Markmap大法！&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[9,10]},&quot;v&quot;:&quot;直接弄，失败&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[10,11]},&quot;v&quot;:&quot;使用jsdom，失败&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[11,12]},&quot;v&quot;:&quot;寻找现成库，成功&quot;}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[12,13]},&quot;v&quot;:&quot;咕咕咕咕咕咕咕咕咕咕咕咕&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[13,14]},&quot;v&quot;:&quot;凑一下行数让版面好看点&quot;}]}"></svg>    </div>  <pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% markmap 250px %}<span class="token title important"><span class="token punctuation">#</span> 思维导图？</span><span class="token title important"><span class="token punctuation">##</span> 使用现有的插件或组件？</span><span class="token title important"><span class="token punctuation">###</span> Mermaid：更偏向流程图</span><span class="token title important"><span class="token punctuation">###</span> Kityminder</span><span class="token title important"><span class="token punctuation">####</span> 现成hexo插件有些小问题。</span><span class="token title important"><span class="token punctuation">####</span> 二次开发，失败</span><span class="token title important"><span class="token punctuation">##</span> 找寻相关项目？</span><span class="token title important"><span class="token punctuation">###</span> Markmap大法！</span><span class="token title important"><span class="token punctuation">####</span> 直接弄，失败</span><span class="token title important"><span class="token punctuation">####</span> 使用jsdom，失败</span><span class="token title important"><span class="token punctuation">####</span> 寻找现成库，成功</span><span class="token title important"><span class="token punctuation">##</span> 咕咕咕咕咕咕咕咕咕咕咕咕</span><span class="token title important"><span class="token punctuation">##</span> 凑一下行数让版面好看点</span>{% endmarkmap %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>Here is the footnote. <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p>Here's one with multiple blocks.</p><p>Subsequent paragraphs are indented to show that they <a href="#fnref2" class="footnote-backref">↩︎</a></p></li></ol></section><link rel="stylesheet" href="/css/bilicard.css" type="text/css">    <style>.markmap-container{display:flex;justify-content:center;margin:0 auto;width:90%;height:500px}.markmap-container svg{width:100%;height:100%}@media(max-width:768px){.markmap-container{height:400px}}</style>    <script src="https://cdn.jsdelivr.net/npm/d3@6"></script>    <script src="https://cdn.jsdelivr.net/npm/markmap-view"></script>    <script> document.querySelectorAll('.markmap-container>svg').forEach(mindmap => markmap.Markmap.create(mindmap, null, JSON.parse(mindmap.getAttribute('data'))))</script>  ]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="web" scheme="https://blog.17lai.site/categories/web/"/>
    
    
    <category term="hexo" scheme="https://blog.17lai.site/tags/hexo/"/>
    
    <category term="mermaid" scheme="https://blog.17lai.site/tags/mermaid/"/>
    
    <category term="plantuml" scheme="https://blog.17lai.site/tags/plantuml/"/>
    
    <category term="mathjax" scheme="https://blog.17lai.site/tags/mathjax/"/>
    
  </entry>
  
  <entry>
    <title>第一次使用VS CODE时你应该指导的一切配置</title>
    <link href="https://blog.17lai.site/posts/44557ab0/"/>
    <id>https://blog.17lai.site/posts/44557ab0/</id>
    <published>2021-10-18T04:25:00.000Z</published>
    <updated>2022-03-16T11:18:36.817Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="前言-2">前言</h2><blockquote><p>文章标题：《第一次使用 VS Code 时你应该知道的一切配置》。本文的最新内容，更新于 2021-10-09。大家完全不用担心这篇文章会过时，因为随着 VS Code 的版本更新和插件更新，本文也会随之更新。</p></blockquote><blockquote><p>本文的最新内容，也会在<a target="_blank" rel="noopener" href="https://github.com/qianguyihao/Web/blob/master/00-%E5%89%8D%E7%AB%AF%E5%B7%A5%E5%85%B7/01-VS%20Code%E7%9A%84%E4%BD%BF%E7%94%A8.md">GitHub</a>上同步更新，欢迎 star。</p></blockquote><p>VS Code 软件实在是太酷、太好用了，越来越多的新生代互联网民工正在使用它。</p><p>前端男神<strong>尤雨溪</strong>大大这样评价 VS Code：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201152.png" alt=""></p><p>有一点你可能会感到惊讶：VS Code 这款软件本身，是用 JavaScript 语言编写的（具体请自行查阅基于 JS 的 PC 客户端开发框架 <code>Electron</code>）。Jeff Atwood 在 2007 年提出了著名的 Atwood 定律：</p><blockquote><p><strong>任何能够用 JavaScript 实现的应用系统，最终都必将用 JavaScript 实现</strong>。</p></blockquote><p>Jeff Atwood 这个人是谁不重要（他是 Stack Overflow 网站的联合创始人），重要的是这条定律。</p><p>前端目前是处在春秋战国时代，各路英雄豪杰成为后浪，各种框架工具层出不穷，VS Code 软件无疑是大前端时代最骄傲的工具。</p><p>如果你是做前端开发（JavaScript 编程语言为主），则完全可以将 VS Code 作为「<strong>主力开发工具</strong>」。这款软件是为前端同学量身定制的，开箱即用。</p><p>如果你是做其他语言方向的开发，并且不需要太复杂的集成开发环境，那么，你可以把 VS Code 作为「<strong>代码编辑器</strong>」来使用，纵享丝滑。</p><p>甚至是一些写文档、写作的同学，也经常把 VS Code 作为 markdown <strong>写作工具</strong>，毫无违和感。</p><p>退而求其次，即便你不属于以上任何范畴，你还可以把 VS Code 当作最简单的<strong>文本编辑器</strong>来使用，完胜 Windows 系统自带的记事本。</p><p>写下这篇文章，是顺势而为。</p><h2 id="一、惊艳登场：VS-Code-的介绍">一、惊艳登场：VS Code 的介绍</h2><p>VS Code 的全称是 Visual Studio Code，是一款开源的、免费的、跨平台的、高性能的、轻量级的代码编辑器。它在性能、语言支持、开源社区方面，都做得很不错。</p><p>微软有两种软件：一种是 VS Code，一种是其他软件。</p><p>在2015年4月29日的微软Build开发者大会上，微软宣布推出 VS Code之后，这个轻量级的编辑器成为全球无数开发者们最喜爱的开发工具。VS Code基于开源且跨平台的理念，每月都会进行迭代，并提供每天发布的 insider 版本（insider是微软的一种公测计划，类似于国内软件所说的内测版）。它拥有至少几万个插件，生态极为活跃和丰富。</p><h3 id="IDE-与-编辑器的对比">IDE 与 编辑器的对比</h3><p>IDE 和编辑器是有区别的：</p><ul><li><p><strong>IDE</strong>（Integrated Development Environment，集成开发环境）：对代码有较好的智能提示和相互跳转，同时侧重于工程项目，对项目的开发、调试工作有较好的图像化界面的支持，因此比较笨重。比如 Eclipse 的定位就是 IDE。</p></li><li><p><strong>编辑器</strong>：要相对轻量许多，侧重于文本的编辑。比如 Sublime Text 的定位就是编辑器。再比如 Windows 系统自带的「记事本」就是最简单的编辑器。</p></li></ul><p>需要注意的是，VS Code 的定位是<strong>编辑器</strong>，而非 IDE ，但 VS Code 又比一般的编辑器的功能要丰富许多。可以这样理解：VS Code 的体量是介于编辑器和 IDE 之间。VS Code 的使命，是让开发者在编辑器里拥有 IDE 那样的开发体验。</p><p>VS Code流行起来之后，使用 Sublime Text、Atom 这类编辑器软件的人，自然就越来越少了。</p><h3 id="VS-Code-的特点">VS Code 的特点</h3><ul><li>跨平台：支持 MacOS、Windows 和 Linux 等多个平台。在这多种平台下，拥有一致的用户界面和开发体验。</li><li>开源：VS Code 的源代码以 MIT 协议开源。不仅代码开源，而且整个产品的开发计划和发布管理也都是开源的。VS Code团队每年都会在 GitHub 的Wiki上发布 <a target="_blank" rel="noopener" href="https://github.com/microsoft/vscode/wiki/Roadmap">Roadmap</a>，列出一整年的规划图。VS Code 软件的官方文档也托管在了 <a target="_blank" rel="noopener" href="https://github.com/Microsoft/vscode-docs">GitHub</a> 上。</li><li>自带终端、图形化的调试工具、Git 版本控制。</li><li>插件扩展：支持第三方插件，功能强大。既有中心化的插件市场，也可以直接在 VS Code里搜索你想要的插件。</li><li>生态：社区生态活跃且丰富，社区氛围浓厚。</li><li>自带  emmet：支持代码自动补全，快速生成简单的语法结构。要知道，这个功能在 Sublime Text中，得先安装插件才行。</li><li>语法支持：VS Code 自带了 JavaScript、TypeScript 和 Node.js 的<strong>语法支持</strong>，包括：<strong>语法高亮、代码智能提示和补全、括号匹配、颜色区分、代码片段提示</strong>等。也就是说，你在书写 JS 和 TS 时，这些语法支持都是自带的。其他的一些语言，你需要先安装相应的<strong>扩展包</strong>插件，就出现语法支持。</li><li>在修改配置方面，既有图形化的配置界面，也有 基于 JSON 文件的配置方式，满足不同人群的使用习惯。</li></ul><h3 id="前端利器之争：-VS-Code-与-WebStorm">前端利器之争： VS Code 与 WebStorm</h3><p>前端小白最喜欢问的一个问题是：哪个编辑器/IDE 好用？是 VS Code 还是 WebStorm （WebStorm 其实是 IntelliJ IDEA 的定制版）？我来做个对比：</p><ul><li><p><strong>哪个更酷</strong>：显然 VS Code 更酷。</p></li><li><p><strong>内存占用情况</strong>：根据我的观察，VS Code 是很占内存的（尤其是当你打开多个窗口的时候），但如果你的内存条够用，使用起来是不会有任何卡顿的感觉的。相比之下，IntelliJ IDEA 不仅非常占内存，而且还非常卡顿。如果你想换个既轻量级、又不占内存的编辑器，最好还是使用「Sublime Text」编辑器。</p></li><li><p><strong>使用比例</strong>：当然是 VS Code 更胜一筹。先不说别的，我就拿数据说话，我目前所在的研发团队有 200 人左右（120个后台、80个前端），他们绝大部分人都在用 VS Code 编码，妥妥的。</p></li></ul><p>所以，如果你以后还问这个问题，那就真有些掉底了。</p><h3 id="VS-Code-的技术栈、核心组件">VS Code 的技术栈、核心组件</h3><p>了解 VS Code的技术栈和核心组件，可以让我们对 VS Code 有更深入的认识。此小段，了解即可。</p><ul><li>开发框架：Electron。Electron可以使用 Node.js + JS这样的技术栈开发桌面GUI应用程序。</li><li>编辑器：Monaco Editor。Monaco Editor 是一款开源的在线代码编辑器，是 <strong>VS Code 浏览器版本</strong>的最核心组件。<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/88828576">#</a></li><li>编程语言：TypeScript。TypeScript 是  JavaScript的严格超集。TS 在JS的基础上添加了许多功能，引入了声明文件，而且支持类型扩展。TS 适合长期的、多人开发的大型项目开发。</li><li>让编辑器支持语言功能：Language Server Protocol （LSP） 语言服务协议。LSP是编辑器/IDE 与语言服务器之间的一种协议，通过 JSON-PRC 传输消息，可以让编辑器嵌入并支持各种编程语言。开发者可以在编辑器中使用各种语言来编写程序。</li><li>让编辑器支持调试功能：Debug Adapter Protocol（DAP）。DAP 是基于 JSON的协议，它抽象了开发工具与调试工具质检的通信。</li><li>集成终端：Xterm.js。VS Code的集成终端是基于开源项目 <a target="_blank" rel="noopener" href="https://github.com/xtermjs/xterm.js/">Xterm.js</a> 进行开发的。Xterm.js 是一个使用 TS 开发的终端组件。另外，Xterm.js 并不是直接下来下来就能用的终端应用，它只是一个前端组件，可以与 bash这样的进程进行连接，然后让用户通过  Xterm.js 进行交互。</li></ul><h3 id="VS-Code-的安装">VS Code 的安装</h3><ul><li>VS Code 官网：<a target="_blank" rel="noopener" href="https://code.visualstudio.com">https://code.visualstudio.com</a></li></ul><p>VS Code 的安装很简单，直接去官网下载安装包，然后双击安装即可。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201230.png" alt=""></p><p>上图中，直接点击 download，一键下载安装即可。</p><p>VS Code支持以下平台：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201146.png" alt=""></p><p>安装完成后的界面如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201237.png" alt=""></p><p>VS  Code被分为以下五个区域：</p><ul><li>编辑器</li><li>侧边栏</li><li>状态栏</li><li>活动栏</li><li>面板</li></ul><p>VS Code在功能上非常克制，只包含了大多数开发流程中所需要的基础模块，包括：编辑器、文件管理、窗口管理、首选项设置、终端等。</p><p>你需要根据具体需要安装额外的组件或者插件。比如说，如果开发TS项目，则需要安装 TS编译器、ESLint、TSLint等编译工具。如果开发C语言项目，则需要安装gcc、Clang等编辑工具。</p><h2 id="二、崭露锋芒：VS-Code-快捷键">二、崭露锋芒：VS Code 快捷键</h2><p>VS Code 用得熟不熟，首先就看你是否会用快捷键。以下列出的内容，都是常用快捷键，而加粗部分的快捷键，使用频率则非常高。</p><p>任何工具，掌握 20%的技能，足矣应对 80% 的工作。既然如此，你可能会问：那就只保留 20% 的特性，不久可以满足 80%的用户了吗？</p><p>但我想说的是：<strong>那从来都不是同样的 20%</strong>，每个人都会用到不同的功能。</p><p>掌握下面这些高频核心快捷键，你和你的工具，足矣露出锋芒。</p><h3 id="1、工作区快捷键">1、工作区快捷键</h3><table><thead><tr><th style="text-align:left">Mac 快捷键</th><th style="text-align:left">Win 快捷键</th><th style="text-align:left">作用</th><th style="text-align:left">备注</th></tr></thead><tbody><tr><td style="text-align:left"><strong>Cmd + Shift + P</strong></td><td style="text-align:left"><strong>Ctrl + Shift + P</strong>，F1</td><td style="text-align:left">显示命令面板</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><strong>Cmd + B</strong></td><td style="text-align:left"><strong>Ctrl + B</strong></td><td style="text-align:left">显示/隐藏侧边栏</td><td style="text-align:left">很实用</td></tr><tr><td style="text-align:left"><code>Cmd + \</code></td><td style="text-align:left"><code>Ctrl + \</code></td><td style="text-align:left"><strong>拆分为多个编辑器</strong></td><td style="text-align:left">【重要】抄代码利器</td></tr><tr><td style="text-align:left"><strong>Cmd + 1、2</strong></td><td style="text-align:left"><strong>Ctrl + 1、2</strong></td><td style="text-align:left">聚焦到第 1、第 2 个编辑器</td><td style="text-align:left">同上重要</td></tr><tr><td style="text-align:left"><strong>Cmd + +、Cmd + -</strong></td><td style="text-align:left"><strong>ctrl + +、ctrl + -</strong></td><td style="text-align:left">将工作区放大/缩小（包括代码字体、左侧导航栏）</td><td style="text-align:left">在投影仪场景经常用到</td></tr><tr><td style="text-align:left">Cmd + J</td><td style="text-align:left">Ctrl + J</td><td style="text-align:left">显示/隐藏控制台</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><strong>Cmd + Shift + N</strong></td><td style="text-align:left"><strong>Ctrl + Shift + N</strong></td><td style="text-align:left">重新开一个软件的窗口</td><td style="text-align:left">很常用</td></tr><tr><td style="text-align:left">Cmd + Shift + W</td><td style="text-align:left">Ctrl + Shift + W</td><td style="text-align:left">关闭软件的当前窗口</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Cmd + N</td><td style="text-align:left">Ctrl + N</td><td style="text-align:left">新建文件</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Cmd + W</td><td style="text-align:left">Ctrl + W</td><td style="text-align:left">关闭当前文件</td><td style="text-align:left"></td></tr></tbody></table><h3 id="2、跳转操作">2、跳转操作</h3><table><thead><tr><th style="text-align:left">Mac 快捷键</th><th style="text-align:left">Win 快捷键</th><th style="text-align:left">作用</th><th style="text-align:left">备注</th></tr></thead><tbody><tr><td style="text-align:left">Cmd + `</td><td style="text-align:left">没有</td><td style="text-align:left">在同一个软件的<strong>多个工作区</strong>之间切换</td><td style="text-align:left">使用很频繁</td></tr><tr><td style="text-align:left"><strong>Cmd + Option + 左右方向键</strong></td><td style="text-align:left">Ctrl + Pagedown/Pageup</td><td style="text-align:left">在已经打开的<strong>多个文件</strong>之间进行切换</td><td style="text-align:left">非常实用</td></tr><tr><td style="text-align:left">Ctrl + Tab</td><td style="text-align:left">Ctrl + Tab</td><td style="text-align:left">在已经打开的多个文件之间进行跳转</td><td style="text-align:left">不如上面的快捷键快</td></tr><tr><td style="text-align:left">Cmd + Shift + O</td><td style="text-align:left">Ctrl + shift + O</td><td style="text-align:left">在当前文件的各种<strong>方法之间</strong>（符号：Symbol）进行跳转</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Cmd + T</td><td style="text-align:left">Ctrl + T</td><td style="text-align:left">在当前<strong>工作区</strong>的各种方法之间（符号：Symbol）进行跳转</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Ctrl + G</td><td style="text-align:left">Ctrl + G</td><td style="text-align:left">跳转到指定行</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><code>Cmd+Shift+\</code></td><td style="text-align:left"><code>Ctrl+Shift+\</code></td><td style="text-align:left">跳转到匹配的括号</td><td style="text-align:left"></td></tr></tbody></table><h3 id="3、移动光标">3、移动光标</h3><table><thead><tr><th style="text-align:left">Mac 快捷键</th><th style="text-align:left">Win 快捷键</th><th style="text-align:left">作用</th><th style="text-align:left">备注</th></tr></thead><tbody><tr><td style="text-align:left">方向键</td><td style="text-align:left">方向键</td><td style="text-align:left">在<strong>单个字符</strong>之间移动光标</td><td style="text-align:left">大家都知道</td></tr><tr><td style="text-align:left"><strong>option + 左右方向键</strong></td><td style="text-align:left"><strong>Ctrl + 左右方向键</strong></td><td style="text-align:left">在<strong>单词</strong>之间移动光标</td><td style="text-align:left">很常用</td></tr><tr><td style="text-align:left"><strong>Cmd + 左右方向键</strong></td><td style="text-align:left"><strong>Fn + 左右方向键</strong>（或 Win + 左右方向键）</td><td style="text-align:left">将光标定位到当前行的最左侧、最右侧（在<strong>整行</strong>之间移动光标）</td><td style="text-align:left">很常用</td></tr><tr><td style="text-align:left"><strong>Option + Alt + 左右方向键</strong></td><td style="text-align:left"><strong>Alt + Shift + 左右方向键</strong></td><td style="text-align:left">左右扩大/缩小选中的范围</td><td style="text-align:left">很酷，极为高效</td></tr><tr><td style="text-align:left">Cmd + ↑</td><td style="text-align:left">Ctrl + Home</td><td style="text-align:left">将光标定位到文件的第一行</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Cmd + ↓</td><td style="text-align:left">Ctrl + End</td><td style="text-align:left">将光标定位到文件的最后一行</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Cmd + Shift + \</td><td style="text-align:left"></td><td style="text-align:left">在<strong>代码块</strong>之间移动光标</td><td style="text-align:left"></td></tr></tbody></table><h3 id="4、编辑操作">4、编辑操作</h3><table><thead><tr><th style="text-align:left">Mac 快捷键</th><th style="text-align:left">Win 快捷键</th><th style="text-align:left">作用</th><th style="text-align:left">备注</th></tr></thead><tbody><tr><td style="text-align:left">Cmd + C</td><td style="text-align:left">Ctrl + C</td><td style="text-align:left">复制</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Cmd + X</td><td style="text-align:left">Ctrl + X</td><td style="text-align:left">剪切</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Cmd + C</td><td style="text-align:left">Ctrl + V</td><td style="text-align:left">粘贴</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><strong>Cmd + Enter</strong></td><td style="text-align:left"><strong>Ctrl + Enter</strong></td><td style="text-align:left">在当前行的下方新增一行，然后跳至该行</td><td style="text-align:left">即使光标不在行尾，也能快速向下插入一行</td></tr><tr><td style="text-align:left">Cmd+Shift+Enter</td><td style="text-align:left">Ctrl+Shift+Enter</td><td style="text-align:left">在当前行的上方新增一行，然后跳至该行</td><td style="text-align:left">即使光标不在行尾，也能快速向上插入一行</td></tr><tr><td style="text-align:left"><strong>Option + ↑</strong></td><td style="text-align:left"><strong>Alt + ↑</strong></td><td style="text-align:left">将代码向上移动</td><td style="text-align:left">很常用</td></tr><tr><td style="text-align:left"><strong>Option + ↓</strong></td><td style="text-align:left"><strong>Alt + ↓</strong></td><td style="text-align:left">将代码向下移动</td><td style="text-align:left">很常用</td></tr><tr><td style="text-align:left">Option + Shift + ↑</td><td style="text-align:left">Alt + Shift + ↑</td><td style="text-align:left">将代码向上复制一行</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><strong>Option + Shift + ↓</strong></td><td style="text-align:left"><strong>Alt + Shift + ↓</strong></td><td style="text-align:left">将代码向下复制一行</td><td style="text-align:left">写重复代码的利器</td></tr></tbody></table><p>另外再补充一点：将光标点击到某一行的任意位置时，默认就已经是<strong>选中全行</strong>了，此时可以直接<strong>复制</strong>或<strong>剪切</strong>，无需点击鼠标。这个非常实用，是所有的编辑操作中，使用得最频繁的。它可以有以下使用场景：</p><ul><li>场景1：假设光标现在处于第5行的<strong>任意位置</strong>，那么，直接依次按下 <code>Cmd + C</code> 和 <code>Cmd + V</code>，就会把这行代码复制到第6行。继续按 <code>Cmd + C</code> 和 <code>Cmd + V</code>，就会把这行代码复制到第7行。copy代码so easy。</li><li>场景2：假设光标现在处于第5行，那么，先按下 <code>Cmd + C</code>，然后按两下<code>↑</code> 方向键，此时光标处于第3行；紧接着，继续按下<code>Cmd + V</code>，就会把刚刚那行代码复制到第3行，原本处于第3行的代码会整体<strong>下移</strong>。</li></ul><p>你看到了没？上面的两个场景，我全程没有使用鼠标，只通过简单的复制粘贴和方向键，就做到了如此迅速的copy代码。你说是不是很高效？</p><h3 id="5、删除操作">5、删除操作</h3><table><thead><tr><th style="text-align:left">Mac 快捷键</th><th style="text-align:left">Win 快捷键</th><th style="text-align:left">作用</th><th style="text-align:left">备注</th></tr></thead><tbody><tr><td style="text-align:left">Cmd + shift + K</td><td style="text-align:left">Ctrl + Shift + K</td><td style="text-align:left">删除整行</td><td style="text-align:left">「Cmd + X」的作用是剪切，但也可以删除整行</td></tr><tr><td style="text-align:left"><strong>option + Backspace</strong></td><td style="text-align:left"><strong>Ctrl + Backspace</strong></td><td style="text-align:left">删除光标之前的一个单词</td><td style="text-align:left">英文有效，很常用</td></tr><tr><td style="text-align:left">option + delete</td><td style="text-align:left">Ctrl + delete</td><td style="text-align:left">删除光标之后的一个单词</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><strong>Cmd + Backspace</strong></td><td style="text-align:left"></td><td style="text-align:left">删除光标之前的整行内容</td><td style="text-align:left">很常用</td></tr><tr><td style="text-align:left">Cmd + delete</td><td style="text-align:left"></td><td style="text-align:left">删除光标之后的整行内容</td><td style="text-align:left"></td></tr></tbody></table><p>备注：上面所讲到的移动光标、编辑操作、删除操作的快捷键，在其他编辑器里，大部分都适用。</p><h3 id="6、多光标选择-多光标编辑">6、多光标选择/多光标编辑</h3><p>多光标选择在编程的<strong>提效</strong>方面可谓立下了汗马功劳。因为比较难记住，所以你要时不时回来复习这一段。</p><table><thead><tr><th>Mac 快捷键</th><th>Win 快捷键</th><th>作用</th><th>备注</th></tr></thead><tbody><tr><td><strong>Option + 鼠标连续点击任意位置</strong></td><td><strong>Alt + 鼠标连续点击任意位置</strong></td><td>在任意位置，同时出现多个光标</td><td>很容易记住</td></tr><tr><td>Cmd + D</td><td>Ctrl + D</td><td>将光标放在某个单词的位置（或者先选中某个单词），然后反复按下「 <strong>Cmd + D</strong> 」键， 即可将下一个相同的词逐一加入选择。</td><td>较常用</td></tr><tr><td><strong>Cmd + Shift + L</strong></td><td><strong>Ctrl + Shift + L</strong></td><td>将光标放在某个单词的位置（或者先选中某个单词），然后按下快捷键，则所有的相同内容处，都会出现光标。</td><td>很常用。比如变量重命名的时候，就经常用到</td></tr></tbody></table><h3 id="7、多列选择-多列编辑">7、多列选择/多列编辑</h3><p>多列选择是更高效的多光标选择，所以单独列成一小段。</p><table><thead><tr><th>Mac 快捷键</th><th>Win 快捷键</th><th>作用</th><th>备注</th></tr></thead><tbody><tr><td>Cmd + Option + 上下键</td><td>Ctrl + Alt + 上下键</td><td>在连续的多列上，同时出现多个光标</td><td>较常用</td></tr><tr><td>Option + Shift + 鼠标拖动</td><td>Alt + Shift + 鼠标拖动</td><td>按住快捷键，然后把鼠标从区域的左上角拖至右下角，即可在选中区域的每一行末尾，出现光标。</td><td>很神奇的操作，较常用</td></tr><tr><td><strong>Option + Shift + i</strong></td><td><strong>Alt + Shift + I</strong></td><td>选中一堆文本后，按下快捷键，既可在<strong>每一行的末尾</strong>都出现一个光标。</td><td>很常用</td></tr></tbody></table><h3 id="8、编程语言相关">8、编程语言相关</h3><table><thead><tr><th style="text-align:left">Mac 快捷键</th><th style="text-align:left">Win 快捷键</th><th style="text-align:left">作用</th><th style="text-align:left">备注</th></tr></thead><tbody><tr><td style="text-align:left">Cmd + /</td><td style="text-align:left">Ctrl + /</td><td style="text-align:left">添加单行注释</td><td style="text-align:left">很常用</td></tr><tr><td style="text-align:left"><strong>Option + Shift + F</strong></td><td style="text-align:left">Alt + shift + F</td><td style="text-align:left">代码格式化</td><td style="text-align:left">很常用</td></tr><tr><td style="text-align:left">F2</td><td style="text-align:left">F2</td><td style="text-align:left">以重构的方式进行<strong>重命名</strong></td><td style="text-align:left">改代码备</td></tr><tr><td style="text-align:left">Ctrl + J</td><td style="text-align:left"></td><td style="text-align:left">将多行代码合并为一行</td><td style="text-align:left">Win 用户可在命令面板搜索”合并行“</td></tr><tr><td style="text-align:left">Cmd +</td><td style="text-align:left"></td><td style="text-align:left"></td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Cmd + U</td><td style="text-align:left">Ctrl + U</td><td style="text-align:left">将光标的移动回退到上一个位置</td><td style="text-align:left">撤销光标的移动和选择</td></tr></tbody></table><h3 id="9、搜索相关">9、搜索相关</h3><table><thead><tr><th style="text-align:left">Mac 快捷键</th><th style="text-align:left">Win 快捷键</th><th style="text-align:left">作用</th><th style="text-align:left">备注</th></tr></thead><tbody><tr><td style="text-align:left"><strong>Cmd + Shift + F</strong></td><td style="text-align:left"><strong>Ctrl + Shift +F</strong></td><td style="text-align:left">全局搜索代码</td><td style="text-align:left">很常用</td></tr><tr><td style="text-align:left"><strong>Cmd + P</strong></td><td style="text-align:left"><strong>Ctrl + P</strong></td><td style="text-align:left">在当前的项目工程里，<strong>全局</strong>搜索文件名</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Cmd + F</td><td style="text-align:left">Ctrl + F</td><td style="text-align:left">在当前文件中搜索代码，光标在搜索框里</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><strong>Cmd + G</strong></td><td style="text-align:left"><strong>F3</strong></td><td style="text-align:left">在当前文件中搜索代码，光标仍停留在编辑器里</td><td style="text-align:left">很巧妙</td></tr></tbody></table><h3 id="10、自定义快捷键">10、自定义快捷键</h3><p>按住快捷键「Cmd + Shift + P」，弹出命令面板，在命令面板中输入“快捷键”，可以进入快捷键的设置。</p><p>当然，你也可以选择菜单栏「偏好设置 --&gt; 键盘快捷方式」，进入快捷键的设置：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201244.png" alt=""></p><h3 id="11、快捷键列表">11、快捷键列表</h3><p>你可以点击 VS Code 左下角的齿轮按钮，效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201139.png" alt=""></p><p>上图中，在展开的菜单中选择「键盘快捷方式」，就可以查看和修改所有的快捷键列表了：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201333.png" alt=""></p><h3 id="快捷键参考表（官方）">快捷键参考表（官方）</h3><p>VS Code官网提供了 PDF版本的键盘快捷键参考表，转需：</p><ul><li>Windows版本：https://code.visualstudio.com/shortcuts/keyboard-shortcuts-windows.pdf</li><li>Mac 版本：https://code.visualstudio.com/shortcuts/keyboard-shortcuts-macos.pdf</li><li>Linux版本：https://code.visualstudio.com/shortcuts/keyboard-shortcuts-linux.pdf</li></ul><p>我们在 VS  Code软件里通过菜单栏「帮助--&gt;键盘快捷方式参考」也可以打开相应平台的快捷键大全（PDF版本）。</p><h2 id="三、高端访问：命令面板的使用">三、高端访问：命令面板的使用</h2><p>Mac 用户按住快捷键 <code>Cmd+Shift+P</code> （Windows 用户按住快捷键<code>Ctrl+Shift+P</code>），可以打开快速命令面板。效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201339.png" alt=""></p><p>命令面板的作用是<strong>希望解放开发者的鼠标，让一些操作和配置可以直接通过键盘进行</strong>。如果让开发者记住所有的配置项在菜单的哪个位置是不现实的，而且有些命令并不在菜单中。</p><p>有了命令面板之后，如果你需要修改一些设置项，或者进行一些快捷操作，则可以通过「命令面板」来操作，效率会更高。接下来列举一些。</p><h3 id="1、VS-Code-设置为中文语言">1、VS Code 设置为中文语言</h3><p>Mac 用户按住快捷键 <code>Cmd+Shift+P</code> （Windows 用户按住快捷键<code>Ctrl+Shift+P</code>），打开命令面板。</p><p>在命令面板中，输入<code>Configure Display Language</code>，选择<code>Install additional languages</code>，然后安装插件<code>Chinese (Simplified) Language Pack for Visual Studio Code</code>即可。</p><p>或者，我们可以直接安装插件<code>Chinese (Simplified) Language Pack for Visual Studio Code</code>，是一样的。</p><p>安装完成后，重启 VS Code。</p><h3 id="2、设置字体大小">2、设置字体大小</h3><p>在命令面板输入“字体”，可以进行字体的设置，效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201251.png" alt=""></p><p>当然，你也可以在菜单栏，选择「首选项-设置-常用设置」，在这个设置项里修改字体大小。</p><h3 id="3、快捷键设置">3、快捷键设置</h3><p>在命令面板输入“快捷键”，就可以进入快捷键的设置。</p><h3 id="4、大小写转换">4、大小写转换</h3><p>选中文本后，在命令面板中输入<code>transfrom</code>，就可以修改文本的大小写了。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201132.png" alt=""></p><h3 id="5、使用命令行启动-VS-Code">5、使用命令行启动 VS Code</h3><p>（1）输入快捷键「Cmd + Shift + P 」，选择<code>install code command</code>：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201258.png" alt=""></p><p>（2）使用命令行：</p><ul><li><code>code</code>命令：启动 VS Code 软件</li><li><code>code pathName/fileName</code>命令：通过 VS Code 软件打开指定目录/指定文件。</li></ul><p>备注：这种方法快捷简单，但是在电脑重启之后就失效了。稍后在第五段，我会介绍更常见的方法。</p><h3 id="6、修改特定编程语言的设置项">6、修改特定编程语言的设置项</h3><p>输入快捷键「Cmd + Shift + P 」打开命令面板，然后输入并执行 <code>Configure Language Specific Settings</code>即可。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201304.png" alt=""></p><h2 id="四、私人订制：VS-Code-的常见配置">四、私人订制：VS Code 的常见配置</h2><h3 id="0、设置项介绍">0、设置项介绍</h3><p>在修改 VS Code配置之前，我们需要知道，在哪里可以找到设置项的入口。</p><p><strong>方式1</strong>：Mac用户选择菜单栏「Code--&gt; 首选项--&gt;设置」，即可打开配置项：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201346.png" alt=""></p><p><strong>方式2</strong>：点击软件右下角的设置图标：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201347.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201125.png" alt=""></p><p>如上图所示，VS Code提供两种不同范围的设置：</p><ul><li><strong>用户</strong>设置：全局生效。</li><li><strong>工作区</strong>设置：只针对当前项目生效。工作区设置会覆盖用户设置。适用于团队协作场景。工作区的设置文件是保存在当前项目根目录的<code>.vscode/settings.json</code>中，可以被提交到Git仓库，方便共享给项目组的其他成员。</li></ul><p>操作技巧：</p><p>（1）我们可以在设置面板的顶部搜索框，输入关键词，就能迅速定位到你想要的设置项。</p><p>（2）上图中，点击右上角的icon，可以通过 json文件的形式修改设置项。</p><h3 id="1、修改主题">1、修改主题</h3><p>1）修改颜色主题：</p><p>选择菜单栏「Code --&gt; 首选项 --&gt; 颜色主题」：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201353.png" alt=""></p><p>在弹出的对话框中，挑选你一个你喜欢的的颜色主题吧，或者安装其他颜色的主题：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201119.png" alt="20211013_1018"></p><p>或者在设置项里搜索<code>Workbench: Color Theme</code>，进行修改。</p><p>2）修改文件图标的主题：</p><p>选择菜单栏「Code --&gt; 首选项 --&gt; 文件图标主题」：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201113.png" alt="20211013_1015"></p><p>在弹出的对话框中，挑选你一个你喜欢的的主题吧，或者安装其他的主题：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201112.png" alt="20211013_1019"></p><p>或者在设置项里搜索<code>Workbench: Icon Theme</code>，进行修改。</p><h3 id="2、面包屑（Breadcrumb）导航">2、面包屑（Breadcrumb）导航</h3><p>打开 VS Code 的设置项，选择「用户设置 -&gt; 工作台 -&gt; 导航路径」，如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201400.png" alt=""></p><p>上图中，将红框部分打钩即可。</p><p>设置成功后，我们就可以查看到当前文件的「层级结构」，非常方便。如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201106.png" alt=""></p><p>有了这个面包屑导航，我们可以点击它，在任意目录、任意文件之间随意跳转。使用频繁非常高。</p><h3 id="3、是否显示代码的行号">3、是否显示代码的行号</h3><p>VS Code 默认显示代码的行号。你可以在设置项里搜索 <code>editor.lineNumbers</code>修改设置，配置项如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201105.png" alt=""></p><p>我建议保留这个设置项，无需修改。</p><h3 id="4、右侧是否显示代码的缩略图">4、右侧是否显示代码的缩略图</h3><p>如果某个文件的代码量很大，缩略图就很有用了，可以预览全局，并在当前文件中快速跳转。</p><p>VS Code 会在代码的右侧，默认显示缩略图。你可以在设置项里搜索 <code>editor.minimap</code> 进行设置，配置项如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201407.png" alt=""></p><p>上面这张图，你仔细琢磨下会发现，中文翻译十分精准。</p><h3 id="5、将当前行代码高亮显示（更改光标所在行的背景色）">5、将当前行代码高亮显示（更改光标所在行的背景色）</h3><p>当我们把光标放在某一行时，这一行的背景色并没有发生变化。如果想<strong>高亮显示</strong>当前行的代码，需要设置两步：</p><p>（1）在设置项里搜索<code>editor.renderLineHighlight</code>，将选项值设置为<code>all</code>或者<code>line</code>。</p><p>（2）在设置项里增加如下内容：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"workbench.colorCustomizations"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"editor.lineHighlightBackground"</span><span class="token operator">:</span> <span class="token string">"#00000090"</span><span class="token punctuation">,</span>    <span class="token property">"editor.lineHighlightBorder"</span><span class="token operator">:</span> <span class="token string">"#ffffff30"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>上方代码，第一行代码的意思是：修改光标所在行的背景色（背景色设置为全黑，不透明度 90%）；第二行代码的意思是：修改光标所在行的边框色。</p><h3 id="6、改完代码后立即自动保存">6、改完代码后立即自动保存</h3><p><strong>方式一</strong>：</p><p>改完代码后，默认不会自动保存。你可以在设置项里搜索<code>files.autoSave</code>，修改参数值为<code>afterDelay</code>  ，即可自动保存。如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201514.png" alt=""></p><p>files.autoSave的参数值有以下几种：</p><ul><li>off（默认值）：不自动保存。</li><li>afterDelay（建议配置）：文件修改超过一定时间（默认1秒）后，就自动保存。</li><li>onFocusChange：当前编辑器失去焦点时，则自动保存。如果我们将配置项修改为<code>onFocusChange</code>之后，那么，当光标离开该文件后，这个文件就会自动保存了。</li><li>onWindowChange：VS  Code软件失去焦点时，则自动保存。</li></ul><p><strong>方式二</strong>：</p><p>当然，你也可以直接在菜单栏选择「文件-自动保存」。勾选后，当你写完代码后，文件会立即实时保存。</p><h3 id="7、热退出">7、热退出</h3><p>当VS Code退出后，它可以记住未保存的文件。如果你希望达到这种效果，那么，你需要先将设置项<code>files.hotExit</code>的值改为 <code>onExitAndWindowClose</code>。这个配置项要不要改，看你个人需要。比如我自己平时设置的值是<code>onExit</code>。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201413.png" alt="20211012_2014"></p><h3 id="8、保存代码后，是否立即格式化">8、保存代码后，是否立即格式化</h3><p>保存代码后，默认<strong>不会立即</strong>进行代码的格式化。你可以在设置项里搜索<code>editor.formatOnSave</code>查看该配置项：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201058.png" alt=""></p><p>我觉得这个配置项保持默认就好，不用打钩。</p><h3 id="9、自动格式化粘贴的内容">9、自动格式化粘贴的内容</h3><p>在设置项里搜索 <code>editor.formatOnPaste</code>，将设置项改为<code>true</code>：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201059.png" alt="20211012_1049"></p><h3 id="10、设置字体大小">10、设置字体大小</h3><p>在设置项里搜索<code>fontSize</code>，然后根据需要设置各种模块的字体大小：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201420.png" alt="20211012_1053"></p><h3 id="11、空格-or-制表符">11、空格 or 制表符</h3><p>VS Code 会根据你所打开的文件来决定该使用空格还是制表。也就是说，如果你的项目中使用的都是制表符，那么，当你在写新的代码时，按下 tab 键后，编辑器就会识别成制表符。</p><p>（1）建议的设置项如下：</p><ul><li><strong>editor.detectIndentation</strong>：自动检测（默认开启）。建议把这个配置项修改为 false，截图如下：</li></ul><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201052.png" alt="20211012_1139"></p><p>这样做，是为了取消系统的自动缩进，建议自己手动格式化比较好。 参考链接：https://www.yisu.com/zixun/327399.html</p><ul><li><strong>editor.insertSpaces</strong>：按 Tab 键时插入空格（默认值为true）。截图如下：</li></ul><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201523.png" alt=""></p><ul><li><strong>editor.tabSize</strong>：一个制表符默认等于四个空格。截图如下：</li></ul><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201530.png" alt=""></p><p>（2）状态栏也会显示当前的缩进值。点击状态栏，可以直接修改 tabSize 缩进值：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201045.png" alt=""></p><p>（3）另外，我们还可以安装 prettier 插件，设置代码在格式化时默认缩进值。prettier 是做代码格式化的最常见工具。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201536.png" alt=""></p><p>（4）去掉每一行末尾的空格。在设置项里搜索<code>空格</code>或者<code>"files.trimTrailingWhitespace"</code>，将值设置为 true：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201858.png" alt="20211012_1231"></p><p>一般来说，每一行代码末尾的空格是多余的，所以建议去掉。</p><h3 id="12、直观地显示代码里的空格和缩进-✨">12、直观地显示代码里的空格和缩进 ✨</h3><p>代码里如果有缩进或者空格，肉眼是看不出来的，但是我们可以修改配置项，把它揪出来。</p><p>在配置项里搜索<code>editor.renderWhitespace</code>，修改为<code>all</code>：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201039.png" alt="20211012_1150"></p><p>修改之后，代码里的空格、缩进的展示效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201905.png" alt="20211012_1258"></p><p>看到了没？哪里有空格、哪里是缩进，全都一目了然。</p><h3 id="13、新建文件后的默认文件类型">13、新建文件后的默认文件类型</h3><p>当我们按下快捷键「Cmd + N」新建文件时，VS Code 默认无法识别这个文件到底是什么类型的，因此也就无法识别相应的语法高亮。</p><p>如果你想修改默认的文件类型，可以在设置项里搜索<code>files.defaultLanguage</code>，设置项如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201542.png" alt=""></p><p>上图中的红框部分，填入你期望的默认文件类型。我填的是<code>html</code>类型，你也可以填写成 <code>javascript</code> 或者 <code>markdown</code>，或者其他的语言类型。</p><h3 id="14、删除文件时，是否弹出确认框">14、删除文件时，是否弹出确认框</h3><p>当我们在 VS Code 中删除文件时，默认会弹出确认框。如果你想修改设置，可以在设置项里搜索<code>xplorer.confirmDelete</code>。截图如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201032.png" alt=""></p><p>我建议这个设置项保持默认的打钩就好，不用修改。删除文件前的弹窗提示，也是为了安全考虑，万一手贱不小心删了呢？</p><h3 id="15、在新窗口打开文件-文件夹">15、在新窗口打开文件/文件夹</h3><p>通过 <code>window.openFoldersInNewWindow</code>（默认值为off）和<code>window.openFilesInNewWindow</code>（默认值为default），可以配置在打开文件夹、打开文件时，是否开启一个新的窗口。我个人建议，把这两个配置项都设置为 on，避免旧的窗口被覆盖：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201549.png" alt=""></p><p>补充知识—— <code>window.restoreWindows</code>可以用来配置 如何恢复之前的会话窗口。涉及到的场景是：你把 VS Code 关闭了，然后又打开了，是否要展示之前打开过的文件、文件夹？参数值有以下几种：</p><ul><li>one（默认配置）：只会重新打开上一次回话中最后操作的那一个窗口。</li><li>none：打开一个空的窗口，不包含任何文件、文件夹。</li><li>all（建议配置）：恢复上一次会话中的所有窗口。</li><li>folders：恢复上一次会话中包含文件夹的窗口。</li></ul><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201026.png" alt="20211012_1704"></p><blockquote><p>接下来，我们来讲一些更高级的操作。</p></blockquote><h2 id="五、纵享丝滑：常见操作和使用技巧">五、纵享丝滑：常见操作和使用技巧</h2><h3 id="1、快速生成HTML骨架">1、快速生成HTML骨架</h3><p>先新建一个空的html文件，然后通过以下方式，可以快速生成html骨架。</p><p><strong>方式1</strong>：输入<code>!</code>，然后按下<code>enter</code>键，即可生成html骨架。如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201555.gif" alt=""></p><p><strong>方式2</strong>：输入<code>html:5</code>，然后按住 <code>Tab</code>键，即可生成html骨架。</p><p>生成的骨架，内容如下：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>有了上面的html骨架之后，我们就可以快乐地在里面插入CSS 代码和 JS 代码。</p><h3 id="2、并排编辑：左右（上下）显示多个编辑器窗口（copy代码利器）">2、并排编辑：左右（上下）显示多个编辑器窗口（copy代码利器）</h3><blockquote><p>并排编辑是所有的编辑操作中最常用的一个技巧，十分有用。比如我们在开发一个项目时，可能需要同时打开 HTML 文件和 CSS 文件，很常见。</p></blockquote><p>Mac 用户按住快捷键 <code>Cmd + \</code>， Windows 用户按住快捷键<code>Ctrl + \</code>，即可同时打开多个编辑器窗口，进行并排编辑。效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201020.gif" alt=""></p><p>按快捷键「Cmd + 1 」切换到左边的窗口，按快捷键「Cmd + 2 」切换到右边的窗口，以此类推。随时随地，想切就切。</p><p>学会了这一招，以后 copy 代码的时候，leader 再也不用担心我抄得慢了，一天工资到手。</p><hr><p>当然，使用快捷键<code>Cmd + \</code>只是其中一种方式，我们还有很多种方式打开并行编辑。我们来做一个汇总。</p><p>如果你已经打开了一个编辑器，那么可以通过以下几种方式在另一侧打开另一个编辑器：（按照使用频率，从高到低排序）</p><ul><li>使用快捷键<code>Cmd + \</code>将编辑器一分为二。</li><li>使用快捷键<code>Cmd + P</code>调出文件列表，选择要打开的文件，然后按下 <code>Cmd + Enter</code>快捷键。【重要】</li><li>按住 Option 键的同时，单击资源管理器的文件（Windows 用户是按 Alt 键）。</li><li>点击编辑器右上角的 <code>Split Editor</code>按钮。</li><li>选择菜单栏「查看--&gt; 编辑器布局」，然后选择你具体想要的布局，如下图所示：</li></ul><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201602.png" alt="20211012_1451"></p><ul><li>通过拖拽，把当前文件移动到任意一侧。</li></ul><p>补充知识：通过配置项<code>worbench.editor.OpenSideBySideDirection</code>可以控制编辑器在并排打开时出现的默认位置（默认值为right，你也可以根据需要改为 down）。如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201019.png" alt="20211012_1455"></p><h3 id="3、从终端-code-命令启动-VS-Code（Mac电脑）">3、从终端 code 命令启动 VS Code（Mac电脑）</h3><p>在终端输入<code>code</code>或者输入 <code>code + 指定项目的目录</code>，就可以启动 VS  Code，十分便捷。即：</p><ul><li><code>code</code> 命令：启动 VS Code 软件。</li><li><code>code pathName/fileName</code> 命令：通过 VS Code 软件打开指定目录/指定文件。</li></ul><p>为了达到目的，我们需要先将 VS Code的软件安装路径添加到环境变量，一劳永逸。具体操作如下：</p><p>（1）打开 <code>bash_profile</code>文件：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~<span class="token function">vim</span> ./bash_profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>（2）在 bash_profile 中添加如下内容：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 从终端启动VS Code，并设置vscode启动的命令别名</span><span class="token builtin class-name">alias</span> <span class="token assign-left variable">code</span><span class="token operator">=</span><span class="token string">"/Applications/Visual\ Studio\ Code.app/Contents/Resources/app/bin/code"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>注意，由于<code>Visual Studio Code.app</code>这个路径里有空格，所以需要在空格前面加上反斜杠<code>\</code>。</p><p>（3）重启环境变量的配置：</p><pre class="line-numbers language-none"><code class="language-none"># 重启source ~/.bash_profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>大功告成。</p><p>改完之后，如果没生效，那你把  <code>bash_profile</code>文件 换成 <code>zshrc</code>文件试试。</p><p>参考链接：</p><ul><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/logan_LG/article/details/106800904">mac通过终端code 命令打开vscode</a></li></ul><h3 id="3、从终端-code-命令启动-VS-Code（Windows电脑）">3、从终端 code 命令启动 VS Code（Windows电脑）</h3><p>在终端输入<code>code</code>或者输入 <code>code + 指定项目的目录</code>，就可以启动 VS  Code，十分便捷。即：</p><ul><li><code>code</code> 命令：启动 VS Code 软件。</li><li><code>code pathName/fileName</code> 命令：通过 VS Code 软件打开指定目录/指定文件。</li></ul><p>为了达到目的，我们需要先将 VS Code的软件安装路径添加到环境变量，一劳永逸。具体操作如下：</p><p>（1）打开 VS Code 的安装位置，进入bin文件夹，复制路径。比如：<code>D:\Microsoft VS Code\bin</code>。</p><p>（2）回到桌面，右键我的电脑--&gt;高级系统设置--&gt;环境变量--&gt;编辑path值，在原来的path后面，追加内容<code>;D:\Microsoft VS Code\bin</code>（即英文的分号+VS  Code 的 bin 路径)</p><p>（3）重启电脑，大功告成。</p><p>改完之后，如果没生效，那八成是因为你填的 path 值有问题。</p><p>参考链接：</p><ul><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zyl-Tara/p/10642704.html">windows使用 code . 命令打开vscode</a></li></ul><h3 id="4、在当前文件中搜索">4、在当前文件中搜索</h3><p>在上面的快捷键列表中，我们已经知道如下快捷键：</p><ul><li><p>Cmd + F（Win 用户是 Ctrl + F）：在当前文件中搜索，光标在搜索框里</p></li><li><p>Cmd + G（Win 用户是 F3）：在当前文件中搜索，光标仍停留在编辑器里</p></li></ul><p>多个搜索结果出来之后，按下 Enter 键之后跳转到下一个搜索结果，按下 Shift + Enter 键之后跳转到上一个搜索结果。</p><p>另外，你可能会注意到，搜索框里有很多按钮，每个按钮都对应着不同的功能，如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201012.png" alt=""></p><p>上图中，你可以通过「Tab」键和「Shift + Tab」键在输入框和替换框之间进行切换。</p><p>「在选定内容中查找」这个功能还是比较实用的。你也可以在设置项里搜索 <code>editor.find.autoFindInSelection</code>，勾选该设置项后，那么，当你选中指定内容后，然后按住「Cmd + F」，就可以<strong>自动</strong>只在这些内容里进行查找。该设置项如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201608.png" alt=""></p><h3 id="5、全局搜索">5、全局搜索</h3><p>在上面的快捷键列表中，我们已经知道如下快捷键：</p><ul><li>Cmd + Shift + F（Win 用户是 Ctrl + Shift +F）：在全局的文件夹中进行搜索。效果如下：</li></ul><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201013.png" alt="20211012_1548"></p><p>上图中，你可以点击<strong>红框</strong>部分，展开更多的配置项。然后点击<strong>红圈</strong>部分，进行过滤搜索。注意，第二个红圈那里会经常用到，它可以在搜索时过滤掉  <code>.git</code>、<code>.node_modules</code>等忽略文件。</p><p>上图中，我们还可以点击“在编辑器中打开”，在一个单独的文件中聚合展示搜索结果：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201615.png" alt=""></p><h3 id="6、文件名-文件夹的搜索">6、文件名/文件夹的搜索</h3><p>前面的快捷键那一段我们讲过，通过 「Cmd + P」可以快速搜索并打开<strong>文件</strong>/文件夹。这种方式，一般用于快速打开最近编辑过的文件。</p><p>其实还有一种很巧妙的方式，可以在整个项目里，既能搜到文件，也能搜到<strong>文件夹</strong>。这种方式，常用于<strong>过滤项目的目录</strong>。操作方法很简单：</p><blockquote><p>直接在文件资源管理器输入关键字就行。搜索结果会自动出现；使用方向键进行上下移动，可以在搜索的文件和文件夹之间进行跳转。</p><p>另外，右上角会看到一个过滤器，点击下图中的红圈部分，则只显示匹配的文件和文件夹。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201006.png" alt="20211012_1616"></p><p>当然，这招也有一点不足：不能搜中文。</p><h3 id="7、大纲视图">7、大纲视图</h3><p>如下图所示，大纲视图可以展示当前代码的方法结构、文件的目录结构：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201621.png" alt="20211012_1628"></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201929.png" alt="20211012_1636"></p><h3 id="8、文件对比">8、文件对比</h3><p>VS Code 默认支持<strong>对比两个文件的内容</strong>。选中两个文件，然后右键选择「将已选项进行比较」即可，效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200959.png" alt=""></p><p>VS Code 自带的对比功能并不够强大，我们可以安装插件<code>compareit</code>，进行更丰富的对比。比如说，安装完插件<code>compareit</code>之后，我们可以将「当前文件」与「剪切板」里的内容进行对比：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201628.png" alt=""></p><p>如果你安装了 GitLens 插件，还可以将两个git分支的代码进行比对，非常完美。</p><h3 id="9、查找某个函数在哪些地方被调用了">9、查找某个函数在哪些地方被调用了</h3><p>比如我已经在<code>a.js</code>文件里调用了 <code>foo()</code>函数。那么，如果我想知道<code>foo()</code>函数在其他文件中是否也被调用了，该怎么做呢？</p><p>做法如下：在 <code>a.js</code> 文件里，选中<code>foo()</code>函数（或者将光标放置在<code>foo()</code>函数上），然后按住快捷键「Shift + F12」，就能看到 <code>foo()</code>函数在哪些地方被调用了，比较实用。</p><h3 id="10、鼠标操作">10、鼠标操作</h3><ul><li><p>在当前行的位置，鼠标三击，可以选中当前行。</p></li><li><p>用鼠标单击文件的<strong>行号</strong>，可以选中当前行。</p></li><li><p>在某个<strong>行号</strong>的位置，<strong>上下移动鼠标，可以选中多行</strong>。</p></li></ul><h3 id="11、重构">11、重构</h3><p>重构分很多种，我们来举几个例子。</p><p><strong>命名重构</strong>：</p><p>当我们尝试去修改某个函数（或者变量名）时，我们可以把光标放在上面，然后按下「F2」键，那么，这个函数（或者变量名）出现的地方都会被修改。</p><p><strong>方法重构</strong>：</p><p>选中某一段代码，这个时候，代码的左侧会出现一个「灯泡图标」，点击这个图标，就可以把这段代码提取为一个单独的函数。</p><h3 id="12：终端配置">12：终端配置</h3><p>VS Code软件自带了终端，但我个人认为不是很好用，而且VS Code 软件关了之后，终端也没了。建议大家使用其他的终端软件，专业的事情交给专业的人做。</p><ul><li>Windows平台的终端：推荐 PowerShell 软件。远程终端推荐 xshell 软件。</li><li>Mac平台的终端：推荐 <a target="_blank" rel="noopener" href="https://iterm2.com/">iTerm2 </a>。 iTerm2 是Mac平台最好用的终端软件，没有之一。</li></ul><p><strong>右键行为</strong>：</p><blockquote><p>在终端上，单击右键所产生的行为在不同的系统里是不同的。</p></blockquote><ul><li>Windows：如果有<strong>选定</strong>文本，则复制当前文本；如果没有选定文本，则粘贴。</li><li>macOS：选中光标所在位置的单词，并显示右键菜单。</li><li>Linux：显示右键菜单。</li></ul><h3 id="13、Git-版本管理">13、Git 版本管理</h3><p>在 VS Code中使用Git之前，需要你先安装 Git 环境。</p><p>VS Code 自带了 Git 版本管理的功能，如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200958.png" alt=""></p><p>上图中，我们可以在这里进行常见的 git 命令操作。如果你还不熟悉 <strong>Git 版本管理</strong>，可以先去补补课。</p><p>我自己用的最多的功能是<strong>diff 代码</strong>和<strong>合并冲突</strong>，自从用上了  VS Code 的这两个功能，简直离不开它。</p><p>我们先来看看 diff 代码的效果：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201634.png" alt="20211013_1411"></p><p>上图中，点击右上角的<code>...</code>，然后点击<code>内联视图</code>，则可以换一种视图 diff 代码：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201937.png" alt=""></p><p><strong>Git状态栏</strong>：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200952.png" alt="20211013_1421"></p><p>在VS Code的左下角会显示Git状态栏。如果当前代码仓库配置了远程仓库，那么“同步更改”会显示以下信息：</p><ul><li>左边的数字：表示远程分支比本地分支多了XX个 Git commit。</li><li>右边的数字：表示本地分支比远程分支多了XX个 Git commit。</li></ul><p>点击“同步更改”按钮，会拉取（pull）远程分支到本地分支，并推送（push）本地的Git commit到远程分支。</p><p>如果当前代码仓库没有配置远程仓库，则会显示“发布更改”的按钮。点击“发布更改”按钮，会把当前分支push到远程仓库。</p><hr><p>另外，我建议安装插件<code>GitLens</code>搭配使用，它是 VS Code 中我最推荐的一个插件，简直是 Git 神器，码农必备。</p><p>我还要补充一句：</p><p>有人说，高手都是直接用命令行操作Git。然而，根据我多年的经验来看，如果你的代码仓库需要管理的分支特别多，与团队的其他成员需要经常协作，那么，我建议你<strong>优先使用</strong> GUI 图形化工具来操作Git，避免出错。</p><p>我推荐的GUI版的Git工具有：</p><ul><li><a target="_blank" rel="noopener" href="https://www.git-tower.com/">Tower</a></li><li><a target="_blank" rel="noopener" href="https://www.sourcetreeapp.com/">Sourcetree</a></li><li><a target="_blank" rel="noopener" href="https://www.gitkraken.com/">GitKraken</a></li></ul><h3 id="14、将工作区放大-缩小">14、将工作区放大/缩小</h3><p>我们在上面的设置项里修改字体大小后，仅仅只是修改了代码的字体大小。</p><p>如果你想要缩放整个工作区（包括代码的字体、左侧导航栏的字体等），可以按下快捷键「<strong>cmd +/-</strong>」。windows 用户是按下「ctrl +/-」</p><p><strong>当我们在投影仪上给别人演示代码的时候，这一招十分管用</strong>。</p><p>如果你想恢复默认的工作区大小，可以在命令面板输入<code>重置缩放</code>（英文是<code>reset zoom</code>）</p><p>f### 11、创建多层子文件夹</p><p>我们可以在新建文件夹的时候，如果直接输入<code>aa/bb/cc</code>，比如：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201641.png" alt=""></p><p>那么，就可以创建多层子文件夹，效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200945.png" alt=""></p><h3 id="15、-vscode-文件夹的作用">15、<code>.vscode</code> 文件夹的作用</h3><p>为了统一团队的 vscode 配置，我们可以在项目的根目录下建立<code>.vscode</code>目录，在里面放置一些配置内容，比如：</p><ul><li><p><code>settings.json</code>：工作空间设置、代码格式化配置、插件配置。</p></li><li><p><code>sftp.json</code>：ftp 文件传输的配置。</p></li></ul><p><code>.vscode</code>目录里的配置只针对当前项目范围内生效。将<code>.vscode</code>提交到代码仓库，大家统一配置时，会非常方便。</p><h3 id="16、自带终端">16、自带终端</h3><p>我们可以按下「Ctrl + `」打开 VS Code 自带的终端。我认为内置终端并没有那么好用，我更建议你使用第三方的终端 <strong>item2</strong>。</p><h3 id="17、markdown-语法支持">17、markdown 语法支持</h3><p>VS Code 自带 markdown 语法高亮。也就是说，如果你是用 markdown 格式写文章，则完全可以用 VS Code 进行写作。</p><p>写完 md 文件之后，你可以点击右上角的按钮进行预览，如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201648.png" alt=""></p><p>我一般是安装「Markdown Preview Github Styling」插件，以 GitHub 风格预览 Markdown 样式。样式十分简洁美观。</p><p>你也可以在控制面板输入<code>Markdown: 打开预览</code>，直接全屏预览 markdown 文件。</p><h3 id="18、Emmet-in-VS-Code">18、Emmet in VS Code</h3><p><code>Emmet</code>可以极大的提高 html 和 css 的编写效率，它提供了一种非常简练的语法规则。</p><p>举个例子，我们在编辑器中输入缩写代码：<code>ul&gt;li*6</code> ，然后按下 Tab 键，即可得到如下代码片段：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>VS Code 默认支持 Emmet。更多 Emmet 语法规则，可以自行查阅。</p><h3 id="19、修改字体，使用「Fira-Code」字体">19、修改字体，使用「Fira Code」字体</h3><p>这款字体很漂亮，很适合用来写代码：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201655.png" alt=""></p><p>安装步骤如下：</p><p>（1）进入 <a target="_blank" rel="noopener" href="https://github.com/tonsky/FiraCode">https://github.com/tonsky/FiraCode</a> 网站，下载并安装「Fira Code」字体。</p><p>（2）打开 VS Code 的「设置」，搜索<code>font</code>，修改相关配置为如下内容：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"editor.fontFamily"</span><span class="token operator">:</span> <span class="token string">"'Fira Code',Menlo, Monaco, 'Courier New', monospace"</span><span class="token punctuation">,</span> <span class="token comment">// 设置字体显示</span><span class="token property">"editor.fontLigatures"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">//控制是否启用字体连字，true启用，false不启用</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>上方的第二行配置，取决于个人习惯，我是直接设置为<code>"editor.fontLigatures": null</code>，因为我不太习惯连字。</p><h3 id="20、代码格式化">20、代码格式化</h3><p>VS Code 默认对 JavaScript、TypeScript、JSON、HTML 提供了开箱即用的代码格式化支持。其他语言则需要先安装相应的插件才能支持。</p><p>另外，我们还可以安装 Prettier 插件进行<strong>更精细</strong>的代码格式化。下一段将插件的时候，会讲解。</p><h3 id="21、智能提示-IntelliSense">21、智能提示 IntelliSense</h3><p>VS Code 默认对 JavaScript、TypeScript、JSON、HTML、CSS、SCSS、Less这7种语言（文件）提供了<strong>智能提示</strong>的支持。其他编程语言则需要先安装相应的插件才能支持。</p><p>在 VS Code插件职场中，下图是最受欢迎的8种<a href="https://marketplace.visualstudio.com/search?target=VSCode&amp;category=Programming%20Languages&amp;sortBy=Installs">编程语言插件</a>：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201656.png" alt="20211013_1120"></p><p>智能提示的功能很强大， 包括函数介绍、代码自动补全等等。</p><h3 id="22、调试与运行">22、调试与运行</h3><p>VS Code <strong>内置</strong>了对 Node.js 运行时的调试支持，可以直接调试  JavaScript 和 TypeScript。其他编程语言的调试，则需要先安装相应的插件才能支持。</p><p>在 VS Code插件市场中，下图是最受欢迎的几种调试插件：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200938.png" alt=""></p><h3 id="23、文件传输：sftp">23、文件传输：sftp</h3><p>如果你需要将本地文件通过 ftp 的形式上传到局域网的服务器（需要先把服务端的配置搭建好），可以安装<code>sftp</code>这个插件，很好用。在公司会经常用到。</p><p>步骤如下：</p><p>（1）安装插件<code>sftp</code>。</p><p>（2）配置 <code>sftp.json</code>文件。 插件安装完成后，输入快捷键「cmd+shift+P」弹出命令面板，然后输入<code>sftp:config</code>，回车，当前工程的<code>.vscode</code>文件夹下就会自动生成一个<code>sftp.json</code>文件，我们需要在这个文件里配置的内容可以是：</p><ul><li><p><code>host</code>：服务器的 IP 地址</p></li><li><p><code>username</code>：用户名</p></li><li><p><code>privateKeyPath</code>：存放在本地的已配置好的用于登录工作站的密钥文件（也可以是 ppk 文件）</p></li><li><p><code>remotePath</code>：工作站上与本地工程同步的文件夹路径，需要和本地工程文件根目录同名，且在使用 sftp 上传文件之前，要手动在工作站上 mkdir 生成这个根目录</p></li><li><p><code>ignore</code>：指定在使用 sftp: sync to remote 的时候忽略的文件及文件夹，注意每一行后面有逗号，最后一行没有逗号</p></li></ul><p>举例如下：(注意，其中的注释需要去掉)</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"host"</span><span class="token operator">:</span> <span class="token string">"192.168.xxx.xxx"</span><span class="token punctuation">,</span> <span class="token comment">//服务器ip</span>  <span class="token property">"port"</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token comment">//端口，sftp模式是22</span>  <span class="token property">"username"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token comment">//用户名</span>  <span class="token property">"password"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token comment">//密码</span>  <span class="token property">"protocol"</span><span class="token operator">:</span> <span class="token string">"sftp"</span><span class="token punctuation">,</span> <span class="token comment">//模式</span>  <span class="token property">"agent"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>  <span class="token property">"privateKeyPath"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>  <span class="token property">"passphrase"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>  <span class="token property">"passive"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token property">"interactiveAuth"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token property">"remotePath"</span><span class="token operator">:</span> <span class="token string">"/root/node/build/"</span><span class="token punctuation">,</span> <span class="token comment">//服务器上的文件地址</span>  <span class="token property">"context"</span><span class="token operator">:</span> <span class="token string">"./server/build"</span><span class="token punctuation">,</span> <span class="token comment">//本地的文件地址</span>  <span class="token property">"uploadOnSave"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//监听保存并上传</span>  <span class="token property">"syncMode"</span><span class="token operator">:</span> <span class="token string">"update"</span><span class="token punctuation">,</span>  <span class="token property">"watcher"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token comment">//监听外部文件</span>    <span class="token property">"files"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//外部文件的绝对路径</span>    <span class="token property">"autoUpload"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token property">"autoDelete"</span><span class="token operator">:</span> <span class="token boolean">false</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"ignore"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token comment">//忽略项</span>    <span class="token string">"**/.vscode/**"</span><span class="token punctuation">,</span>    <span class="token string">"**/.git/**"</span><span class="token punctuation">,</span>    <span class="token string">"**/.DS_Store"</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>（3）在 VS Code 的当前文件里，选择「右键 -&gt; upload」，就可以将本地的代码上传到 指定的 ftp 服务器上（也就是在上方 <code>host</code> 中配置的服务器 ip）。</p><p>我们还可以选择「右键 -&gt; Diff with Remote」，就可以将本地的代码和 ftp 服务器上的代码做对比，非常方便。</p><h3 id="24、沉浸模式-禅模式">24、沉浸模式/禅模式</h3><p>程序员写代码需要专注，有时需要进入一种心流。VS Code给我们提供了一种全屏下的沉浸模式，周围的面板都会被隐藏起来，只显示编辑器部分。</p><p>操作方法：菜单栏选择「查看-外观-禅模式」即可；或者按下快捷键<code>Cmd + K</code>，放手，再按<code>Z</code>也可以达到目的。</p><h3 id="正则表达式批量删除字符串">正则表达式批量删除字符串</h3><p><strong>需求</strong>：将文本中的字符串<code>axxxxb</code>，批量替换为<code>ab</code>。其中，开头字符 a 和 结尾字符 b 固定，中间xxx长度不确定。</p><p><strong>解决</strong>：传统查找替换无法胜任。可以使用VScode正则表达式功能，查找<code>a.*?b</code>替换为<code>ab</code>即可。其中<code>?</code>是禁止贪婪匹配，否则会误删很多内容。</p><hr><p><strong>拓展需求</strong>：需求——将文本中的字符串<code>axxxx</code>，批量替换为<code>a</code>。其中，开头字符 a 固定，后面的xxx长度不确定。</p><p><strong>解决</strong>：传统查找替换无法胜任。可以使用VScode正则表达式功能，查找<code>a.*?\n</code>替换为<code>a\n</code>即可。</p><h2 id="六、三头六臂：VS-Code-插件介绍-插件推荐">六、三头六臂：VS Code 插件介绍 &amp; 插件推荐</h2><p>VS Code 有一个很强大的功能就是支持插件扩展，让你的编辑器仿佛拥有了三头六臂。</p><h3 id="安装插件-4">安装插件</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201702.png" alt=""></p><p>上图中，点击红框部分，即可在顶部输入框里，查找你想要的插件名，然后进行安装。</p><p>插件安装完成后，记得重启软件（或者点击插件位置的“重新加载”），插件才会生效。</p><p>另外，我们还可以访问官网的插件市场来安装插件：</p><ul><li>VS Code插件市场（官方）：https://marketplace.visualstudio.com/vscode</li></ul><p><strong>插件的安装目录</strong>：</p><ul><li>Windows：：<code>%USERPROFILE%\.vscode\extensions</code></li><li>macOS：<code>~/.vscode/extensions</code></li><li>macOS：<code>~/.vscode/extensions</code></li></ul><h3 id="插件的类型">插件的类型</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201709.png" alt="20211013_1757_2"></p><p>插件市场的首页有四个模块，可以作为重要的信息来源：</p><ul><li>Featured：由  VS Code团队精心推荐的插件。</li><li>Trending：近期热门插件。</li><li>Most Popular：按总安装量排序的插件。</li><li>Recently Added：最新发布的插件。</li></ul><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200932.png" alt="20211013_1758"></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200925.png" alt="20211013_1955"></p><p>插件市场至少有17种类型的插件：（按照数量排序）</p><ul><li>Themes：主题插件</li><li>Programming Languages：编程语言插件</li><li>Snippets：代码片段</li><li>Extension Packs：插件包，里面包括多个插件</li><li>Formatters：代码格式化</li><li>Linters：静态检查</li><li>Debuggers：调试器</li><li>Keymaps：快捷键映射</li><li>Visualization：可视化</li><li>Language Packs：各国的语言插件</li><li>Azure：Azure 云计算</li><li>Data Science：数据科学</li><li>SCM Providers：源代码控制管理器（source control manager）</li><li>Notebooks</li><li>Education：教育</li><li>Testing：测试相关</li><li>Machine Learning：机器学习</li><li>Others：其他</li></ul><h3 id="插件的过滤显示">插件的过滤显示</h3><p>在 VS  Code中打开插件管理视图，可以针对已安装的插件，进行过滤展示。</p><p>1）点击插件视图右上角的<code>...</code>按钮，可以展示不同状态的插件：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201958.png" alt="20211013_2011"></p><p>2）在搜索框输入字符<code>@</code>，会展示出不同类型的过滤器：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201716.png" alt="20211013_2015"></p><p><strong>常见的过滤器如下</strong>：</p><p>1）按大类搜：</p><ul><li><code>@builtin</code>：显示 VS Code内置的插件</li><li><code>@disabled</code>：显示被禁用的插件</li><li><code>@enabled</code>：显示已启用的插件</li><li><code>@installed</code>：显示已安装的插件</li><li><code>@outdated</code>：显示待更新的插件</li></ul><p>2）精准搜索：</p><ul><li><code>@id</code>：按id显示插件</li><li><code>@tag</code>：根据标签显示插件。</li></ul><p>3）对插件进行排序：</p><ul><li><code>@sort:installs</code>：根据插件的安装量排序</li><li><code>@sourt:rating</code>：根据插件的评分排序</li><li><code>@sort:name</code>：根据插件名字的字母顺序排序</li></ul><p>4）组合搜索：（举例）</p><ul><li><code>@installed @category:themes</code>：显示已安装的主题插件。</li><li><code>@sort:installs java</code>：对 Java 相关的插件按照安装量排序。</li></ul><p>下面的内容，我来列举一些常见的插件，这些插件都很实用，小伙伴们可以按需安装。注意：每一类插件里，<strong>顺序越靠前，越实用</strong>。</p><h3 id="1、基本插件">1、基本插件</h3><h4 id="Chinese-Simplified-Language-Pack-for-Visual-Studio-Code">Chinese (Simplified) Language Pack for Visual Studio Code</h4><p>让软件显示为简体中文语言。</p><h3 id="2、Git-相关插件">2、Git 相关插件</h3><h4 id="GitLens-【荐】">GitLens 【荐】</h4><p>我强烈建议你安装插件<code>GitLens</code>，它是 VS Code 中我最推荐的一个插件，简直是 Git 神器，码农必备。如果你不知道，那真是 out 了。</p><p>GitLens 在 Git 管理上有很多强大的功能，比如：</p><ul><li>将光标放置在代码的当前行，可以看到这样代码的提交者是谁，以及提交时间。这一点，是 GitLens 最便捷的功能。</li><li>查看某个 commit 的代码改动记录</li><li>查看不同的分支</li><li>可以将两个 commit 进行代码对比</li><li>甚至可以将两个 branch 分支进行整体的代码对比。这一点，简直是 GitLens 最强大的功能。当我们在不同分支 review 代码的时候，就可以用到这一招。</li></ul><p>打开你的 Git仓库，未安装  GitLens 时是这样的：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200918.png" alt=""></p><p>安装了  GitLens 之后是这样的：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201723.png" alt=""></p><p>上图中，红框部分就是  GitLens 的功能，诸君可以自由发挥。</p><p>补充一个有意思的趣事：Python插件、Ruby插件、GitLens插件、Vetur插件，这四个插件的开发者先后加入了微软。</p><h4 id="Git-History">Git History</h4><p>有些同学习惯使用编辑器中的 Git 管理工具，而不太喜欢要打开另外一个 Git UI 工具的同学，这一款插件满足你查询所有 Git 记录的需求。</p><h4 id="Local-History-【荐】">Local History 【荐】</h4><p>维护文件的本地历史记录。代码意外丢失时，有时可以救命。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201729.png" alt=""></p><h3 id="3、代码智能提示插件">3、代码智能提示插件</h3><h4 id="Vetur">Vetur</h4><p>Vue 多功能集成插件，包括：语法高亮，智能提示，emmet，错误提示，格式化，自动补全，debugger。VS Code 官方钦定 Vue 插件，Vue 开发者必备。</p><h4 id="ES7-React-Redux-GraphQL-React-Native-snippets">ES7 React/Redux/GraphQL/React-Native snippets</h4><p>React/Redux/react-router 的语法智能提示。</p><h4 id="JavaScript-ES6-code-snippets">JavaScript(ES6) code snippets</h4><p>ES6 语法智能提示，支持快速输入。</p><h4 id="javascript-console-utils：快速打印-log-日志【荐】">javascript console utils：快速打印 log 日志【荐】</h4><p>安装这个插件后，当我们按住快捷键「Cmd + Shift + L」后，即可自动出现日志 <code>console.log()</code>。简直是日志党福音。</p><p>当我们选中某个变量 <code>name</code>，然后按住快捷键「Cmd + Shift + L」，即可自动出现这个变量的日志 <code>console.log(name)</code>。</p><p>其他的同类插件还有：Turbo Console Log。</p><p>不过，生产环境的代码，还是尽量少打日志比较好，避免出现一些异常。</p><p>编程有三等境界：</p><ul><li><p>第三等境界是打日志，这是最简单、便捷的方式，略显低级，一般新手或资深程序员偷懒时会用。</p></li><li><p>第二等境界是断点调试，在前端、Java、PHP、iOS 开发时非常常用，通过断点调试可以很直观地跟踪代码执行逻辑、调用栈、变量等，是非常实用的技巧。</p></li><li><p>第一等境界是测试驱动开发，在写代码之前先写测试。与第二等的断点调试刚好相反，大部分人不是很习惯这种方式，但在国外开发者或者敏捷爱好者看来，这是最高效的开发方式，在保证代码质量、重构等方面非常有帮助，是现代编程开发必不可少的一部分。</p></li></ul><h4 id="Code-Spell-Checker：单词拼写错误检查">Code Spell Checker：单词拼写错误检查</h4><p>这个拼写检查程序的目标是帮助捕获常见的单词拼写错误，可以检测驼峰命名。从此告别 Chinglish.</p><h4 id="Auto-Close-Tag、Auto-Rename-Tag">Auto Close Tag、Auto Rename Tag</h4><p>自动闭合配对的标签、自动重命名配对的标签。</p><h3 id="4、代码显示增强插件">4、代码显示增强插件</h3><h4 id="Bracket-Pair-Colorizer-2：突出显示成对的括号【荐】">Bracket Pair Colorizer 2：突出显示成对的括号【荐】</h4><p><code>Bracket Pair Colorizer 2</code>插件：以不同颜色显示成对的括号，并用连线标注括号范围。简称<strong>彩虹括号</strong>。</p><p>另外，还有个<code>Rainbow Brackets</code>插件，也可以突出显示成对的括号。</p><h4 id="highlight-icemode：选中相同的代码时，让高亮显示更加明显【荐】">highlight-icemode：选中相同的代码时，让高亮显示更加明显【荐】</h4><p>VSCode 自带的高亮显示，实在是不够显眼。用插件支持一下吧。</p><p>所用了这个插件之后，VS Code 自带的高亮就可以关掉了：</p><p>在用户设置里添加<code>"editor.selectionHighlight": false</code>即可。</p><p>参考链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/palmer_kai/article/details/79548164">vscode 选中后相同内容高亮插件推荐</a></p><h4 id="vscode-icons">vscode-icons</h4><p>vscode-icons 会根据文件的后缀名来显示不同的图标，让你更直观地知道每种文件是什么类型的。</p><h4 id="indent-rainbow：突出显示代码缩进">indent-rainbow：突出显示代码缩进</h4><p><code>indent-rainbow</code>插件：突出显示代码缩进。</p><p>安装完成后，效果如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200911.png" alt=""></p><h4 id="TODO-Highlight">TODO Highlight</h4><p>写代码过程中，突然发现一个 Bug，但是又不想停下来手中的活，以免打断思路，怎么办？按照代码规范，我们一般是在代码中加个 TODO 注释。比如：（注意，一定要写成大写<code>TODO</code>，而不是小写的<code>todo</code>）</p><pre class="line-numbers language-none"><code class="language-none">//TODO:这里有个bug，我一会儿再收拾你<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>或者：</p><pre class="line-numbers language-none"><code class="language-none">//FIXME:我也不知道为啥， but it works only that way.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>安装了插件 <code>TODO Highlight</code>之后，按住「Cmd + Shift + P」打开命令面板，输入「Todohighlist」，选择相关的命令，我们就可以看到一个 todoList 的清单。</p><h4 id="Better-Comments">Better Comments</h4><p>为注释添加更醒目、带分类的色彩。</p><h3 id="5、代码格式化插件">5、代码格式化插件</h3><h4 id="Prettier：代码格式化">Prettier：代码格式化</h4><p>Prettier 是一个代码格式化工具，<strong>只关注格式化，但不具备校验功能</strong>。在一个多人协同开发的团队中，统一的代码编写规范非常重要。一套规范可以让我们编写的代码达到一致的风格，提高代码的可读性和统一性。自然维护性也会有所提高，代码的展示也会更加美观。</p><p>步骤如下：</p><p>（1）安装插件 <code>Prettier</code>。</p><p>（2）在项目的根路径下，新建文件<code>.prettierrc</code>，并在文件中添加如下内容：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"printWidth"</span><span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span>  <span class="token property">"tabWidth"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token property">"semi"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token property">"singleQuote"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token property">"trailingComma"</span><span class="token operator">:</span> <span class="token string">"es5"</span><span class="token punctuation">,</span>  <span class="token property">"tslintIntegration"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token property">"insertSpaceBeforeFunctionParenthesis"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的内容，是我自己的配置，你可以参考。更多配置，可见官方文档：<a target="_blank" rel="noopener" href="https://prettier.io/docs/en/options.html">https://prettier.io/docs/en/options.html</a></p><p>（3）Mac用户按快捷键「Option + Shift + F」，Win 用户按快捷键「Alt + shift + F」，即可完成代码的格式化。如果你的VS Code 设置的是自动格式化代码，那么这一步可以忽略。</p><h4 id="ESLint：代码格式的校验">ESLint：代码格式的校验</h4><p>日常开发中，建议用 Prettier 做<strong>代码格式化</strong>，然后用 eslint 做<strong>格式校验</strong>。很多人把这两个插件的功能弄混了。</p><p>一般做法是：格式化建议是由程序员手动触发，格式校验由系统强制校验。通过 Prettier <strong>手动</strong>触发格式化，是为了让用户有感知；通过eslint 做<strong>强制</strong>校验之后，如果代码的格式不符合要求，系统就禁止你提交代码。</p><h4 id="Beautify">Beautify</h4><p>代码格式化工具。</p><p>备注：相比之下，Prettier 是当前最流行的代码格式化工具，比 Beautify 用得更多。</p><h4 id="Paste-JSON-as-Code">Paste JSON as Code</h4><p>此插件可以将剪贴板中的 JSON 字符串转换成工作代码。支持多种语言。</p><h4 id="JS-CSS-HTML-Formatter【荐】">JS-CSS-HTML Formatter【荐】</h4><p>保存文件时，自动格式化 HTML、CSS、JS代码。</p><h3 id="6、图片相关插件">6、图片相关插件</h3><h4 id="Polacode-2020：生成代码截图-【荐】">Polacode-2020：生成代码截图 【荐】</h4><p>可以把代码片段保存成美观的图片，主题不同，代码的配色方案也不同，也也可以自定义设置图片的边框颜色、大小、阴影。</p><p>尤其是在我们做 PPT 分享时需要用到代码片段时，或者需要在网络上优雅地分享代码片段时，这一招很有用。</p><p>生成的效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200904.png" alt=""></p><p>其他同类插件：<code>CodeSnap</code>。我们也可以通过 <a target="_blank" rel="noopener" href="https://carbon.now.sh/">https://carbon.now.sh/</a>这个网站生成代码图片</p><p>有人可能会说：直接用 QQ 截图不行吗？可以是可以，但不够美观、不够干净。</p><h4 id="Image-Preview-【荐】">Image Preview 【荐】</h4><p>图片预览。鼠标移动到图片 url 上的时候，会自动显示图片的预览和图片尺寸。</p><h3 id="7、CSS相关插件">7、CSS相关插件</h3><h4 id="CSS-Peek">CSS Peek</h4><p>增强 HTML 和 CSS 之间的关联，快速查看该元素上的 CSS 样式。</p><h4 id="Vue-CSS-Peek">Vue CSS Peek</h4><p>CSS Peek 对 Vue 没有支持，该插件提供了对 Vue 文件的支持。</p><h4 id="Color-Info">Color Info</h4><p>这个便捷的插件，将为你提供你在 CSS 中使用颜色的相关信息。你只需在颜色上悬停光标，就可以预览色块中色彩模型的（HEX、 RGB、HSL 和 CMYK）相关信息了。</p><h3 id="8、Mardown-相关插件">8、Mardown 相关插件</h3><h4 id="Markdown-Preview-Github-Styling-【荐】">Markdown Preview Github Styling 【荐】</h4><p>以 GitHub 风格预览 Markdown 样式，十分简洁优雅。就像下面这样，左侧书写 Markdown 文本，右侧预览 Markdown 的渲染效果：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201736.png" alt=""></p><h4 id="Markdown-Preview-Enhanced">Markdown Preview Enhanced</h4><p>预览 Markdown 样式。</p><h4 id="Markdown-All-in-One">Markdown All in One</h4><p>这个插件将帮助你更高效地在 Markdown 中编写文档。</p><h3 id="9、通用工具类插件">9、通用工具类插件</h3><h4 id="sftp：文件传输-【荐】">sftp：文件传输 【荐】</h4><p>如果你需要将本地文件通过 ftp 的形式上传到局域网的服务器，可以安装<code>sftp</code>这个插件，很好用。在公司会经常用到。</p><p>详细配置已经在上面讲过。</p><h4 id="Live-Server-【荐】">Live Server 【荐】</h4><p>在本地启动一个服务器，代码写完后可以实现「热更新」，实时地在网页中看到运行效果。就不需要每次都得手动刷新页面了。</p><p>使用方式：安装插件后，开始写代码；代码写完后，右键选择「Open with Live Server」。</p><h4 id="open-in-browser">open in browser</h4><p>安装<code>open in browser</code>插件后，在 HTML 文件中「右键选择 --&gt; Open in Default Browser」，即可在浏览器中预览网页。</p><h4 id="Project-Manager">Project Manager</h4><p>工作中，我们经常会来回切换多个项目，每次都要找到对应项目的目录再打开，比较麻烦。Project Manager 插件可以解决这样的烦恼，它提供了专门的视图来展示你的项目，我们可以把常用的项目保存在这里，需要时一键切换，十分方便。</p><h4 id="WakaTime-【荐】">WakaTime 【荐】</h4><p>统计在 VS Code 里写代码的时间。统计效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200858.png" alt=""></p><h4 id="Code-Time">Code Time</h4><p><code>Code Time</code>插件：记录编程时间，统计代码行数。</p><p>安装该插件后，VS Code 底部的状态栏右下角可以看到时间统计。点击那个位置之后，选择「Code Time Dashboard」，即可查看统计结果。</p><p>备注：团长试了一下这个 code time 插件，发现统计结果不是很准。</p><h4 id="File-Tree-to-Text-Generator：快速生成文件的目录树">File Tree to Text Generator：快速生成文件的目录树</h4><p>如题。</p><h4 id="Settings-Sync">Settings Sync</h4><ul><li><p>地址：<a target="_blank" rel="noopener" href="https://github.com/shanalikhan/code-settings-sync">https://github.com/shanalikhan/code-settings-sync</a></p></li><li><p>作用：多台设备之间，同步 VS Code 配置。通过登录 GitHub 账号来使用这个同步工具。</p></li></ul><p>同步的详细操作，下一段会讲。</p><p>另外，北京时间的<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/184868336">2020年8月14日</a>，微软发布 Visual Studio Code 1.48 稳定版。此版本<strong>原生</strong>支持用户同步 VS Code的配置，只需要登录微软账号或者 GitHub账号即可。</p><h4 id="vscode-syncing">vscode-syncing</h4><ul><li><p>地址：<a target="_blank" rel="noopener" href="https://github.com/nonoroazoro/vscode-syncing">https://github.com/nonoroazoro/vscode-syncing</a></p></li><li><p>作用：多台设备之间，同步 VS Code 配置。</p></li></ul><h4 id="minapp：小程序支持">minapp：小程序支持</h4><p>小程序开发必备插件。</p><h4 id="Search-node-modules">Search node_modules</h4><p><code>node_modules</code>模块里面的文件夹和模块实在是太多了，根本不好找。好在安装 <code>Search node_modules</code> 这个插件后，输入快捷键「Cmd + Shift + P」，然后输入 <code>node_modules</code>，在弹出的选项中选择 <code>Search node_modules</code>，即可搜索 node_modules 里的模块。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200857.jpeg" alt=""></p><h4 id="RemoteHub">RemoteHub</h4><p>不要惊讶，RemoteHub 和 GitLens 是同一个作者开发出来的。</p><p><code>RemoteHub</code>插件的作用是：可以在本地查看 GitHub 网站上的代码，而不需要将代码下载到本地。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200857.png" alt=""></p><p>这个插件目前使用的人还不多，赶紧安装起来尝尝鲜吧。</p><h4 id="Live-Share：实时编码分享">Live Share：实时编码分享</h4><p><code>Live Share</code>这个神奇的插件是由微软官方出品，它的作用是：<strong>实时编码分享</strong>。也就是说，它可以实现你和你的同伴一起写代码。这绝对就是<strong>结对编程</strong>的神器啊。</p><p>安装方式：</p><p>打开插件管理，搜索“live share”，安装。安装后重启 VS Code，在左侧会多出一个按钮：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201743.png" alt=""></p><p>上图中，点击红框部分，登录后就可以分享你的工作空间了。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200850.png" alt=""></p><h4 id="Import-Cost">Import Cost</h4><p>在项目开发过程中，我们会引入很多 npm 包，有时候可能只用到了某个包里的一个方法，却引入了整个包，导致代码体积增大很多。<code>Import Cost</code>插件可以在代码中友好的提示我们，当前引入的包会增加多少体积，这很有助于帮我们优化代码的体积。</p><h3 id="10、主题插件">10、主题插件</h3><p>给你的 VS Code 换个皮肤吧，免费的那种。</p><ul><li><p>Dracula Theme</p></li><li><p>Material Theme</p></li><li><p>Nebula Theme</p></li><li><p><a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=zhuangtongfa.Material-theme">One Dark Pro</a></p></li><li><p>One Monokai Theme</p></li><li><p>Monokai Pro</p></li><li><p>Ayu</p></li><li><p><a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=akarlsten.vscode-snazzy-akarlsten">Snazzy Plus</a></p></li><li><p><a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=alexanderte.dainty-vscode">Dainty</a></p></li><li><p><code>SynthWave '84</code></p></li><li><p>GitHub Plus Theme：白色主题</p></li><li><p>Horizon Theme：红色主题</p></li></ul><h2 id="七、无缝切换：VS-Code-配置云同步">七、无缝切换：VS Code 配置云同步</h2><p>我们可以将配置云同步，这样的话，当我们换个电脑时，即可将配置一键同步到本地，就不需要重新安装插件了，也不需要重新配置软件。</p><p>下面讲的两个同步方法，都可以，看你自己需要。方法1是 VS Code自带的同步功能，操作简单。方法2 需要安装插件，支持更多的自定义配置。</p><h3 id="方法1：使用-VS-Code-自带的同步功能">方法1：使用 VS Code 自带的同步功能</h3><p>1、<strong>配置同步</strong>：</p><p>（1）在菜单栏选择「 Code --&gt; 首选项 --&gt; 打开设置同步」：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201750.png" alt=""></p><p>（2）选择需要同步的配置：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200843.png" alt=""></p><p>（3）通过Microsoft或者GitHub账号登录。 上图中，点击“登录并打开”，然后弹出如下界面：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201757.png" alt=""></p><p>上图中，使用  微软账号或者 GitHub账号登录：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312201803.png" alt=""></p><p>（4）同步完成后，菜单栏会显示“首先项同步已打开”，最左侧也会多出一个同步图标，如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312202032.png" alt=""></p><p>2、<strong>管理同步</strong>：</p><p>（1）点击菜单栏「Code --&gt; 首选项 --&gt; 设置同步已打开」，会弹出如下界面，进行相应的同步管理即可：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200836.png" alt=""></p><p>（2）换另外一个电脑时，登录相同的账号，即可完成同步。</p><p>参考链接：</p><ul><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/baidu_33340703/article/details/106967884">VS Code原生的配置同步功能——Settings Sync</a></li></ul><h3 id="方法2：使用插件-settings-sync">方法2：使用插件 <code>settings-sync</code></h3><p>使用方法2，我们还可以把配置分享其他用户，也可以把其他用户的配置给自己用。</p><p>1、<strong>配置同步</strong>：（将自己本地的配置云同步到 GitHub）</p><p>（1）安装插件 <code>settings-sync</code>。</p><p>（2）安装完插件后，在插件里使用 GitHub 账号登录。</p><p>（3）登录后在 vscode 的界面中，可以选择一个别人的 gist；也可以忽略掉，然后创建一个属于自己的 gist。</p><p>（4）使用快捷键 「Command + Shift + P」，在弹出的命令框中输入 sync，并选择「更新/上传配置」，这样就可以把最新的配置上传到 GitHub。</p><p>2、<strong>管理同步</strong>：（换另外一个电脑时，从云端同步配置到本地）</p><p>（1）当我们换另外一台电脑时，可以先在 VS Code 中安装 <code>settings-sync</code> 插件。</p><p>（2）安装完插件后，在插件里使用 GitHub 账号登录。</p><p>（3）登录之后，插件的界面上，会自动出现之前的同步记录：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200829.png" alt=""></p><p>上图中，我们点击最新的那条记录，就可将云端的最新配置同步到本地：</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2022/03/1220220312200825.png" alt=""></p><p>如果你远程的配置没有成功同步到本地，那可能是网络的问题，此时，可以使用快捷键 「Command + Shift + P」，在弹出的命令框中输入 sync，并选择「下载配置」，多试几次。</p><p><strong>使用其他人的配置</strong>：</p><p>如果我们想使用别人的配置，首先需要对方提供给你 gist。具体步骤如下：</p><p>（1）安装插件 <code>settings-sync</code>。</p><p>（2）使用快捷键 「Command + Shift + P」，在弹出的命令框中输入 sync，并选择「下载配置」</p><p>（3）在弹出的界面中，选择「Download Public Gist」，然后输入别人分享给你的 gist。注意，这一步不需要登录 GitHub 账号。</p><h2 id="最后一段">最后一段</h2><p>如果你还有什么推荐的 VS Code 插件，欢迎留言。</p><p>大家完全不用担心这篇文章会过时，随着 VS Code 的版本更新和插件更新，本文也会随之更新。关于 VS Code 内容的后续更新，你可以关注我在 GitHub 上的前端入门项目，项目地址是：</p><blockquote><p>https://github.com/qianguyihao/Web</p></blockquote><p>一个超级详细和真诚的前端入门项目。</p><h2 id="todo">todo</h2><ul><li><a target="_blank" rel="noopener" href="https://github.com/qianguyihao/Web/issues/84">issues 84</a></li></ul><h2 id="参考链接">参考链接</h2><h3 id="2021年">2021年</h3><ul><li>中文版 Awesome VS Code：https://github.com/formulahendry/awesome-vscode-cn</li></ul><h3 id="2020年">2020年</h3><ul><li><a target="_blank" rel="noopener" href="https://juejin.im/post/5ea40c6751882573b219777d">VSCode 插件大全｜ VSCode 高级玩家之第二篇</a></li><li><a target="_blank" rel="noopener" href="http://www.supuwoerc.xyz/tools/vscode/plugins.html">http://www.supuwoerc.xyz/tools/vscode/plugins.html</a></li><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/99462672">如何让 VS Code 更好用 10 倍？这里有一份 VS Code 新手指南</a></li><li><a target="_blank" rel="noopener" href="https://lyreal666.com/%E9%82%A3%E4%BA%9B%E4%BD%A0%E5%BA%94%E8%AF%A5%E8%80%83%E8%99%91%E5%8D%B8%E8%BD%BD%E7%9A%84-VSCode-%E6%89%A9%E5%B1%95/#more">那些你应该考虑卸载的 VSCode 扩展</a></li><li><a target="_blank" rel="noopener" href="https://juejin.im/post/5d74eb5c51882525017787d9">VS Code 折腾记 - (16) 推荐一波实用的插件集</a></li><li><a target="_blank" rel="noopener" href="https://juejin.im/post/5db66672f265da4d0e009aad">VSCode 前端必备插件，有可能你装了却不知道如何使用？</a></li><li><a target="_blank" rel="noopener" href="https://juejin.im/post/5a08d1d6f265da430f31950e">能让你开发效率翻倍的 VSCode 插件配置（上）</a></li><li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000012811886">https://segmentfault.com/a/1190000012811886</a></li><li><a target="_blank" rel="noopener" href="https://idoubi.cc/2019/07/08/vscode-sublime-theme/">「Vscode」打造类 sublime 的高颜值编辑器</a></li><li><a target="_blank" rel="noopener" href="https://lsqy.tech/2020/03/14/20200314Mac-Vscode%E5%BF%AB%E6%8D%B7%E9%94%AE/">Mac Vscode 快捷键</a></li><li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?src=11&amp;timestamp=1591581536&amp;ver=2387&amp;signature=i4xLZlLe1Gkl7OiBIhPO*VSeNB5lzFgTY-dgNW9E9ZbtIAv4bnJ1RdAAZdhvDw*cg-DmMcUa-V8NSUdV-tthmXZCq3ht4edCweq6v0QxKjnh8IuAxyyh5qymdRui*8iE&amp;new=1">使用 VSCode 的一些技巧</a></li><li>转载来源，[GitHub](https://github.com/qianguyihao/Web/blob/master/00-前端工具/01-VS Code的使用.md) 推荐关注star！</li></ul><hr><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="tools" scheme="https://blog.17lai.site/categories/tools/"/>
    
    
    <category term="vscode" scheme="https://blog.17lai.site/tags/vscode/"/>
    
    <category term="插件" scheme="https://blog.17lai.site/tags/%E6%8F%92%E4%BB%B6/"/>
    
    <category term="编码" scheme="https://blog.17lai.site/tags/%E7%BC%96%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>如何使用Traefik V2 在Ubuntu20.04 上面来做 Dockers Containers 的反向代理</title>
    <link href="https://blog.17lai.site/posts/465d2738/"/>
    <id>https://blog.17lai.site/posts/465d2738/</id>
    <published>2021-10-14T11:25:00.000Z</published>
    <updated>2022-03-16T12:29:06.969Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>How To Use Traefik v2 as a Reverse Proxy for Docker Containers on Ubuntu 20.04</p><blockquote><p>Traefik 适合配合Dockers swarm 做服务， Dockers portainer 做管理，ELK集群做监控日志。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1420211014200800.png" alt="Traefik"></p><p><code>traefik</code> 与 <code>nginx</code> 一样，是一款优秀的反向代理工具，或者叫 <code>Edge Router</code>。至于使用它的原因则基于以下几点</p><ul><li>无须重启即可更新配置</li><li>自动的服务发现与负载均衡</li><li>与 <code>docker</code> 完美集成，基于 <code>container label</code> 的配置</li><li>漂亮的 <code>dashboard</code> 界面</li><li><code>metrics</code> 的支持，支持对 <code>prometheus</code> 和 <code>k8s</code> 集成</li></ul><h3 id="Introduction">Introduction</h3><p><a target="_blank" rel="noopener" href="https://www.docker.com/">Docker</a> can be an efficient way to run web applications in production, but you may want to run multiple applications on the same Docker host. In this situation, you’ll need to set up a reverse proxy. This is because you only want to expose ports <code>80</code> and <code>443</code> to the rest of the world.</p><p><a target="_blank" rel="noopener" href="https://traefik.io/">Traefik</a> is a Docker-aware reverse proxy that includes a monitoring dashboard. Traefik v1 has been widely used for a while, and <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-use-traefik-as-a-reverse-proxy-for-docker-containers-on-ubuntu-20-04">you can follow this earlier tutorial to install Traefik v1</a>). But in this tutorial, you’ll install and configure Traefik v2, which includes quite a few differences.</p><p>The biggest difference between Traefik v1 and v2 is that <em>frontends</em> and <em>backends</em> were removed and their combined functionality spread out across <em>routers</em>, <em>middlewares</em>, and <em>services</em>. Previously a backend did the job of making modifications to requests and getting that request to whatever was supposed to handle it. Traefik v2 provides more separation of concerns by introducing middlewares that can modify requests before sending them to a service. Middlewares make it easier to specify a single modification step that might be used by a lot of different routes so that they can be reused (such as HTTP Basic Auth, which you’ll see later). A router can also use many different middlewares.</p><p>In this tutorial you’ll configure Traefik v2 to route requests to two different web application containers: a <a target="_blank" rel="noopener" href="http://wordpress.org/">Wordpress</a> container and an <a target="_blank" rel="noopener" href="https://www.adminer.org/">Adminer</a> container, each talking to a <a target="_blank" rel="noopener" href="https://www.mysql.com/">MySQL</a> database. You’ll configure Traefik to serve everything over HTTPS using <a target="_blank" rel="noopener" href="https://letsencrypt.org/">Let’s Encrypt</a>.</p><h2 id="Prerequisites">Prerequisites</h2><p>To complete this tutorial, you will need the following:</p><ul><li><a target="_blank" rel="noopener" href="https://www.digitalocean.com/products/linux-distribution/ubuntu/">One Ubuntu 20.04 server</a> with a sudo non-root user and a firewall. You can set this up by following our <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-20-04">Ubuntu 20.04 initial server setup guide</a>.</li><li>Docker installed on your server, which you can accomplish by following <strong>Steps 1 and 2</strong> of <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-20-04">How to Install and Use Docker on Ubuntu 20.04</a>.</li><li>Docker Compose installed using the instructions from <strong>Step 1</strong> of <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-compose-on-ubuntu-20-04">How to Install Docker Compose on Ubuntu 20.04</a>.</li><li>A domain and three A records, <code>db-admin.your_domain</code>, <code>blog.your_domain</code> and <code>monitor.your_domain</code>. Each should point to the IP address of your server. You can learn how to point domains to DigitalOcean Droplets by reading through <a target="_blank" rel="noopener" href="https://www.digitalocean.com/docs/networking/dns/">DigitalOcean’s Domains and DNS documentation</a>. Throughout this tutorial, substitute your domain for <code>your_domain</code> in the configuration files and examples.</li></ul><h2 id="Step-1-—-Configuring-and-Running-Traefik">Step 1 — Configuring and Running Traefik</h2><p>The Traefik project has an <a target="_blank" rel="noopener" href="https://hub.docker.com/_/traefik">official Docker image</a>, so you will use that to run Traefik in a Docker container.</p><p>But before you get your Traefik container up and running, you need to create a configuration file and set up an encrypted password so you can access the monitoring dashboard.</p><p>You’ll use the <code>htpasswd</code> utility to create this encrypted password. First, install the utility, which is included in the <code>apache2-utils</code> package:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> apache2-utils<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Then generate the password with <code>htpasswd</code>. Substitute <code>secure_password</code> with the password you’d like to use for the Traefik admin user:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">htpasswd -nb admin secure_password<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>The output from the program will look like this:</p><pre class="line-numbers language-none"><code class="language-none">Outputadmin:$apr1$ruca84Hq$mbjdMZBAG.KWn7vfN/SNK/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>You’ll use this output in the Traefik configuration file to set up HTTP Basic Authentication for the Traefik health check and monitoring dashboard. Copy the entire output line so you can paste it later.</p><p>To configure the Traefik server, you’ll create two new configuration files called <code>traefik.toml</code> and <code>traefik_dynamic.toml</code> using the TOML format. <a target="_blank" rel="noopener" href="https://github.com/toml-lang/toml">TOML</a> is a configuration language similar to INI files, but standardized. <a target="_blank" rel="noopener" href="https://docs.traefik.io/providers/overview/">These files let us configure the Traefik server and various integrations</a>, or <code>providers</code>, that you want to use. In this tutorial, you will use three of Traefik’s available providers: <code>api</code>, <code>docker</code>, and <code>acme</code>. The last of these, <code>acme</code>, supports TLS certificates using Let’s Encrypt.</p><p>Create and open <code>traefik.toml</code> using <code>nano</code> or your preferred text editor:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">nano</span> traefik.toml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>First, you want to specify the ports that Traefik should listen on using the <code>entryPoints</code> section of your config file. You want two because you want to listen on port <code>80</code> and <code>443</code>. Let’s call these <code>web</code> (port <code>80</code>) and <code>websecure</code> (port <code>443</code>).</p><p>Add the following configurations:</p><p>traefik.toml</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">entryPoints</span><span class="token punctuation">]</span>  <span class="token punctuation">[</span><span class="token table class-name">entryPoints.web</span><span class="token punctuation">]</span>    <span class="token key property">address</span> <span class="token punctuation">=</span> <span class="token string">":80"</span>    <span class="token punctuation">[</span><span class="token table class-name">entryPoints.web.http.redirections.entryPoint</span><span class="token punctuation">]</span>      <span class="token key property">to</span> <span class="token punctuation">=</span> <span class="token string">"websecure"</span>      <span class="token key property">scheme</span> <span class="token punctuation">=</span> <span class="token string">"https"</span>  <span class="token punctuation">[</span><span class="token table class-name">entryPoints.websecure</span><span class="token punctuation">]</span>    <span class="token key property">address</span> <span class="token punctuation">=</span> <span class="token string">":443"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Note that you are also automatically redirecting traffic to be handled over TLS.</p><p>Next, configure the Traefik <code>api</code>, which gives you access to both the API and your dashboard interface. The heading of <code>[api]</code> is all that you need because the dashboard is then enabled by default, but you’ll be explicit for the time being.</p><p>Add the following code:</p><p>traefik.toml</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token table class-name">api</span><span class="token punctuation">]</span>  <span class="token key property">dashboard</span> <span class="token punctuation">=</span> <span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>To finish securing your web requests you want to use Let’s Encrypt to generate valid TLS certificates. Traefik v2 supports Let’s Encrypt out of the box and you can configure it by creating a <em>certificates resolver</em> of the type <code>acme</code>.</p><p>Let’s configure your certificates resolver now using the name <code>lets-encrypt</code>:</p><p>traefik.toml</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token table class-name">certificatesResolvers.lets-encrypt.acme</span><span class="token punctuation">]</span>  <span class="token key property">email</span> <span class="token punctuation">=</span> <span class="token string">"your_email@your_domain"</span>  <span class="token key property">storage</span> <span class="token punctuation">=</span> <span class="token string">"acme.json"</span>  <span class="token punctuation">[</span><span class="token table class-name">certificatesResolvers.lets-encrypt.acme.tlsChallenge</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This section is called <code>acme</code> because <a target="_blank" rel="noopener" href="https://github.com/ietf-wg-acme/acme/">ACME</a> is the name of the protocol used to communicate with Let’s Encrypt to manage certificates. The Let’s Encrypt service requires registration with a valid email address, so to have Traefik generate certificates for your hosts, set the <code>email</code> key to your email address. You then specify that you will store the information that you will receive from Let’s Encrypt in a JSON file called <code>acme.json</code>.</p><p>The <code>acme.tlsChallenge</code> section allows us to specify how Let’s Encrypt can verify that the certificate. You’re configuring it to serve a file as part of the challenge over port <code>443</code>.</p><p>Finally, you need to configure Traefik to work with Docker.</p><p>Add the following configurations:</p><p>traefik.toml</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token table class-name">providers.docker</span><span class="token punctuation">]</span>  <span class="token key property">watch</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>  <span class="token key property">network</span> <span class="token punctuation">=</span> <span class="token string">"web"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>The <code>docker</code> provider enables Traefik to act as a proxy in front of Docker containers. You’ve configured the provider to <code>watch</code> for new containers on the <code>web</code> network, which you’ll create soon.</p><p>Our final configuration uses the <code>file</code> provider. With Traefik v2, static and dynamic configurations can’t be mixed and matched. To get around this, you will use <code>traefik.toml</code> to define your static configurations and then keep your dynamic configurations in another file, which you will call <code>traefik_dynamic.toml</code>. Here you are using the <code>file</code> provider to tell Traefik that it should read in dynamic configurations from a different file.</p><p>Add the following <code>file</code> provider:</p><p>traefik.toml</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>providers.file<span class="token punctuation">]</span>  filename <span class="token operator">=</span> <span class="token string">"traefik_dynamic.toml"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Your completed <code>traefik.toml</code> will look like this:</p><p>traefik.toml</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">entryPoints</span><span class="token punctuation">]</span>  <span class="token punctuation">[</span><span class="token table class-name">entryPoints.web</span><span class="token punctuation">]</span>    <span class="token key property">address</span> <span class="token punctuation">=</span> <span class="token string">":80"</span>    <span class="token punctuation">[</span><span class="token table class-name">entryPoints.web.http.redirections.entryPoint</span><span class="token punctuation">]</span>      <span class="token key property">to</span> <span class="token punctuation">=</span> <span class="token string">"websecure"</span>      <span class="token key property">scheme</span> <span class="token punctuation">=</span> <span class="token string">"https"</span>  <span class="token punctuation">[</span><span class="token table class-name">entryPoints.websecure</span><span class="token punctuation">]</span>    <span class="token key property">address</span> <span class="token punctuation">=</span> <span class="token string">":443"</span><span class="token punctuation">[</span><span class="token table class-name">api</span><span class="token punctuation">]</span>  <span class="token key property">dashboard</span> <span class="token punctuation">=</span> <span class="token boolean">true</span><span class="token punctuation">[</span><span class="token table class-name">certificatesResolvers.lets-encrypt.acme</span><span class="token punctuation">]</span>  <span class="token key property">email</span> <span class="token punctuation">=</span> <span class="token string">"your_email@your_domain"</span>  <span class="token key property">storage</span> <span class="token punctuation">=</span> <span class="token string">"acme.json"</span>  <span class="token punctuation">[</span><span class="token table class-name">certificatesResolvers.lets-encrypt.acme.tlsChallenge</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token table class-name">providers.docker</span><span class="token punctuation">]</span>  <span class="token key property">watch</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>  <span class="token key property">network</span> <span class="token punctuation">=</span> <span class="token string">"web"</span><span class="token punctuation">[</span><span class="token table class-name">providers.file</span><span class="token punctuation">]</span>  <span class="token key property">filename</span> <span class="token punctuation">=</span> <span class="token string">"traefik_dynamic.toml"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Save and close the file.</p><p>Now let’s create <code>traefik_dynamic.toml</code>.</p><p>The dynamic configuration values that you need to keep in their own file are the <em>middlewares</em> and the <em>routers</em>. To put your dashboard behind a password you need to customize the API’s <em>router</em> and configure a <em>middleware</em> to handle HTTP basic authentication. Let’s start by setting up the middleware.</p><p>The middleware is configured on a per-protocol basis and since you’re working with HTTP you’ll specify it as a section chained off of <code>http.middlewares</code>. Next comes the name of your middleware so that you can reference it later, followed by the type of middleware that it is, which will be <code>basicAuth</code> in this case. Let’s call your middleware <code>simpleAuth</code>.</p><p>Create and open a new file called <code>traefik_dynamic.toml</code>:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">nano</span> traefik_dynamic.toml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Add the following code. This is where you’ll paste the output from the <code>htpasswd</code> command:</p><p>traefik_dynamic.toml</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">http.middlewares.simpleAuth.basicAuth</span><span class="token punctuation">]</span>  <span class="token key property">users</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>    <span class="token string">"admin:$apr1$ruca84Hq$mbjdMZBAG.KWn7vfN/SNK/"</span>  <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>To configure the router for the api you’ll once again be chaining off of the protocol name, but instead of using <code>http.middlewares</code>, you’ll use <code>http.routers</code> followed by the name of the router. In this case, the <code>api</code> provides its own named router that you can configure by using the <code>[http.routers.api]</code> section. You’ll configure the domain that you plan on using with your dashboard also by setting the <code>rule</code> key using a host match, the entrypoint to use <code>websecure</code>, and the middlewares to include <code>simpleAuth</code>.</p><p>Add the following configurations:</p><p>traefik_dynamic.toml</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token table class-name">http.routers.api</span><span class="token punctuation">]</span>  <span class="token key property">rule</span> <span class="token punctuation">=</span> <span class="token string">"Host(`monitor.your_domain`)"</span>  <span class="token key property">entrypoints</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"websecure"</span><span class="token punctuation">]</span>  <span class="token key property">middlewares</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"simpleAuth"</span><span class="token punctuation">]</span>  <span class="token key property">service</span> <span class="token punctuation">=</span> <span class="token string">"api@internal"</span>  <span class="token punctuation">[</span><span class="token table class-name">http.routers.api.tls</span><span class="token punctuation">]</span>    <span class="token key property">certResolver</span> <span class="token punctuation">=</span> <span class="token string">"lets-encrypt"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The <code>web</code> entry point handles port <code>80</code>, while the <code>websecure</code> entry point uses port <code>443</code> for TLS/SSL. You automatically redirect all of the traffic on port <code>80</code> to the <code>websecure</code> entry point to force secure connections for all requests.</p><p>Notice the last three lines here configure a <em>service</em>, enable tls, and configure <code>certResolver</code> to <code>"lets-encrypt"</code>. Services are the final step to determining where a request is finally handled. The <code>api@internal</code> service is a built-in service that sits behind the API that you expose. Just like routers and middlewares, services can be configured in this file, but you won’t need to do that to achieve your desired result.</p><p>Your completed <code>traefik_dynamic.toml</code> file will look like this:</p><p>traefik_dynamic.toml</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">http.middlewares.simpleAuth.basicAuth</span><span class="token punctuation">]</span>  <span class="token key property">users</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>    <span class="token string">"admin:$apr1$ruca84Hq$mbjdMZBAG.KWn7vfN/SNK/"</span>  <span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token table class-name">http.routers.api</span><span class="token punctuation">]</span>  <span class="token key property">rule</span> <span class="token punctuation">=</span> <span class="token string">"Host(`monitor.your_domain`)"</span>  <span class="token key property">entrypoints</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"websecure"</span><span class="token punctuation">]</span>  <span class="token key property">middlewares</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"simpleAuth"</span><span class="token punctuation">]</span>  <span class="token key property">service</span> <span class="token punctuation">=</span> <span class="token string">"api@internal"</span>  <span class="token punctuation">[</span><span class="token table class-name">http.routers.api.tls</span><span class="token punctuation">]</span>    <span class="token key property">certResolver</span> <span class="token punctuation">=</span> <span class="token string">"lets-encrypt"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Save the file and exit the editor.</p><p>With these configurations in place, you will now start Traefik.</p><h2 id="Step-2-–-Running-the-Traefik-Container">Step 2 – Running the Traefik Container</h2><p>In this step you will create a Docker network for the proxy to share with containers. You will then access the Traefik dashboard. The Docker network is necessary so that you can use it with applications that are run using Docker Compose.</p><p>Create a new Docker network called <code>web</code>:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> network create web<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>When the Traefik container starts, you will add it to this network. Then you can add additional containers to this network later for Traefik to proxy to.</p><p>Next, create an empty file that will hold your Let’s Encrypt information. You’ll share this into the container so Traefik can use it:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">touch</span> acme.json<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Traefik will only be able to use this file if the root user inside of the container has unique read and write access to it. To do this, lock down the permissions on <code>acme.json</code> so that only the owner of the file has read and write permission.</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> <span class="token number">600</span> acme.json<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Once the file gets passed to Docker, the owner will automatically change to the <strong>root</strong> user inside the container.</p><p>Finally, create the Traefik container with this command:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run -d <span class="token punctuation">\</span>  -v /var/run/docker.sock:/var/run/docker.sock <span class="token punctuation">\</span>  -v <span class="token environment constant">$PWD</span>/traefik.toml:/traefik.toml <span class="token punctuation">\</span>  -v <span class="token environment constant">$PWD</span>/traefik_dynamic.toml:/traefik_dynamic.toml <span class="token punctuation">\</span>  -v <span class="token environment constant">$PWD</span>/acme.json:/acme.json <span class="token punctuation">\</span>  -p <span class="token number">80</span>:80 <span class="token punctuation">\</span>  -p <span class="token number">443</span>:443 <span class="token punctuation">\</span>  --network web <span class="token punctuation">\</span>  --name traefik <span class="token punctuation">\</span>  traefik:v2.2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This command is a little long. Let’s break it down.</p><p>You use the <code>-d</code> flag to run the container in the background as a daemon. You then share your <code>docker.sock</code> file into the container so that the Traefik process can listen for changes to containers. You also share the <code>traefik.toml</code> and <code>traefik_dynamic.toml</code> configuration files into the container, as well as <code>acme.json</code>.</p><p>Next, you map ports <code>:80</code> and <code>:443</code> of your Docker host to the same ports in the Traefik container so Traefik receives all HTTP and HTTPS traffic to the server.</p><p>You set the network of the container to <code>web</code>, and you name the container <code>traefik</code>.</p><p>Finally, you use the <code>traefik:v2.2</code> image for this container so that you can guarantee that you’re not running a completely different version than this tutorial is written for.</p><p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#entrypoint">A Docker image’s <code>ENTRYPOINT</code> is a command that always runs when a container is created from the image</a>. In this case, the command is the <code>traefik</code> binary within the container. You can pass additional arguments to that command when you launch the container, but you’ve configured all of your settings in the <code>traefik.toml</code> file.</p><p>With the container started, you now have a dashboard you can access to see the health of your containers. You can also use this dashboard to visualize the routers, services, and middlewares that Traefik has registered. You can try to access the monitoring dashboard by pointing your browser to <code>https://monitor.your_domain/dashboard/</code> (the trailing <code>/</code> is required).</p><p>You will be prompted for your username and password, which are <strong>admin</strong> and the password you configured in Step 1.</p><p>Once logged in, you’ll see the Traefik interface:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1420211014200207.png" alt="Empty Traefik dashboard"></p><p>You will notice that there are already some routers and services registered, but those are the ones that come with Traefik and the router configuration that you wrote for the API.</p><p>You now have your Traefik proxy running, and you’ve configured it to work with Docker and monitor other containers. In the next step you will start some containers for Traefik to proxy.</p><h2 id="Step-3-—-Registering-Containers-with-Traefik">Step 3 — Registering Containers with Traefik</h2><p>With the Traefik container running, you’re ready to run applications behind it. Let’s launch the following containers behind Traefik:</p><ol><li>A blog using the <a target="_blank" rel="noopener" href="https://hub.docker.com/_/wordpress/">official WordPress image</a>.</li><li>A database management server using the <a target="_blank" rel="noopener" href="https://hub.docker.com/_/adminer/">official Adminer image</a>.</li></ol><p>You’ll manage both of these applications with Docker Compose using a <code>docker-compose.yml</code> file.</p><p>Create and open the <code>docker-compose.yml</code> file in your editor:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">nano</span> docker-compose.yml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Add the following lines to the file to specify the version and the networks you’ll use:</p><p>docker-compose.yml</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span><span class="token key atrule">networks</span><span class="token punctuation">:</span>  <span class="token key atrule">web</span><span class="token punctuation">:</span>    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">internal</span><span class="token punctuation">:</span>    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>You use Docker Compose version <code>3</code> because it’s the newest major version of the Compose file format.</p><p>For Traefik to recognize your applications, they must be part of the same network, and since you created the network manually, you pull it in by specifying the network name of <code>web</code> and setting <code>external</code> to <code>true</code>. Then you define another network so that you can connect your exposed containers to a database container that you won’t expose through Traefik. You’ll call this network <code>internal</code>.</p><p>Next, you’ll define each of your <code>services</code>, one at a time. Let’s start with the <code>blog</code> container, which you’ll base on the official WordPress image. Add this configuration to the bottom of the file:</p><p>docker-compose.yml</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">...</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">blog</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> wordpress<span class="token punctuation">:</span>4.9.8<span class="token punctuation">-</span>apache    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">WORDPRESS_DB_PASSWORD</span><span class="token punctuation">:</span>    <span class="token key atrule">labels</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> traefik.http.routers.blog.rule=Host(`blog.your_domain`)      <span class="token punctuation">-</span> traefik.http.routers.blog.tls=true      <span class="token punctuation">-</span> traefik.http.routers.blog.tls.certresolver=lets<span class="token punctuation">-</span>encrypt      <span class="token punctuation">-</span> traefik.port=80    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> internal      <span class="token punctuation">-</span> web    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The <code>environment</code> key lets you specify environment variables that will be set inside of the container. By not setting a value for <code>WORDPRESS_DB_PASSWORD</code>, you’re telling Docker Compose to get the value from your shell and pass it through when you create the container. You will define this environment variable in your shell before starting the containers. This way you don’t hard-code passwords into the configuration file.</p><p>The <code>labels</code> section is where you specify configuration values for Traefik. Docker labels don’t do anything by themselves, but Traefik reads these so it knows how to treat containers. Here’s what each of these labels does:</p><ul><li><code>traefik.http.routers.adminer.rule=Host(`````blog.your_domain`````)</code> creates a new <em>router</em> for your container and then specifies the routing rule used to determine if a request matches this container.</li><li><code>traefik.routers.custom_name.tls=true</code> specifies that this router should use TLS.</li><li><code>traefik.routers.custom_name.tls.certResolver=lets-encrypt</code> specifies that the certificates resolver that you created earlier called <code>lets-encrypt</code> should be used to get a certificate for this route.</li><li><code>traefik.port</code> specifies the exposed port that Traefik should use to route traffic to this container.</li></ul><p>With this configuration, all traffic sent to your Docker host on port <code>80</code> or <code>443</code> with the domain of <code>blog.your_domain</code> will be routed to the <code>blog</code> container.</p><p>You assign this container to two different networks so that Traefik can find it via the <code>web</code> network and it can communicate with the database container through the <code>internal</code> network.</p><p>Lastly, the <code>depends_on</code> key tells Docker Compose that this container needs to start <em>after</em> its dependencies are running. Since WordPress needs a database to run, you must run your <code>mysql</code> container before starting your <code>blog</code> container.</p><p>Next, configure the MySQL service:</p><p>docker-compose.yml</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">services</span><span class="token punctuation">:</span><span class="token punctuation">...</span>  <span class="token key atrule">mysql</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span>    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> internal    <span class="token key atrule">labels</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> traefik.enable=false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>You’re using the official MySQL 5.7 image for this container. You’ll notice that you’re once again using an <code>environment</code> item without a value. The <code>MYSQL_ROOT_PASSWORD</code> and <code>WORDPRESS_DB_PASSWORD</code> variables will need to be set to the same value to make sure that your WordPress container can communicate with the MySQL. You don’t want to expose the <code>mysql</code> container to Traefik or the outside world, so you’re only assigning this container to the <code>internal</code> network. Since Traefik has access to the Docker socket, the process will still expose a router for the <code>mysql</code> container by default, so you’ll add the label <code>traefik.enable=false</code> to specify that Traefik should not expose this container.</p><p>Finally, define the Adminer container:</p><p>docker-compose.yml</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">services</span><span class="token punctuation">:</span><span class="token punctuation">...</span>  <span class="token key atrule">adminer</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> adminer<span class="token punctuation">:</span>4.6.3<span class="token punctuation">-</span>standalone    <span class="token key atrule">labels</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> traefik.http.routers.adminer.rule=Host(`db<span class="token punctuation">-</span>admin.your_domain`)      <span class="token punctuation">-</span> traefik.http.routers.adminer.tls=true      <span class="token punctuation">-</span> traefik.http.routers.adminer.tls.certresolver=lets<span class="token punctuation">-</span>encrypt      <span class="token punctuation">-</span> traefik.port=8080    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> internal      <span class="token punctuation">-</span> web    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This container is based on the official Adminer image. The <code>network</code> and <code>depends_on</code> configuration for this container exactly match what you’re using for the <code>blog</code> container.</p><p>The line <code>traefik.http.routers.adminer.rule=Host(`````db-admin.your_domain`````)</code> tells Traefik to examine the host requested. If it matches the pattern of <code>db-admin.your_domain</code>, Traefik will route the traffic to the <code>adminer</code> container over port <code>8080</code>.</p><p>Your completed <code>docker-compose.yml</code> file will look like this:</p><p>docker-compose.yml</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span><span class="token key atrule">networks</span><span class="token punctuation">:</span>  <span class="token key atrule">web</span><span class="token punctuation">:</span>    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">internal</span><span class="token punctuation">:</span>    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">blog</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> wordpress<span class="token punctuation">:</span>4.9.8<span class="token punctuation">-</span>apache    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">WORDPRESS_DB_PASSWORD</span><span class="token punctuation">:</span>    <span class="token key atrule">labels</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> traefik.http.routers.blog.rule=Host(`blog.your_domain`)      <span class="token punctuation">-</span> traefik.http.routers.blog.tls=true      <span class="token punctuation">-</span> traefik.http.routers.blog.tls.certresolver=lets<span class="token punctuation">-</span>encrypt      <span class="token punctuation">-</span> traefik.port=80    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> internal      <span class="token punctuation">-</span> web    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> mysql  <span class="token key atrule">mysql</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span>    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> internal    <span class="token key atrule">labels</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> traefik.enable=false  <span class="token key atrule">adminer</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> adminer<span class="token punctuation">:</span>4.6.3<span class="token punctuation">-</span>standalone    <span class="token key atrule">labels</span><span class="token punctuation">:</span>    <span class="token key atrule">labels</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> traefik.http.routers.adminer.rule=Host(`db<span class="token punctuation">-</span>admin.your_domain`)      <span class="token punctuation">-</span> traefik.http.routers.adminer.tls=true      <span class="token punctuation">-</span> traefik.http.routers.adminer.tls.certresolver=lets<span class="token punctuation">-</span>encrypt      <span class="token punctuation">-</span> traefik.port=8080    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> internal      <span class="token punctuation">-</span> web    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Save the file and exit the text editor.</p><p>Next, set values in your shell for the <code>WORDPRESS_DB_PASSWORD</code> and <code>MYSQL_ROOT_PASSWORD</code> variables:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">WORDPRESS_DB_PASSWORD</span><span class="token operator">=</span>secure_database_password<span class="token builtin class-name">export</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>secure_database_password<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Substitute <code>secure_database_password</code> with your desired database password. Remember to use the same password for both <code>WORDPRESS_DB_PASSWORD</code> and <code>MYSQL_ROOT_PASSWORD</code>.</p><p>With these variables set, run the containers using <code>docker-compose</code>:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> up -d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Now watch the Traefik admin dashboard while it populates.</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1420211014200110.png" alt="Populated Traefik dashboard"></p><p>If you explore the <strong>Routers</strong> section you will find routers for <code>adminer</code> and <code>blog</code> configured with TLS:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1420211014200142.png" alt="HTTP Routers w/ TLS"></p><p>Navigate to <code>blog.your_domain</code>, substituting <code>your_domain</code> with your domain. You’ll be redirected to a TLS connection and you can now complete the WordPress setup:</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1420211014200114.png" alt="WordPress setup screen"></p><p>Now access Adminer by visiting <code>db-admin.your_domain</code> in your browser, again substituting <code>your_domain</code> with your domain. The <code>mysql</code> container isn’t exposed to the outside world, but the <code>adminer</code> container has access to it through the <code>internal</code> Docker network that they share using the <code>mysql</code> container name as a hostname.</p><p>On the Adminer login screen, enter <code>root</code> for <strong>Username</strong>, enter <code>mysql</code> for <strong>Server</strong>, and enter the value you set for <code>MYSQL_ROOT_PASSWORD</code> for the <strong>Password</strong>. Leave <strong>Database</strong> empty. Now press <strong>Login</strong>.</p><p>Once logged in, you’ll see the Adminer user interface.</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1420211014200132.png" alt="Adminer connected to the MySQL database"></p><p>Both sites are now working, and you can use the dashboard at <code>monitor.your_domain</code> to keep an eye on your applications.</p><h2 id="Conclusion">Conclusion</h2><p>In this tutorial, you configured Traefik v2 to proxy requests to other applications in Docker containers.</p><p>Traefik’s declarative configuration at the application container level makes it easy to configure more services, and there’s no need to restart the <code>traefik</code> container when you add new applications to proxy traffic to since Traefik notices the changes immediately through the Docker socket file it’s monitoring.</p><p>To learn more about what you can do with Traefik v2, head over to <a target="_blank" rel="noopener" href="https://doc.traefik.io/traefik/">the official Traefik documentation</a>.</p><h2 id="服务集群">服务集群</h2><blockquote><p>k8s 太重了,虽然也有 k3s 之类的轻量级 k8s 解决方案，不过我还是选择了原生的 docker swarm。VPS 安装好 Docker 之后，不需要额外安装软件，就可以马上建立集群。</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 集群初始化，节点成为 manager 节点</span><span class="token function">docker</span> swarm init --advertise-addr<span class="token operator">=</span>x.x.x.x<span class="token comment"># 集群丢失 Leader 时，强制重建集群</span><span class="token function">docker</span> swarm init --advertise-addr<span class="token operator">=</span>x.x.x.x --force-new-cluster<span class="token comment"># 获取作为 worker 节点加入集群的命令</span><span class="token function">docker</span> swarm join-token worker<span class="token comment"># 获取作为 manager 节点加入集群的命令</span><span class="token function">docker</span> swarm join-token manager<span class="token comment"># 加入集群</span><span class="token function">docker</span> swarm <span class="token function">join</span> --token xxx x.x.x.x:xxx --advertise-addr<span class="token operator">=</span>x.x.x.x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="参考：-3">参考：</h2><ul><li><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-use-traefik-v2-as-a-reverse-proxy-for-docker-containers-on-ubuntu-20-04">digitalocean</a></li><li><a target="_blank" rel="noopener" href="https://shanyue.tech/op/traefik.html">shanyue</a></li></ul><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="web" scheme="https://blog.17lai.site/categories/web/"/>
    
    
    <category term="docker" scheme="https://blog.17lai.site/tags/docker/"/>
    
    <category term="traefik" scheme="https://blog.17lai.site/tags/traefik/"/>
    
    <category term="proxy" scheme="https://blog.17lai.site/tags/proxy/"/>
    
    <category term="swarm" scheme="https://blog.17lai.site/tags/swarm/"/>
    
    <category term="ubuntu" scheme="https://blog.17lai.site/tags/ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>通过IPV6访问Qnap NAS中Docker的服务</title>
    <link href="https://blog.17lai.site/posts/462f1e5c/"/>
    <id>https://blog.17lai.site/posts/462f1e5c/</id>
    <published>2021-10-12T05:42:55.000Z</published>
    <updated>2022-03-16T10:52:11.433Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="环境">环境</h2><p>系统：QTS 4.3.6<br>网络：IPV4 &amp; IPV6<br>Docker: 由Container Station提供</p><h2 id="问题-2">问题</h2><p>通过ipv6地址可以打开NAS的管理页面，但是无法访问Docker对应端口的服务。</p><h2 id="排查">排查</h2><p>QTS中Docker使用的虚拟交换机网络没有启动IPV6，且无法在虚拟交换机设置中手动启动。<br>这样一来，Docker只监听了tcp4的端口，对于主机上tcp6的端口的访问无法映射到docker容器上。</p><h2 id="解决方案-2">解决方案</h2><p>在主机上开一个tcp6的端口，将其转发到主机上与docker关联的tcp4端口。<br>即：<br>docker(tcp4)–&gt;host(tcp4)–&gt;host(tcp6)</p><ul><li>在qts上安装包管理器：Entware. https://github.com/Entware/Entware/wiki/Install-on-QNAP-NAS</li><li>执行opkg update,更新</li><li>安装端口转发工具，这里使用socat：opkg install socat</li><li>设置转发host(tcp6)–&gt;host(tcp4):(socat TCP6-LISTEN:6880,reuseaddr,fork TCP4:127.0.0.1:7880 &amp;)</li><li>大功告成</li></ul><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="nas" scheme="https://blog.17lai.site/categories/nas/"/>
    
    
    <category term="nas" scheme="https://blog.17lai.site/tags/nas/"/>
    
    <category term="docker" scheme="https://blog.17lai.site/tags/docker/"/>
    
    <category term="qnap" scheme="https://blog.17lai.site/tags/qnap/"/>
    
    <category term="ipv6" scheme="https://blog.17lai.site/tags/ipv6/"/>
    
  </entry>
  
  <entry>
    <title>CMake快速入门教程</title>
    <link href="https://blog.17lai.site/posts/495db4d3/"/>
    <id>https://blog.17lai.site/posts/495db4d3/</id>
    <published>2021-10-12T04:25:00.000Z</published>
    <updated>2022-03-16T10:52:11.506Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="1-cmake简介">1.cmake简介</h2><p>cmake是跨平台的makefile文件生成工具,是为了解决各个平台下面make工具不同造成的makefile文件格式不同的问题.也就是cmake是用来解决跨平台编译问题的.常见的还有autotool工具集，该工具集用于GNU软件协议的makefile文件生成，方便GNU包的编译和安装。</p><h2 id="2-cmake文件编辑规则">2.cmake文件编辑规则</h2><ul><li>1)<strong>命令不区分大小写，但是变量区分大小写</strong>。</li><li>2)<strong>注释</strong>使用#符号</li><li>3)命令如果有多个参数，互相之间用空格隔开</li></ul><h2 id="3-cmake保留变量">3.cmake保留变量</h2><p>cmake里面有很多的预定义变量,是程序环境固有的,比如CUDA_NVCC_FLAGS,不同的变量有固定的作用,比如CUDA_NVCC_FLAGS是nvcc的参数list,变量可以使用set命令和list命令进行赋值和追加值,要注意的是变量可能可以有多个值,值与值之间用分号分开,可以使用set(var a b c)给var赋值a b c,还可以使用list命令给var追加删除插入值等,不同的变量有不同的值域,需要查阅<a target="_blank" rel="noopener" href="https://cmake.org/documentation/">手册</a></p><h2 id="4-cmake变量引用">4.cmake变量引用</h2><p>cmake里面变量的取值引用要使用${var}的形式,但是在赋值的时候是不需要的,和shell命令有点相似.</p><h2 id="5-cmake指定Debug和Release版本">5.cmake指定Debug和Release版本</h2><p>指定Debug和Release一共有三种方法：</p><p>1.使用ADD_COMPILE_OPTIONS()加入-g指定Debug版本.</p><p>2.使用SET( CMAKE_BUILD_TYPE Debug/Rrelease)指定Debug<br>在下面加入：</p><pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token function">SET</span><span class="token punctuation">(</span><span class="token variable">CMAKE_CXX_FLAGS_DEBUG</span> <span class="token string">"$ENV{CXXFLAGS} -O0 -Wall -g2 -ggdb"</span><span class="token punctuation">)</span><span class="token function">SET</span><span class="token punctuation">(</span><span class="token variable">CMAKE_CXX_FLAGS_RELEASE</span> <span class="token string">"$ENV{CXXFLAGS} -O3 -Wall"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>上面的设置C++编译选项，对于C语言，设置CMAKE_C_FLAGS_DEBUG、CMAKE_._FLAGS_RELEASE变量，一般来说最好两个都设置原因是CMake 中有一个变量 CMAKE_BUILD_TYPE ,可以的取值是 Debug Release等.当这个变量值为 Debug 的时候,CMake 会使用变量 CMAKE_CXX_FLAGS_DEBUG 和 CMAKE_C_FLAGS_DEBUG 中的字符串作为编译选项生成 Makefile</p><p>编译动态库or静态库时，最好通过修改CXXFLAGS和CFLAGS，以支持-fPIC，这个选项有时是默认开启，有时默认关闭，但为了以后的应用，库文件最好都使用-fPIC编译</p><ol start="3"><li>在使用cmake命令时加上-DCMAKE_BUILD_TYPE=Debug/Release</li></ol><h2 id="5-cmake指定生成文件">5.cmake指定生成文件</h2><p>CUDA_ADD_LIBRARY()指明目标文件是库文件,CUDA_ADD_EXECUTABLE()指明生成的文件为可执行文件</p><h2 id="6-配置模板">6.配置模板</h2><p>通常我们要在工程目录下面创建include、src文件夹，include文件夹里面存放头文件，src文件夹里面存放源代码，注意这时候的源代码里面包含头文件的路径应该是“../include/xx.h”，然后在工程根目录下面创建CMakeLists.txt文件，里面写入命令.在编译的时候为了不搞乱工程目录，在工程根目录下面创建build文件夹，在里面使用“cmake ..”命令创建CMakefile,再make即可。</p><pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token comment">#指定cmake最低版本号</span><span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.2</span><span class="token punctuation">)</span><span class="token comment">#指定项目名称</span><span class="token function">PROJECT</span><span class="token punctuation">(</span>Liner_Struct<span class="token punctuation">)</span><span class="token comment">#指定头文件目录，不同目录用空格隔开,目录中有空格可用引号</span><span class="token comment">#如果是相对路径，相对于CMakeLists.txt文件</span><span class="token property">INCLUDE_DIRECTORIES</span><span class="token punctuation">(</span>include<span class="token punctuation">)</span><span class="token comment">#指定源文件目录，DIR_SRCS值自定义变量，下面的命令对其进行了赋值</span><span class="token function">AUX_SOURCE_DIRECTORY</span><span class="token punctuation">(</span>src DIR_SRCS<span class="token punctuation">)</span><span class="token comment">#设置变量用于存放所有的编译文件，</span><span class="token comment">#TEST_LINER_STRUCT是自定义变量，使用SET给其赋值</span><span class="token function">SET</span><span class="token punctuation">(</span>TEST_LINER_STRUCT <span class="token punctuation">${</span>DIR_SRCS<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">#增加编译选项</span><span class="token comment">#判断是否为gcc编译器，如果是，增加编译选项</span><span class="token comment">#c99是c语言的标准，常用的还有c++标准c++11</span><span class="token comment">#下面的命令判断是否编译器是gcc</span><span class="token comment">#message命令是输出信息,例如下面的输出“optional:-std=c99”</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">CMAKE_COMPILER_IS_GNUCXX</span><span class="token punctuation">)</span>    <span class="token function">ADD_COMPILE_OPTIONS</span><span class="token punctuation">(</span>-std=c99<span class="token punctuation">)</span>    <span class="token keyword">message</span><span class="token punctuation">(</span>STATUS <span class="token string">"optional:-std=c99"</span><span class="token punctuation">)</span><span class="token keyword">endif</span><span class="token punctuation">(</span><span class="token variable">CMAKE_COMPILER_IS_GNUCXX</span><span class="token punctuation">)</span><span class="token comment">#配置生成文件</span><span class="token comment">#${PROJECT_NAME}是cmake自带变量，其值和PROJECT()命令指定的一样</span><span class="token comment">#${TEST_LINER_STRUCT}是自定义变量，上文赋值的</span><span class="token function">ADD_EXECUTABLE</span><span class="token punctuation">(</span><span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span> <span class="token punctuation">${</span>TEST_LINER_STRUCT<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="7-if-else语句">7.<a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/v3.0/command/if.html">if-else</a>语句</h2><p>cmake中的if-else语句</p><pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">if</span><span class="token punctuation">(</span>exp<span class="token punctuation">)</span>     cmdA     cmdB<span class="token keyword">elseif</span><span class="token punctuation">(</span>exp<span class="token punctuation">)</span>      cmdC<span class="token keyword">endif</span><span class="token punctuation">(</span>exp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最简单得到一个应用</p><pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">if</span><span class="token punctuation">(</span>ARM<span class="token punctuation">)</span>   <span class="token comment">#ARM平台</span><span class="token keyword">else</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#非ARM平台 </span><span class="token keyword">endif</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用cmake -DARM=1 .. 时编译ARM代码，使用cmake -DAMR=0 ..编译非ARM代码</p><h2 id="8-与平台编译器的结合">8.与平台编译器的结合</h2><h3 id="8-1windows">8.1windows</h3><p>在windows上运行cmake可以生成对应的VS的工程文件，然后使用相应的VS打开工程就可以进行编译。要注意的是如果使用VS2010及其以前的版本，C不支持C99，也就是变量的命名必须放在函数或者域的最前面，不能放在中间，特别麻烦。VS2015在安装后可能还需要打开VS，新建工程时选择VC<ins>可能相关组件还没有安装，如果这时候使用cmake会提示找不到C、C</ins>编译器（类似yuNo CMAKE_CXX_COMPILER could be found）的错误。安装了相关的组件后cmake即不会有错误。</p><h3 id="8-2-为VS2015生成的项目">8.2 为VS2015生成的项目</h3><p>打开工程文件后可以看到有3个项目，其中只有一个和我们有直接关系，就是我们在CMakeLists.txt里面定义的PROJECT_NAME,剩下的两个是ALL_BUILD和ZERO_CHECK.</p><p><strong>ZERO_CHECK</strong><br>该目标会检查生成工程的 CMake 配置文件（ CMakeLists.txt ）是否更新。如更新，将运行 CMake 重新生成工程文件。</p><p>如果确信 CMakeLists.txt 不会被更新，或者希望手工运行 CMake 重新生成工程文件，可以在 CMakeLists.txt 配置文件中添加 set(CMAKE_SUPPRESS_REGENERATION FALSE) 命令， ZERO_CHECK 目标将不会生成。</p><p><strong>ALL_BUILD</strong><br>该目标会导致工程中所有项目被构建，类似 Visual Studio 的 Build All 或者 make 的 make all命令。</p><p>转载 <a target="_blank" rel="noopener" href="https://lightzhan.xyz/index.php/2020/03/11/cmake-quick-tutorial/">CMake快速入门教程</a></p><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="linux" scheme="https://blog.17lai.site/categories/linux/"/>
    
    
    <category term="linux" scheme="https://blog.17lai.site/tags/linux/"/>
    
    <category term="cmake" scheme="https://blog.17lai.site/tags/cmake/"/>
    
    <category term="develop" scheme="https://blog.17lai.site/tags/develop/"/>
    
  </entry>
  
  <entry>
    <title>如何使用tinyMediaManager刮削电影和电视剧，动画，并自动下载字幕</title>
    <link href="https://blog.17lai.site/posts/e6d40157/"/>
    <id>https://blog.17lai.site/posts/e6d40157/</id>
    <published>2021-10-11T11:25:00.000Z</published>
    <updated>2022-03-16T12:29:06.798Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>注意使用V3版本，V4版本收费！</p><p>所以升级V3版本即可，不要升级到V4版本！不要升级到V4版本！不要升级到V4版本！</p></blockquote><ul><li><strong>Plex</strong>是一款很好用的个人媒体中心软件，但是因为国内网络的原因，使用默认的TMDB刮削器挂出来的效果并不好，要么就是影片信息不正确，要么就是海报不正常显示，实在让人头疼。</li><li><strong>tinyMediaManager</strong>是一款电影信息刮削和整理的软件，正好可以和plex配合，完美的解决这一问题。tinyMediaManager在刮削影片的过程中会把影片的海报、演员表、背景图片等等都保存到影片所在文件夹，自动生成电影的nfo信息文件，并对文件和文件夹进行重新命名的操作。在plex设置刮削代理的时候，需要用一款插件可以直接读取nfo的信息，完成刮削，下面把使用方法分享给大家，</li></ul><h2 id="下载和安装tinyMediaManager"><strong>下载和安装tinyMediaManager</strong></h2><p><strong>官网下载地址：<a href="www.tinymediamanager.org/download/">https://www.tinymediamanager.org/download/</a></strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181048.jpeg" alt=""></p><h3 id="tmm下载">tmm下载</h3><p><strong>下载后直接解压文件夹</strong></p><p>客户端需要java支持，先在电脑安装java</p><p>客户端下载后是一个压缩包，解压之后就可以用</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181054.jpeg" alt=""></p><p><strong>解压之后打开tinyMediaManager.exe</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181101.png" alt="tmm目录"></p><h2 id="TMM设置">TMM设置</h2><h3 id="TMM代理设置">TMM代理设置</h3><blockquote><p>重要：很多源都需要代理才能访问。这里正确的配置才能正确的刮削！</p><p>可以调整这里使用的内存，大内存可以极大加速刮削速度。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011211402.png" alt=""></p><h2 id="电影刮削设置">电影刮削设置</h2><p><strong>进行相关设置。Tmm可以对电影和电视剧的刮削进行分别设置，打开设置后选择电影选项，可以选择分级标准、自动重命名等选项。</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181337.png" alt=""></p><p>电影信息选项</p><p><strong>点击侧边栏媒体库目录，添加电影目录</strong></p><p><strong>刮削器设置</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181107.jpeg" alt=""></p><p>选择电影刮削器</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181107.png" alt=""></p><p>刮削器选项</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181114.png" alt=""></p><p>nfo选项，建议选择生成两种命名放视的nfo</p><p><strong>图片刮削器选择全选，图片文件名建议两边都选上，会分别生成两组命名格式不同的图片，为了保证plex能读取</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181331.png" alt=""></p><p>图片命名选项</p><p>Tmm还可以自动下载预告片，字幕。字幕下载时可以输入opensubtitles账户</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181115.png" alt=""></p><p>字幕下载选项</p><p><strong>重命名规则</strong></p><p>这里重点讲一下重命名规则，刮削完后可以选择对电影文件和文件夹进行重命名，可能对于pt用户重命名可能会影响资源上传，可以不进行重命名操作。</p><p>一般情况下电影刮削出来的信息，title是电影的中文标题名称，originaltitle是电影的原标题名称，一般是英文名称。软件默认的设置是文件和文件夹都命名成title，也就是中文标题，但是我发现这样在后期使用的时候有弊端。英文电影在检索字幕时会用文件名来检索，而用中文名称很多情况下检索不出来，所以这里把文件的命名规则改一下，改成originaltitle，并去掉年份信息的括号，中间连接符改成点，文件名设置成<img src="https://math.now.sh?inline=%7Boriginaltitle%7D" style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;">{- ,edition,}.<img src="https://math.now.sh?inline=%7Byear%7D." style="filter: opacity(90%);transform:scale(0.85);text-align:center;display:inline-block;margin: 0;">{videoFormat}.${audioCodec}的格式。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181121.png" alt=""></p><p>电影文件重命名选项</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181127.png" alt=""></p><p>刮削完的文件夹内文件信息</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181323.png" alt=""></p><p>刮削完的电影文件夹目录</p><p><strong>电视节目刮削设置类似，如果挂不出来可以用the tvdb来刮削。</strong></p><p><strong>tmm有时候会出现网络不稳定，刮不到的情况，可以修改host解决</strong></p><p>改host 在host文件最后加一行13.224.161.90 <a href="https://link.zhihu.com/?target=http%3A//api.themoviedb.org">http://api.themoviedb.org</a></p><p><strong>退出设置，开始刮削</strong></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181317.png" alt=""></p><p>更新电影源</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181128.jpeg" alt=""></p><p>选中要刮削的电影自动匹配</p><h3 id="电影手动刮削">电影手动刮削</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011183942.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011184131.png" alt=""></p><h2 id="电视剧-动画手动刮削">电视剧&amp;动画手动刮削</h2><h3 id="电视剧元数据刮削">电视剧元数据刮削</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011184909.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011185747.png" alt=""></p><h3 id="季和集元数据刮削前整理">季和集元数据刮削前整理</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011185049.png" alt=""></p><h3 id="刮削季元素">刮削季元素</h3><p>整理好正确的季和集之后，才能正确的刮削季元素</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011185146.png" alt=""></p><h3 id="TMM整理完效果">TMM整理完效果</h3><blockquote><p>这里用海贼王做展示，一个季和集都特别多的剧。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011185448.png" alt=""></p><h2 id="TMM目录重命名整理">TMM目录重命名整理</h2><blockquote><p>刮削完后，可以重命名视频文件，并进行目录整理。</p></blockquote><p>方法1</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181133.jpeg" alt=""></p><p>方法2</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011184315.png" alt=""></p><p>等所有电影的信息刮削完后，选择重命名和清理，这样就完成了刮削的操作。以后下载了新电影，直接打开tmm,更新源之后直接选择搜索未刮削过的电影完成刮削。刮削出来的信息kodi，emby等软件也都能用。</p><h2 id="Plex设置">Plex设置</h2><h3 id="plex插件的安装和设置"><strong>plex插件的安装和设置</strong></h3><p><strong>下载plex的插件</strong></p><p>插件XBMCnfoMoviesImporter和XBMCnfoTVImporter分别是刮削电影和电视剧的插件</p><p>下载地址：<a href="https%3A//github.com/gboudreau/XBMCnfoMoviesImporter.bundle">https://github.com/gboudreau/XBMCnfoMoviesImporter.bundle</a></p><p>如果不能下载的话可以联系我获取，还有几个很好用的plex插件</p><p>下载完插件后就需要把插件解压到plex的插件目录：C:\Users\用户名\AppData\Local\Plex Media Server\Plug-ins</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181134.png" alt=""></p><p>plex插件目录</p><p>注意解压后要把文件夹名后边的master去掉。</p><p><strong>plex代理设置</strong></p><p>Plex的代理设置就是选择刮削电影所用的刮削器及优先级。</p><p>装好插件后重启plex，进行plex的设置。在代理设置中选择XBMCnfoMoviesImporter，把它的优先级调到最高，第二个可以设置成字幕插件。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181140.jpeg" alt=""></p><p><strong>设置电影资料库的刮削器代理</strong></p><p>点击设置界面下方管理里边的资料库，选择电影资料夹的高级设置，设置如下</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181140.png" alt=""><br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181146.png" alt=""></p><p>plex代理设置</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181152.png" alt=""></p><p><strong>刷新电影源数据资料</strong></p><p>设置完成后就可以在plex主页对电影文件夹刷新元数据了。等待刷新完后就可以载入所有的电影信息了。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181152.jpeg" alt=""></p><p>管理资料库-刷新电影元数据</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181153.jpeg" alt=""></p><p>更新后的电影信息</p><p>采用类似的设置，电视剧信息也能刮削。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181159.jpeg" alt=""></p><p>电视剧更新后的信息</p><h2 id="Emby设置">Emby设置</h2><blockquote><p>Emby内置刮削工具，但是速度较慢。下面设置基于外部刮削工具TMM，所以没有勾选Emby刮削源！</p></blockquote><p>最终效果演示</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011190035.png" alt="最终效果"></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011190347.png" alt=""></p><h3 id="开始设置">开始设置</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011181946.png" alt=""></p><h3 id="新增媒体库">新增媒体库</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011182142.png" alt=""></p><h3 id="已有媒体库属性设置">已有媒体库属性设置</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011182244.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011182350.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011183115.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011183157.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011183336.png" alt=""></p><h3 id="Emby字幕设置">Emby字幕设置</h3><p>字幕下载设置，字幕下载工具见后面的[字幕下载]章节</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011182554.png" alt=""></p><h2 id="字幕下载-2"><strong>字幕下载</strong></h2><p>想要较好的自动下载字幕，最好用前面介绍的tmm刮削改名之后再使用下面工具。</p><h3 id="subfinder-自动下载字幕-2">subfinder 自动下载字幕</h3><ul><li>Docker： <a target="_blank" rel="noopener" href="https://hub.docker.com/r/superng6/subfinder">superng6/subfinder</a></li></ul><p>下载完成，刮削后的目录，挂载到subfinder的media目录，就会自动下载字幕。</p><p>字幕下载对电影，英文剧集支持较好。对于一些tv，动画手动下载字幕会更好一些。</p><p>注意：官方的配置文件有问题，时效问题。修改URL到最新即可。</p><h3 id="chinesesubfinder-2">chinesesubfinder</h3><ul><li>Docker： <a target="_blank" rel="noopener" href="https://hub.docker.com/r/allanpk716/chinesesubfinder">allanpk716/chinesesubfinder</a></li><li>新开发的中文字幕查找工具，上面那个很久没更新了，这个刚出来。使用nfo里面刮削出来的文件名来匹配字幕。所以就原理来说，这个字幕匹配更准确。</li></ul><h3 id="bazarr-2">bazarr</h3><ul><li>Docker：<a target="_blank" rel="noopener" href="https://hub.docker.com/r/linuxserver/bazarr">linuxserver/bazarr</a></li><li>字幕下载管理，配合sonarr, radarr 使用效果更好。对于英文剧集命名规范的支持较好，比如<code>[name]S01E01</code></li></ul><h2 id="参考-3">参考</h2><ul><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/112167546?from_voters_page=true">利用tinyMediaManager刮削影片，解决家用nas软件plex电影墙的问题</a></li></ul><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="video" scheme="https://blog.17lai.site/categories/video/"/>
    
    
    <category term="刮削" scheme="https://blog.17lai.site/tags/%E5%88%AE%E5%89%8A/"/>
    
    <category term="tmm" scheme="https://blog.17lai.site/tags/tmm/"/>
    
    <category term="字幕" scheme="https://blog.17lai.site/tags/%E5%AD%97%E5%B9%95/"/>
    
    <category term="emby" scheme="https://blog.17lai.site/tags/emby/"/>
    
    <category term="plex" scheme="https://blog.17lai.site/tags/plex/"/>
    
  </entry>
  
  <entry>
    <title>如何使用media Go,MusicBrainz,Mp3tag工具刮削音乐 整理音乐资料库</title>
    <link href="https://blog.17lai.site/posts/3847ad58/"/>
    <id>https://blog.17lai.site/posts/3847ad58/</id>
    <published>2021-10-11T01:25:00.000Z</published>
    <updated>2022-03-16T12:29:06.715Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="背景">背景</h2><p>动画、电影、剧集可使用TinyMediaManager生成nfo元数据文件，多媒体软件解析生成海报墙展示丰富的影片信息。</p><p>而音乐文件则是将歌名、歌手、专辑、发行时间、歌词、封面图等信息写入文件标签，称为ID3 Tag 。桌面软件、多媒体管理软件（Foobar2000/Plex/Emby/Jellyfin等）都能解析展现歌曲信息。ID3标签是MP3音乐档案中的歌曲附加讯息，它能够在MP3中附加曲子的演出者、作者以及其它类别资讯，方便众多乐曲的管理。缺少ID3标签并不会影响 MP3的播放，但若没有的话，管理音乐文件也会相当的麻烦。</p><h2 id="刮削效果">刮削效果</h2><h3 id="Foobar2000读取效果：">Foobar2000读取效果：</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173843.jpeg" alt=""></p><h3 id="Jellyfin读取效果：">Jellyfin读取效果：</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173846.jpeg" alt=""></p><h2 id="Mp3tag">Mp3tag</h2><blockquote><p>纯手工修改，开源工具。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011174402.png" alt="Mp3tag"></p><h2 id="Media-Go">Media Go</h2><blockquote><p>不要使用最新版！老版本才有我们最需要的功能。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011174641.png" alt="Media Go"></p><h3 id="添加媒体库">添加媒体库</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011175356.png" alt="Media Go"></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011175429.png" alt=""></p><h3 id="自动获取属性">自动获取属性</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011175852.png" alt=""></p><h3 id="歌曲属性修改">歌曲属性修改</h3><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011175602.png" alt=""></p><h2 id="MusicBrainz">MusicBrainz</h2><blockquote><ul><li>MusicBrainz官网：<a target="_blank" rel="noopener" href="https://musicbrainz.org/">https://musicbrainz.org/</a></li><li>MusicBrainz Picard下载地址：<a target="_blank" rel="noopener" href="https://picard.musicbrainz.org/">https://picard.musicbrainz.org/</a></li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173854.jpeg" alt="MusicBrainz"><br>MusicBrainz Picard可以修改音乐的Tag标签信息，根据标签重命名文件。它的数据来源于非营利互联网音乐专辑数据库MusicBrainz项目，歌曲资源非常丰富。尤其它能根据声纹（音频指纹）识别Mp3文件进行匹配取信息，匹配率极高。不管是英文、中文歌曲，还是录音室版本、演唱会版本，都能很好地匹配出来。<br>支持MP3、FLAC、OGG、M4A、WMA、WAV等主流的音频格式，wav,ape格式不支持，需要要转换成支持的格式。<br>写入前后对比：<br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173901.jpeg" alt=""></p><p><strong>MusicBrainz Picard使用教程：</strong><br>将音乐文件/文件夹拖入左侧窗口，点上方“查询“按钮，在MusicBrainz数据库里搜索对应音乐。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173901.png" alt=""><br>如果搜索不到，点击”扫描“，使用声纹匹配，准确度更高。<br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173907.png" alt=""><br>如果以上两种方法都搜索不到，或者添加的文件名变成乱码，右击”查找相似的音轨“<br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173942.png" alt=""><br>手动输入歌曲名字，搜索，选择正确的歌曲信息，载入Picard。<br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173914.png" alt=""></p><p>右侧窗口载入专辑信息。展开列表，绿色方块的就是匹配成功的音乐。底部窗口展示文件原始标签信息和MusicBrainz网站上的信息对照。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173948.png" alt=""><br>如果匹配的不是正确的专辑信息，右击”查找相似的音轨“，选择正确的专辑信息载入Picard。<br>如果搜索出了多张专辑，可点击错误的专辑拖动到目标专辑上完成匹配，省的一个一个文件的修改。<br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173955.png" alt=""></p><p>最后点“保存”，将标签信息写入音乐文件。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011174018.png" alt=""></p><p><strong>如何重命名文件：</strong><br>菜单栏-选项-勾选“重命名文件”，保存的时候会同时写入信息+重命名。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011174002.png" alt=""><br>默认设置是：序号 歌名.mp3，适合一个专辑一个文件夹使用。<br>如果是单文件的话要去创建命名规则，选项-正在重命名文件-保存时重命名文件，填写命名规则。<br><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/1120211011173929.jpeg" alt=""></p><h2 id="参考：-2">参考：</h2><ul><li><a target="_blank" rel="noopener" href="http://www.92nas.com/forum.php?mod=viewthread&amp;tid=115">使用MusicBrainz Picard刮削音乐 整理音乐资料库</a></li></ul><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="music" scheme="https://blog.17lai.site/categories/music/"/>
    
    
    <category term="music" scheme="https://blog.17lai.site/tags/music/"/>
    
    <category term="刮削" scheme="https://blog.17lai.site/tags/%E5%88%AE%E5%89%8A/"/>
    
    <category term="MusicBrainz" scheme="https://blog.17lai.site/tags/MusicBrainz/"/>
    
    <category term="mp3tag" scheme="https://blog.17lai.site/tags/mp3tag/"/>
    
  </entry>
  
  <entry>
    <title>http 错误代码表</title>
    <link href="https://blog.17lai.site/posts/80906b88/"/>
    <id>https://blog.17lai.site/posts/80906b88/</id>
    <published>2021-10-06T11:25:00.000Z</published>
    <updated>2022-03-16T10:52:11.175Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>所有 HTTP 状态代码及其定义。<br>　代码&nbsp;&nbsp;指示&nbsp;&nbsp;<br>2xx&nbsp;&nbsp;成功&nbsp;&nbsp;<br>200&nbsp;&nbsp;正常；请求已完成。&nbsp;&nbsp;<br>201&nbsp;&nbsp;正常；紧接 POST 命令。&nbsp;&nbsp;<br>202&nbsp;&nbsp;正常；已接受用于处理，但处理尚未完成。&nbsp;&nbsp;<br>203&nbsp;&nbsp;正常；部分信息 — 返回的信息只是一部分。&nbsp;&nbsp;<br>204&nbsp;&nbsp;正常；无响应 — 已接收请求，但不存在要回送的信息。&nbsp;&nbsp;<br>3xx&nbsp;&nbsp;重定向&nbsp;&nbsp;<br>301&nbsp;&nbsp;已移动 — 请求的数据具有新的位置且更改是永久的。&nbsp;&nbsp;<br>302&nbsp;&nbsp;已找到 — 请求的数据临时具有不同 URI。&nbsp;&nbsp;<br>303&nbsp;&nbsp;请参阅其它 — 可在另一 URI 下找到对请求的响应，且应使用 GET 方法检索此响应。&nbsp;&nbsp;<br>304&nbsp;&nbsp;未修改 — 未按预期修改文档。&nbsp;&nbsp;<br>305&nbsp;&nbsp;使用代理 — 必须通过位置字段中提供的代理来访问请求的资源。&nbsp;&nbsp;<br>306&nbsp;&nbsp;未使用 — 不再使用；保留此代码以便将来使用。&nbsp;&nbsp;<br>4xx&nbsp;&nbsp;客户机中出现的错误&nbsp;&nbsp;<br>400&nbsp;&nbsp;错误请求 — 请求中有语法问题，或不能满足请求。&nbsp;&nbsp;<br>401&nbsp;&nbsp;未授权 — 未授权客户机访问数据。&nbsp;&nbsp;<br>402&nbsp;&nbsp;需要付款 — 表示计费系统已有效。&nbsp;&nbsp;<br>403&nbsp;&nbsp;禁止 — 即使有授权也不需要访问。&nbsp;&nbsp;<br>404&nbsp;&nbsp;找不到 — 服务器找不到给定的资源；文档不存在。&nbsp;&nbsp;<br>407&nbsp;&nbsp;代理认证请求 — 客户机首先必须使用代理认证自身。&nbsp;&nbsp;<br>415&nbsp;&nbsp;介质类型不受支持 — 服务器拒绝服务请求，因为不支持请求实体的格式。&nbsp;&nbsp;<br>5xx&nbsp;&nbsp;服务器中出现的错误&nbsp;&nbsp;<br>500&nbsp;&nbsp;内部错误 — 因为意外情况，服务器不能完成请求。&nbsp;&nbsp;<br>501&nbsp;&nbsp;未执行 — 服务器不支持请求的工具。&nbsp;&nbsp;<br>502&nbsp;&nbsp;错误网关 — 服务器接收到来自上游服务器的无效响应。&nbsp;&nbsp;<br>503&nbsp;&nbsp;无法获得服务 — 由于临时过载或维护，服务器无法处理请求。</p><hr><p>HTTP&nbsp;400&nbsp;-&nbsp;请求无效&nbsp;<br>HTTP&nbsp;401.1&nbsp;-&nbsp;未授权：登录失败&nbsp;<br>HTTP&nbsp;401.2&nbsp;-&nbsp;未授权：服务器配置问题导致登录失败&nbsp;<br>HTTP&nbsp;401.3&nbsp;-&nbsp;ACL&nbsp;禁止访问资源&nbsp;<br>HTTP&nbsp;401.4&nbsp;-&nbsp;未授权：授权被筛选器拒绝&nbsp;<br>HTTP&nbsp;401.5&nbsp;-&nbsp;未授权：ISAPI&nbsp;或&nbsp;CGI&nbsp;授权失败&nbsp;&nbsp;<br>HTTP&nbsp;403&nbsp;-&nbsp;禁止访问&nbsp;<br>HTTP&nbsp;403&nbsp;-&nbsp;对&nbsp;Internet&nbsp;服务管理器&nbsp;(HTML)&nbsp;的访问仅限于&nbsp;Localhost&nbsp;<br>HTTP&nbsp;403.1&nbsp;禁止访问：禁止可执行访问&nbsp;<br>HTTP&nbsp;403.2&nbsp;-&nbsp;禁止访问：禁止读访问&nbsp;<br>HTTP&nbsp;403.3&nbsp;-&nbsp;禁止访问：禁止写访问&nbsp;<br>HTTP&nbsp;403.4&nbsp;-&nbsp;禁止访问：要求&nbsp;SSL&nbsp;<br>HTTP&nbsp;403.5&nbsp;-&nbsp;禁止访问：要求&nbsp;SSL&nbsp;128&nbsp;<br>HTTP&nbsp;403.6&nbsp;-&nbsp;禁止访问：IP&nbsp;地址被拒绝&nbsp;<br>HTTP&nbsp;403.7&nbsp;-&nbsp;禁止访问：要求客户证书&nbsp;<br>HTTP&nbsp;403.8&nbsp;-&nbsp;禁止访问：禁止站点访问&nbsp;<br>HTTP&nbsp;403.9&nbsp;-&nbsp;禁止访问：连接的用户过多&nbsp;<br>HTTP&nbsp;403.10&nbsp;-&nbsp;禁止访问：配置无效&nbsp;<br>HTTP&nbsp;403.11&nbsp;-&nbsp;禁止访问：密码更改&nbsp;<br>HTTP&nbsp;403.12&nbsp;-&nbsp;禁止访问：映射器拒绝访问&nbsp;<br>HTTP&nbsp;403.13&nbsp;-&nbsp;禁止访问：客户证书已被吊销&nbsp;<br>HTTP&nbsp;403.15&nbsp;-&nbsp;禁止访问：客户访问许可过多&nbsp;<br>HTTP&nbsp;403.16&nbsp;-&nbsp;禁止访问：客户证书不可信或者无效&nbsp;<br>HTTP&nbsp;403.17&nbsp;-&nbsp;禁止访问：客户证书已经到期或者尚未生效&nbsp;<br>HTTP&nbsp;404.1&nbsp;-&nbsp;无法找到&nbsp;Web&nbsp;站点&nbsp;<br>HTTP&nbsp;404&nbsp;-&nbsp;无法找到文件&nbsp;<br>HTTP&nbsp;405&nbsp;-&nbsp;资源被禁止&nbsp;<br>HTTP&nbsp;406&nbsp;-&nbsp;无法接受&nbsp;<br>HTTP&nbsp;407&nbsp;-&nbsp;要求代理身份验证&nbsp;<br>HTTP&nbsp;410&nbsp;-&nbsp;永远不可用&nbsp;<br>HTTP&nbsp;412&nbsp;-&nbsp;先决条件失败&nbsp;<br>HTTP&nbsp;414&nbsp;-&nbsp;请求&nbsp;-&nbsp;URI&nbsp;太长&nbsp;<br>HTTP&nbsp;500&nbsp;-&nbsp;内部服务器错误&nbsp;<br>HTTP&nbsp;500.100&nbsp;-&nbsp;内部服务器错误&nbsp;-&nbsp;ASP&nbsp;错误&nbsp;<br>HTTP&nbsp;500-11&nbsp;服务器关闭&nbsp;<br>HTTP&nbsp;500-12&nbsp;应用程序重新启动&nbsp;<br>HTTP&nbsp;500-13&nbsp;-&nbsp;服务器太忙&nbsp;<br>HTTP&nbsp;500-14&nbsp;-&nbsp;应用程序无效&nbsp;<br>HTTP&nbsp;500-15&nbsp;-&nbsp;不允许请求&nbsp;global.asa&nbsp;<br>Error&nbsp;501&nbsp;-&nbsp;未实现&nbsp;<br>HTTP&nbsp;502&nbsp;-&nbsp;网关错误</p><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="web" scheme="https://blog.17lai.site/categories/web/"/>
    
    
    <category term="web" scheme="https://blog.17lai.site/tags/web/"/>
    
    <category term="http" scheme="https://blog.17lai.site/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>解决Thinkpad笔记本喇叭破音问题！</title>
    <link href="https://blog.17lai.site/posts/c945eae1/"/>
    <id>https://blog.17lai.site/posts/c945eae1/</id>
    <published>2021-10-05T01:25:00.000Z</published>
    <updated>2022-03-16T12:29:06.658Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="问题">问题</h2><p>主力笔记本笔记本播放音乐再次出现破音，换了几首音乐后问题依旧，前后对比强烈。</p><h2 id="分析">分析</h2><p>从几年前上一次维修经验来看，应该是喇叭老化破裂了！拆机查看，发现的确事喇叭破裂。</p><h2 id="解决方案">解决方案</h2><p>如是，网购了一个新喇叭，拆机，换上，完美解决问题！</p><p>喇叭施压后，能明显看到断裂痕迹。这样的喇叭音色就会出现明显的破音！如下图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/0520211005175831.jpg" alt="喇叭破裂施压图"></p><p><img src="https://cdn.jsdelivr.net/gh/appotry/cloudimg@latest/data/2021/10/0520211005175843.jpg" alt="喇叭破裂未施压图"></p><blockquote><p>这已经是这台笔记本第二次出现喇叭破裂问题了！  感觉喇叭材料或者工艺有问题。</p><p>型号：Thinkpad T4X0S</p></blockquote><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="notebook" scheme="https://blog.17lai.site/categories/notebook/"/>
    
    
    <category term="thinkpad" scheme="https://blog.17lai.site/tags/thinkpad/"/>
    
    <category term="sound" scheme="https://blog.17lai.site/tags/sound/"/>
    
    <category term="speaker" scheme="https://blog.17lai.site/tags/speaker/"/>
    
  </entry>
  
  <entry>
    <title>从文学的角度，分析韩红的《天亮了》</title>
    <link href="https://blog.17lai.site/posts/cb623532/"/>
    <id>https://blog.17lai.site/posts/cb623532/</id>
    <published>2021-10-02T16:25:00.000Z</published>
    <updated>2022-03-16T10:52:11.024Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="现场MV">现场MV</h2><style>.bbplayer{width: 100%; max-width: 850px; margin: auto}</style><div class="bbplayer"><iframe class="bbplayer" id="mmedia-bTMZmZKTnWtCmnJu" src="https://player.bilibili.com/player.html?bvid=BV1B7411p7aD&amp;page=1&amp;high_quality=1&amp;danmaku=true" allowfullscreen="allowfullscreen" scrolling="no" border="0" frameborder="0" framespacing="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts allow-popups"></iframe></div><script> document.getElementById("mmedia-bTMZmZKTnWtCmnJu").style.height=document.getElementById("mmedia-bTMZmZKTnWtCmnJu").scrollWidth*0.76+"px";    window.onresize = function(){      document.getElementById("mmedia-bTMZmZKTnWtCmnJu").style.height=document.getElementById("mmedia-bTMZmZKTnWtCmnJu").scrollWidth*0.76+"px";    }; </script><blockquote><p>精品分析： 原作：石晶兰 <a target="_blank" rel="noopener" href="https://tieba.baidu.com/p/5313070309?red_tag=2537504175">短文吧</a></p><p>再做个传送门： <a target="_blank" rel="noopener" href="https://www.baidu.com/s?ie=UTF-8&amp;wd=%E9%9F%A9%E7%BA%A2%20%E5%A4%A9%E4%BA%AE%E4%BA%86">天亮了</a>，听歌时，关灯，准备纸巾。</p></blockquote><h2 id="先分析结构。">先分析结构。</h2><p>看歌词。</p><p>那是一个秋天，风儿那么缠绵，<br>让我想起他们那双无助的眼。<br>就在那美丽风景相伴的地方，<br>我听到一声巨响震彻山谷。<br>就是那个秋天，再看不到爸爸的脸。<br>他用他的双肩，托起我重生的起点。<br>黑暗中泪水沾满了双眼，<br>不要离开不要伤害。</p><p>共八行，等于两个四行。<br>两个四行一一对应，前三行，旋律基本是相同的。只有最后一行，为了与后面衔接，所以不同。<br>两个四行的布置，等于是一种重复。<br>这样的重要，在文学结构上，常见于起承。<br>但歌，相当于诗。囿于篇幅，在结构上，通常会有所缺失。起承两者，一般缺失的，都是起。那样的做法，也就是直接叙事，存在让受众猝不及防的弊病。<br>然后，《天亮了》并不是。<br>“那是一个秋天，风儿那么缠绵”和“就是那个秋天”分明是起。<br>所以，《天亮了》并没有进行文学结构上的省略。<br>“那是一个秋天，风儿那么缠绵”是起，接紧着的三行歌词，自然就是承了。<br>那么，第五行“就是那个秋天”怎么又来一个起呢？<br>自然是因为篇幅太短，叙事不够（前面承得不够），所以，还需要再承一下。<br>不能够不要第五行的起，直接往下写吗？<br>真要说的话，其实也能。不过，再加四行承，真的就能把事情说清楚吗？<br>显然，韩红想要表达的东西很多，她认为，不能。<br>仅靠精练语言，明显是不够的，还需要换角度陈述。<br>第五行的再起，实际上，就是为后面的换角度承，打基础的。<br>这种写法，也是有先例的。请看邓丽君《相见在明天》歌词：<br>记得我俩初相见，<br>风吹花儿飞满天。<br>你说我的笑容像花朵，<br>比那花儿更娇艳。<br>我还记得那一天，<br>送你送到小河边。<br>手牵着手呀心里有千言，<br>相对却无言。<br>跟《天亮了》一样，《相见在明天》也是两个四行，也是起承起承。<br>并且，两起两承，还跟诗词的押韵一样，其重复，不仅有加深印象的作用，更有共鸣回旋的作用，正是唐陈子昂所说的“音情顿挫”的顿挫，极大的提升了作品的美感，让受众的接受度大大提高，</p><h2 id="继续看《天亮了》歌词：">继续看《天亮了》歌词：</h2><p>我看到爸爸妈妈就这么走远，<br>留下我在这陌生的人世间。<br>不知道未来还会有什么风险。<br>我想要紧紧抓住他的手。<br>妈妈告诉我希望还会有。<br>看到太阳出来妈妈笑了。<br>天亮了。</p><p>六行都是转。具体在这里，自然不是转折，而是高那个潮。</p><p>此处值得一说的是合，只有三个字“天亮了”。<br>这三个字，正好也是这首歌的歌名。<br>但是这三个字表达的，到底是什么意思、什么情感呢？</p><p>题都城南庄/唐/崔护<br>去年今日此门中，人面桃花相映红。<br>人面不知何处去，桃花依旧笑春风。</p><p>不难看出，最后一句“桃花依旧笑春风”跟前面三句的叙述，是接不上的。<br>去年这儿，有人面有桃花。今年这儿人面没有了，接下来说的通常是：还真是让人怀念啊。<br>俗吗？的确俗。并且，还不仅仅是俗，还存在因为什么而怀念那个姑娘的严重问题。<br>动机不纯的话，写出来就会玷污那个姑娘。动机纯粹，只是单纯的对美好事物的欣赏，写出来的话，又有自夸之嫌。<br>还真是不好写啊。<br>不好写，干脆就不写，另起一笔：“桃花依旧笑春风”。究竟表达的是什么样的滋味，让受众自己去想。</p><p>《天亮了》末尾的合“天亮了”，就是“桃花依旧笑春风”这种表现手法。太多的感情，千言万语，加总在一起，实在难以挽上疙瘩。于是，就另起一行，来了句看似关系不大的“天亮了”，让一切，尽在无言中。<br>不同的受众，会有不同的感受。因而这种让受众自己去想的结尾，总是余味无穷。</p><p>文学结构分析，就到这儿。第二段的结构跟第一段相同，就不讲了。</p><h2 id="下面进行逐句评讲。">下面进行逐句评讲。</h2><p>“那是一个秋天，风儿那么缠绵，”没毛病。“那是”开头，虽然不出彩，但是很自然，容易被人接受，接着往下听。<br>“让我想起他们那双无助的眼。”这里，“他们”是两个人；“那双”眼睛虽然是复数，但落实到人，却是单数。因此，这是一个小错误。<br>很显然，用相同性质的词语直接替换是不行的，譬如“四只”。四，数量较多，会分散受众的注意力，让受众去思考为什么是四。因而，如果硬要改的话，只能用其它性质的词语去替换，譬如“彷徨”。<br>但“彷徨无助”，又稍显生僻，会影响听者的接受速度，形成不怎么大的接受障碍。而如果也用“无”的话，无什么呢？无神？听上去，岂不是比“彷徨无助”更不容易分辨。<br>所以，实在要改，就只能把“他们”二字挪到这儿。<br>那样一来，“让我想起”就要掺进两个水字了，譬如“风儿让我想起”。<br>是不是太水了？<br>于是，我最终感觉，还是不改为好。<br>小错误嘛，存在也无妨。这就像文豪写书法一样，多一点少一点，多一笔少一笑，根本不算错误，关键是，那个字不能被错认为是别的字。<br>“那双无助的眼”也一样，虽然存在小错误，但由于不影响表达内容，听者一听，就知道是怎么回事。由于没有影响信息传递，所以不改也是行的。</p><p>“就在那美丽风景相伴的地方，我听到一声巨响震彻山谷。”这两小句，没有基础毛病。<br>值得注意的是，这两小句，存在一个对比：一个美丽的地方，一件悲惨的事。颇有一种把美好的事情撕烂了给读者看的悲剧色彩。</p><p>“就是那个秋天，再看不到爸爸的脸。”<br>为什么提到爸爸没提到妈妈？爸爸妈妈，可以一起提，也可以先后提。这里，实际上是先后提。先提爸爸，后面会提到妈妈。<br>先提爸爸，又比先提妈妈要好。这是因为，时至今日，最不令人怀疑的，是父女情。虽然背景事件中，那是个儿子，但韩红是女的，唱出来的声音又带有明显的女性特征。女声，提到爸爸，无形中，就相当于女儿提到爸爸。其中的感情，就往父女情的方向靠近了那么一点，让听者一下就能接受，丝毫没有怀疑。<br>“他用他的双肩，托起我重生的起点。”<br>背景事件的具体经过，可能生还的当事人都已经记不清楚了。这一句，属于带有归纳性、比拟性的描述。因而不需要因为“用”“双肩托起”，去询问是不是父亲从洪水中救起了儿子那样的细节。<br>“黑暗中泪水沾满了双眼，”<br>“黑暗中”很妙。只描述了环境，没有指明时间。那其实表达的是，若干个“黑暗中”。包括当时，也包括事后。并且，“黑暗”有天然的，也有人为的。天然的，譬如天黑加停电；人为的，譬如钻进被窝里。这些，都被包括了进去。<br>“不要离开、不要伤害。”这句，就有些难度了。<br>“不要离开”好理解。可以是儿子对父母的呼唤。但“不要伤害”呢？<br>“不要伤害”，到底是谁对谁发出的呐喊，后面再讲。</p><p>“我看到爸爸妈妈就这么走远，留下我在这陌生的人世间。不知道未来还会有什么风险。”<br>三小句，基础上没毛病。直接看上去，字面意思表达能力似乎稍弱。真是不是，后面再说。<br>“我想要紧紧抓住他的手”中的“他”，指父亲，也可以指母亲。<br>“妈妈告诉我希望还会有。看到太阳出来妈妈笑了。”这是绝望中的回忆。这一家人，以前也是经受过苦难的。在曾经难熬的岁月中，妈妈曾经多次鼓励过儿子。鼓励的时候，有直述“告诉我希望还会有”，也有以身作则“看到太阳出来，妈妈笑了”。</p><p>“天亮了。”尽在不言中，就不再讲了。</p><p>“这是一个夜晚天上宿星点点，我在梦里看见我的妈妈。”<br>继“那是”之后，此处出现了“这是”。表示已经是事后，灾难之后。<br>“一个人在世上要学会坚强”，很明显，这不是儿子对父母能够说出的话。<br>结合前一小句“我在梦里看见我的妈妈”，可以发现，这是妈妈对儿子说的话。并且还是死去之后的妈妈对儿子所说的话。<br>“我在梦里看见我的妈妈。一个人在世上要学会坚强”紧接着的两句，主语变了。前一句是“我”，后一句是“妈妈”。同时，又因为死去的人继续说话这一违反科学常理的设定，使得后一句主语“妈妈”变得有些难以理解。<br>其实，受众的心，也是强大的。多听两遍，也还是能够理解的。<br>这两句主语的变化，从玄学的角度看，简单。但从文学的角度看，跳跃就非常大了。</p><p>唐/李白有句：“千里江陵一日还”。“千里江陵”说的是千里之外的江陵。站在什么地方能够说出此话，自然是白帝城。“还”，指回来，站在什么地方能够说“还”，当然只能是江陵。就这么一句，视角就从白帝城跳到了江陵。<br>《天亮了》中，这两句紧挨着的歌词的主语跳跃，其实跟“千里江陵一日还”的视角跳跃，是相似的类型。</p><p>“你不要离开不要伤害”上一段出现过，就不讲了。</p><p>“我看到爸爸妈妈就这么走远，留下我在这陌生的人世间。我愿为他建造一个美丽的花园。”<br>比较上一段，区别的，是第三小句。此处的第三小句，从陈述中跳脱出来了，相当于插入了一个事后的心愿。</p><p>“我想要紧紧抓住他的手。妈妈告诉我希望还会有，看到太阳出来、天亮了。”<br>比较上一段，区别的仍然是第三小句。“妈妈笑了”变成“天亮了”。但此处的“天亮了”，跟前面不一样，并不是起承转合的合，不是收尾，而就是一个简单的陈述，其实质，就相当于“妈妈笑了”。</p><p>“我看到爸爸妈妈就这么走远，留下我在这陌生的人世间。我愿为他建造一个美丽的花园。<br>“我想要紧紧抓住他的手。妈妈告诉我希望还会有。看到太阳出来，他们笑了。”<br>重复，强调，加倍。略有不同的，就是“妈妈笑了”变成“他们笑了”。由“妈妈”变成“他们”，实际上也在告诉受众，马上就要收尾了。<br>以什么收尾，收到哪里呢？依然还是“天亮了”，尽在不言中，让受众自己去想，</p><p>不知道是哪年哪天了，无意中，我就这么偶然听到了这首歌。<br>一听，就感受很好听。<br>一听，就听出来了，里面讲述了一场事故。因为有“我听到一声巨响震彻山谷”、“再看不到爸爸的脸”。<br>另外，还听出了事故中，父母对孩子的救助。因为有“他用他的双肩托起我重生的起点”。<br>很明显，事故是悲惨的，事故中的父母是可歌可泣的，事故之后的儿子或女儿（从歌词中听不出孩子的性别）是可怜的。<br>但是，就这么算了么？<br>这么好听的歌，最后一句“天亮了”到底表述的是怎样的感情？<br>没弄清楚，怎么能算完。</p><p>生活中，有各种各样的事故。最常见的，恐怕应该是车祸。<br>车祸事故，几乎每天都能够在地方新闻上看到。<br>看到车祸事故的新闻，心中有什么感受？<br>悲伤么？自然没有。<br>一般来说，亲人，才会悲伤。陌生人，通常只是略带同情、怜悯。<br>此处说的是，同样的事，因为自身角度的不同，感受大不相同。<br>那么，《天亮了》应该站在什么样的角度去欣赏呢？</p><p>最容易想到的角度，有两个。<br>一是生还的儿子或女儿。但是，站在这个角度欣赏，“我看到爸爸妈妈就这么走远，留下我在这陌生的人世间，不知道未来还会有什么风险。”真的弱爆了。<br>另一个角度，则是富有同情心的旁观善良人士。这个角度的存在，是因为韩红。因为，就这么看过去，韩红，对于此次事故，似乎就是富有同情心的旁观善良人士。<br>但这个角度还是不行。“黑暗中泪水沾满了双眼”，没什么感觉。<br>于是乎，就剩下了不常见的角度——死去父母的角度！<br>我试着想象了这样的角度，再听《天亮了》，眼泪一下子就出来了。<br>我是在这之后，才搜索得知了《天亮了》的创作背景。</p><p>是的，韩红，把自己当作那个孩子的父母，并且还把自己当作了孩子死去的父母。《天亮了》这首歌，表达的是死者对生者的寄托！<br>重新再看歌词。“黑暗中泪水沾满了双眼”，所指的，就不仅仅是事后孩子多次在被窝里痛哭，并且还指死去的父母在地狱中带泪含悲。<br>“不要离开”，只是孩子对父母的呼唤么？已然不是。以父母为参照物，生存的孩子，又何尝不是一种离开。<br>当然不是说想要孩子一起死，否则就不会用双肩托起重生的起点了。<br>“不要伤害”的答案，此时就出来了。那就是死去的父母发出的呐喊。呐喊的对象是天地——老天爷，不要伤害我们的孩子！<br>“一个人在世上要学会坚强”不再是父母对自己的叮嘱，而是自己，对自己幸存的子女的叮嘱。<br>于是乎，最后一句合中的“天亮了”，就表达了深深的无奈。<br>天亮了，通常指清晨，代表的是希望。但是，对于死者来说，天亮了，就代表魂魄状态的死者必须离开。<br>这是自然规律，死者必须离开。不想离开，也必须离开。因为——天亮了。<br>难怪韩红唱这三个字的时候，泣不成声。</p><p>题外话又冒出来了。<br>我曾经进行过无数次评论。有那么一个人，曾经对于我的少部分评论非常不服。那就是，关于李白的诗的评论。<br>他认为，一件事物，可以从好坏两方面去说。他认为，李白的诗，就像打油诗，水平并不高。只是因为我的评论，才变得水平绝高了。<br>具体的说法就是，我先假定李诗水平绝高，然后往去往绝高的方向分析。<br>我的确也是这样做的。<br>但是，别人的诗，也可以假定为水平绝高啊，难道说真的就能分析出水平绝高来吗？<br>譬如杜甫的“三顾频烦天下计”。“顾频烦”三字的“页”旁，看不见吗？不擅书法，才会视而不见，所以杜甫不擅书法。是“频烦天下计”么？明明就只烦了一次。次数相对较多的，反而是“顾”，顾了三次。于是这句应该读成“三顾频、烦天下计”。这水平还怎么绝高呢？<br>相似的例子还有很多。无论是谁的作品，都能事先假定为水平绝高。但只有李白的诗，才会真的分析出水平绝高的答案出来。<br>所以，李诗的水平，是真的绝高。</p><p>这番题外话，表达的是，前面关于《天亮了》的评论，或许韩红自己并没那么想，或者韩红没想那么多，或许《天亮了》就仅仅是韩红的偶然之得。<br>我要说的是，《天亮了》既然已经成为作品，那么它就脱离了作者韩红，变成了一种独立的存在。不能因为韩红的文学水平不够高，而去否认《天亮了》的文学成就。<br>我的确是抱着欣赏的态度，先假定《天亮了》文学水平很高，然后真往极高文学水平的方向去分析的。但是很幸运，我得出了《天亮了》文学水平果然很高的结论。<br>换首别的歌，行吗？<br>谁说行，谁上。</p><p>最后，我还要说的是，文学水平，所指的，并不仅仅是文字方面的能力。<br>在打基础的时候，在斟酌字词句，在训练表达力、说服力的阶段，的确单指文字方面。<br>但是，在跨入感染力阶段之后，就不是了。<br>更多的，是提高心性。<br>心性高了，视角就不同了，感受也随之不同了，不管是写出来的作品，还是唱出来的歌，那都是不同的。<br>很多人说邓丽君的演唱水平并不高，那是不对的。应该说，邓丽君的演唱水平，其实很多人都达到过。个别的，譬如韩红，偶尔还超越过。<br>但是，为什么邓丽君流传下来的歌曲就那么多呢？其他歌者流传下来的歌就那么少呢？<br>就是因为心性。<br>心性与感染力关系，最容易明白的例子，就是翻唱。<br>《何日君在来》、《船歌》在邓丽君翻唱之前，并不好听，结果邓丽君一唱，就化腐朽为神奇了。<br>恰好，韩红也有过化腐朽为神奇的表现，譬如《妹妹找哥泪花流》、《天之大》（可搜）。<br>心性如此之高的韩红，偶得《天亮了》极高文学水准的作品，就是正常的了。</p><p>（全文完）</p><link rel="stylesheet" href="/css/bilicard.css" type="text/css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="music" scheme="https://blog.17lai.site/categories/music/"/>
    
    
    <category term="music" scheme="https://blog.17lai.site/tags/music/"/>
    
    <category term="韩红" scheme="https://blog.17lai.site/tags/%E9%9F%A9%E7%BA%A2/"/>
    
  </entry>
  
</feed>
